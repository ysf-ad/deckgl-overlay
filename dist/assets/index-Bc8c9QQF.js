import"https://visgl.github.io/react-google-maps/scripts/examples.js";function cE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();function _l(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d0={exports:{}},Y={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qs=Symbol.for("react.element"),fE=Symbol.for("react.portal"),hE=Symbol.for("react.fragment"),dE=Symbol.for("react.strict_mode"),gE=Symbol.for("react.profiler"),pE=Symbol.for("react.provider"),mE=Symbol.for("react.context"),yE=Symbol.for("react.forward_ref"),vE=Symbol.for("react.suspense"),_E=Symbol.for("react.memo"),EE=Symbol.for("react.lazy"),Fd=Symbol.iterator;function wE(t){return t===null||typeof t!="object"?null:(t=Fd&&t[Fd]||t["@@iterator"],typeof t=="function"?t:null)}var g0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p0=Object.assign,m0={};function Ci(t,e,n){this.props=t,this.context=e,this.refs=m0,this.updater=n||g0}Ci.prototype.isReactComponent={};Ci.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Ci.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function y0(){}y0.prototype=Ci.prototype;function Df(t,e,n){this.props=t,this.context=e,this.refs=m0,this.updater=n||g0}var zf=Df.prototype=new y0;zf.constructor=Df;p0(zf,Ci.prototype);zf.isPureReactComponent=!0;var Dd=Array.isArray,v0=Object.prototype.hasOwnProperty,Bf={current:null},_0={key:!0,ref:!0,__self:!0,__source:!0};function E0(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)v0.call(e,r)&&!_0.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:qs,type:t,key:s,ref:o,props:i,_owner:Bf.current}}function TE(t,e){return{$$typeof:qs,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Uf(t){return typeof t=="object"&&t!==null&&t.$$typeof===qs}function bE(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var zd=/\/+/g;function tu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?bE(""+t.key):e.toString(36)}function ua(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case qs:case fE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+tu(o,0):r,Dd(i)?(n="",t!=null&&(n=t.replace(zd,"$&/")+"/"),ua(i,e,n,"",function(u){return u})):i!=null&&(Uf(i)&&(i=TE(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(zd,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Dd(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+tu(s,a);o+=ua(s,e,n,l,i)}else if(l=wE(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+tu(s,a++),o+=ua(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Ao(t,e,n){if(t==null)return t;var r=[],i=0;return ua(t,r,"","",function(s){return e.call(n,s,i++)}),r}function xE(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var He={current:null},ca={transition:null},SE={ReactCurrentDispatcher:He,ReactCurrentBatchConfig:ca,ReactCurrentOwner:Bf};function w0(){throw Error("act(...) is not supported in production builds of React.")}Y.Children={map:Ao,forEach:function(t,e,n){Ao(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Ao(t,function(){e++}),e},toArray:function(t){return Ao(t,function(e){return e})||[]},only:function(t){if(!Uf(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Y.Component=Ci;Y.Fragment=hE;Y.Profiler=gE;Y.PureComponent=Df;Y.StrictMode=dE;Y.Suspense=vE;Y.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SE;Y.act=w0;Y.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=p0({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=Bf.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)v0.call(e,l)&&!_0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];r.children=a}return{$$typeof:qs,type:t.type,key:i,ref:s,props:r,_owner:o}};Y.createContext=function(t){return t={$$typeof:mE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:pE,_context:t},t.Consumer=t};Y.createElement=E0;Y.createFactory=function(t){var e=E0.bind(null,t);return e.type=t,e};Y.createRef=function(){return{current:null}};Y.forwardRef=function(t){return{$$typeof:yE,render:t}};Y.isValidElement=Uf;Y.lazy=function(t){return{$$typeof:EE,_payload:{_status:-1,_result:t},_init:xE}};Y.memo=function(t,e){return{$$typeof:_E,type:t,compare:e===void 0?null:e}};Y.startTransition=function(t){var e=ca.transition;ca.transition={};try{t()}finally{ca.transition=e}};Y.unstable_act=w0;Y.useCallback=function(t,e){return He.current.useCallback(t,e)};Y.useContext=function(t){return He.current.useContext(t)};Y.useDebugValue=function(){};Y.useDeferredValue=function(t){return He.current.useDeferredValue(t)};Y.useEffect=function(t,e){return He.current.useEffect(t,e)};Y.useId=function(){return He.current.useId()};Y.useImperativeHandle=function(t,e,n){return He.current.useImperativeHandle(t,e,n)};Y.useInsertionEffect=function(t,e){return He.current.useInsertionEffect(t,e)};Y.useLayoutEffect=function(t,e){return He.current.useLayoutEffect(t,e)};Y.useMemo=function(t,e){return He.current.useMemo(t,e)};Y.useReducer=function(t,e,n){return He.current.useReducer(t,e,n)};Y.useRef=function(t){return He.current.useRef(t)};Y.useState=function(t){return He.current.useState(t)};Y.useSyncExternalStore=function(t,e,n){return He.current.useSyncExternalStore(t,e,n)};Y.useTransition=function(){return He.current.useTransition()};Y.version="18.3.1";d0.exports=Y;var k=d0.exports;const ee=_l(k);var T0={exports:{}},ft={},b0={exports:{}},x0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(D,G){var W=D.length;D.push(G);e:for(;0<W;){var ue=W-1>>>1,ae=D[ue];if(0<i(ae,G))D[ue]=G,D[W]=ae,W=ue;else break e}}function n(D){return D.length===0?null:D[0]}function r(D){if(D.length===0)return null;var G=D[0],W=D.pop();if(W!==G){D[0]=W;e:for(var ue=0,ae=D.length,kr=ae>>>1;ue<kr;){var xt=2*(ue+1)-1,ki=D[xt],Jt=xt+1,ye=D[Jt];if(0>i(ki,W))Jt<ae&&0>i(ye,ki)?(D[ue]=ye,D[Jt]=W,ue=Jt):(D[ue]=ki,D[xt]=W,ue=xt);else if(Jt<ae&&0>i(ye,W))D[ue]=ye,D[Jt]=W,ue=Jt;else break e}}return G}function i(D,G){var W=D.sortIndex-G.sortIndex;return W!==0?W:D.id-G.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],u=[],c=1,f=null,h=3,d=!1,p=!1,E=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(D){for(var G=n(u);G!==null;){if(G.callback===null)r(u);else if(G.startTime<=D)r(u),G.sortIndex=G.expirationTime,e(l,G);else break;G=n(u)}}function T(D){if(E=!1,_(D),!p)if(n(l)!==null)p=!0,Ri(S);else{var G=n(u);G!==null&&Rr(T,G.startTime-D)}}function S(D,G){p=!1,E&&(E=!1,y(C),C=-1),d=!0;var W=h;try{for(_(G),f=n(l);f!==null&&(!(f.expirationTime>G)||D&&!B());){var ue=f.callback;if(typeof ue=="function"){f.callback=null,h=f.priorityLevel;var ae=ue(f.expirationTime<=G);G=t.unstable_now(),typeof ae=="function"?f.callback=ae:f===n(l)&&r(l),_(G)}else r(l);f=n(l)}if(f!==null)var kr=!0;else{var xt=n(u);xt!==null&&Rr(T,xt.startTime-G),kr=!1}return kr}finally{f=null,h=W,d=!1}}var P=!1,L=null,C=-1,I=5,M=-1;function B(){return!(t.unstable_now()-M<I)}function V(){if(L!==null){var D=t.unstable_now();M=D;var G=!0;try{G=L(!0,D)}finally{G?j():(P=!1,L=null)}}else P=!1}var j;if(typeof m=="function")j=function(){m(V)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,bt=Z.port2;Z.port1.onmessage=V,j=function(){bt.postMessage(null)}}else j=function(){b(V,0)};function Ri(D){L=D,P||(P=!0,j())}function Rr(D,G){C=b(function(){D(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(D){D.callback=null},t.unstable_continueExecution=function(){p||d||(p=!0,Ri(S))},t.unstable_forceFrameRate=function(D){0>D||125<D?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):I=0<D?Math.floor(1e3/D):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(D){switch(h){case 1:case 2:case 3:var G=3;break;default:G=h}var W=h;h=G;try{return D()}finally{h=W}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(D,G){switch(D){case 1:case 2:case 3:case 4:case 5:break;default:D=3}var W=h;h=D;try{return G()}finally{h=W}},t.unstable_scheduleCallback=function(D,G,W){var ue=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ue+W:ue):W=ue,D){case 1:var ae=-1;break;case 2:ae=250;break;case 5:ae=1073741823;break;case 4:ae=1e4;break;default:ae=5e3}return ae=W+ae,D={id:c++,callback:G,priorityLevel:D,startTime:W,expirationTime:ae,sortIndex:-1},W>ue?(D.sortIndex=W,e(u,D),n(l)===null&&D===n(u)&&(E?(y(C),C=-1):E=!0,Rr(T,W-ue))):(D.sortIndex=ae,e(l,D),p||d||(p=!0,Ri(S))),D},t.unstable_shouldYield=B,t.unstable_wrapCallback=function(D){var G=h;return function(){var W=h;h=G;try{return D.apply(this,arguments)}finally{h=W}}}})(x0);b0.exports=x0;var PE=b0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AE=k,ut=PE;function R(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var S0=new Set,bs={};function Lr(t,e){gi(t,e),gi(t+"Capture",e)}function gi(t,e){for(bs[t]=e,t=0;t<e.length;t++)S0.add(e[t])}var fn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),fc=Object.prototype.hasOwnProperty,LE=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bd={},Ud={};function CE(t){return fc.call(Ud,t)?!0:fc.call(Bd,t)?!1:LE.test(t)?Ud[t]=!0:(Bd[t]=!0,!1)}function IE(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ME(t,e,n,r){if(e===null||typeof e>"u"||IE(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xe(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Re={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Re[t]=new Xe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Re[e]=new Xe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Re[t]=new Xe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Re[t]=new Xe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Re[t]=new Xe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Re[t]=new Xe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Re[t]=new Xe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Re[t]=new Xe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Re[t]=new Xe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Vf=/[\-:]([a-z])/g;function jf(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Vf,jf);Re[e]=new Xe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Vf,jf);Re[e]=new Xe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Vf,jf);Re[e]=new Xe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Re[t]=new Xe(t,1,!1,t.toLowerCase(),null,!1,!1)});Re.xlinkHref=new Xe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Re[t]=new Xe(t,1,!1,t.toLowerCase(),null,!0,!0)});function Gf(t,e,n,r){var i=Re.hasOwnProperty(e)?Re[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ME(e,n,i,r)&&(n=null),r||i===null?CE(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var yn=AE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Lo=Symbol.for("react.element"),Wr=Symbol.for("react.portal"),Hr=Symbol.for("react.fragment"),Wf=Symbol.for("react.strict_mode"),hc=Symbol.for("react.profiler"),P0=Symbol.for("react.provider"),A0=Symbol.for("react.context"),Hf=Symbol.for("react.forward_ref"),dc=Symbol.for("react.suspense"),gc=Symbol.for("react.suspense_list"),Xf=Symbol.for("react.memo"),Ln=Symbol.for("react.lazy"),L0=Symbol.for("react.offscreen"),Vd=Symbol.iterator;function ji(t){return t===null||typeof t!="object"?null:(t=Vd&&t[Vd]||t["@@iterator"],typeof t=="function"?t:null)}var de=Object.assign,nu;function rs(t){if(nu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);nu=e&&e[1]||""}return`
`+nu+t}var ru=!1;function iu(t,e){if(!t||ru)return"";ru=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var r=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){r=u}t.call(e.prototype)}else{try{throw Error()}catch(u){r=u}t()}}catch(u){if(u&&r&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{ru=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?rs(t):""}function OE(t){switch(t.tag){case 5:return rs(t.type);case 16:return rs("Lazy");case 13:return rs("Suspense");case 19:return rs("SuspenseList");case 0:case 2:case 15:return t=iu(t.type,!1),t;case 11:return t=iu(t.type.render,!1),t;case 1:return t=iu(t.type,!0),t;default:return""}}function pc(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Hr:return"Fragment";case Wr:return"Portal";case hc:return"Profiler";case Wf:return"StrictMode";case dc:return"Suspense";case gc:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case A0:return(t.displayName||"Context")+".Consumer";case P0:return(t._context.displayName||"Context")+".Provider";case Hf:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Xf:return e=t.displayName||null,e!==null?e:pc(t.type)||"Memo";case Ln:e=t._payload,t=t._init;try{return pc(t(e))}catch{}}return null}function RE(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return pc(e);case 8:return e===Wf?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Yn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function C0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function kE(t){var e=C0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Co(t){t._valueTracker||(t._valueTracker=kE(t))}function I0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=C0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ra(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function mc(t,e){var n=e.checked;return de({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function jd(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Yn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function M0(t,e){e=e.checked,e!=null&&Gf(t,"checked",e,!1)}function yc(t,e){M0(t,e);var n=Yn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?vc(t,e.type,n):e.hasOwnProperty("defaultValue")&&vc(t,e.type,Yn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Gd(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function vc(t,e,n){(e!=="number"||Ra(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var is=Array.isArray;function si(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Yn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function _c(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(R(91));return de({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Wd(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(R(92));if(is(n)){if(1<n.length)throw Error(R(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Yn(n)}}function O0(t,e){var n=Yn(e.value),r=Yn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Hd(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function R0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ec(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?R0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Io,k0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Io=Io||document.createElement("div"),Io.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Io.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function xs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var cs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NE=["Webkit","ms","Moz","O"];Object.keys(cs).forEach(function(t){NE.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),cs[e]=cs[t]})});function N0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||cs.hasOwnProperty(t)&&cs[t]?(""+e).trim():e+"px"}function F0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=N0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var FE=de({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function wc(t,e){if(e){if(FE[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(R(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(R(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(R(61))}if(e.style!=null&&typeof e.style!="object")throw Error(R(62))}}function Tc(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var bc=null;function Yf(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var xc=null,oi=null,ai=null;function Xd(t){if(t=eo(t)){if(typeof xc!="function")throw Error(R(280));var e=t.stateNode;e&&(e=xl(e),xc(t.stateNode,t.type,e))}}function D0(t){oi?ai?ai.push(t):ai=[t]:oi=t}function z0(){if(oi){var t=oi,e=ai;if(ai=oi=null,Xd(t),e)for(t=0;t<e.length;t++)Xd(e[t])}}function B0(t,e){return t(e)}function U0(){}var su=!1;function V0(t,e,n){if(su)return t(e,n);su=!0;try{return B0(t,e,n)}finally{su=!1,(oi!==null||ai!==null)&&(U0(),z0())}}function Ss(t,e){var n=t.stateNode;if(n===null)return null;var r=xl(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(R(231,e,typeof n));return n}var Sc=!1;if(fn)try{var Gi={};Object.defineProperty(Gi,"passive",{get:function(){Sc=!0}}),window.addEventListener("test",Gi,Gi),window.removeEventListener("test",Gi,Gi)}catch{Sc=!1}function DE(t,e,n,r,i,s,o,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(n,u)}catch(c){this.onError(c)}}var fs=!1,ka=null,Na=!1,Pc=null,zE={onError:function(t){fs=!0,ka=t}};function BE(t,e,n,r,i,s,o,a,l){fs=!1,ka=null,DE.apply(zE,arguments)}function UE(t,e,n,r,i,s,o,a,l){if(BE.apply(this,arguments),fs){if(fs){var u=ka;fs=!1,ka=null}else throw Error(R(198));Na||(Na=!0,Pc=u)}}function Cr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function j0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Yd(t){if(Cr(t)!==t)throw Error(R(188))}function VE(t){var e=t.alternate;if(!e){if(e=Cr(t),e===null)throw Error(R(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Yd(i),t;if(s===r)return Yd(i),e;s=s.sibling}throw Error(R(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(R(189))}}if(n.alternate!==r)throw Error(R(190))}if(n.tag!==3)throw Error(R(188));return n.stateNode.current===n?t:e}function G0(t){return t=VE(t),t!==null?W0(t):null}function W0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=W0(t);if(e!==null)return e;t=t.sibling}return null}var H0=ut.unstable_scheduleCallback,$d=ut.unstable_cancelCallback,jE=ut.unstable_shouldYield,GE=ut.unstable_requestPaint,me=ut.unstable_now,WE=ut.unstable_getCurrentPriorityLevel,$f=ut.unstable_ImmediatePriority,X0=ut.unstable_UserBlockingPriority,Fa=ut.unstable_NormalPriority,HE=ut.unstable_LowPriority,Y0=ut.unstable_IdlePriority,El=null,Zt=null;function XE(t){if(Zt&&typeof Zt.onCommitFiberRoot=="function")try{Zt.onCommitFiberRoot(El,t,void 0,(t.current.flags&128)===128)}catch{}}var Ot=Math.clz32?Math.clz32:ZE,YE=Math.log,$E=Math.LN2;function ZE(t){return t>>>=0,t===0?32:31-(YE(t)/$E|0)|0}var Mo=64,Oo=4194304;function ss(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Da(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=ss(a):(s&=o,s!==0&&(r=ss(s)))}else o=n&~i,o!==0?r=ss(o):s!==0&&(r=ss(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Ot(e),i=1<<n,r|=t[n],e&=~i;return r}function KE(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qE(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Ot(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=KE(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Ac(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function $0(){var t=Mo;return Mo<<=1,!(Mo&4194240)&&(Mo=64),t}function ou(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Qs(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Ot(e),t[e]=n}function QE(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Ot(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Zf(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Ot(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Q=0;function Z0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var K0,Kf,q0,Q0,J0,Lc=!1,Ro=[],Dn=null,zn=null,Bn=null,Ps=new Map,As=new Map,In=[],JE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Zd(t,e){switch(t){case"focusin":case"focusout":Dn=null;break;case"dragenter":case"dragleave":zn=null;break;case"mouseover":case"mouseout":Bn=null;break;case"pointerover":case"pointerout":Ps.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":As.delete(e.pointerId)}}function Wi(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=eo(e),e!==null&&Kf(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function ew(t,e,n,r,i){switch(e){case"focusin":return Dn=Wi(Dn,t,e,n,r,i),!0;case"dragenter":return zn=Wi(zn,t,e,n,r,i),!0;case"mouseover":return Bn=Wi(Bn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Ps.set(s,Wi(Ps.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,As.set(s,Wi(As.get(s)||null,t,e,n,r,i)),!0}return!1}function ey(t){var e=ur(t.target);if(e!==null){var n=Cr(e);if(n!==null){if(e=n.tag,e===13){if(e=j0(n),e!==null){t.blockedOn=e,J0(t.priority,function(){q0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function fa(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Cc(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);bc=r,n.target.dispatchEvent(r),bc=null}else return e=eo(n),e!==null&&Kf(e),t.blockedOn=n,!1;e.shift()}return!0}function Kd(t,e,n){fa(t)&&n.delete(e)}function tw(){Lc=!1,Dn!==null&&fa(Dn)&&(Dn=null),zn!==null&&fa(zn)&&(zn=null),Bn!==null&&fa(Bn)&&(Bn=null),Ps.forEach(Kd),As.forEach(Kd)}function Hi(t,e){t.blockedOn===e&&(t.blockedOn=null,Lc||(Lc=!0,ut.unstable_scheduleCallback(ut.unstable_NormalPriority,tw)))}function Ls(t){function e(i){return Hi(i,t)}if(0<Ro.length){Hi(Ro[0],t);for(var n=1;n<Ro.length;n++){var r=Ro[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Dn!==null&&Hi(Dn,t),zn!==null&&Hi(zn,t),Bn!==null&&Hi(Bn,t),Ps.forEach(e),As.forEach(e),n=0;n<In.length;n++)r=In[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<In.length&&(n=In[0],n.blockedOn===null);)ey(n),n.blockedOn===null&&In.shift()}var li=yn.ReactCurrentBatchConfig,za=!0;function nw(t,e,n,r){var i=Q,s=li.transition;li.transition=null;try{Q=1,qf(t,e,n,r)}finally{Q=i,li.transition=s}}function rw(t,e,n,r){var i=Q,s=li.transition;li.transition=null;try{Q=4,qf(t,e,n,r)}finally{Q=i,li.transition=s}}function qf(t,e,n,r){if(za){var i=Cc(t,e,n,r);if(i===null)mu(t,e,r,Ba,n),Zd(t,r);else if(ew(i,t,e,n,r))r.stopPropagation();else if(Zd(t,r),e&4&&-1<JE.indexOf(t)){for(;i!==null;){var s=eo(i);if(s!==null&&K0(s),s=Cc(t,e,n,r),s===null&&mu(t,e,r,Ba,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else mu(t,e,r,null,n)}}var Ba=null;function Cc(t,e,n,r){if(Ba=null,t=Yf(r),t=ur(t),t!==null)if(e=Cr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=j0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ba=t,null}function ty(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WE()){case $f:return 1;case X0:return 4;case Fa:case HE:return 16;case Y0:return 536870912;default:return 16}default:return 16}}var On=null,Qf=null,ha=null;function ny(){if(ha)return ha;var t,e=Qf,n=e.length,r,i="value"in On?On.value:On.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return ha=i.slice(t,1<r?1-r:void 0)}function da(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ko(){return!0}function qd(){return!1}function ht(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ko:qd,this.isPropagationStopped=qd,this}return de(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ko)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ko)},persist:function(){},isPersistent:ko}),e}var Ii={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Jf=ht(Ii),Js=de({},Ii,{view:0,detail:0}),iw=ht(Js),au,lu,Xi,wl=de({},Js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:eh,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Xi&&(Xi&&t.type==="mousemove"?(au=t.screenX-Xi.screenX,lu=t.screenY-Xi.screenY):lu=au=0,Xi=t),au)},movementY:function(t){return"movementY"in t?t.movementY:lu}}),Qd=ht(wl),sw=de({},wl,{dataTransfer:0}),ow=ht(sw),aw=de({},Js,{relatedTarget:0}),uu=ht(aw),lw=de({},Ii,{animationName:0,elapsedTime:0,pseudoElement:0}),uw=ht(lw),cw=de({},Ii,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),fw=ht(cw),hw=de({},Ii,{data:0}),Jd=ht(hw),dw={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},gw={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pw={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function mw(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=pw[t])?!!e[t]:!1}function eh(){return mw}var yw=de({},Js,{key:function(t){if(t.key){var e=dw[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=da(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?gw[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:eh,charCode:function(t){return t.type==="keypress"?da(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?da(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),vw=ht(yw),_w=de({},wl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),eg=ht(_w),Ew=de({},Js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:eh}),ww=ht(Ew),Tw=de({},Ii,{propertyName:0,elapsedTime:0,pseudoElement:0}),bw=ht(Tw),xw=de({},wl,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Sw=ht(xw),Pw=[9,13,27,32],th=fn&&"CompositionEvent"in window,hs=null;fn&&"documentMode"in document&&(hs=document.documentMode);var Aw=fn&&"TextEvent"in window&&!hs,ry=fn&&(!th||hs&&8<hs&&11>=hs),tg=" ",ng=!1;function iy(t,e){switch(t){case"keyup":return Pw.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sy(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Xr=!1;function Lw(t,e){switch(t){case"compositionend":return sy(e);case"keypress":return e.which!==32?null:(ng=!0,tg);case"textInput":return t=e.data,t===tg&&ng?null:t;default:return null}}function Cw(t,e){if(Xr)return t==="compositionend"||!th&&iy(t,e)?(t=ny(),ha=Qf=On=null,Xr=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return ry&&e.locale!=="ko"?null:e.data;default:return null}}var Iw={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Iw[t.type]:e==="textarea"}function oy(t,e,n,r){D0(r),e=Ua(e,"onChange"),0<e.length&&(n=new Jf("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var ds=null,Cs=null;function Mw(t){yy(t,0)}function Tl(t){var e=Zr(t);if(I0(e))return t}function Ow(t,e){if(t==="change")return e}var ay=!1;if(fn){var cu;if(fn){var fu="oninput"in document;if(!fu){var ig=document.createElement("div");ig.setAttribute("oninput","return;"),fu=typeof ig.oninput=="function"}cu=fu}else cu=!1;ay=cu&&(!document.documentMode||9<document.documentMode)}function sg(){ds&&(ds.detachEvent("onpropertychange",ly),Cs=ds=null)}function ly(t){if(t.propertyName==="value"&&Tl(Cs)){var e=[];oy(e,Cs,t,Yf(t)),V0(Mw,e)}}function Rw(t,e,n){t==="focusin"?(sg(),ds=e,Cs=n,ds.attachEvent("onpropertychange",ly)):t==="focusout"&&sg()}function kw(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Tl(Cs)}function Nw(t,e){if(t==="click")return Tl(e)}function Fw(t,e){if(t==="input"||t==="change")return Tl(e)}function Dw(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Nt=typeof Object.is=="function"?Object.is:Dw;function Is(t,e){if(Nt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!fc.call(e,i)||!Nt(t[i],e[i]))return!1}return!0}function og(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function ag(t,e){var n=og(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=og(n)}}function uy(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?uy(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function cy(){for(var t=window,e=Ra();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ra(t.document)}return e}function nh(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function zw(t){var e=cy(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&uy(n.ownerDocument.documentElement,n)){if(r!==null&&nh(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=ag(n,s);var o=ag(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Bw=fn&&"documentMode"in document&&11>=document.documentMode,Yr=null,Ic=null,gs=null,Mc=!1;function lg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Mc||Yr==null||Yr!==Ra(r)||(r=Yr,"selectionStart"in r&&nh(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),gs&&Is(gs,r)||(gs=r,r=Ua(Ic,"onSelect"),0<r.length&&(e=new Jf("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Yr)))}function No(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var $r={animationend:No("Animation","AnimationEnd"),animationiteration:No("Animation","AnimationIteration"),animationstart:No("Animation","AnimationStart"),transitionend:No("Transition","TransitionEnd")},hu={},fy={};fn&&(fy=document.createElement("div").style,"AnimationEvent"in window||(delete $r.animationend.animation,delete $r.animationiteration.animation,delete $r.animationstart.animation),"TransitionEvent"in window||delete $r.transitionend.transition);function bl(t){if(hu[t])return hu[t];if(!$r[t])return t;var e=$r[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in fy)return hu[t]=e[n];return t}var hy=bl("animationend"),dy=bl("animationiteration"),gy=bl("animationstart"),py=bl("transitionend"),my=new Map,ug="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Kn(t,e){my.set(t,e),Lr(e,[t])}for(var du=0;du<ug.length;du++){var gu=ug[du],Uw=gu.toLowerCase(),Vw=gu[0].toUpperCase()+gu.slice(1);Kn(Uw,"on"+Vw)}Kn(hy,"onAnimationEnd");Kn(dy,"onAnimationIteration");Kn(gy,"onAnimationStart");Kn("dblclick","onDoubleClick");Kn("focusin","onFocus");Kn("focusout","onBlur");Kn(py,"onTransitionEnd");gi("onMouseEnter",["mouseout","mouseover"]);gi("onMouseLeave",["mouseout","mouseover"]);gi("onPointerEnter",["pointerout","pointerover"]);gi("onPointerLeave",["pointerout","pointerover"]);Lr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Lr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Lr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Lr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Lr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Lr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var os="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),jw=new Set("cancel close invalid load scroll toggle".split(" ").concat(os));function cg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,UE(r,e,void 0,t),t.currentTarget=null}function yy(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;cg(i,a,u),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;cg(i,a,u),s=l}}}if(Na)throw t=Pc,Na=!1,Pc=null,t}function ie(t,e){var n=e[Fc];n===void 0&&(n=e[Fc]=new Set);var r=t+"__bubble";n.has(r)||(vy(e,t,2,!1),n.add(r))}function pu(t,e,n){var r=0;e&&(r|=4),vy(n,t,r,e)}var Fo="_reactListening"+Math.random().toString(36).slice(2);function Ms(t){if(!t[Fo]){t[Fo]=!0,S0.forEach(function(n){n!=="selectionchange"&&(jw.has(n)||pu(n,!1,t),pu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Fo]||(e[Fo]=!0,pu("selectionchange",!1,e))}}function vy(t,e,n,r){switch(ty(e)){case 1:var i=nw;break;case 4:i=rw;break;default:i=qf}n=i.bind(null,e,n,t),i=void 0,!Sc||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function mu(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=ur(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}V0(function(){var u=s,c=Yf(n),f=[];e:{var h=my.get(t);if(h!==void 0){var d=Jf,p=t;switch(t){case"keypress":if(da(n)===0)break e;case"keydown":case"keyup":d=vw;break;case"focusin":p="focus",d=uu;break;case"focusout":p="blur",d=uu;break;case"beforeblur":case"afterblur":d=uu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Qd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=ow;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=ww;break;case hy:case dy:case gy:d=uw;break;case py:d=bw;break;case"scroll":d=iw;break;case"wheel":d=Sw;break;case"copy":case"cut":case"paste":d=fw;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=eg}var E=(e&4)!==0,b=!E&&t==="scroll",y=E?h!==null?h+"Capture":null:h;E=[];for(var m=u,_;m!==null;){_=m;var T=_.stateNode;if(_.tag===5&&T!==null&&(_=T,y!==null&&(T=Ss(m,y),T!=null&&E.push(Os(m,T,_)))),b)break;m=m.return}0<E.length&&(h=new d(h,p,null,n,c),f.push({event:h,listeners:E}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",h&&n!==bc&&(p=n.relatedTarget||n.fromElement)&&(ur(p)||p[hn]))break e;if((d||h)&&(h=c.window===c?c:(h=c.ownerDocument)?h.defaultView||h.parentWindow:window,d?(p=n.relatedTarget||n.toElement,d=u,p=p?ur(p):null,p!==null&&(b=Cr(p),p!==b||p.tag!==5&&p.tag!==6)&&(p=null)):(d=null,p=u),d!==p)){if(E=Qd,T="onMouseLeave",y="onMouseEnter",m="mouse",(t==="pointerout"||t==="pointerover")&&(E=eg,T="onPointerLeave",y="onPointerEnter",m="pointer"),b=d==null?h:Zr(d),_=p==null?h:Zr(p),h=new E(T,m+"leave",d,n,c),h.target=b,h.relatedTarget=_,T=null,ur(c)===u&&(E=new E(y,m+"enter",p,n,c),E.target=_,E.relatedTarget=b,T=E),b=T,d&&p)t:{for(E=d,y=p,m=0,_=E;_;_=Fr(_))m++;for(_=0,T=y;T;T=Fr(T))_++;for(;0<m-_;)E=Fr(E),m--;for(;0<_-m;)y=Fr(y),_--;for(;m--;){if(E===y||y!==null&&E===y.alternate)break t;E=Fr(E),y=Fr(y)}E=null}else E=null;d!==null&&fg(f,h,d,E,!1),p!==null&&b!==null&&fg(f,b,p,E,!0)}}e:{if(h=u?Zr(u):window,d=h.nodeName&&h.nodeName.toLowerCase(),d==="select"||d==="input"&&h.type==="file")var S=Ow;else if(rg(h))if(ay)S=Fw;else{S=kw;var P=Rw}else(d=h.nodeName)&&d.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(S=Nw);if(S&&(S=S(t,u))){oy(f,S,n,c);break e}P&&P(t,h,u),t==="focusout"&&(P=h._wrapperState)&&P.controlled&&h.type==="number"&&vc(h,"number",h.value)}switch(P=u?Zr(u):window,t){case"focusin":(rg(P)||P.contentEditable==="true")&&(Yr=P,Ic=u,gs=null);break;case"focusout":gs=Ic=Yr=null;break;case"mousedown":Mc=!0;break;case"contextmenu":case"mouseup":case"dragend":Mc=!1,lg(f,n,c);break;case"selectionchange":if(Bw)break;case"keydown":case"keyup":lg(f,n,c)}var L;if(th)e:{switch(t){case"compositionstart":var C="onCompositionStart";break e;case"compositionend":C="onCompositionEnd";break e;case"compositionupdate":C="onCompositionUpdate";break e}C=void 0}else Xr?iy(t,n)&&(C="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(C="onCompositionStart");C&&(ry&&n.locale!=="ko"&&(Xr||C!=="onCompositionStart"?C==="onCompositionEnd"&&Xr&&(L=ny()):(On=c,Qf="value"in On?On.value:On.textContent,Xr=!0)),P=Ua(u,C),0<P.length&&(C=new Jd(C,t,null,n,c),f.push({event:C,listeners:P}),L?C.data=L:(L=sy(n),L!==null&&(C.data=L)))),(L=Aw?Lw(t,n):Cw(t,n))&&(u=Ua(u,"onBeforeInput"),0<u.length&&(c=new Jd("onBeforeInput","beforeinput",null,n,c),f.push({event:c,listeners:u}),c.data=L))}yy(f,e)})}function Os(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ua(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Ss(t,n),s!=null&&r.unshift(Os(t,s,i)),s=Ss(t,e),s!=null&&r.push(Os(t,s,i))),t=t.return}return r}function Fr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function fg(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,u=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&u!==null&&(a=u,i?(l=Ss(n,s),l!=null&&o.unshift(Os(n,l,a))):i||(l=Ss(n,s),l!=null&&o.push(Os(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Gw=/\r\n?/g,Ww=/\u0000|\uFFFD/g;function hg(t){return(typeof t=="string"?t:""+t).replace(Gw,`
`).replace(Ww,"")}function Do(t,e,n){if(e=hg(e),hg(t)!==e&&n)throw Error(R(425))}function Va(){}var Oc=null,Rc=null;function kc(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Nc=typeof setTimeout=="function"?setTimeout:void 0,Hw=typeof clearTimeout=="function"?clearTimeout:void 0,dg=typeof Promise=="function"?Promise:void 0,Xw=typeof queueMicrotask=="function"?queueMicrotask:typeof dg<"u"?function(t){return dg.resolve(null).then(t).catch(Yw)}:Nc;function Yw(t){setTimeout(function(){throw t})}function yu(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),Ls(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);Ls(e)}function Un(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function gg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Mi=Math.random().toString(36).slice(2),Ht="__reactFiber$"+Mi,Rs="__reactProps$"+Mi,hn="__reactContainer$"+Mi,Fc="__reactEvents$"+Mi,$w="__reactListeners$"+Mi,Zw="__reactHandles$"+Mi;function ur(t){var e=t[Ht];if(e)return e;for(var n=t.parentNode;n;){if(e=n[hn]||n[Ht]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=gg(t);t!==null;){if(n=t[Ht])return n;t=gg(t)}return e}t=n,n=t.parentNode}return null}function eo(t){return t=t[Ht]||t[hn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Zr(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(R(33))}function xl(t){return t[Rs]||null}var Dc=[],Kr=-1;function qn(t){return{current:t}}function oe(t){0>Kr||(t.current=Dc[Kr],Dc[Kr]=null,Kr--)}function ne(t,e){Kr++,Dc[Kr]=t.current,t.current=e}var $n={},Ue=qn($n),Ke=qn(!1),mr=$n;function pi(t,e){var n=t.type.contextTypes;if(!n)return $n;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function qe(t){return t=t.childContextTypes,t!=null}function ja(){oe(Ke),oe(Ue)}function pg(t,e,n){if(Ue.current!==$n)throw Error(R(168));ne(Ue,e),ne(Ke,n)}function _y(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(R(108,RE(t)||"Unknown",i));return de({},n,r)}function Ga(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||$n,mr=Ue.current,ne(Ue,t),ne(Ke,Ke.current),!0}function mg(t,e,n){var r=t.stateNode;if(!r)throw Error(R(169));n?(t=_y(t,e,mr),r.__reactInternalMemoizedMergedChildContext=t,oe(Ke),oe(Ue),ne(Ue,t)):oe(Ke),ne(Ke,n)}var sn=null,Sl=!1,vu=!1;function Ey(t){sn===null?sn=[t]:sn.push(t)}function Kw(t){Sl=!0,Ey(t)}function Qn(){if(!vu&&sn!==null){vu=!0;var t=0,e=Q;try{var n=sn;for(Q=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}sn=null,Sl=!1}catch(i){throw sn!==null&&(sn=sn.slice(t+1)),H0($f,Qn),i}finally{Q=e,vu=!1}}return null}var qr=[],Qr=0,Wa=null,Ha=0,mt=[],yt=0,yr=null,ln=1,un="";function or(t,e){qr[Qr++]=Ha,qr[Qr++]=Wa,Wa=t,Ha=e}function wy(t,e,n){mt[yt++]=ln,mt[yt++]=un,mt[yt++]=yr,yr=t;var r=ln;t=un;var i=32-Ot(r)-1;r&=~(1<<i),n+=1;var s=32-Ot(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,ln=1<<32-Ot(e)+i|n<<i|r,un=s+t}else ln=1<<s|n<<i|r,un=t}function rh(t){t.return!==null&&(or(t,1),wy(t,1,0))}function ih(t){for(;t===Wa;)Wa=qr[--Qr],qr[Qr]=null,Ha=qr[--Qr],qr[Qr]=null;for(;t===yr;)yr=mt[--yt],mt[yt]=null,un=mt[--yt],mt[yt]=null,ln=mt[--yt],mt[yt]=null}var ot=null,st=null,le=!1,Ct=null;function Ty(t,e){var n=vt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function yg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ot=t,st=Un(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ot=t,st=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=yr!==null?{id:ln,overflow:un}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=vt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ot=t,st=null,!0):!1;default:return!1}}function zc(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Bc(t){if(le){var e=st;if(e){var n=e;if(!yg(t,e)){if(zc(t))throw Error(R(418));e=Un(n.nextSibling);var r=ot;e&&yg(t,e)?Ty(r,n):(t.flags=t.flags&-4097|2,le=!1,ot=t)}}else{if(zc(t))throw Error(R(418));t.flags=t.flags&-4097|2,le=!1,ot=t}}}function vg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ot=t}function zo(t){if(t!==ot)return!1;if(!le)return vg(t),le=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!kc(t.type,t.memoizedProps)),e&&(e=st)){if(zc(t))throw by(),Error(R(418));for(;e;)Ty(t,e),e=Un(e.nextSibling)}if(vg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(R(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){st=Un(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}st=null}}else st=ot?Un(t.stateNode.nextSibling):null;return!0}function by(){for(var t=st;t;)t=Un(t.nextSibling)}function mi(){st=ot=null,le=!1}function sh(t){Ct===null?Ct=[t]:Ct.push(t)}var qw=yn.ReactCurrentBatchConfig;function Yi(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(R(309));var r=n.stateNode}if(!r)throw Error(R(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(R(284));if(!n._owner)throw Error(R(290,t))}return t}function Bo(t,e){throw t=Object.prototype.toString.call(e),Error(R(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function _g(t){var e=t._init;return e(t._payload)}function xy(t){function e(y,m){if(t){var _=y.deletions;_===null?(y.deletions=[m],y.flags|=16):_.push(m)}}function n(y,m){if(!t)return null;for(;m!==null;)e(y,m),m=m.sibling;return null}function r(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function i(y,m){return y=Wn(y,m),y.index=0,y.sibling=null,y}function s(y,m,_){return y.index=_,t?(_=y.alternate,_!==null?(_=_.index,_<m?(y.flags|=2,m):_):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return t&&y.alternate===null&&(y.flags|=2),y}function a(y,m,_,T){return m===null||m.tag!==6?(m=Su(_,y.mode,T),m.return=y,m):(m=i(m,_),m.return=y,m)}function l(y,m,_,T){var S=_.type;return S===Hr?c(y,m,_.props.children,T,_.key):m!==null&&(m.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ln&&_g(S)===m.type)?(T=i(m,_.props),T.ref=Yi(y,m,_),T.return=y,T):(T=Ea(_.type,_.key,_.props,null,y.mode,T),T.ref=Yi(y,m,_),T.return=y,T)}function u(y,m,_,T){return m===null||m.tag!==4||m.stateNode.containerInfo!==_.containerInfo||m.stateNode.implementation!==_.implementation?(m=Pu(_,y.mode,T),m.return=y,m):(m=i(m,_.children||[]),m.return=y,m)}function c(y,m,_,T,S){return m===null||m.tag!==7?(m=gr(_,y.mode,T,S),m.return=y,m):(m=i(m,_),m.return=y,m)}function f(y,m,_){if(typeof m=="string"&&m!==""||typeof m=="number")return m=Su(""+m,y.mode,_),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case Lo:return _=Ea(m.type,m.key,m.props,null,y.mode,_),_.ref=Yi(y,null,m),_.return=y,_;case Wr:return m=Pu(m,y.mode,_),m.return=y,m;case Ln:var T=m._init;return f(y,T(m._payload),_)}if(is(m)||ji(m))return m=gr(m,y.mode,_,null),m.return=y,m;Bo(y,m)}return null}function h(y,m,_,T){var S=m!==null?m.key:null;if(typeof _=="string"&&_!==""||typeof _=="number")return S!==null?null:a(y,m,""+_,T);if(typeof _=="object"&&_!==null){switch(_.$$typeof){case Lo:return _.key===S?l(y,m,_,T):null;case Wr:return _.key===S?u(y,m,_,T):null;case Ln:return S=_._init,h(y,m,S(_._payload),T)}if(is(_)||ji(_))return S!==null?null:c(y,m,_,T,null);Bo(y,_)}return null}function d(y,m,_,T,S){if(typeof T=="string"&&T!==""||typeof T=="number")return y=y.get(_)||null,a(m,y,""+T,S);if(typeof T=="object"&&T!==null){switch(T.$$typeof){case Lo:return y=y.get(T.key===null?_:T.key)||null,l(m,y,T,S);case Wr:return y=y.get(T.key===null?_:T.key)||null,u(m,y,T,S);case Ln:var P=T._init;return d(y,m,_,P(T._payload),S)}if(is(T)||ji(T))return y=y.get(_)||null,c(m,y,T,S,null);Bo(m,T)}return null}function p(y,m,_,T){for(var S=null,P=null,L=m,C=m=0,I=null;L!==null&&C<_.length;C++){L.index>C?(I=L,L=null):I=L.sibling;var M=h(y,L,_[C],T);if(M===null){L===null&&(L=I);break}t&&L&&M.alternate===null&&e(y,L),m=s(M,m,C),P===null?S=M:P.sibling=M,P=M,L=I}if(C===_.length)return n(y,L),le&&or(y,C),S;if(L===null){for(;C<_.length;C++)L=f(y,_[C],T),L!==null&&(m=s(L,m,C),P===null?S=L:P.sibling=L,P=L);return le&&or(y,C),S}for(L=r(y,L);C<_.length;C++)I=d(L,y,C,_[C],T),I!==null&&(t&&I.alternate!==null&&L.delete(I.key===null?C:I.key),m=s(I,m,C),P===null?S=I:P.sibling=I,P=I);return t&&L.forEach(function(B){return e(y,B)}),le&&or(y,C),S}function E(y,m,_,T){var S=ji(_);if(typeof S!="function")throw Error(R(150));if(_=S.call(_),_==null)throw Error(R(151));for(var P=S=null,L=m,C=m=0,I=null,M=_.next();L!==null&&!M.done;C++,M=_.next()){L.index>C?(I=L,L=null):I=L.sibling;var B=h(y,L,M.value,T);if(B===null){L===null&&(L=I);break}t&&L&&B.alternate===null&&e(y,L),m=s(B,m,C),P===null?S=B:P.sibling=B,P=B,L=I}if(M.done)return n(y,L),le&&or(y,C),S;if(L===null){for(;!M.done;C++,M=_.next())M=f(y,M.value,T),M!==null&&(m=s(M,m,C),P===null?S=M:P.sibling=M,P=M);return le&&or(y,C),S}for(L=r(y,L);!M.done;C++,M=_.next())M=d(L,y,C,M.value,T),M!==null&&(t&&M.alternate!==null&&L.delete(M.key===null?C:M.key),m=s(M,m,C),P===null?S=M:P.sibling=M,P=M);return t&&L.forEach(function(V){return e(y,V)}),le&&or(y,C),S}function b(y,m,_,T){if(typeof _=="object"&&_!==null&&_.type===Hr&&_.key===null&&(_=_.props.children),typeof _=="object"&&_!==null){switch(_.$$typeof){case Lo:e:{for(var S=_.key,P=m;P!==null;){if(P.key===S){if(S=_.type,S===Hr){if(P.tag===7){n(y,P.sibling),m=i(P,_.props.children),m.return=y,y=m;break e}}else if(P.elementType===S||typeof S=="object"&&S!==null&&S.$$typeof===Ln&&_g(S)===P.type){n(y,P.sibling),m=i(P,_.props),m.ref=Yi(y,P,_),m.return=y,y=m;break e}n(y,P);break}else e(y,P);P=P.sibling}_.type===Hr?(m=gr(_.props.children,y.mode,T,_.key),m.return=y,y=m):(T=Ea(_.type,_.key,_.props,null,y.mode,T),T.ref=Yi(y,m,_),T.return=y,y=T)}return o(y);case Wr:e:{for(P=_.key;m!==null;){if(m.key===P)if(m.tag===4&&m.stateNode.containerInfo===_.containerInfo&&m.stateNode.implementation===_.implementation){n(y,m.sibling),m=i(m,_.children||[]),m.return=y,y=m;break e}else{n(y,m);break}else e(y,m);m=m.sibling}m=Pu(_,y.mode,T),m.return=y,y=m}return o(y);case Ln:return P=_._init,b(y,m,P(_._payload),T)}if(is(_))return p(y,m,_,T);if(ji(_))return E(y,m,_,T);Bo(y,_)}return typeof _=="string"&&_!==""||typeof _=="number"?(_=""+_,m!==null&&m.tag===6?(n(y,m.sibling),m=i(m,_),m.return=y,y=m):(n(y,m),m=Su(_,y.mode,T),m.return=y,y=m),o(y)):n(y,m)}return b}var yi=xy(!0),Sy=xy(!1),Xa=qn(null),Ya=null,Jr=null,oh=null;function ah(){oh=Jr=Ya=null}function lh(t){var e=Xa.current;oe(Xa),t._currentValue=e}function Uc(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ui(t,e){Ya=t,oh=Jr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ze=!0),t.firstContext=null)}function wt(t){var e=t._currentValue;if(oh!==t)if(t={context:t,memoizedValue:e,next:null},Jr===null){if(Ya===null)throw Error(R(308));Jr=t,Ya.dependencies={lanes:0,firstContext:t}}else Jr=Jr.next=t;return e}var cr=null;function uh(t){cr===null?cr=[t]:cr.push(t)}function Py(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,uh(e)):(n.next=i.next,i.next=n),e.interleaved=n,dn(t,r)}function dn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Cn=!1;function ch(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ay(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function cn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Vn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,K&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,dn(t,n)}return i=r.interleaved,i===null?(e.next=e,uh(r)):(e.next=i.next,i.next=e),r.interleaved=e,dn(t,n)}function ga(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Zf(t,n)}}function Eg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function $a(t,e,n,r){var i=t.updateQueue;Cn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,u=l.next;l.next=null,o===null?s=u:o.next=u,o=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==o&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,c=u=l=null,a=s;do{var h=a.lane,d=a.eventTime;if((r&h)===h){c!==null&&(c=c.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,E=a;switch(h=e,d=n,E.tag){case 1:if(p=E.payload,typeof p=="function"){f=p.call(d,f,h);break e}f=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=E.payload,h=typeof p=="function"?p.call(d,f,h):p,h==null)break e;f=de({},f,h);break e;case 2:Cn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else d={eventTime:d,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=d,l=f):c=c.next=d,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(!0);if(c===null&&(l=f),i.baseState=l,i.firstBaseUpdate=u,i.lastBaseUpdate=c,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);_r|=o,t.lanes=o,t.memoizedState=f}}function wg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(R(191,i));i.call(r)}}}var to={},Kt=qn(to),ks=qn(to),Ns=qn(to);function fr(t){if(t===to)throw Error(R(174));return t}function fh(t,e){switch(ne(Ns,e),ne(ks,t),ne(Kt,to),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Ec(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Ec(e,t)}oe(Kt),ne(Kt,e)}function vi(){oe(Kt),oe(ks),oe(Ns)}function Ly(t){fr(Ns.current);var e=fr(Kt.current),n=Ec(e,t.type);e!==n&&(ne(ks,t),ne(Kt,n))}function hh(t){ks.current===t&&(oe(Kt),oe(ks))}var ce=qn(0);function Za(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var _u=[];function dh(){for(var t=0;t<_u.length;t++)_u[t]._workInProgressVersionPrimary=null;_u.length=0}var pa=yn.ReactCurrentDispatcher,Eu=yn.ReactCurrentBatchConfig,vr=0,he=null,we=null,Se=null,Ka=!1,ps=!1,Fs=0,Qw=0;function ke(){throw Error(R(321))}function gh(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Nt(t[n],e[n]))return!1;return!0}function ph(t,e,n,r,i,s){if(vr=s,he=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,pa.current=t===null||t.memoizedState===null?nT:rT,t=n(r,i),ps){s=0;do{if(ps=!1,Fs=0,25<=s)throw Error(R(301));s+=1,Se=we=null,e.updateQueue=null,pa.current=iT,t=n(r,i)}while(ps)}if(pa.current=qa,e=we!==null&&we.next!==null,vr=0,Se=we=he=null,Ka=!1,e)throw Error(R(300));return t}function mh(){var t=Fs!==0;return Fs=0,t}function Wt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Se===null?he.memoizedState=Se=t:Se=Se.next=t,Se}function Tt(){if(we===null){var t=he.alternate;t=t!==null?t.memoizedState:null}else t=we.next;var e=Se===null?he.memoizedState:Se.next;if(e!==null)Se=e,we=t;else{if(t===null)throw Error(R(310));we=t,t={memoizedState:we.memoizedState,baseState:we.baseState,baseQueue:we.baseQueue,queue:we.queue,next:null},Se===null?he.memoizedState=Se=t:Se=Se.next=t}return Se}function Ds(t,e){return typeof e=="function"?e(t):e}function wu(t){var e=Tt(),n=e.queue;if(n===null)throw Error(R(311));n.lastRenderedReducer=t;var r=we,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,u=s;do{var c=u.lane;if((vr&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:t(r,u.action);else{var f={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,he.lanes|=c,_r|=c}u=u.next}while(u!==null&&u!==s);l===null?o=r:l.next=a,Nt(r,e.memoizedState)||(Ze=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,he.lanes|=s,_r|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Tu(t){var e=Tt(),n=e.queue;if(n===null)throw Error(R(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Nt(s,e.memoizedState)||(Ze=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Cy(){}function Iy(t,e){var n=he,r=Tt(),i=e(),s=!Nt(r.memoizedState,i);if(s&&(r.memoizedState=i,Ze=!0),r=r.queue,yh(Ry.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Se!==null&&Se.memoizedState.tag&1){if(n.flags|=2048,zs(9,Oy.bind(null,n,r,i,e),void 0,null),Ae===null)throw Error(R(349));vr&30||My(n,e,i)}return i}function My(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=he.updateQueue,e===null?(e={lastEffect:null,stores:null},he.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Oy(t,e,n,r){e.value=n,e.getSnapshot=r,ky(e)&&Ny(t)}function Ry(t,e,n){return n(function(){ky(e)&&Ny(t)})}function ky(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Nt(t,n)}catch{return!0}}function Ny(t){var e=dn(t,1);e!==null&&Rt(e,t,1,-1)}function Tg(t){var e=Wt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ds,lastRenderedState:t},e.queue=t,t=t.dispatch=tT.bind(null,he,t),[e.memoizedState,t]}function zs(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=he.updateQueue,e===null?(e={lastEffect:null,stores:null},he.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Fy(){return Tt().memoizedState}function ma(t,e,n,r){var i=Wt();he.flags|=t,i.memoizedState=zs(1|e,n,void 0,r===void 0?null:r)}function Pl(t,e,n,r){var i=Tt();r=r===void 0?null:r;var s=void 0;if(we!==null){var o=we.memoizedState;if(s=o.destroy,r!==null&&gh(r,o.deps)){i.memoizedState=zs(e,n,s,r);return}}he.flags|=t,i.memoizedState=zs(1|e,n,s,r)}function bg(t,e){return ma(8390656,8,t,e)}function yh(t,e){return Pl(2048,8,t,e)}function Dy(t,e){return Pl(4,2,t,e)}function zy(t,e){return Pl(4,4,t,e)}function By(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Uy(t,e,n){return n=n!=null?n.concat([t]):null,Pl(4,4,By.bind(null,e,t),n)}function vh(){}function Vy(t,e){var n=Tt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&gh(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function jy(t,e){var n=Tt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&gh(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Gy(t,e,n){return vr&21?(Nt(n,e)||(n=$0(),he.lanes|=n,_r|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ze=!0),t.memoizedState=n)}function Jw(t,e){var n=Q;Q=n!==0&&4>n?n:4,t(!0);var r=Eu.transition;Eu.transition={};try{t(!1),e()}finally{Q=n,Eu.transition=r}}function Wy(){return Tt().memoizedState}function eT(t,e,n){var r=Gn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Hy(t))Xy(e,n);else if(n=Py(t,e,n,r),n!==null){var i=We();Rt(n,t,r,i),Yy(n,e,r)}}function tT(t,e,n){var r=Gn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Hy(t))Xy(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Nt(a,o)){var l=e.interleaved;l===null?(i.next=i,uh(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=Py(t,e,i,r),n!==null&&(i=We(),Rt(n,t,r,i),Yy(n,e,r))}}function Hy(t){var e=t.alternate;return t===he||e!==null&&e===he}function Xy(t,e){ps=Ka=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function Yy(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Zf(t,n)}}var qa={readContext:wt,useCallback:ke,useContext:ke,useEffect:ke,useImperativeHandle:ke,useInsertionEffect:ke,useLayoutEffect:ke,useMemo:ke,useReducer:ke,useRef:ke,useState:ke,useDebugValue:ke,useDeferredValue:ke,useTransition:ke,useMutableSource:ke,useSyncExternalStore:ke,useId:ke,unstable_isNewReconciler:!1},nT={readContext:wt,useCallback:function(t,e){return Wt().memoizedState=[t,e===void 0?null:e],t},useContext:wt,useEffect:bg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,ma(4194308,4,By.bind(null,e,t),n)},useLayoutEffect:function(t,e){return ma(4194308,4,t,e)},useInsertionEffect:function(t,e){return ma(4,2,t,e)},useMemo:function(t,e){var n=Wt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Wt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=eT.bind(null,he,t),[r.memoizedState,t]},useRef:function(t){var e=Wt();return t={current:t},e.memoizedState=t},useState:Tg,useDebugValue:vh,useDeferredValue:function(t){return Wt().memoizedState=t},useTransition:function(){var t=Tg(!1),e=t[0];return t=Jw.bind(null,t[1]),Wt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=he,i=Wt();if(le){if(n===void 0)throw Error(R(407));n=n()}else{if(n=e(),Ae===null)throw Error(R(349));vr&30||My(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,bg(Ry.bind(null,r,s,t),[t]),r.flags|=2048,zs(9,Oy.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Wt(),e=Ae.identifierPrefix;if(le){var n=un,r=ln;n=(r&~(1<<32-Ot(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Fs++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Qw++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},rT={readContext:wt,useCallback:Vy,useContext:wt,useEffect:yh,useImperativeHandle:Uy,useInsertionEffect:Dy,useLayoutEffect:zy,useMemo:jy,useReducer:wu,useRef:Fy,useState:function(){return wu(Ds)},useDebugValue:vh,useDeferredValue:function(t){var e=Tt();return Gy(e,we.memoizedState,t)},useTransition:function(){var t=wu(Ds)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:Cy,useSyncExternalStore:Iy,useId:Wy,unstable_isNewReconciler:!1},iT={readContext:wt,useCallback:Vy,useContext:wt,useEffect:yh,useImperativeHandle:Uy,useInsertionEffect:Dy,useLayoutEffect:zy,useMemo:jy,useReducer:Tu,useRef:Fy,useState:function(){return Tu(Ds)},useDebugValue:vh,useDeferredValue:function(t){var e=Tt();return we===null?e.memoizedState=t:Gy(e,we.memoizedState,t)},useTransition:function(){var t=Tu(Ds)[0],e=Tt().memoizedState;return[t,e]},useMutableSource:Cy,useSyncExternalStore:Iy,useId:Wy,unstable_isNewReconciler:!1};function At(t,e){if(t&&t.defaultProps){e=de({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Vc(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:de({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Al={isMounted:function(t){return(t=t._reactInternals)?Cr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=We(),i=Gn(t),s=cn(r,i);s.payload=e,n!=null&&(s.callback=n),e=Vn(t,s,i),e!==null&&(Rt(e,t,i,r),ga(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=We(),i=Gn(t),s=cn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Vn(t,s,i),e!==null&&(Rt(e,t,i,r),ga(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=We(),r=Gn(t),i=cn(n,r);i.tag=2,e!=null&&(i.callback=e),e=Vn(t,i,r),e!==null&&(Rt(e,t,r,n),ga(e,t,r))}};function xg(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!Is(n,r)||!Is(i,s):!0}function $y(t,e,n){var r=!1,i=$n,s=e.contextType;return typeof s=="object"&&s!==null?s=wt(s):(i=qe(e)?mr:Ue.current,r=e.contextTypes,s=(r=r!=null)?pi(t,i):$n),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Al,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Sg(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Al.enqueueReplaceState(e,e.state,null)}function jc(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},ch(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=wt(s):(s=qe(e)?mr:Ue.current,i.context=pi(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Vc(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Al.enqueueReplaceState(i,i.state,null),$a(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function _i(t,e){try{var n="",r=e;do n+=OE(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function bu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Gc(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var sT=typeof WeakMap=="function"?WeakMap:Map;function Zy(t,e,n){n=cn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Ja||(Ja=!0,Jc=r),Gc(t,e)},n}function Ky(t,e,n){n=cn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Gc(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Gc(t,e),typeof r!="function"&&(jn===null?jn=new Set([this]):jn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Pg(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new sT;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=_T.bind(null,t,e,n),e.then(t,t))}function Ag(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Lg(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=cn(-1,1),e.tag=2,Vn(n,e,1))),n.lanes|=1),t)}var oT=yn.ReactCurrentOwner,Ze=!1;function je(t,e,n,r){e.child=t===null?Sy(e,null,n,r):yi(e,t.child,n,r)}function Cg(t,e,n,r,i){n=n.render;var s=e.ref;return ui(e,i),r=ph(t,e,n,r,s,i),n=mh(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gn(t,e,i)):(le&&n&&rh(e),e.flags|=1,je(t,e,r,i),e.child)}function Ig(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!Ph(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,qy(t,e,s,r,i)):(t=Ea(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:Is,n(o,r)&&t.ref===e.ref)return gn(t,e,i)}return e.flags|=1,t=Wn(s,r),t.ref=e.ref,t.return=e,e.child=t}function qy(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Is(s,r)&&t.ref===e.ref)if(Ze=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(Ze=!0);else return e.lanes=t.lanes,gn(t,e,i)}return Wc(t,e,n,r,i)}function Qy(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ne(ti,rt),rt|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ne(ti,rt),rt|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ne(ti,rt),rt|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ne(ti,rt),rt|=r;return je(t,e,i,n),e.child}function Jy(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Wc(t,e,n,r,i){var s=qe(n)?mr:Ue.current;return s=pi(e,s),ui(e,i),n=ph(t,e,n,r,s,i),r=mh(),t!==null&&!Ze?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,gn(t,e,i)):(le&&r&&rh(e),e.flags|=1,je(t,e,n,i),e.child)}function Mg(t,e,n,r,i){if(qe(n)){var s=!0;Ga(e)}else s=!1;if(ui(e,i),e.stateNode===null)ya(t,e),$y(e,n,r),jc(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,u=n.contextType;typeof u=="object"&&u!==null?u=wt(u):(u=qe(n)?mr:Ue.current,u=pi(e,u));var c=n.getDerivedStateFromProps,f=typeof c=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==u)&&Sg(e,o,r,u),Cn=!1;var h=e.memoizedState;o.state=h,$a(e,r,o,i),l=e.memoizedState,a!==r||h!==l||Ke.current||Cn?(typeof c=="function"&&(Vc(e,n,c,r),l=e.memoizedState),(a=Cn||xg(e,n,a,r,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=u,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Ay(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:At(e.type,a),o.props=u,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=wt(l):(l=qe(n)?mr:Ue.current,l=pi(e,l));var d=n.getDerivedStateFromProps;(c=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&Sg(e,o,r,l),Cn=!1,h=e.memoizedState,o.state=h,$a(e,r,o,i);var p=e.memoizedState;a!==f||h!==p||Ke.current||Cn?(typeof d=="function"&&(Vc(e,n,d,r),p=e.memoizedState),(u=Cn||xg(e,n,u,r,h,p,l)||!1)?(c||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,p,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,p,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return Hc(t,e,n,r,s,i)}function Hc(t,e,n,r,i,s){Jy(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&mg(e,n,!1),gn(t,e,s);r=e.stateNode,oT.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=yi(e,t.child,null,s),e.child=yi(e,null,a,s)):je(t,e,a,s),e.memoizedState=r.state,i&&mg(e,n,!0),e.child}function ev(t){var e=t.stateNode;e.pendingContext?pg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&pg(t,e.context,!1),fh(t,e.containerInfo)}function Og(t,e,n,r,i){return mi(),sh(i),e.flags|=256,je(t,e,n,r),e.child}var Xc={dehydrated:null,treeContext:null,retryLane:0};function Yc(t){return{baseLanes:t,cachePool:null,transitions:null}}function tv(t,e,n){var r=e.pendingProps,i=ce.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ne(ce,i&1),t===null)return Bc(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Il(o,r,0,null),t=gr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Yc(n),e.memoizedState=Xc,t):_h(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return aT(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Wn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Wn(a,s):(s=gr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?Yc(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Xc,r}return s=t.child,t=s.sibling,r=Wn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function _h(t,e){return e=Il({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Uo(t,e,n,r){return r!==null&&sh(r),yi(e,t.child,null,n),t=_h(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function aT(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=bu(Error(R(422))),Uo(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Il({mode:"visible",children:r.children},i,0,null),s=gr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&yi(e,t.child,null,o),e.child.memoizedState=Yc(o),e.memoizedState=Xc,s);if(!(e.mode&1))return Uo(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(R(419)),r=bu(s,r,void 0),Uo(t,e,o,r)}if(a=(o&t.childLanes)!==0,Ze||a){if(r=Ae,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,dn(t,i),Rt(r,t,i,-1))}return Sh(),r=bu(Error(R(421))),Uo(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=ET.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,st=Un(i.nextSibling),ot=e,le=!0,Ct=null,t!==null&&(mt[yt++]=ln,mt[yt++]=un,mt[yt++]=yr,ln=t.id,un=t.overflow,yr=e),e=_h(e,r.children),e.flags|=4096,e)}function Rg(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Uc(t.return,e,n)}function xu(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function nv(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(je(t,e,r.children,n),r=ce.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Rg(t,n,e);else if(t.tag===19)Rg(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ne(ce,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Za(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),xu(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Za(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}xu(e,!0,n,null,s);break;case"together":xu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ya(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function gn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),_r|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(R(153));if(e.child!==null){for(t=e.child,n=Wn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Wn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function lT(t,e,n){switch(e.tag){case 3:ev(e),mi();break;case 5:Ly(e);break;case 1:qe(e.type)&&Ga(e);break;case 4:fh(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ne(Xa,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ne(ce,ce.current&1),e.flags|=128,null):n&e.child.childLanes?tv(t,e,n):(ne(ce,ce.current&1),t=gn(t,e,n),t!==null?t.sibling:null);ne(ce,ce.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return nv(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ne(ce,ce.current),r)break;return null;case 22:case 23:return e.lanes=0,Qy(t,e,n)}return gn(t,e,n)}var rv,$c,iv,sv;rv=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};$c=function(){};iv=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,fr(Kt.current);var s=null;switch(n){case"input":i=mc(t,i),r=mc(t,r),s=[];break;case"select":i=de({},i,{value:void 0}),r=de({},r,{value:void 0}),s=[];break;case"textarea":i=_c(t,i),r=_c(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Va)}wc(n,r);var o;n=null;for(u in i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var a=i[u];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(bs.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var l=r[u];if(a=i!=null?i[u]:void 0,r.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(u,n)),n=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(bs.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&ie("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}n&&(s=s||[]).push("style",n);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};sv=function(t,e,n,r){n!==r&&(e.flags|=4)};function $i(t,e){if(!le)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ne(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function uT(t,e,n){var r=e.pendingProps;switch(ih(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ne(e),null;case 1:return qe(e.type)&&ja(),Ne(e),null;case 3:return r=e.stateNode,vi(),oe(Ke),oe(Ue),dh(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(zo(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ct!==null&&(nf(Ct),Ct=null))),$c(t,e),Ne(e),null;case 5:hh(e);var i=fr(Ns.current);if(n=e.type,t!==null&&e.stateNode!=null)iv(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(R(166));return Ne(e),null}if(t=fr(Kt.current),zo(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Ht]=e,r[Rs]=s,t=(e.mode&1)!==0,n){case"dialog":ie("cancel",r),ie("close",r);break;case"iframe":case"object":case"embed":ie("load",r);break;case"video":case"audio":for(i=0;i<os.length;i++)ie(os[i],r);break;case"source":ie("error",r);break;case"img":case"image":case"link":ie("error",r),ie("load",r);break;case"details":ie("toggle",r);break;case"input":jd(r,s),ie("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ie("invalid",r);break;case"textarea":Wd(r,s),ie("invalid",r)}wc(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Do(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Do(r.textContent,a,t),i=["children",""+a]):bs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ie("scroll",r)}switch(n){case"input":Co(r),Gd(r,s,!0);break;case"textarea":Co(r),Hd(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Va)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=R0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Ht]=e,t[Rs]=r,rv(t,e,!1,!1),e.stateNode=t;e:{switch(o=Tc(n,r),n){case"dialog":ie("cancel",t),ie("close",t),i=r;break;case"iframe":case"object":case"embed":ie("load",t),i=r;break;case"video":case"audio":for(i=0;i<os.length;i++)ie(os[i],t);i=r;break;case"source":ie("error",t),i=r;break;case"img":case"image":case"link":ie("error",t),ie("load",t),i=r;break;case"details":ie("toggle",t),i=r;break;case"input":jd(t,r),i=mc(t,r),ie("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=de({},r,{value:void 0}),ie("invalid",t);break;case"textarea":Wd(t,r),i=_c(t,r),ie("invalid",t);break;default:i=r}wc(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?F0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&k0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&xs(t,l):typeof l=="number"&&xs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(bs.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ie("scroll",t):l!=null&&Gf(t,s,l,o))}switch(n){case"input":Co(t),Gd(t,r,!1);break;case"textarea":Co(t),Hd(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Yn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?si(t,!!r.multiple,s,!1):r.defaultValue!=null&&si(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Va)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ne(e),null;case 6:if(t&&e.stateNode!=null)sv(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(R(166));if(n=fr(Ns.current),fr(Kt.current),zo(e)){if(r=e.stateNode,n=e.memoizedProps,r[Ht]=e,(s=r.nodeValue!==n)&&(t=ot,t!==null))switch(t.tag){case 3:Do(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Do(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ht]=e,e.stateNode=r}return Ne(e),null;case 13:if(oe(ce),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(le&&st!==null&&e.mode&1&&!(e.flags&128))by(),mi(),e.flags|=98560,s=!1;else if(s=zo(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(R(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(R(317));s[Ht]=e}else mi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ne(e),s=!1}else Ct!==null&&(nf(Ct),Ct=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ce.current&1?Te===0&&(Te=3):Sh())),e.updateQueue!==null&&(e.flags|=4),Ne(e),null);case 4:return vi(),$c(t,e),t===null&&Ms(e.stateNode.containerInfo),Ne(e),null;case 10:return lh(e.type._context),Ne(e),null;case 17:return qe(e.type)&&ja(),Ne(e),null;case 19:if(oe(ce),s=e.memoizedState,s===null)return Ne(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)$i(s,!1);else{if(Te!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=Za(t),o!==null){for(e.flags|=128,$i(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ne(ce,ce.current&1|2),e.child}t=t.sibling}s.tail!==null&&me()>Ei&&(e.flags|=128,r=!0,$i(s,!1),e.lanes=4194304)}else{if(!r)if(t=Za(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),$i(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!le)return Ne(e),null}else 2*me()-s.renderingStartTime>Ei&&n!==1073741824&&(e.flags|=128,r=!0,$i(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=me(),e.sibling=null,n=ce.current,ne(ce,r?n&1|2:n&1),e):(Ne(e),null);case 22:case 23:return xh(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?rt&1073741824&&(Ne(e),e.subtreeFlags&6&&(e.flags|=8192)):Ne(e),null;case 24:return null;case 25:return null}throw Error(R(156,e.tag))}function cT(t,e){switch(ih(e),e.tag){case 1:return qe(e.type)&&ja(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return vi(),oe(Ke),oe(Ue),dh(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return hh(e),null;case 13:if(oe(ce),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(R(340));mi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return oe(ce),null;case 4:return vi(),null;case 10:return lh(e.type._context),null;case 22:case 23:return xh(),null;case 24:return null;default:return null}}var Vo=!1,ze=!1,fT=typeof WeakSet=="function"?WeakSet:Set,z=null;function ei(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){pe(t,e,r)}else n.current=null}function Zc(t,e,n){try{n()}catch(r){pe(t,e,r)}}var kg=!1;function hT(t,e){if(Oc=za,t=cy(),nh(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,u=0,c=0,f=t,h=null;t:for(;;){for(var d;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(d=f.firstChild)!==null;)h=f,f=d;for(;;){if(f===t)break t;if(h===n&&++u===i&&(a=o),h===s&&++c===r&&(l=o),(d=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Rc={focusedElem:t,selectionRange:n},za=!1,z=e;z!==null;)if(e=z,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,z=t;else for(;z!==null;){e=z;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var E=p.memoizedProps,b=p.memoizedState,y=e.stateNode,m=y.getSnapshotBeforeUpdate(e.elementType===e.type?E:At(e.type,E),b);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var _=e.stateNode.containerInfo;_.nodeType===1?_.textContent="":_.nodeType===9&&_.documentElement&&_.removeChild(_.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(R(163))}}catch(T){pe(e,e.return,T)}if(t=e.sibling,t!==null){t.return=e.return,z=t;break}z=e.return}return p=kg,kg=!1,p}function ms(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Zc(e,n,s)}i=i.next}while(i!==r)}}function Ll(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Kc(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ov(t){var e=t.alternate;e!==null&&(t.alternate=null,ov(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ht],delete e[Rs],delete e[Fc],delete e[$w],delete e[Zw])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function av(t){return t.tag===5||t.tag===3||t.tag===4}function Ng(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||av(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function qc(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Va));else if(r!==4&&(t=t.child,t!==null))for(qc(t,e,n),t=t.sibling;t!==null;)qc(t,e,n),t=t.sibling}function Qc(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Qc(t,e,n),t=t.sibling;t!==null;)Qc(t,e,n),t=t.sibling}var Ie=null,Lt=!1;function Tn(t,e,n){for(n=n.child;n!==null;)lv(t,e,n),n=n.sibling}function lv(t,e,n){if(Zt&&typeof Zt.onCommitFiberUnmount=="function")try{Zt.onCommitFiberUnmount(El,n)}catch{}switch(n.tag){case 5:ze||ei(n,e);case 6:var r=Ie,i=Lt;Ie=null,Tn(t,e,n),Ie=r,Lt=i,Ie!==null&&(Lt?(t=Ie,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ie.removeChild(n.stateNode));break;case 18:Ie!==null&&(Lt?(t=Ie,n=n.stateNode,t.nodeType===8?yu(t.parentNode,n):t.nodeType===1&&yu(t,n),Ls(t)):yu(Ie,n.stateNode));break;case 4:r=Ie,i=Lt,Ie=n.stateNode.containerInfo,Lt=!0,Tn(t,e,n),Ie=r,Lt=i;break;case 0:case 11:case 14:case 15:if(!ze&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Zc(n,e,o),i=i.next}while(i!==r)}Tn(t,e,n);break;case 1:if(!ze&&(ei(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){pe(n,e,a)}Tn(t,e,n);break;case 21:Tn(t,e,n);break;case 22:n.mode&1?(ze=(r=ze)||n.memoizedState!==null,Tn(t,e,n),ze=r):Tn(t,e,n);break;default:Tn(t,e,n)}}function Fg(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new fT),e.forEach(function(r){var i=wT.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Pt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Ie=a.stateNode,Lt=!1;break e;case 3:Ie=a.stateNode.containerInfo,Lt=!0;break e;case 4:Ie=a.stateNode.containerInfo,Lt=!0;break e}a=a.return}if(Ie===null)throw Error(R(160));lv(s,o,i),Ie=null,Lt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(u){pe(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)uv(e,t),e=e.sibling}function uv(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pt(e,t),Ut(t),r&4){try{ms(3,t,t.return),Ll(3,t)}catch(E){pe(t,t.return,E)}try{ms(5,t,t.return)}catch(E){pe(t,t.return,E)}}break;case 1:Pt(e,t),Ut(t),r&512&&n!==null&&ei(n,n.return);break;case 5:if(Pt(e,t),Ut(t),r&512&&n!==null&&ei(n,n.return),t.flags&32){var i=t.stateNode;try{xs(i,"")}catch(E){pe(t,t.return,E)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&M0(i,s),Tc(a,o);var u=Tc(a,s);for(o=0;o<l.length;o+=2){var c=l[o],f=l[o+1];c==="style"?F0(i,f):c==="dangerouslySetInnerHTML"?k0(i,f):c==="children"?xs(i,f):Gf(i,c,f,u)}switch(a){case"input":yc(i,s);break;case"textarea":O0(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?si(i,!!s.multiple,d,!1):h!==!!s.multiple&&(s.defaultValue!=null?si(i,!!s.multiple,s.defaultValue,!0):si(i,!!s.multiple,s.multiple?[]:"",!1))}i[Rs]=s}catch(E){pe(t,t.return,E)}}break;case 6:if(Pt(e,t),Ut(t),r&4){if(t.stateNode===null)throw Error(R(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(E){pe(t,t.return,E)}}break;case 3:if(Pt(e,t),Ut(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Ls(e.containerInfo)}catch(E){pe(t,t.return,E)}break;case 4:Pt(e,t),Ut(t);break;case 13:Pt(e,t),Ut(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Th=me())),r&4&&Fg(t);break;case 22:if(c=n!==null&&n.memoizedState!==null,t.mode&1?(ze=(u=ze)||c,Pt(e,t),ze=u):Pt(e,t),Ut(t),r&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&t.mode&1)for(z=t,c=t.child;c!==null;){for(f=z=c;z!==null;){switch(h=z,d=h.child,h.tag){case 0:case 11:case 14:case 15:ms(4,h,h.return);break;case 1:ei(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(E){pe(r,n,E)}}break;case 5:ei(h,h.return);break;case 22:if(h.memoizedState!==null){zg(f);continue}}d!==null?(d.return=h,z=d):zg(f)}c=c.sibling}e:for(c=null,f=t;;){if(f.tag===5){if(c===null){c=f;try{i=f.stateNode,u?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=N0("display",o))}catch(E){pe(t,t.return,E)}}}else if(f.tag===6){if(c===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(E){pe(t,t.return,E)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;c===f&&(c=null),f=f.return}c===f&&(c=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Pt(e,t),Ut(t),r&4&&Fg(t);break;case 21:break;default:Pt(e,t),Ut(t)}}function Ut(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(av(n)){var r=n;break e}n=n.return}throw Error(R(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(xs(i,""),r.flags&=-33);var s=Ng(t);Qc(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Ng(t);qc(t,a,o);break;default:throw Error(R(161))}}catch(l){pe(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function dT(t,e,n){z=t,cv(t)}function cv(t,e,n){for(var r=(t.mode&1)!==0;z!==null;){var i=z,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||Vo;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||ze;a=Vo;var u=ze;if(Vo=o,(ze=l)&&!u)for(z=i;z!==null;)o=z,l=o.child,o.tag===22&&o.memoizedState!==null?Bg(i):l!==null?(l.return=o,z=l):Bg(i);for(;s!==null;)z=s,cv(s),s=s.sibling;z=i,Vo=a,ze=u}Dg(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,z=s):Dg(t)}}function Dg(t){for(;z!==null;){var e=z;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ze||Ll(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ze)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:At(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&wg(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}wg(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var f=c.dehydrated;f!==null&&Ls(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(R(163))}ze||e.flags&512&&Kc(e)}catch(h){pe(e,e.return,h)}}if(e===t){z=null;break}if(n=e.sibling,n!==null){n.return=e.return,z=n;break}z=e.return}}function zg(t){for(;z!==null;){var e=z;if(e===t){z=null;break}var n=e.sibling;if(n!==null){n.return=e.return,z=n;break}z=e.return}}function Bg(t){for(;z!==null;){var e=z;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Ll(4,e)}catch(l){pe(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){pe(e,i,l)}}var s=e.return;try{Kc(e)}catch(l){pe(e,s,l)}break;case 5:var o=e.return;try{Kc(e)}catch(l){pe(e,o,l)}}}catch(l){pe(e,e.return,l)}if(e===t){z=null;break}var a=e.sibling;if(a!==null){a.return=e.return,z=a;break}z=e.return}}var gT=Math.ceil,Qa=yn.ReactCurrentDispatcher,Eh=yn.ReactCurrentOwner,_t=yn.ReactCurrentBatchConfig,K=0,Ae=null,_e=null,Oe=0,rt=0,ti=qn(0),Te=0,Bs=null,_r=0,Cl=0,wh=0,ys=null,$e=null,Th=0,Ei=1/0,rn=null,Ja=!1,Jc=null,jn=null,jo=!1,Rn=null,el=0,vs=0,ef=null,va=-1,_a=0;function We(){return K&6?me():va!==-1?va:va=me()}function Gn(t){return t.mode&1?K&2&&Oe!==0?Oe&-Oe:qw.transition!==null?(_a===0&&(_a=$0()),_a):(t=Q,t!==0||(t=window.event,t=t===void 0?16:ty(t.type)),t):1}function Rt(t,e,n,r){if(50<vs)throw vs=0,ef=null,Error(R(185));Qs(t,n,r),(!(K&2)||t!==Ae)&&(t===Ae&&(!(K&2)&&(Cl|=n),Te===4&&Mn(t,Oe)),Qe(t,r),n===1&&K===0&&!(e.mode&1)&&(Ei=me()+500,Sl&&Qn()))}function Qe(t,e){var n=t.callbackNode;qE(t,e);var r=Da(t,t===Ae?Oe:0);if(r===0)n!==null&&$d(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&$d(n),e===1)t.tag===0?Kw(Ug.bind(null,t)):Ey(Ug.bind(null,t)),Xw(function(){!(K&6)&&Qn()}),n=null;else{switch(Z0(r)){case 1:n=$f;break;case 4:n=X0;break;case 16:n=Fa;break;case 536870912:n=Y0;break;default:n=Fa}n=vv(n,fv.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function fv(t,e){if(va=-1,_a=0,K&6)throw Error(R(327));var n=t.callbackNode;if(ci()&&t.callbackNode!==n)return null;var r=Da(t,t===Ae?Oe:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=tl(t,r);else{e=r;var i=K;K|=2;var s=dv();(Ae!==t||Oe!==e)&&(rn=null,Ei=me()+500,dr(t,e));do try{yT();break}catch(a){hv(t,a)}while(!0);ah(),Qa.current=s,K=i,_e!==null?e=0:(Ae=null,Oe=0,e=Te)}if(e!==0){if(e===2&&(i=Ac(t),i!==0&&(r=i,e=tf(t,i))),e===1)throw n=Bs,dr(t,0),Mn(t,r),Qe(t,me()),n;if(e===6)Mn(t,r);else{if(i=t.current.alternate,!(r&30)&&!pT(i)&&(e=tl(t,r),e===2&&(s=Ac(t),s!==0&&(r=s,e=tf(t,s))),e===1))throw n=Bs,dr(t,0),Mn(t,r),Qe(t,me()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(R(345));case 2:ar(t,$e,rn);break;case 3:if(Mn(t,r),(r&130023424)===r&&(e=Th+500-me(),10<e)){if(Da(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){We(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Nc(ar.bind(null,t,$e,rn),e);break}ar(t,$e,rn);break;case 4:if(Mn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Ot(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=me()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*gT(r/1960))-r,10<r){t.timeoutHandle=Nc(ar.bind(null,t,$e,rn),r);break}ar(t,$e,rn);break;case 5:ar(t,$e,rn);break;default:throw Error(R(329))}}}return Qe(t,me()),t.callbackNode===n?fv.bind(null,t):null}function tf(t,e){var n=ys;return t.current.memoizedState.isDehydrated&&(dr(t,e).flags|=256),t=tl(t,e),t!==2&&(e=$e,$e=n,e!==null&&nf(e)),t}function nf(t){$e===null?$e=t:$e.push.apply($e,t)}function pT(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Nt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Mn(t,e){for(e&=~wh,e&=~Cl,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Ot(e),r=1<<n;t[n]=-1,e&=~r}}function Ug(t){if(K&6)throw Error(R(327));ci();var e=Da(t,0);if(!(e&1))return Qe(t,me()),null;var n=tl(t,e);if(t.tag!==0&&n===2){var r=Ac(t);r!==0&&(e=r,n=tf(t,r))}if(n===1)throw n=Bs,dr(t,0),Mn(t,e),Qe(t,me()),n;if(n===6)throw Error(R(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,ar(t,$e,rn),Qe(t,me()),null}function bh(t,e){var n=K;K|=1;try{return t(e)}finally{K=n,K===0&&(Ei=me()+500,Sl&&Qn())}}function Er(t){Rn!==null&&Rn.tag===0&&!(K&6)&&ci();var e=K;K|=1;var n=_t.transition,r=Q;try{if(_t.transition=null,Q=1,t)return t()}finally{Q=r,_t.transition=n,K=e,!(K&6)&&Qn()}}function xh(){rt=ti.current,oe(ti)}function dr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,Hw(n)),_e!==null)for(n=_e.return;n!==null;){var r=n;switch(ih(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ja();break;case 3:vi(),oe(Ke),oe(Ue),dh();break;case 5:hh(r);break;case 4:vi();break;case 13:oe(ce);break;case 19:oe(ce);break;case 10:lh(r.type._context);break;case 22:case 23:xh()}n=n.return}if(Ae=t,_e=t=Wn(t.current,null),Oe=rt=e,Te=0,Bs=null,wh=Cl=_r=0,$e=ys=null,cr!==null){for(e=0;e<cr.length;e++)if(n=cr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}cr=null}return t}function hv(t,e){do{var n=_e;try{if(ah(),pa.current=qa,Ka){for(var r=he.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Ka=!1}if(vr=0,Se=we=he=null,ps=!1,Fs=0,Eh.current=null,n===null||n.return===null){Te=1,Bs=e,_e=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Oe,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,f=c.tag;if(!(c.mode&1)&&(f===0||f===11||f===15)){var h=c.alternate;h?(c.updateQueue=h.updateQueue,c.memoizedState=h.memoizedState,c.lanes=h.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=Ag(o);if(d!==null){d.flags&=-257,Lg(d,o,a,s,e),d.mode&1&&Pg(s,u,e),e=d,l=u;var p=e.updateQueue;if(p===null){var E=new Set;E.add(l),e.updateQueue=E}else p.add(l);break e}else{if(!(e&1)){Pg(s,u,e),Sh();break e}l=Error(R(426))}}else if(le&&a.mode&1){var b=Ag(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Lg(b,o,a,s,e),sh(_i(l,a));break e}}s=l=_i(l,a),Te!==4&&(Te=2),ys===null?ys=[s]:ys.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var y=Zy(s,l,e);Eg(s,y);break e;case 1:a=l;var m=s.type,_=s.stateNode;if(!(s.flags&128)&&(typeof m.getDerivedStateFromError=="function"||_!==null&&typeof _.componentDidCatch=="function"&&(jn===null||!jn.has(_)))){s.flags|=65536,e&=-e,s.lanes|=e;var T=Ky(s,a,e);Eg(s,T);break e}}s=s.return}while(s!==null)}pv(n)}catch(S){e=S,_e===n&&n!==null&&(_e=n=n.return);continue}break}while(!0)}function dv(){var t=Qa.current;return Qa.current=qa,t===null?qa:t}function Sh(){(Te===0||Te===3||Te===2)&&(Te=4),Ae===null||!(_r&268435455)&&!(Cl&268435455)||Mn(Ae,Oe)}function tl(t,e){var n=K;K|=2;var r=dv();(Ae!==t||Oe!==e)&&(rn=null,dr(t,e));do try{mT();break}catch(i){hv(t,i)}while(!0);if(ah(),K=n,Qa.current=r,_e!==null)throw Error(R(261));return Ae=null,Oe=0,Te}function mT(){for(;_e!==null;)gv(_e)}function yT(){for(;_e!==null&&!jE();)gv(_e)}function gv(t){var e=yv(t.alternate,t,rt);t.memoizedProps=t.pendingProps,e===null?pv(t):_e=e,Eh.current=null}function pv(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=cT(n,e),n!==null){n.flags&=32767,_e=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Te=6,_e=null;return}}else if(n=uT(n,e,rt),n!==null){_e=n;return}if(e=e.sibling,e!==null){_e=e;return}_e=e=t}while(e!==null);Te===0&&(Te=5)}function ar(t,e,n){var r=Q,i=_t.transition;try{_t.transition=null,Q=1,vT(t,e,n,r)}finally{_t.transition=i,Q=r}return null}function vT(t,e,n,r){do ci();while(Rn!==null);if(K&6)throw Error(R(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(R(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(QE(t,s),t===Ae&&(_e=Ae=null,Oe=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||jo||(jo=!0,vv(Fa,function(){return ci(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=_t.transition,_t.transition=null;var o=Q;Q=1;var a=K;K|=4,Eh.current=null,hT(t,n),uv(n,t),zw(Rc),za=!!Oc,Rc=Oc=null,t.current=n,dT(n),GE(),K=a,Q=o,_t.transition=s}else t.current=n;if(jo&&(jo=!1,Rn=t,el=i),s=t.pendingLanes,s===0&&(jn=null),XE(n.stateNode),Qe(t,me()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Ja)throw Ja=!1,t=Jc,Jc=null,t;return el&1&&t.tag!==0&&ci(),s=t.pendingLanes,s&1?t===ef?vs++:(vs=0,ef=t):vs=0,Qn(),null}function ci(){if(Rn!==null){var t=Z0(el),e=_t.transition,n=Q;try{if(_t.transition=null,Q=16>t?16:t,Rn===null)var r=!1;else{if(t=Rn,Rn=null,el=0,K&6)throw Error(R(331));var i=K;for(K|=4,z=t.current;z!==null;){var s=z,o=s.child;if(z.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(z=u;z!==null;){var c=z;switch(c.tag){case 0:case 11:case 15:ms(8,c,s)}var f=c.child;if(f!==null)f.return=c,z=f;else for(;z!==null;){c=z;var h=c.sibling,d=c.return;if(ov(c),c===u){z=null;break}if(h!==null){h.return=d,z=h;break}z=d}}}var p=s.alternate;if(p!==null){var E=p.child;if(E!==null){p.child=null;do{var b=E.sibling;E.sibling=null,E=b}while(E!==null)}}z=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,z=o;else e:for(;z!==null;){if(s=z,s.flags&2048)switch(s.tag){case 0:case 11:case 15:ms(9,s,s.return)}var y=s.sibling;if(y!==null){y.return=s.return,z=y;break e}z=s.return}}var m=t.current;for(z=m;z!==null;){o=z;var _=o.child;if(o.subtreeFlags&2064&&_!==null)_.return=o,z=_;else e:for(o=m;z!==null;){if(a=z,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Ll(9,a)}}catch(S){pe(a,a.return,S)}if(a===o){z=null;break e}var T=a.sibling;if(T!==null){T.return=a.return,z=T;break e}z=a.return}}if(K=i,Qn(),Zt&&typeof Zt.onPostCommitFiberRoot=="function")try{Zt.onPostCommitFiberRoot(El,t)}catch{}r=!0}return r}finally{Q=n,_t.transition=e}}return!1}function Vg(t,e,n){e=_i(n,e),e=Zy(t,e,1),t=Vn(t,e,1),e=We(),t!==null&&(Qs(t,1,e),Qe(t,e))}function pe(t,e,n){if(t.tag===3)Vg(t,t,n);else for(;e!==null;){if(e.tag===3){Vg(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(jn===null||!jn.has(r))){t=_i(n,t),t=Ky(e,t,1),e=Vn(e,t,1),t=We(),e!==null&&(Qs(e,1,t),Qe(e,t));break}}e=e.return}}function _T(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=We(),t.pingedLanes|=t.suspendedLanes&n,Ae===t&&(Oe&n)===n&&(Te===4||Te===3&&(Oe&130023424)===Oe&&500>me()-Th?dr(t,0):wh|=n),Qe(t,e)}function mv(t,e){e===0&&(t.mode&1?(e=Oo,Oo<<=1,!(Oo&130023424)&&(Oo=4194304)):e=1);var n=We();t=dn(t,e),t!==null&&(Qs(t,e,n),Qe(t,n))}function ET(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),mv(t,n)}function wT(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(R(314))}r!==null&&r.delete(e),mv(t,n)}var yv;yv=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Ke.current)Ze=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ze=!1,lT(t,e,n);Ze=!!(t.flags&131072)}else Ze=!1,le&&e.flags&1048576&&wy(e,Ha,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ya(t,e),t=e.pendingProps;var i=pi(e,Ue.current);ui(e,n),i=ph(null,e,r,t,i,n);var s=mh();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,qe(r)?(s=!0,Ga(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ch(e),i.updater=Al,e.stateNode=i,i._reactInternals=e,jc(e,r,t,n),e=Hc(null,e,r,!0,s,n)):(e.tag=0,le&&s&&rh(e),je(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ya(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=bT(r),t=At(r,t),i){case 0:e=Wc(null,e,r,t,n);break e;case 1:e=Mg(null,e,r,t,n);break e;case 11:e=Cg(null,e,r,t,n);break e;case 14:e=Ig(null,e,r,At(r.type,t),n);break e}throw Error(R(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:At(r,i),Wc(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:At(r,i),Mg(t,e,r,i,n);case 3:e:{if(ev(e),t===null)throw Error(R(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Ay(t,e),$a(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=_i(Error(R(423)),e),e=Og(t,e,r,n,i);break e}else if(r!==i){i=_i(Error(R(424)),e),e=Og(t,e,r,n,i);break e}else for(st=Un(e.stateNode.containerInfo.firstChild),ot=e,le=!0,Ct=null,n=Sy(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(mi(),r===i){e=gn(t,e,n);break e}je(t,e,r,n)}e=e.child}return e;case 5:return Ly(e),t===null&&Bc(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,kc(r,i)?o=null:s!==null&&kc(r,s)&&(e.flags|=32),Jy(t,e),je(t,e,o,n),e.child;case 6:return t===null&&Bc(e),null;case 13:return tv(t,e,n);case 4:return fh(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=yi(e,null,r,n):je(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:At(r,i),Cg(t,e,r,i,n);case 7:return je(t,e,e.pendingProps,n),e.child;case 8:return je(t,e,e.pendingProps.children,n),e.child;case 12:return je(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ne(Xa,r._currentValue),r._currentValue=o,s!==null)if(Nt(s.value,o)){if(s.children===i.children&&!Ke.current){e=gn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=cn(-1,n&-n),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Uc(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(R(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Uc(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}je(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ui(e,n),i=wt(i),r=r(i),e.flags|=1,je(t,e,r,n),e.child;case 14:return r=e.type,i=At(r,e.pendingProps),i=At(r.type,i),Ig(t,e,r,i,n);case 15:return qy(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:At(r,i),ya(t,e),e.tag=1,qe(r)?(t=!0,Ga(e)):t=!1,ui(e,n),$y(e,r,i),jc(e,r,i,n),Hc(null,e,r,!0,t,n);case 19:return nv(t,e,n);case 22:return Qy(t,e,n)}throw Error(R(156,e.tag))};function vv(t,e){return H0(t,e)}function TT(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vt(t,e,n,r){return new TT(t,e,n,r)}function Ph(t){return t=t.prototype,!(!t||!t.isReactComponent)}function bT(t){if(typeof t=="function")return Ph(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Hf)return 11;if(t===Xf)return 14}return 2}function Wn(t,e){var n=t.alternate;return n===null?(n=vt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ea(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")Ph(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Hr:return gr(n.children,i,s,e);case Wf:o=8,i|=8;break;case hc:return t=vt(12,n,e,i|2),t.elementType=hc,t.lanes=s,t;case dc:return t=vt(13,n,e,i),t.elementType=dc,t.lanes=s,t;case gc:return t=vt(19,n,e,i),t.elementType=gc,t.lanes=s,t;case L0:return Il(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case P0:o=10;break e;case A0:o=9;break e;case Hf:o=11;break e;case Xf:o=14;break e;case Ln:o=16,r=null;break e}throw Error(R(130,t==null?t:typeof t,""))}return e=vt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function gr(t,e,n,r){return t=vt(7,t,r,e),t.lanes=n,t}function Il(t,e,n,r){return t=vt(22,t,r,e),t.elementType=L0,t.lanes=n,t.stateNode={isHidden:!1},t}function Su(t,e,n){return t=vt(6,t,null,e),t.lanes=n,t}function Pu(t,e,n){return e=vt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function xT(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ou(0),this.expirationTimes=ou(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ou(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Ah(t,e,n,r,i,s,o,a,l){return t=new xT(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=vt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ch(s),t}function ST(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Wr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function _v(t){if(!t)return $n;t=t._reactInternals;e:{if(Cr(t)!==t||t.tag!==1)throw Error(R(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(qe(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(R(171))}if(t.tag===1){var n=t.type;if(qe(n))return _y(t,n,e)}return e}function Ev(t,e,n,r,i,s,o,a,l){return t=Ah(n,r,!0,t,i,s,o,a,l),t.context=_v(null),n=t.current,r=We(),i=Gn(n),s=cn(r,i),s.callback=e??null,Vn(n,s,i),t.current.lanes=i,Qs(t,i,r),Qe(t,r),t}function Ml(t,e,n,r){var i=e.current,s=We(),o=Gn(i);return n=_v(n),e.context===null?e.context=n:e.pendingContext=n,e=cn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Vn(i,e,o),t!==null&&(Rt(t,i,o,s),ga(t,i,o)),o}function nl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function jg(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Lh(t,e){jg(t,e),(t=t.alternate)&&jg(t,e)}function PT(){return null}var wv=typeof reportError=="function"?reportError:function(t){console.error(t)};function Ch(t){this._internalRoot=t}Ol.prototype.render=Ch.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(R(409));Ml(t,e,null,null)};Ol.prototype.unmount=Ch.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Er(function(){Ml(null,t,null,null)}),e[hn]=null}};function Ol(t){this._internalRoot=t}Ol.prototype.unstable_scheduleHydration=function(t){if(t){var e=Q0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<In.length&&e!==0&&e<In[n].priority;n++);In.splice(n,0,t),n===0&&ey(t)}};function Ih(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Rl(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Gg(){}function AT(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var u=nl(o);s.call(u)}}var o=Ev(e,r,t,0,null,!1,!1,"",Gg);return t._reactRootContainer=o,t[hn]=o.current,Ms(t.nodeType===8?t.parentNode:t),Er(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var u=nl(l);a.call(u)}}var l=Ah(t,0,!1,null,null,!1,!1,"",Gg);return t._reactRootContainer=l,t[hn]=l.current,Ms(t.nodeType===8?t.parentNode:t),Er(function(){Ml(e,l,n,r)}),l}function kl(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=nl(o);a.call(l)}}Ml(e,o,t,i)}else o=AT(n,e,t,i,r);return nl(o)}K0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ss(e.pendingLanes);n!==0&&(Zf(e,n|1),Qe(e,me()),!(K&6)&&(Ei=me()+500,Qn()))}break;case 13:Er(function(){var r=dn(t,1);if(r!==null){var i=We();Rt(r,t,1,i)}}),Lh(t,1)}};Kf=function(t){if(t.tag===13){var e=dn(t,134217728);if(e!==null){var n=We();Rt(e,t,134217728,n)}Lh(t,134217728)}};q0=function(t){if(t.tag===13){var e=Gn(t),n=dn(t,e);if(n!==null){var r=We();Rt(n,t,e,r)}Lh(t,e)}};Q0=function(){return Q};J0=function(t,e){var n=Q;try{return Q=t,e()}finally{Q=n}};xc=function(t,e,n){switch(e){case"input":if(yc(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=xl(r);if(!i)throw Error(R(90));I0(r),yc(r,i)}}}break;case"textarea":O0(t,n);break;case"select":e=n.value,e!=null&&si(t,!!n.multiple,e,!1)}};B0=bh;U0=Er;var LT={usingClientEntryPoint:!1,Events:[eo,Zr,xl,D0,z0,bh]},Zi={findFiberByHostInstance:ur,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CT={bundleType:Zi.bundleType,version:Zi.version,rendererPackageName:Zi.rendererPackageName,rendererConfig:Zi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:yn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=G0(t),t===null?null:t.stateNode},findFiberByHostInstance:Zi.findFiberByHostInstance||PT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Go=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Go.isDisabled&&Go.supportsFiber)try{El=Go.inject(CT),Zt=Go}catch{}}ft.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LT;ft.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ih(e))throw Error(R(200));return ST(t,e,null,n)};ft.createRoot=function(t,e){if(!Ih(t))throw Error(R(299));var n=!1,r="",i=wv;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Ah(t,1,!1,null,null,n,!1,r,i),t[hn]=e.current,Ms(t.nodeType===8?t.parentNode:t),new Ch(e)};ft.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(R(188)):(t=Object.keys(t).join(","),Error(R(268,t)));return t=G0(e),t=t===null?null:t.stateNode,t};ft.flushSync=function(t){return Er(t)};ft.hydrate=function(t,e,n){if(!Rl(e))throw Error(R(200));return kl(null,t,e,!0,n)};ft.hydrateRoot=function(t,e,n){if(!Ih(t))throw Error(R(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=wv;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=Ev(e,null,t,1,n??null,i,!1,s,o),t[hn]=e.current,Ms(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Ol(e)};ft.render=function(t,e,n){if(!Rl(e))throw Error(R(200));return kl(null,t,e,!1,n)};ft.unmountComponentAtNode=function(t){if(!Rl(t))throw Error(R(40));return t._reactRootContainer?(Er(function(){kl(null,null,t,!1,function(){t._reactRootContainer=null,t[hn]=null})}),!0):!1};ft.unstable_batchedUpdates=bh;ft.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Rl(n))throw Error(R(200));if(t==null||t._reactInternals===void 0)throw Error(R(38));return kl(t,e,n,!1,r)};ft.version="18.3.1-next-f1338f8080-20240426";function Tv(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Tv)}catch(t){console.error(t)}}Tv(),T0.exports=ft;var bv=T0.exports,xv,Wg=bv;xv=Wg.createRoot,Wg.hydrateRoot;var IT=function t(e,n){if(e===n)return!0;if(e&&n&&typeof e=="object"&&typeof n=="object"){if(e.constructor!==n.constructor)return!1;var r,i,s;if(Array.isArray(e)){if(r=e.length,r!=n.length)return!1;for(i=r;i--!==0;)if(!t(e[i],n[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();if(s=Object.keys(e),r=s.length,r!==Object.keys(n).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[i]))return!1;for(i=r;i--!==0;){var o=s[i];if(!t(e[o],n[o]))return!1}return!0}return e!==e&&n!==n};const MT=_l(IT);function kt(){return kt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},kt.apply(null,arguments)}function wr(t,e){if(t==null)return{};var n={};for(var r in t)if({}.hasOwnProperty.call(t,r)){if(e.includes(r))continue;n[r]=t[r]}return n}function OT(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}function RT(t){var e=OT(t,"string");return typeof e=="symbol"?e:e+""}const on={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",LOADED:"LOADED",FAILED:"FAILED",AUTH_FAILURE:"AUTH_FAILURE"},kT="https://maps.googleapis.com/maps/api/js";class Us{static async load(e,n){var r;const i=e.libraries?e.libraries.split(","):[],s=this.serializeParams(e);this.listeners.push(n),(r=window.google)!=null&&(r=r.maps)!=null&&r.importLibrary?(this.serializedApiParams||(this.loadingStatus=on.LOADED),this.notifyLoadingStatusListeners()):(this.serializedApiParams=s,this.initImportLibrary(e)),this.serializedApiParams&&this.serializedApiParams!==s&&console.warn("[google-maps-api-loader] The maps API has already been loaded with different parameters and will not be loaded again. Refresh the page for new values to have effect.");const o=["maps",...i];await Promise.all(o.map(a=>google.maps.importLibrary(a)))}static serializeParams(e){return[e.v,e.key,e.language,e.region,e.authReferrerPolicy,e.solutionChannel].join("/")}static initImportLibrary(e){if(window.google||(window.google={}),window.google.maps||(window.google.maps={}),window.google.maps.importLibrary){console.error("[google-maps-api-loader-internal]: initImportLibrary must only be called once");return}let n=null;const r=()=>n||(n=new Promise((i,s)=>{var o;const a=document.createElement("script"),l=new URLSearchParams;for(const[u,c]of Object.entries(e)){const f=u.replace(/[A-Z]/g,h=>"_"+h[0].toLowerCase());l.set(f,c)}l.set("loading","async"),l.set("callback","__googleMapsCallback__"),a.async=!0,a.src=kT+"?"+l.toString(),a.nonce=((o=document.querySelector("script[nonce]"))==null?void 0:o.nonce)||"",a.onerror=()=>{this.loadingStatus=on.FAILED,this.notifyLoadingStatusListeners(),s(new Error("The Google Maps JavaScript API could not load."))},window.__googleMapsCallback__=()=>{this.loadingStatus=on.LOADED,this.notifyLoadingStatusListeners(),i()},window.gm_authFailure=()=>{this.loadingStatus=on.AUTH_FAILURE,this.notifyLoadingStatusListeners()},this.loadingStatus=on.LOADING,this.notifyLoadingStatusListeners(),document.head.append(a)}),n);google.maps.importLibrary=i=>r().then(()=>google.maps.importLibrary(i))}static notifyLoadingStatusListeners(){for(const e of this.listeners)e(this.loadingStatus)}}Us.loadingStatus=on.NOT_LOADED;Us.serializedApiParams=void 0;Us.listeners=[];const NT=["onLoad","onError","apiKey","version","libraries"],FT=["children"],DT="GMP_visgl_rgmlibrary_v1_default",no=ee.createContext(null);function zT(){const[t,e]=k.useState({});return{mapInstances:t,addMapInstance:(s,o="default")=>{e(a=>kt({},a,{[o]:s}))},removeMapInstance:(s="default")=>{e(o=>wr(o,[s].map(RT)))},clearMapInstances:()=>{e({})}}}function BT(t){const{onLoad:e,onError:n,apiKey:r,version:i,libraries:s=[]}=t,o=wr(t,NT),[a,l]=k.useState(Us.loadingStatus),[u,c]=k.useReducer((p,E)=>p[E.name]?p:kt({},p,{[E.name]:E.value}),{}),f=k.useMemo(()=>s==null?void 0:s.join(","),[s]),h=k.useMemo(()=>JSON.stringify(kt({apiKey:r,version:i},o)),[r,i,o]),d=k.useCallback(async p=>{var E;if(u[p])return u[p];if(!((E=google)!=null&&(E=E.maps)!=null&&E.importLibrary))throw new Error("[api-provider-internal] importLibrary was called before google.maps.importLibrary was defined.");const b=await window.google.maps.importLibrary(p);return c({name:p,value:b}),b},[u]);return k.useEffect(()=>{(async()=>{try{const p=kt({key:r},o);i&&(p.v=i),(f==null?void 0:f.length)>0&&(p.libraries=f),p.solutionChannel===void 0?p.solutionChannel=DT:p.solutionChannel===""&&delete p.solutionChannel,await Us.load(p,E=>l(E));for(const E of["core","maps",...s])await d(E);e&&e()}catch(p){n?n(p):console.error("<ApiProvider> failed to load the Google Maps JavaScript API",p)}})()},[r,f,h]),{status:a,loadedLibraries:u,importLibrary:d}}const UT=t=>{const{children:e}=t,n=wr(t,FT),{mapInstances:r,addMapInstance:i,removeMapInstance:s,clearMapInstances:o}=zT(),{status:a,loadedLibraries:l,importLibrary:u}=BT(n),c=k.useMemo(()=>({mapInstances:r,addMapInstance:i,removeMapInstance:s,clearMapInstances:o,status:a,loadedLibraries:l,importLibrary:u}),[r,i,s,o,a,l,u]);return ee.createElement(no.Provider,{value:c},e)};function VT(t,e){for(const n of HT){const r=e[n],i=Sv[n];k.useEffect(()=>{if(!t||!r)return;const s=google.maps.event.addListener(t,i,o=>{r(jT(i,t,o))});return()=>s.remove()},[t,i,r])}}function jT(t,e,n){const r={type:t,map:e,detail:{},stoppable:!1,stop:()=>{}};if(GT.includes(t)){const s=r,o=e.getCenter(),a=e.getZoom(),l=e.getHeading()||0,u=e.getTilt()||0,c=e.getBounds();return(!o||!c||!Number.isFinite(a))&&console.warn("[createEvent] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),s.detail={center:(o==null?void 0:o.toJSON())||{lat:0,lng:0},zoom:a||0,heading:l,tilt:u,bounds:(c==null?void 0:c.toJSON())||{north:90,east:180,south:-90,west:-180}},s}else if(WT.includes(t)){var i;if(!n)throw new Error("[createEvent] mouse events must provide a srcEvent");const s=r;return s.domEvent=n.domEvent,s.stoppable=!0,s.stop=()=>n.stop(),s.detail={latLng:((i=n.latLng)==null?void 0:i.toJSON())||null,placeId:n.placeId},s}return r}const Sv={onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onContextmenu:"contextmenu",onDblclick:"dblclick",onDrag:"drag",onDragend:"dragend",onDragstart:"dragstart",onHeadingChanged:"heading_changed",onIdle:"idle",onIsFractionalZoomEnabledChanged:"isfractionalzoomenabled_changed",onMapCapabilitiesChanged:"mapcapabilities_changed",onMapTypeIdChanged:"maptypeid_changed",onMousemove:"mousemove",onMouseout:"mouseout",onMouseover:"mouseover",onProjectionChanged:"projection_changed",onRenderingTypeChanged:"renderingtype_changed",onTilesLoaded:"tilesloaded",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed",onCameraChanged:"bounds_changed"},GT=["bounds_changed","center_changed","heading_changed","tilt_changed","zoom_changed"],WT=["click","contextmenu","dblclick","mousemove","mouseout","mouseover"],HT=Object.keys(Sv);function XT(t,e){const n=k.useRef(void 0);(!n.current||!MT(e,n.current))&&(n.current=e),k.useEffect(t,n.current)}const YT=new Set(["backgroundColor","clickableIcons","controlSize","disableDefaultUI","disableDoubleClickZoom","draggable","draggableCursor","draggingCursor","fullscreenControl","fullscreenControlOptions","gestureHandling","headingInteractionEnabled","isFractionalZoomEnabled","keyboardShortcuts","mapTypeControl","mapTypeControlOptions","mapTypeId","maxZoom","minZoom","noClear","panControl","panControlOptions","restriction","rotateControl","rotateControlOptions","scaleControl","scaleControlOptions","scrollwheel","streetView","streetViewControl","streetViewControlOptions","styles","tiltInteractionEnabled","zoomControl","zoomControlOptions"]);function $T(t,e){const n={},r=Object.keys(e);for(const i of r)YT.has(i)&&(n[i]=e[i]);XT(()=>{t&&t.setOptions(n)},[n])}function Pv(){var t;return((t=k.useContext(no))==null?void 0:t.status)||on.NOT_LOADED}function ZT(t,e){const{viewport:n,viewState:r}=e,i=!!n;return k.useLayoutEffect(()=>{if(!t||!r)return;const{latitude:s,longitude:o,bearing:a,pitch:l,zoom:u}=r;t.moveCamera({center:{lat:s,lng:o},heading:a,tilt:l,zoom:u+1})},[t,r]),i}function KT(t){return!t||typeof t!="object"||!("lat"in t&&"lng"in t)?!1:Number.isFinite(t.lat)&&Number.isFinite(t.lng)}function Av(t){return KT(t)?t:t.toJSON()}function qT(t,e,n){const r=n.center?Av(n.center):null;let i=null,s=null;r&&Number.isFinite(r.lat)&&Number.isFinite(r.lng)&&(i=r.lat,s=r.lng);const o=Number.isFinite(n.zoom)?n.zoom:null,a=Number.isFinite(n.heading)?n.heading:null,l=Number.isFinite(n.tilt)?n.tilt:null;k.useLayoutEffect(()=>{if(!t)return;const u={};let c=!1;i!==null&&s!==null&&(e.current.center.lat!==i||e.current.center.lng!==s)&&(u.center={lat:i,lng:s},c=!0),o!==null&&e.current.zoom!==o&&(u.zoom=o,c=!0),a!==null&&e.current.heading!==a&&(u.heading=a,c=!0),l!==null&&e.current.tilt!==l&&(u.tilt=l,c=!0),c&&t.moveCamera(u)})}const QT=()=>{const t={position:"absolute",top:0,left:0,bottom:0,right:0,zIndex:999,display:"flex",flexFlow:"column nowrap",textAlign:"center",justifyContent:"center",fontSize:".8rem",color:"rgba(0,0,0,0.6)",background:"#dddddd",padding:"1rem 1.5rem"};return ee.createElement("div",{style:t},ee.createElement("h2",null,"Error: AuthFailure"),ee.createElement("p",null,"A problem with your API key prevents the map from rendering correctly. Please make sure the value of the ",ee.createElement("code",null,"APIProvider.apiKey")," prop is correct. Check the error-message in the console for further details."))};function JT(){const[t,e]=k.useState(null),n=k.useCallback(r=>e(r),[e]);return[t,n]}function Lv(){return Pv()===on.LOADED}function eb(){const[,t]=k.useReducer(e=>e+1,0);return t}function tb(t,e){const n=t.getCenter(),r=t.getZoom(),i=t.getHeading()||0,s=t.getTilt()||0,o=t.getBounds();(!n||!o||!Number.isFinite(r))&&console.warn("[useTrackedCameraState] at least one of the values from the map returned undefined. This is not expected to happen. Please report an issue at https://github.com/visgl/react-google-maps/issues/new"),Object.assign(e.current,{center:(n==null?void 0:n.toJSON())||{lat:0,lng:0},zoom:r||0,heading:i,tilt:s})}function nb(t){const e=eb(),n=k.useRef({center:{lat:0,lng:0},heading:0,tilt:0,zoom:0});return k.useEffect(()=>{if(!t)return;const r=google.maps.event.addListener(t,"bounds_changed",()=>{tb(t,n),e()});return()=>r.remove()},[t,e]),n}const rb=["id","defaultBounds","defaultCenter","defaultZoom","defaultHeading","defaultTilt","reuseMaps","renderingType","colorScheme"],ib=["padding"];class wa{static has(e){return this.entries[e]&&this.entries[e].length>0}static pop(e){return this.entries[e]&&this.entries[e].pop()||null}static push(e,n){this.entries[e]||(this.entries[e]=[]),this.entries[e].push(n)}}wa.entries={};function sb(t,e){const n=Lv(),[r,i]=k.useState(null),[s,o]=JT(),a=nb(r),{id:l,defaultBounds:u,defaultCenter:c,defaultZoom:f,defaultHeading:h,defaultTilt:d,reuseMaps:p,renderingType:E,colorScheme:b}=t,y=wr(t,rb),m=t.zoom!==void 0||t.defaultZoom!==void 0,_=t.center!==void 0||t.defaultCenter!==void 0;!u&&(!m||!_)&&console.warn("<Map> component is missing configuration. You have to provide zoom and center (via the `zoom`/`defaultZoom` and `center`/`defaultCenter` props) or specify the region to show using `defaultBounds`. See https://visgl.github.io/react-google-maps/docs/api-reference/components/map#required"),!y.center&&c&&(y.center=c),!y.zoom&&Number.isFinite(f)&&(y.zoom=f),!y.heading&&Number.isFinite(h)&&(y.heading=h),!y.tilt&&Number.isFinite(d)&&(y.tilt=d);for(const S of Object.keys(y))y[S]===void 0&&delete y[S];const T=k.useRef();return k.useEffect(()=>{if(!s||!n)return;const{addMapInstance:S,removeMapInstance:P}=e,{mapId:L}=t,C=`${L||"default"}:${E||"default"}:${b||"LIGHT"}`;let I,M;if(p&&wa.has(C)?(M=wa.pop(C),I=M.getDiv(),s.appendChild(I),M.setOptions(y),setTimeout(()=>M.setCenter(M.getCenter()),0)):(I=document.createElement("div"),I.style.height="100%",s.appendChild(I),M=new google.maps.Map(I,kt({},y,E?{renderingType:E}:{},b?{colorScheme:b}:{}))),i(M),S(M,l),u){const{padding:B}=u,V=wr(u,ib);M.fitBounds(V,B)}else(!m||!_)&&M.fitBounds({east:180,west:-180,south:-90,north:90});if(T.current){const{mapId:B,cameraState:V}=T.current;B!==L&&M.setOptions(V)}return()=>{T.current={mapId:L,cameraState:a.current},I.remove(),p?wa.push(C,M):google.maps.event.clearInstanceListeners(M),i(null),P(l)}},[s,n,l,t.mapId,t.renderingType,t.colorScheme]),[r,o,a]}const Cv=ee.createContext(null),Iv=t=>{const{children:e,id:n,className:r,style:i}=t,s=k.useContext(no),o=Pv();if(!s)throw new Error("<Map> can only be used inside an <ApiProvider> component.");const[a,l,u]=sb(t,s);qT(a,u,t),VT(a,t),$T(a,t);const c=ZT(a,t),f=!!t.controlled;k.useEffect(()=>{if(a)return c&&a.setOptions({disableDefaultUI:!0}),(c||f)&&a.setOptions({gestureHandling:"none",keyboardShortcuts:!1}),()=>{a.setOptions({gestureHandling:t.gestureHandling,keyboardShortcuts:t.keyboardShortcuts})}},[a,c,f,t.gestureHandling,t.keyboardShortcuts]);const h=t.center?Av(t.center):null;let d=null,p=null;h&&Number.isFinite(h.lat)&&Number.isFinite(h.lng)&&(d=h.lat,p=h.lng);const E=k.useMemo(()=>{var m,_,T,S,P;return{center:{lat:(m=d)!=null?m:0,lng:(_=p)!=null?_:0},zoom:(T=t.zoom)!=null?T:0,heading:(S=t.heading)!=null?S:0,tilt:(P=t.tilt)!=null?P:0}},[d,p,t.zoom,t.heading,t.tilt]);k.useLayoutEffect(()=>{if(!a||!f)return;a.moveCamera(E);const m=a.addListener("bounds_changed",()=>{a.moveCamera(E)});return()=>m.remove()},[a,f,E]);const b=k.useMemo(()=>kt({width:"100%",height:"100%",position:"relative",zIndex:c?-1:0},i),[i,c]),y=k.useMemo(()=>({map:a}),[a]);return o===on.AUTH_FAILURE?ee.createElement("div",{style:kt({position:"relative"},r?{}:b),className:r},ee.createElement(QT,null)):ee.createElement("div",kt({ref:l,"data-testid":"map",style:r?void 0:b,className:r},n?{id:n}:{}),a?ee.createElement(Cv.Provider,{value:y},e):null)};Iv.deckGLViewProps=!0;const Hg=new Set;function ob(...t){const e=JSON.stringify(t);Hg.has(e)||(Hg.add(e),console.error(...t))}const Mh=(t=null)=>{const e=k.useContext(no),{map:n}=k.useContext(Cv)||{};if(e===null)return ob("useMap(): failed to retrieve APIProviderContext. Make sure that the <APIProvider> component exists and that the component you are calling `useMap()` from is a sibling of the <APIProvider>."),null;const{mapInstances:r}=e;return t!==null?r[t]||null:n||r.default||null};function ab(t){const e=Lv(),n=k.useContext(no);return k.useEffect(()=>{!e||!n||n.importLibrary(t)},[e,n,t]),(n==null?void 0:n.loadedLibraries[t])||null}function Wo(t,e,n){k.useEffect(()=>{if(!t||!e||!n)return;const r=google.maps.event.addListener(t,e,n);return()=>r.remove()},[t,e,n])}function Ho(t,e,n){k.useEffect(()=>{t&&(t[e]=n)},[t,e,n])}function Xg(t,e,n){k.useEffect(()=>{if(!(!t||!e||!n))return t.addEventListener(e,n),()=>t.removeEventListener(e,n)},[t,e,n])}const lb=["transform"],ub=ee.createContext(null),cb={TOP_LEFT:["0","0"],TOP_CENTER:["50%","0"],TOP:["50%","0"],TOP_RIGHT:["100%","0"],LEFT_CENTER:["0","50%"],LEFT_TOP:["0","0"],LEFT:["0","50%"],LEFT_BOTTOM:["0","100%"],RIGHT_TOP:["100%","0"],RIGHT:["100%","50%"],RIGHT_CENTER:["100%","50%"],RIGHT_BOTTOM:["100%","100%"],BOTTOM_LEFT:["0","100%"],BOTTOM_CENTER:["50%","100%"],BOTTOM:["50%","100%"],BOTTOM_RIGHT:["100%","100%"],CENTER:["50%","50%"]},fb=({children:t,styles:e,className:n,anchorPoint:r})=>{const[i,s]=r??cb.BOTTOM,o=e??{},{transform:a}=o,l=wr(o,lb);let u=`translate(-${i}, -${s})`;return a&&(u+=` ${a}`),ee.createElement("div",{className:n,style:kt({width:"fit-content",transformOrigin:`${i} ${s}`,transform:u},l)},t)};function hb(t){const[e,n]=k.useState(null),[r,i]=k.useState(null),s=Mh(),o=ab("marker"),{children:a,onClick:l,className:u,onMouseEnter:c,onMouseLeave:f,onDrag:h,onDragStart:d,onDragEnd:p,collisionBehavior:E,clickable:b,draggable:y,position:m,title:_,zIndex:T}=t,S=k.Children.count(a);return k.useEffect(()=>{if(!s||!o)return;const P=new o.AdvancedMarkerElement;P.map=s,n(P);let L=null;return S>0&&(L=document.createElement("div"),L.style.width="0",L.style.height="0",P.content=L,i(L)),()=>{var C;P.map=null,(C=L)==null||C.remove(),n(null),i(null)}},[s,o,S]),k.useEffect(()=>{!e||!e.content||S>0||(e.content.className=u||"")},[e,u,S]),Ho(e,"position",m),Ho(e,"title",_??""),Ho(e,"zIndex",T),Ho(e,"collisionBehavior",E),k.useEffect(()=>{e&&(y!==void 0?e.gmpDraggable=y:h||d||p?e.gmpDraggable=!0:e.gmpDraggable=!1)},[e,y,h,p,d]),k.useEffect(()=>{e&&(b!==void 0?e.gmpClickable=b:l?e.gmpClickable=!0:e.gmpClickable=!1)},[e,b,l]),Wo(e,"click",l),Wo(e,"drag",h),Wo(e,"dragstart",d),Wo(e,"dragend",p),Xg(e==null?void 0:e.element,"mouseenter",c),Xg(e==null?void 0:e.element,"mouseleave",f),[e,r]}k.forwardRef((t,e)=>{const{children:n,style:r,className:i,anchorPoint:s}=t,[o,a]=hb(t),l=k.useMemo(()=>o?{marker:o}:null,[o]);return k.useImperativeHandle(e,()=>o,[o]),a?ee.createElement(ub.Provider,{value:l},bv.createPortal(ee.createElement(fb,{anchorPoint:s,styles:r,className:i},n),a)):null});const db=["onClick","onDrag","onDragStart","onDragEnd","onMouseOver","onMouseOut"];function gb(t){const[e,n]=k.useState(null),r=Mh(),{onClick:i,onDrag:s,onDragStart:o,onDragEnd:a,onMouseOver:l,onMouseOut:u}=t,c=wr(t,db),{position:f,draggable:h}=c;return k.useEffect(()=>{if(!r){r===void 0&&console.error("<Marker> has to be inside a Map component.");return}const d=new google.maps.Marker(c);return d.setMap(r),n(d),()=>{d.setMap(null),n(null)}},[r]),k.useEffect(()=>{if(!e)return;const d=e,p=google.maps.event;return i&&p.addListener(d,"click",i),s&&p.addListener(d,"drag",s),o&&p.addListener(d,"dragstart",o),a&&p.addListener(d,"dragend",a),l&&p.addListener(d,"mouseover",l),u&&p.addListener(d,"mouseout",u),e.setDraggable(!!h),()=>{p.clearInstanceListeners(d)}},[e,h,i,s,o,a,l,u]),k.useEffect(()=>{e&&c&&e.setOptions(c)},[e,c]),k.useEffect(()=>{h||!f||!e||e.setPosition(f)},[h,f,e]),e}k.forwardRef((t,e)=>{const n=gb(t);return k.useImperativeHandle(e,()=>n,[n]),ee.createElement(ee.Fragment,null)});function Vs(t){"@babel/helpers - typeof";return Vs=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Vs(t)}function pb(t,e){if(Vs(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Vs(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mb(t){var e=pb(t,"string");return Vs(e)=="symbol"?e:e+""}function g(t,e,n){return(e=mb(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function rl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Oh=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),Yg=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Yg&&parseFloat(Yg[1]);const yb="3.4.15";function pn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ta=typeof process!="object"||String(process)!=="[object process]"||process.browser,vb=typeof window<"u"&&typeof window.orientation<"u",$g=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);$g&&parseFloat($g[1]);class _b{constructor(e,n){g(this,"name",void 0),g(this,"workerThread",void 0),g(this,"isRunning",!0),g(this,"result",void 0),g(this,"_resolve",()=>{}),g(this,"_reject",()=>{}),this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){pn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){pn(this.isRunning),this.isRunning=!1,this._reject(e)}}let Au=class{terminate(){}};const Lu=new Map;function Eb(t){pn(t.source&&!t.url||!t.source&&t.url);let e=Lu.get(t.source||t.url);return e||(t.url&&(e=wb(t.url),Lu.set(t.url,e)),t.source&&(e=Mv(t.source),Lu.set(t.source,e))),pn(e),e}function wb(t){if(!t.startsWith("http"))return t;const e=Tb(t);return Mv(e)}function Mv(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Tb(t){return`try {
  importScripts('`.concat(t,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}function Ov(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(Zg(t))r.add(t);else if(Zg(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)Ov(t[i],e,r)}}return n===void 0?Array.from(r):[]}function Zg(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Cu=()=>{};class rf{static isSupported(){return typeof Worker<"u"&&Ta||typeof Au<"u"&&!Ta}constructor(e){g(this,"name",void 0),g(this,"source",void 0),g(this,"url",void 0),g(this,"terminated",!1),g(this,"worker",void 0),g(this,"onMessage",void 0),g(this,"onError",void 0),g(this,"_loadableURL","");const{name:n,source:r,url:i}=e;pn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Cu,this.onError=s=>console.log(s),this.worker=Ta?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Cu,this.onError=Cu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||Ov(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(n+="".concat(e.message," in ")),e.lineno&&(n+=":".concat(e.lineno,":").concat(e.colno)),new Error(n)}_createBrowserWorker(){this._loadableURL=Eb({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Au(r,{eval:!1})}else if(this.source)e=new Au(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class bb{static isSupported(){return rf.isSupported()}constructor(e){g(this,"name","unnamed"),g(this,"source",void 0),g(this,"url",void 0),g(this,"maxConcurrency",1),g(this,"maxMobileConcurrency",1),g(this,"onDebug",()=>{}),g(this,"reuseWorkers",!0),g(this,"props",{}),g(this,"jobQueue",[]),g(this,"idleQueue",[]),g(this,"count",0),g(this,"isDestroyed",!1),this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new _b(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new rf({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return vb?this.maxMobileConcurrency:this.maxConcurrency}}const xb={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class an{static isSupported(){return rf.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return an._workerFarm=an._workerFarm||new an({}),an._workerFarm.setProps(e),an._workerFarm}constructor(e){g(this,"props",void 0),g(this,"workerPools",new Map),this.props={...xb},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new bb({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}g(an,"_workerFarm",void 0);const Sb="latest";function Pb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r="".concat(t.id,"-worker.js");let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(i="modules/".concat(t.module,"/dist/").concat(r)),!i){let s=t.version;s==="latest"&&(s=Sb);const o=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(t.module).concat(o,"/dist/").concat(r)}return pn(i),i}function Ab(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:yb;pn(t,"no worker provided");const n=t.version;return!(!e||!n)}function Lb(t,e){return!an.isSupported()||!Ta&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function Cb(t,e,n,r,i){const s=t.id,o=Pb(t,n),l=an.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const u=await l.startJob("process-on-worker",Ib.bind(null,i));return u.postMessage("process",{input:e,options:n,context:r}),await(await u.result).result}async function Ib(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn("parse-with-worker unknown message ".concat(n))}}function Mb(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function Ob(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];const r=e.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),i=r.reduce((a,l)=>a+l.byteLength,0),s=new Uint8Array(i);let o=0;for(const a of r)s.set(a,o),o+=a.byteLength;return s.buffer}async function Rb(t){const e=[];for await(const n of t)e.push(n);return Ob(...e)}function Kg(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class qg{constructor(e,n){g(this,"name",void 0),g(this,"type",void 0),g(this,"sampleSize",1),g(this,"time",void 0),g(this,"count",void 0),g(this,"samples",void 0),g(this,"lastTiming",void 0),g(this,"lastSampleTime",void 0),g(this,"lastSampleCount",void 0),g(this,"_count",0),g(this,"_time",0),g(this,"_samples",0),g(this,"_startTime",0),g(this,"_timerPending",!1),this.name=e,this.type=n,this.reset()}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Kg(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Kg()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Rh{constructor(e){g(this,"id",void 0),g(this,"stats",{}),this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"count";return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e in this.stats)this.stats[e].reset();return this}forEach(e){for(const n in this.stats)e(this.stats[n])}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(){(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).forEach(n=>this._getOrCreate(n))}_getOrCreate(e){if(!e||!e.name)return null;const{name:n,type:r}=e;return this.stats[n]||(e instanceof qg?this.stats[n]=e:this.stats[n]=new qg(n,r)),this.stats[n]}}let kb="";const Qg={};function Nb(t){for(const e in Qg)if(t.startsWith(e)){const n=Qg[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t="".concat(kb).concat(t)),t}function Fb(t){return t&&typeof t=="object"&&t.isBuffer}function Rv(t){if(Fb(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function kv(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function Db(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const zb=t=>typeof t=="boolean",_s=t=>typeof t=="function",ro=t=>t!==null&&typeof t=="object",Jg=t=>ro(t)&&t.constructor==={}.constructor,Bb=t=>t&&typeof t[Symbol.iterator]=="function",Ub=t=>t&&typeof t[Symbol.asyncIterator]=="function",Ir=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Mr=t=>typeof Blob<"u"&&t instanceof Blob,Vb=t=>t&&typeof t=="object"&&t.isBuffer,jb=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||ro(t)&&_s(t.tee)&&_s(t.cancel)&&_s(t.getReader),Gb=t=>ro(t)&&_s(t.read)&&_s(t.pipe)&&zb(t.readable),Nv=t=>jb(t)||Gb(t),Wb=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Hb=/^([-\w.]+\/[-\w.+]+)/;function Xb(t){const e=Hb.exec(t);return e?e[1]:t}function ep(t){const e=Wb.exec(t);return e?e[1]:""}const Fv=/\?.*/;function Yb(t){const e=t.match(Fv);return e&&e[0]}function kh(t){return t.replace(Fv,"")}function Nl(t){return Ir(t)?t.url:Mr(t)?t.name||"":typeof t=="string"?t:""}function Nh(t){if(Ir(t)){const e=t,n=e.headers.get("content-type")||"",r=kh(e.url);return Xb(n)||ep(r)}return Mr(t)?t.type||"":typeof t=="string"?ep(t):""}function $b(t){return Ir(t)?t.headers["content-length"]||-1:Mr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function Dv(t){if(Ir(t))return t;const e={},n=$b(t);n>=0&&(e["content-length"]=String(n));const r=Nl(t),i=Nh(t);i&&(e["content-type"]=i);const s=await qb(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function Zb(t){if(!t.ok){const e=await Kb(t);throw new Error(e)}}async function Kb(t){let e="Failed to fetch resource ".concat(t.url," (").concat(t.status,"): ");try{const n=t.headers.get("Content-Type");let r=t.statusText;n.includes("application/json")&&(r+=" ".concat(await t.text())),e+=r,e=e.length>60?"".concat(e.slice(0,60),"..."):e}catch{}return e}async function qb(t){if(typeof t=="string")return"data:,".concat(t.slice(0,5));if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5),r=Qb(n);return"data:base64,".concat(r)}return null}function Qb(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}async function tp(t,e){if(typeof t=="string"){t=Nb(t);let n=e;return e!=null&&e.fetch&&typeof(e==null?void 0:e.fetch)!="function"&&(n=e.fetch),await fetch(t,n)}return await Dv(t)}function zv(t){if(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron)return!0;const n=typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent;return!!(n&&n.indexOf("Electron")>=0)}function vn(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process.browser)||zv()}const ba={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:typeof process=="object"&&process},Xo=ba.window||ba.self||ba.global,Ki=ba.process||{},Bv=typeof __VERSION__<"u"?__VERSION__:"untranspiled source";vn();const Iu=globalThis;function Uv(t){if(!vn())return"Node";if(zv())return"Electron";const n=(typeof navigator<"u"?navigator:{}).userAgent||"";if(n.indexOf("Edge")>-1)return"Edge";const r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i?"IE":Iu.chrome?"Chrome":Iu.safari?"Safari":Iu.mozInnerScreenX?"Firefox":"Unknown"}function Jb(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class ex{constructor(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";g(this,"storage",void 0),g(this,"id",void 0),g(this,"config",void 0),this.storage=Jb(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function tx(t){let e;return t<10?e="".concat(t.toFixed(2),"ms"):t<100?e="".concat(t.toFixed(1),"ms"):t<1e3?e="".concat(t.toFixed(0),"ms"):e="".concat((t/1e3).toFixed(2),"s"),e}function nx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8;const n=Math.max(e-t.length,0);return"".concat(" ".repeat(n)).concat(t)}function Mu(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600;const i=t.src.replace(/\(/g,"%28").replace(/\)/g,"%29");t.width>r&&(n=Math.min(n,r/t.width));const s=t.width*n,o=t.height*n,a=["font-size:1px;","padding:".concat(Math.floor(o/2),"px ").concat(Math.floor(s/2),"px;"),"line-height:".concat(o,"px;"),"background:url(".concat(i,");"),"background-size:".concat(s,"px ").concat(o,"px;"),"color:transparent;"].join("");return["".concat(e," %c+"),a]}let il;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(il||(il={}));function np(t){return typeof t=="string"?il[t.toUpperCase()]||il.WHITE:t}function rx(t,e,n){return!vn&&typeof t=="string"&&(e&&(e=np(e),t="\x1B[".concat(e,"m").concat(t,"\x1B[39m")),n&&(e=np(n),t="\x1B[".concat(n+10,"m").concat(t,"\x1B[49m"))),t}function ix(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"];const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n);for(const i of r)typeof t[i]=="function"&&(e.find(s=>i===s)||(t[i]=t[i].bind(t)))}function sl(t,e){if(!t)throw new Error(e||"Assertion failed")}function Dr(){let t;if(vn&&"performance"in Xo){var e,n;t=Xo==null||(e=Xo.performance)===null||e===void 0||(n=e.now)===null||n===void 0?void 0:n.call(e)}else if("hrtime"in Ki){var r;const i=Ki==null||(r=Ki.hrtime)===null||r===void 0?void 0:r.call(Ki);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const zr={debug:vn&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},sx={enabled:!0,level:0};function pt(){}const rp={},ip={once:!0};class io{constructor(){let{id:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""};g(this,"id",void 0),g(this,"VERSION",Bv),g(this,"_startTs",Dr()),g(this,"_deltaTs",Dr()),g(this,"_storage",void 0),g(this,"userData",{}),g(this,"LOG_THROTTLE_TIMEOUT",0),this.id=e,this.userData={},this._storage=new ex("__probe-".concat(this.id,"__"),sx),this.timeStamp("".concat(this.id," started")),ix(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Dr()-this._startTs).toPrecision(10))}getDelta(){return Number((Dr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){sl(e,n)}warn(e){return this._getLogFunction(0,e,zr.warn,arguments,ip)}error(e){return this._getLogFunction(0,e,zr.error,arguments)}deprecated(e,n){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}removed(e,n){return this.error("`".concat(e,"` has been removed. Use `").concat(n,"` instead"))}probe(e,n){return this._getLogFunction(e,n,zr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,zr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),s=2;s<r;s++)i[s-2]=arguments[s];return this._getLogFunction(e,n,zr.debug||zr.info,arguments,ip)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||pt,r&&[r],{tag:ux(n)}):pt}image(e){let{logLevel:n,priority:r,image:i,message:s="",scale:o=1}=e;return this._shouldLog(n||r)?vn?lx({image:i,message:s,scale:o}):ax():pt}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||pt)}group(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1};const i=sp({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||pt)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Vv(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=sp({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,sl(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Dr();const o=s.tag||s.message;if(s.once)if(!rp[o])rp[o]=Dr();else return pt;return n=ox(this.id,s.message,s),r.bind(console,n,...s.args)}return pt}}g(io,"VERSION",Bv);function Vv(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return sl(Number.isFinite(e)&&e>=0),e}function sp(t){const{logLevel:e,message:n}=t;t.logLevel=Vv(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return sl(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function ox(t,e,n){if(typeof e=="string"){const r=n.time?nx(tx(n.total)):"";e=n.time?"".concat(t,": ").concat(r,"  ").concat(e):"".concat(t,": ").concat(e),e=rx(e,n.color,n.background)}return e}function ax(t){return console.warn("removed"),pt}function lx(t){let{image:e,message:n="",scale:r=1}=t;if(typeof e=="string"){const s=new Image;return s.onload=()=>{const o=Mu(s,n,r);console.log(...o)},s.src=e,pt}const i=e.nodeName||"";if(i.toLowerCase()==="img")return console.log(...Mu(e,n,r)),pt;if(i.toLowerCase()==="canvas"){const s=new Image;return s.onload=()=>console.log(...Mu(s,n,r)),s.src=e.toDataURL(),pt}return pt}function ux(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const op=new io({id:"loaders.gl"});class cx{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class fx{constructor(){g(this,"console",void 0),this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const jv={fetch:null,mimeType:void 0,nothrow:!1,log:new fx,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oh,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},hx={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Gv(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}const Wv=()=>{const t=Gv();return t.globalOptions=t.globalOptions||{...jv},t.globalOptions};function dx(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],gx(t,n),mx(e,t,r)}function gx(t,e){ap(t,null,jv,hx,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};ap(r,n.id,i,s,e)}}function ap(t,e,n,r,i){const s=e||"Top level",o=e?"".concat(e,"."):"";for(const a in t){const l=!e&&ro(t[a]),u=a==="baseUri"&&!e,c=a==="workerUrl"&&e;if(!(a in n)&&!u&&!c){if(a in r)op.warn("".concat(s," loader option '").concat(o).concat(a,"' no longer supported, use '").concat(r[a],"'"))();else if(!l){const f=px(a,i);op.warn("".concat(s," loader option '").concat(o).concat(a,"' not recognized. ").concat(f))()}}}}function px(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return"Did you mean '".concat(i.id,".").concat(s,"'?");const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||"Did you mean '".concat(i.id,".").concat(s,"'?"))}return r}function mx(t,e,n){const i={...t.options||{}};return yx(i,n),i.log===null&&(i.log=new cx),lp(i,Wv()),lp(i,e),i}function lp(t,e){for(const n in e)if(n in e){const r=e[n];Jg(r)&&Jg(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function yx(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function Fh(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Dh(t){var e,n;rl(t,"null loader"),rl(Fh(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const Hv=()=>{const t=Gv();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function vx(t){const e=Hv();t=Array.isArray(t)?t:[t];for(const n of t){const r=Dh(n);e.find(i=>r===i)||e.unshift(r)}}function _x(){return Hv()}const Ex=new io({id:"loaders.gl"}),wx=/\.([^.]+)$/;async function Tx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Xv(t))return null;let i=up(t,e,{...n,nothrow:!0},r);if(i)return i;if(Mr(t)&&(t=await t.slice(0,10).arrayBuffer(),i=up(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(Yv(t));return i}function up(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Xv(t))return null;if(e&&!Array.isArray(e))return Dh(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(..._x()),xx(i);const s=bx(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(Yv(t));return s}function bx(t,e,n,r){const i=Nl(t),s=Nh(t),o=kh(i)||(r==null?void 0:r.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Ou(e,n==null?void 0:n.mimeType),l="match forced by supplied MIME type ".concat(n==null?void 0:n.mimeType)),a=a||Sx(e,o),l=l||(a?"matched url ".concat(o):""),a=a||Ou(e,s),l=l||(a?"matched MIME type ".concat(s):""),a=a||Ax(e,t),l=l||(a?"matched initial data ".concat($v(t)):""),a=a||Ou(e,n==null?void 0:n.fallbackMimeType),l=l||(a?"matched fallback MIME type ".concat(s):""),l){var u;Ex.log(1,"selectLoader selected ".concat((u=a)===null||u===void 0?void 0:u.name,": ").concat(l,"."))}return a}function Xv(t){return!(t instanceof Response&&t.status===204)}function Yv(t){const e=Nl(t),n=Nh(t);let r="No valid loader found (";r+=e?"".concat(kv(e),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");const i=t?$v(t):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")",r}function xx(t){for(const e of t)Dh(e)}function Sx(t,e){const n=e&&wx.exec(e),r=n&&n[1];return r?Px(t,r):null}function Px(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Ou(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e==="application/x.".concat(n.id))return n;return null}function Ax(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(Lx(e,n))return n}else if(ArrayBuffer.isView(e)){if(cp(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&cp(e,0,n))return n;return null}function Lx(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function cp(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>Cx(t,e,n,i))}function Cx(t,e,n,r){if(r instanceof ArrayBuffer)return Mb(r,t,r.byteLength);switch(typeof r){case"function":return r(t,n);case"string":const i=sf(t,e,r.length);return r===i;default:return!1}}function $v(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?sf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?sf(t,0,e):""}function sf(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const Ix=256*1024;function*Mx(t,e){const n=(e==null?void 0:e.chunkSize)||Ix;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const Ox=256*1024;function Rx(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=Ox}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}()}const kx=1024*1024;async function*Nx(t,e){const n=(e==null?void 0:e.chunkSize)||kx;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function fp(t,e){return Oh?Fx(t,e):Dx(t)}async function*Fx(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield Rv(o)}}catch{n.releaseLock()}}async function*Dx(t,e){for await(const n of t)yield Rv(n)}function zx(t,e){if(typeof t=="string")return Mx(t,e);if(t instanceof ArrayBuffer)return Rx(t,e);if(Mr(t))return Nx(t,e);if(Nv(t))return fp(t,e);if(Ir(t))return fp(t.body,e);throw new Error("makeIterator")}const Zv="Cannot convert supplied data type";function Bx(t,e,n){if(e.text&&typeof t=="string")return t;if(Vb(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(Zv)}async function Ux(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return Bx(t,e);if(Mr(t)&&(t=await Dv(t)),Ir(t)){const i=t;return await Zb(i),e.binary?await i.arrayBuffer():await i.text()}if(Nv(t)&&(t=zx(t,n)),Bb(t)||Ub(t))return Rb(t);throw new Error(Zv)}function Kv(t,e){const n=Wv(),r=t||n;return typeof r.fetch=="function"?r.fetch:ro(r.fetch)?i=>tp(i,r):e!=null&&e.fetch?e==null?void 0:e.fetch:tp}function Vx(t,e,n){if(n)return n;const r={fetch:Kv(e,t),...t};if(r.url){const i=kh(r.url);r.baseUrl=i,r.queryString=Yb(r.url),r.filename=kv(i),r.baseUrl=Db(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function jx(t,e){if(!e&&t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:null}async function zh(t,e,n,r){pn(!r||typeof r=="object"),e&&!Array.isArray(e)&&!Fh(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Nl(t),o=jx(e,r),a=await Tx(t,o,n);return a?(n=dx(n,a,o,i),r=Vx({url:i,parse:zh,loaders:o},n,r||null),await Gx(a,t,n,r)):null}async function Gx(t,e,n,r){if(Ab(t),Ir(e)){const i=e,{ok:s,redirected:o,status:a,statusText:l,type:u,url:c}=i,f=Object.fromEntries(i.headers.entries());r.response={headers:f,ok:s,redirected:o,status:a,statusText:l,type:u,url:c}}if(e=await Ux(e,t,n),t.parseTextSync&&typeof e=="string")return n.dataType="text",t.parseTextSync(e,n,r,t);if(Lb(t,n))return await Cb(t,e,n,r,zh);if(t.parseText&&typeof e=="string")return await t.parseText(e,n,r,t);if(t.parse)return await t.parse(e,n,r,t);throw pn(!t.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"))}async function ol(t,e,n,r){!Array.isArray(e)&&!Fh(e)&&(n=e,e=void 0);const i=Kv(n);let s=t;return typeof t=="string"&&(s=await i(t)),Mr(t)&&(s=await i(t)),await zh(s,e,n)}const Wx="3.4.15",{_parseImageNode:Hx}=globalThis,of=typeof Image<"u",af=typeof ImageBitmap<"u",Xx=!!Hx,lf=Oh?!0:Xx;function Yx(t){switch(t){case"auto":return af||of||lf;case"imagebitmap":return af;case"image":return of;case"data":return lf;default:throw new Error("@loaders.gl/images: image ".concat(t," not supported in this environment"))}}function $x(){if(af)return"imagebitmap";if(of)return"image";if(lf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function Zx(t){const e=qx(t);if(!e)throw new Error("Not an image");return e}function Kx(t){switch(Zx(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function qx(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const Qx=/^data:image\/svg\+xml/,Jx=/\.svg((\?|#).*)?$/;function Bh(t){return t&&(Qx.test(t)||Jx.test(t))}function eS(t,e){if(Bh(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return"data:image/svg+xml;base64,".concat(btoa(r))}return qv(t,e)}function qv(t,e){if(Bh(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function Qv(t,e,n){const r=eS(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await tS(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function tS(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>i(new Error("Could not load image ".concat(t,": ").concat(s)))}catch(s){i(s)}})}const nS={};let hp=!0;async function rS(t,e,n){let r;Bh(n)?r=await Qv(t,e,n):r=qv(t,n);const i=e&&e.imagebitmap;return await iS(r,i)}async function iS(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((sS(e)||!hp)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),hp=!1}return await createImageBitmap(t)}function sS(t){for(const e in t||nS)return!1;return!0}function oS(t){return!cS(t,"ftyp",4)||!(t[8]&96)?null:aS(t)}function aS(t){switch(lS(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function lS(t,e,n){return String.fromCharCode(...t.slice(e,n))}function uS(t){return[...t].map(e=>e.charCodeAt(0))}function cS(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=uS(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Xt=!1,Es=!0;function Jv(t){const e=so(t);return hS(e)||pS(e)||dS(e)||gS(e)||fS(e)}function fS(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=oS(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function hS(t){const e=so(t);return e.byteLength>=24&&e.getUint32(0,Xt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Xt),height:e.getUint32(20,Xt)}:null}function dS(t){const e=so(t);return e.byteLength>=10&&e.getUint32(0,Xt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Es),height:e.getUint16(8,Es)}:null}function gS(t){const e=so(t);return e.byteLength>=14&&e.getUint16(0,Xt)===16973&&e.getUint32(2,Es)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Es),height:e.getUint32(22,Es)}:null}function pS(t){const e=so(t);if(!(e.byteLength>=3&&e.getUint16(0,Xt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=mS();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Xt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Xt),width:e.getUint16(s+7,Xt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Xt)}return null}function mS(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function so(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function yS(t,e){const{mimeType:n}=Jv(t)||{},r=globalThis._parseImageNode;return rl(r),await r(t,n)}async function vS(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=_S(i);let a;switch(o){case"imagebitmap":a=await rS(t,e,s);break;case"image":a=await Qv(t,e,s);break;case"data":a=await yS(t);break;default:rl(!1)}return i==="data"&&(a=Kx(a)),a}function _S(t){switch(t){case"auto":case"data":return $x();default:return Yx(t),t}}const ES=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],wS=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],TS={image:{type:"auto",decode:!0}},bS={id:"image",module:"images",name:"Images",version:Wx,mimeTypes:wS,extensions:ES,parse:vS,tests:[t=>!!Jv(new DataView(t))],options:TS},X=new io({id:"deck"});let uf={};function xS(t){uf=t}function De(t,e,n,r){X.level>0&&uf[t]&&uf[t].call(null,e,n,r)}function SS(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const PS={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:SS,parseTextSync:JSON.parse};function AS(){const t="8.9.36",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error("deck.gl - multiple versions detected: ".concat(e," vs ").concat(t));return e||(X.log(1,"deck.gl ".concat(t))(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:X,_registerLoggers:xS},vx([PS,[bS,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const LS=AS(),q={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(q,"IDENTITY",{get:()=>(X.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Yt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Tr={common:0,meters:1,pixels:2},dp={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},U=new io({id:"luma.gl"});function Ge(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const CS="Invalid WebGLRenderingContext",IS="Requires WebGL2";function Fl(t){return typeof WebGLRenderingContext<"u"&&t instanceof WebGLRenderingContext||typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function $(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function MS(t){return $(t)?t:null}function Dl(t){return Ge(Fl(t),CS),t}function Be(t){return Ge($(t),IS),t}const as={};function OS(t){globalThis.console&&globalThis.console.error&&globalThis.console.error(t)}function RS(t){globalThis.console&&globalThis.console.log&&globalThis.console.log(t)}function kS(t,e){as[t]=!0,OS(e)}function NS(t){const e=t.getError;t.getError=function(){let r;do r=e.apply(t),r!==0&&(as[r]=!0);while(r!==0);for(r in as)if(as[r])return delete as[r],parseInt(r,10);return 0}}const oo=function t(e){const n=e.gl;this.ext=e,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(e.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const i=new t.VertexAttrib(n);this.attribs[r]=i}this.maxAttrib=0};oo.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=5126,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()};oo.VertexAttrib.prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const Or=function(e){const n=this;this.gl=e,NS(e);const r=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(s){return s===n.VERTEX_ARRAY_BINDING_OES?n.currentVertexArrayObject===n.defaultVertexArrayObject?null:n.currentVertexArrayObject:r.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!0,r.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(s){const o=n.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,s);const a=o.attribs[s];return a.enabled=!1,r.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(s,o){switch(s){case 34962:n.currentArrayBuffer=o;break;case 34963:n.currentVertexArrayObject.elementArrayBuffer=o;break}return r.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(s,o){const l=n.currentVertexArrayObject.attribs[s];switch(o){case 34975:return l.buffer;case 34338:return l.enabled;case 34339:return l.size;case 34340:return l.stride;case 34341:return l.type;case 34922:return l.normalized;default:return r.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(s,o,a,l,u,c){const f=n.currentVertexArrayObject;f.maxAttrib=Math.max(f.maxAttrib,s);const h=f.attribs[s];return h.buffer=n.currentArrayBuffer,h.size=o,h.type=a,h.normalized=l,h.stride=u,h.offset=c,h.recache(),r.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",()=>{RS("OESVertexArrayObject emulation library context restored"),n.reset_()},!0),this.reset_()};Or.prototype.VERTEX_ARRAY_BINDING_OES=34229;Or.prototype.reset_=function(){if(this.vertexArrayObjects!==void 0)for(let r=0;r<this.vertexArrayObjects.length;++r)this.vertexArrayObjects.isAlive=!1;const n=this.gl;this.maxVertexAttribs=n.getParameter(34921),this.defaultVertexArrayObject=new oo(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)};Or.prototype.createVertexArrayOES=function(){const e=new oo(this);return this.vertexArrayObjects.push(e),e};Or.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)};Or.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof oo&&e.hasBeenBound&&e.ext===this)};Or.prototype.bindVertexArrayOES=function(e){const n=this.gl;if(e&&!e.isAlive){kS(1282,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}const r=this.original,i=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const s=this.currentVertexArrayObject;if(i===s)return;(!i||s.elementArrayBuffer!==i.elementArrayBuffer)&&r.bindBuffer.call(n,34963,s.elementArrayBuffer);let o=this.currentArrayBuffer;const a=Math.max(i?i.maxAttrib:0,s.maxAttrib);for(let l=0;l<=a;l++){const u=s.attribs[l],c=i?i.attribs[l]:null;if((!i||u.enabled!==c.enabled)&&(u.enabled?r.enableVertexAttribArray.call(n,l):r.disableVertexAttribArray.call(n,l)),u.enabled){let f=!1;(!i||u.buffer!==c.buffer)&&(o!==u.buffer&&(r.bindBuffer.call(n,34962,u.buffer),o=u.buffer),f=!0),(f||u.cached!==c.cached)&&r.vertexAttribPointer.call(n,l,u.size,u.type,u.normalized,u.stride,u.offset)}}this.currentArrayBuffer!==o&&r.bindBuffer.call(n,34962,this.currentArrayBuffer)};function FS(t){if(typeof t.createVertexArray=="function")return;const e=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=e.call(this)||[];return i.indexOf("OES_vertex_array_object")<0&&i.push("OES_vertex_array_object"),i};const n=t.getExtension;t.getExtension=function(i){const s=n.call(this,i);return s||(i!=="OES_vertex_array_object"?null:(t.__OESVertexArrayObject||(this.__OESVertexArrayObject=new Or(this)),this.__OESVertexArrayObject))}}const gp="OES_element_index",pp="WEBGL_draw_buffers",DS="EXT_disjoint_timer_query",zS="EXT_disjoint_timer_query_webgl2",BS="EXT_texture_filter_anisotropic",mp="WEBGL_debug_renderer_info",US=35723,VS=4352,jS=36795,GS=34047,WS=37445,HS=37446,te=t=>$(t)?void 0:0,XS={3074:t=>$(t)?void 0:36064,[US]:t=>$(t)?void 0:VS,35977:te,32937:te,[jS]:(t,e)=>{const n=$(t)?t.getExtension(zS):t.getExtension(DS);return n&&n.GPU_DISJOINT_EXT?e(n.GPU_DISJOINT_EXT):0},[WS]:(t,e)=>{const n=t.getExtension(mp);return e(n&&n.UNMASKED_VENDOR_WEBGL||7936)},[HS]:(t,e)=>{const n=t.getExtension(mp);return e(n&&n.UNMASKED_RENDERER_WEBGL||7937)},[GS]:(t,e)=>{const n=t.luma.extensions[BS];return n?e(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},32883:te,35071:te,37447:te,36063:(t,e)=>{if(!$(t)){const n=t.getExtension(pp);return n?e(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},35379:te,35374:te,35377:te,34852:t=>{if(!$(t)){const e=t.getExtension(pp);return e?e.MAX_DRAW_BUFFERS_WEBGL:0}},36203:t=>t.getExtension(gp)?2147483647:65535,33001:t=>t.getExtension(gp)?16777216:65535,33e3:t=>16777216,37157:te,35373:te,35657:te,36183:te,37137:te,34045:te,35978:te,35979:te,35968:te,35376:te,35375:te,35659:te,37154:te,35371:te,35658:te,35076:te,35077:te,35380:te};function YS(t,e,n){const r=XS[n],i=typeof r=="function"?r(t,e,n):r;return i!==void 0?i:e(n)}const $S="OES_vertex_array_object",e_="ANGLE_instanced_arrays",ZS="WEBGL_draw_buffers",KS="EXT_disjoint_timer_query",qS="EXT_texture_filter_anisotropic",QS="VertexArray requires WebGL2 or OES_vertex_array_object extension";function JS(t,e){return{webgl2:$(t),ext:t.getExtension(e)}}const t_={[$S]:{meta:{suffix:"OES"},createVertexArray:()=>{Ge(!1,QS)},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[e_]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(t,e){Ge(e===0,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},[ZS]:{meta:{suffix:"WEBGL"},drawBuffers:()=>{Ge(!1)}},[KS]:{meta:{suffix:"EXT"},createQuery:()=>{Ge(!1)},deleteQuery:()=>{Ge(!1)},beginQuery:()=>{Ge(!1)},endQuery:()=>{},getQuery(t,e){return this.getQueryObject(t,e)},getQueryParameter(t,e){return this.getQueryObject(t,e)},getQueryObject:()=>{}}},Ru={readBuffer:(t,e,n)=>{$(t)&&e(n)},getVertexAttrib:(t,e,n,r)=>{const{webgl2:i,ext:s}=JS(t,e_);let o;switch(r){case 35069:o=i?void 0:!1;break;case 35070:o=!i&&!s?0:void 0;break}return o!==void 0?o:e(n,r)},getProgramParameter:(t,e,n,r)=>{if(!$(t))switch(r){case 35967:return 35981;case 35971:return 0;case 35382:return 0}return e(n,r)},getInternalformatParameter:(t,e,n,r,i)=>{if(!$(t))switch(i){case 32937:return new Int32Array([0])}return t.getInternalformatParameter(n,r,i)},getTexParameter(t,e,n,r){switch(r){case 34046:const{extensions:i}=t.luma,s=i[qS];r=s&&s.TEXTURE_MAX_ANISOTROPY_EXT||34046;break}return e(n,r)},getParameter:YS,hint(t,e,n,r){return e(n,r)}};function eP(t){t.luma=t.luma||{};const{luma:e}=t;return e.polyfilled||(FS(t),tP(t),rP(t,t_),nP(t,{target:e,target2:t}),e.polyfilled=!0),t}globalThis.polyfillContext=eP;function tP(t){t.luma.extensions={};const e=t.getSupportedExtensions()||[];for(const n of e)t.luma[n]=t.getExtension(n)}function nP(t,e){let{target:n,target2:r}=e;Object.keys(Ru).forEach(i=>{if(typeof Ru[i]=="function"){const s=t[i]?t[i].bind(t):()=>{},o=Ru[i].bind(null,t,s);n[i]=o,r[i]=o}})}function rP(t,e){for(const n of Object.getOwnPropertyNames(e))n!=="overrides"&&iP(t,{extension:n,target:t.luma,target2:t})}function iP(t,e){let{extension:n,target:r,target2:i}=e;const s=t_[n];Ge(s);const{meta:o={}}=s,{suffix:a=""}=o,l=t.getExtension(n);for(const u of Object.keys(s)){const c="".concat(u).concat(a);let f=null;u==="meta"||typeof t[u]=="function"||(l&&typeof l[c]=="function"?f=function(){return l[c](...arguments)}:typeof s[u]=="function"&&(f=s[u].bind(r))),f&&(r[u]=f,i[u]=f)}}const Uh={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,36006:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],3333:4,3317:4,37440:!1,37441:!1,37443:37444,35723:4352,36010:null,35977:!1,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},bn=(t,e,n)=>e?t.enable(n):t.disable(n),yp=(t,e,n)=>t.hint(n,e),et=(t,e,n)=>t.pixelStorei(n,e),sP=(t,e)=>{const n=$(t)?36009:36160;return t.bindFramebuffer(n,e)},oP=(t,e)=>t.bindFramebuffer(36008,e);function qi(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const aP={3042:bn,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:bn,2885:(t,e)=>t.cullFace(e),2929:bn,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:bn,35723:yp,36006:sP,2886:(t,e)=>t.frontFace(e),33170:yp,2849:(t,e)=>t.lineWidth(e),32823:bn,32824:"polygonOffset",10752:"polygonOffset",35977:bn,32938:"sampleCoverage",32939:"sampleCoverage",3089:bn,3088:(t,e)=>t.scissor(...e),2960:bn,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),3333:et,3317:et,37440:et,37441:et,37443:et,3330:et,3332:et,3331:et,36010:oP,3314:et,32878:et,3316:et,3315:et,32877:et,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{e=qi(e)?e:[e,e],t.blendEquationSeparate(...e)},blendFunc:(t,e)=>{e=qi(e)&&e.length===2?[...e,...e]:e,t.blendFuncSeparate(...e)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=qi(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=qi(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=qi(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ge(t,e,n){return e[t]!==void 0?e[t]:n[t]}const lP={blendEquation:(t,e,n)=>t.blendEquationSeparate(ge(32777,e,n),ge(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ge(32969,e,n),ge(32968,e,n),ge(32971,e,n),ge(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ge(32824,e,n),ge(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ge(32938,e,n),ge(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ge(2962,e,n),ge(2967,e,n),ge(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ge(34816,e,n),ge(36003,e,n),ge(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ge(2964,e,n),ge(2965,e,n),ge(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ge(34817,e,n),ge(34818,e,n),ge(34819,e,n))},vp={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Vt=(t,e)=>t.isEnabled(e),_p={3042:Vt,2884:Vt,2929:Vt,3024:Vt,32823:Vt,32926:Vt,32928:Vt,3089:Vt,2960:Vt,35977:Vt};function n_(t){for(const e in t)return!1;return!0}function uP(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}function Ep(t,e){const n=t[e].bind(t);t[e]=function(){const i=arguments.length<=0?void 0:arguments[0];return i in t.state.cache?t.state.enable?t.state.cache[i]:n(...arguments):n(...arguments)},Object.defineProperty(t[e],"name",{value:"".concat(e,"-from-cache"),configurable:!1})}function cP(t,e,n){const r=t[e].bind(t);t[e]=function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];const{valueChanged:l,oldValue:u}=n(t.state._updateCache,...o);return l&&r(...o),u},Object.defineProperty(t[e],"name",{value:"".concat(e,"-to-cache"),configurable:!1})}function fP(t){const e=t.useProgram.bind(t);t.useProgram=function(r){t.state.program!==r&&(e(r),t.state.program=r)}}class hP{constructor(e){let{copyState:n=!1,log:r=()=>{}}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.program=null,this.stateStack=[],this.enable=!0,this.cache=n?i_(e):Object.assign({},Uh),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(){this.stateStack.push({})}pop(){Ge(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];qt(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0&&this.stateStack[this.stateStack.length-1];for(const s in e){Ge(s!==void 0);const o=e[s],a=this.cache[s];uP(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function r_(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{enable:n=!0,copyState:r}=e;if(Ge(r!==void 0),!t.state){const{polyfillContext:i}=globalThis;i&&i(t),t.state=new hP(t,{copyState:r}),fP(t);for(const s in vp){const o=vp[s];cP(t,s,o)}Ep(t,"getParameter"),Ep(t,"isEnabled")}return t.state.enable=n,t}function dP(t){t.state||r_(t,{copyState:!1}),t.state.push()}function wp(t){Ge(t.state),t.state.pop()}function qt(t,e){if(Ge(Fl(t),"setParameters requires a WebGL context"),n_(e))return;const n={};for(const i in e){const s=Number(i),o=aP[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=lP[i];s(t,e,r)}}function i_(t,e){if(e=e||Uh,typeof e=="number"){const i=e,s=_p[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=_p[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function gP(t){qt(t,Uh)}function at(t,e,n){if(n_(e))return n(t);const{nocatch:r=!0}=e;dP(t),qt(t,e);let i;if(r)i=n(t),wp(t);else try{i=n(t)}finally{wp(t)}return i}function wi(t){const{luma:e}=t;if(t.canvas&&e){const n=e.canvasSizeInfo,r="clientWidth"in n?n.clientWidth:t.canvas.clientWidth;return r?t.drawingBufferWidth/r:1}return 1}function ku(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const r=wi(t),i=t.drawingBufferWidth,s=t.drawingBufferHeight;return mP(e,r,i,s,n)}function pP(t){const e=typeof window>"u"?1:window.devicePixelRatio||1;return Number.isFinite(t)?t<=0?1:t:t?e:1}function mP(t,e,n,r,i){const s=Tp(t[0],e,n);let o=bp(t[1],e,r,i),a=Tp(t[0]+1,e,n);const l=a===n-1?a:a-1;a=bp(t[1]+1,e,r,i);let u;return i?(a=a===0?a:a+1,u=o,o=a):u=a===r-1?a:a-1,{x:s,y:o,width:Math.max(l-s+1,1),height:Math.max(u-o+1,1)}}function Tp(t,e,n){return Math.min(Math.round(t*e),n-1)}function bp(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const Vh=vn(),yP=Vh&&typeof document<"u",s_={webgl2:!0,webgl1:!0,throwOnError:!0,manageState:!0,canvas:null,debug:!1,width:800,height:600};function o_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Ge(Vh,`createGLContext only available in the browser.
Create your own headless context or use 'createHeadlessContext' from @luma.gl/test-utils`),t=Object.assign({},s_,t);const{width:e,height:n}=t;function r(a){if(t.throwOnError)throw new Error(a);return console.error(a),null}t.onError=r;let i;const{canvas:s}=t,o=wP({canvas:s,width:e,height:n,onError:r});return i=EP(o,t),i?(i=jh(i,t),TP(i),i):null}function jh(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!t||t._instrumented)return t;t._version=t._version||bP(t),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{},e=Object.assign({},s_,e);const{manageState:n,debug:r}=e;return n&&r_(t,{copyState:!1,log:function(){for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return U.log(1,...s)()}}),Vh&&r&&(globalThis.makeDebugContext?(t=globalThis.makeDebugContext(t,e),U.level=Math.max(U.level,1)):U.warn('WebGL debug mode not activated. import "@luma.gl/debug" to enable.')()),t._instrumented=!0,t}function vP(t){const e=t.getParameter(7936),n=t.getParameter(7937),r=t.getExtension("WEBGL_debug_renderer_info"),i=r&&t.getParameter(r.UNMASKED_VENDOR_WEBGL||7936),s=r&&t.getParameter(r.UNMASKED_RENDERER_WEBGL||7937);return{vendor:i||e,renderer:s||n,vendorMasked:e,rendererMasked:n,version:t.getParameter(7938),shadingLanguageVersion:t.getParameter(35724)}}function _P(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t.canvas){const r=pP(e.useDevicePixels);xP(t,r,e);return}const n=t.getExtension("STACKGL_resize_drawingbuffer");n&&"width"in e&&"height"in e&&n.resize(e.width,e.height)}function EP(t,e){const{onError:n}=e;let r=null;const i=l=>r=l.statusMessage||r;t.addEventListener("webglcontextcreationerror",i,!1);const{webgl1:s=!0,webgl2:o=!0}=e;let a=null;return o&&(a=a||t.getContext("webgl2",e),a=a||t.getContext("experimental-webgl2",e)),s&&(a=a||t.getContext("webgl",e),a=a||t.getContext("experimental-webgl",e)),t.removeEventListener("webglcontextcreationerror",i,!1),a?(e.onContextLost&&t.addEventListener("webglcontextlost",e.onContextLost,!1),e.onContextRestored&&t.addEventListener("webglcontextrestored",e.onContextRestored,!1),a):n("Failed to create ".concat(o&&!s?"WebGL2":"WebGL"," context: ").concat(r||"Unknown error"))}function wP(t){let{canvas:e,width:n=800,height:r=600,onError:i}=t,s;return typeof e=="string"?(yP&&document.readyState==="complete"||i("createGLContext called on canvas '".concat(e,"' before page was loaded")),s=document.getElementById(e)):e?s=e:(s=document.createElement("canvas"),s.id="lumagl-canvas",s.style.width=Number.isFinite(n)?"".concat(n,"px"):"100%",s.style.height=Number.isFinite(r)?"".concat(r,"px"):"100%",document.body.insertBefore(s,document.body.firstChild)),s}function TP(t){const e=$(t)?"WebGL2":"WebGL1",n=vP(t),r=n?"(".concat(n.vendor,",").concat(n.renderer,")"):"",i=t.debug?" debug":"";U.info(1,"".concat(e).concat(i," context ").concat(r))()}function bP(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?2:1}function xP(t,e,n){let r="width"in n?n.width:t.canvas.clientWidth,i="height"in n?n.height:t.canvas.clientHeight;(!r||!i)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=t.canvas.width||1,i=t.canvas.height||1),t.luma=t.luma||{},t.luma.canvasSizeInfo=t.luma.canvasSizeInfo||{};const s=t.luma.canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);t.canvas.width=a,t.canvas.height=l,(t.drawingBufferWidth!==a||t.drawingBufferHeight!==l)&&(U.warn("Device pixel ratio clamped")(),o=Math.min(t.drawingBufferWidth/r,t.drawingBufferHeight/i),t.canvas.width=Math.floor(r*o),t.canvas.height=Math.floor(i*o)),Object.assign(t.luma.canvasSizeInfo,{clientWidth:r,clientHeight:i,devicePixelRatio:e})}}const ws="8.5.21",SP="set luma.log.level=1 (or higher) to trace rendering";class PP{constructor(){this.stats=new Map}get(e){return this.stats.has(e)||this.stats.set(e,new Rh({id:e})),this.stats.get(e)}}const hr=new PP;if(globalThis.luma&&globalThis.luma.VERSION!==ws)throw new Error("luma.gl - multiple VERSIONs detected: ".concat(globalThis.luma.VERSION," vs ").concat(ws));globalThis.luma||(vn()&&U.log(1,"luma.gl ".concat(ws," - ").concat(SP))(),globalThis.luma=globalThis.luma||{VERSION:ws,version:ws,log:U,stats:hr,globals:{modules:{},nodeIO:{}}});function AP(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function LP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}function N(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}function Nu(t,e){if(typeof e!="string")return e;const n=Number(e);if(!isNaN(n))return n;e=e.replace(/^.*\./,"");const r=t[e];return N(r!==void 0,"Accessing undefined constant GL.".concat(e)),r}function Hn(t,e){e=Number(e);for(const n in t)if(t[n]===e)return"GL.".concat(n);return String(e)}const Fu={};function Zn(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"id";Fu[t]=Fu[t]||1;const e=Fu[t]++;return"".concat(t,"-").concat(e)}function xp(t){return N(typeof t=="number","Input must be a number"),t&&(t&t-1)===0}function Ti(t){let e=!0;for(const n in t){e=!1;break}return e}function a_(t,e,n,r){const i="See luma.gl ".concat(n," Upgrade Guide at https://luma.gl/docs/upgrade-guide"),s=Object.getPrototypeOf(t);r.forEach(o=>{s.methodName||(s[o]=()=>{throw U.removed("Calling removed method ".concat(e,".").concat(o,": "),i)(),new Error(o)})})}const Br="Resource subclass must define virtual methods";let _n=class{get[Symbol.toStringTag](){return"Resource"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Dl(e);const{id:r,userData:i={}}=n;this.gl=e,this.gl2=e,this.id=r||Zn(this[Symbol.toStringTag]),this.userData=i,this._bound=!1,this._handle=n.handle,this._handle===void 0&&(this._handle=this._createHandle()),this.byteLength=0,this._addStats()}toString(){return"".concat(this[Symbol.toStringTag]||this.constructor.name,"(").concat(this.id,")")}get handle(){return this._handle}delete(){let{deleteChildren:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this._removeStats(),this._handle=null,n&&e&&n.filter(Boolean).forEach(r=>r.delete()),this}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.handle;if(typeof e!="function")return this._bindHandle(e),this;let n;return this._bound?n=e():(this._bindHandle(this.handle),this._bound=!0,n=e(),this._bound=!1,this._bindHandle(null)),n}unbind(){this.bind(null)}getParameter(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};e=Nu(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=$(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension)))){const a=i.webgl1,l="webgl2"in i?i.webgl2:i.webgl1;return s?l:a}}return this._getParameter(e,n)}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{parameters:n,keys:r}=e,i=this.constructor.PARAMETERS||{},s=$(this.gl),o={},a=n||Object.keys(i);for(const l of a){const u=i[l];if(u&&(!("webgl2"in u)||s)&&(!("extension"in u)||this.gl.getExtension(u.extension))){const f=r?Hn(this.gl,l):l;o[f]=this.getParameter(l,e),r&&u.type==="GLenum"&&(o[f]=Hn(this.gl,o[f]))}}return o}setParameter(e,n){e=Nu(this.gl,e),N(e);const i=(this.constructor.PARAMETERS||{})[e];if(i){const s=$(this.gl);if(!((!("webgl2"in i)||s)&&(!("extension"in i)||this.gl.getExtension(i.extension))))throw new Error("Parameter not available on this platform");i.type==="GLenum"&&(n=Nu(n))}return this._setParameter(e,n),this}setParameters(e){for(const n in e)this.setParameter(n,e[n]);return this}stubRemovedMethods(e,n,r){return a_(this,e,n,r)}initialize(e){}_createHandle(){throw new Error(Br)}_deleteHandle(){throw new Error(Br)}_bindHandle(e){throw new Error(Br)}_getOptsFromHandle(){throw new Error(Br)}_getParameter(e,n){throw new Error(Br)}_setParameter(e,n){throw new Error(Br)}_context(){return this.gl.luma=this.gl.luma||{},this.gl.luma}_addStats(){const e=this[Symbol.toStringTag],n=hr.get("Resource Counts");n.get("Resources Created").incrementCount(),n.get("".concat(e,"s Created")).incrementCount(),n.get("".concat(e,"s Active")).incrementCount()}_removeStats(){const e=this[Symbol.toStringTag];hr.get("Resource Counts").get("".concat(e,"s Active")).decrementCount()}_trackAllocatedMemory(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag];this._trackAllocatedMemoryForContext(e,n),this._trackAllocatedMemoryForContext(e,n,this.gl.canvas&&this.gl.canvas.id),this.byteLength=e}_trackAllocatedMemoryForContext(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this[Symbol.toStringTag],r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";const i=hr.get("Memory Usage".concat(r));i.get("GPU Memory").addCount(e),i.get("".concat(n," Memory")).addCount(e)}_trackDeallocatedMemory(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag];this._trackDeallocatedMemoryForContext(e),this._trackDeallocatedMemoryForContext(e,this.gl.canvas&&this.gl.canvas.id),this.byteLength=0}_trackDeallocatedMemoryForContext(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this[Symbol.toStringTag],n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";const r=hr.get("Memory Usage".concat(n));r.get("GPU Memory").subtractCount(this.byteLength),r.get("".concat(e," Memory")).subtractCount(this.byteLength)}};const CP="Failed to deduce GL constant from typed array";function cf(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(CP)}}function js(t){let{clamped:e=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return e?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function IP(t){let{data:e,width:n,height:r,bytesPerPixel:i=4,temp:s}=t;const o=n*i;s=s||new Uint8Array(o);for(let a=0;a<r/2;++a){const l=a*o,u=(r-a-1)*o;s.set(e.subarray(l,l+o)),e.copyWithin(l,u,u+o),e.set(s,u)}}function MP(t){let{data:e,width:n,height:r}=t;const i=Math.round(n/2),s=Math.round(r/2),o=new Uint8Array(i*s*4);for(let a=0;a<s;a++)for(let l=0;l<i;l++)for(let u=0;u<4;u++)o[(a*i+l)*4+u]=e[(a*2*n+l*2)*4+u];return{data:o,width:i,height:s}}function ff(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const u=r[a]?"".concat(t,".").concat(r[a]):"N/A";U.removed("".concat(t,".").concat(a),u)()}for(const a in i)if(a in e){const l=i[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))()}let o=null;for(const a in s)if(a in e){const l=s[a];U.deprecated("".concat(t,".").concat(a),"".concat(t,".").concat(l))(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]}return o||e}const OP={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},RP={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class it{static getBytesPerElement(e){return js(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return N(e.size),js(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new it(OP,...n)}constructor(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(i=>this._assign(i)),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return it.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return it.getBytesPerVertex(this)}_assign(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e=ff("Accessor",e,RP),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this}}const Sp=10,l_={offset:"accessor.offset",stride:"accessor.stride",type:"accessor.type",size:"accessor.size",divisor:"accessor.divisor",normalized:"accessor.normalized",integer:"accessor.integer",instanced:"accessor.divisor",isInstanced:"accessor.divisor"},kP={removedProps:{},replacedProps:{bytes:"byteLength"},deprecatedProps:l_},NP={removedProps:l_};class J extends _n{get[Symbol.toStringTag](){return"Buffer"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Buffer","v6.0",["layout","setLayout","getIndexedParameter"]),this.target=n.target||(this.gl.webgl2?36662:34962),this.initialize(n),Object.seal(this)}getElementCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/it.getBytesPerElement(e))}getVertexCount(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.accessor;return Math.round(this.byteLength/it.getBytesPerVertex(e))}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return ArrayBuffer.isView(e)&&(e={data:e}),Number.isFinite(e)&&(e={byteLength:e}),e=ff("Buffer",e,kP),this.usage=e.usage||35044,this.debugData=null,this.setAccessor(Object.assign({},e,e.accessor)),e.data?this._setData(e.data,e.offset,e.byteLength):this._setByteLength(e.byteLength||0),this}setProps(e){return e=ff("Buffer",e,NP),"accessor"in e&&this.setAccessor(e.accessor),this}setAccessor(e){return e=Object.assign({},e),delete e.buffer,this.accessor=new it(e),this}reallocate(e){return e>this.byteLength?(this._setByteLength(e),!0):(this.bytesUsed=e,!1)}setData(e){return this.initialize(e)}subData(e){ArrayBuffer.isView(e)&&(e={data:e});const{data:n,offset:r=0,srcOffset:i=0}=e,s=e.byteLength||e.length;N(n);const o=this.gl.webgl2?36663:this.target;return this.gl.bindBuffer(o,this.handle),i!==0||s!==void 0?(Be(this.gl),this.gl.bufferSubData(this.target,r,n,i,s)):this.gl.bufferSubData(o,r,n),this.gl.bindBuffer(o,null),this.debugData=null,this._inferType(n),this}copyData(e){let{sourceBuffer:n,readOffset:r=0,writeOffset:i=0,size:s}=e;const{gl:o}=this;return Be(o),o.bindBuffer(36662,n.handle),o.bindBuffer(36663,this.handle),o.copyBufferSubData(36662,36663,r,i,s),o.bindBuffer(36662,null),o.bindBuffer(36663,null),this.debugData=null,this}getData(){let{dstData:e=null,srcByteOffset:n=0,dstOffset:r=0,length:i=0}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Be(this.gl);const s=js(this.accessor.type||5126,{clamped:!1}),o=this._getAvailableElementCount(n),a=r;let l,u;e?(u=e.length,l=u-a):(l=Math.min(o,i||o),u=a+l);const c=Math.min(o,l);return i=i||c,N(i<=c),e=e||new s(u),this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,e,r,i),this.gl.bindBuffer(36662,null),e}bind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index,offset:r=0,size:i}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?i!==void 0?this.gl.bindBufferRange(e,n,this.handle,r,i):(N(r===0),this.gl.bindBufferBase(e,n,this.handle)):this.gl.bindBuffer(e,this.handle),this}unbind(){let{target:e=this.target,index:n=this.accessor&&this.accessor.index}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e===35345||e===35982?this.gl.bindBufferBase(e,n,null):this.gl.bindBuffer(e,null),this}getDebugData(){return this.debugData?{data:this.debugData,changed:!1}:(this.debugData=this.getData({length:Math.min(Sp,this.byteLength)}),{data:this.debugData,changed:!0})}invalidateDebugData(){this.debugData=null}_setData(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:e.byteLength+n;N(ArrayBuffer.isView(e)),this._trackDeallocatedMemory();const i=this._getTarget();this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.usage),this.gl.bufferSubData(i,n,e),this.gl.bindBuffer(i,null),this.debugData=e.slice(0,Sp),this.bytesUsed=r,this._trackAllocatedMemory(r);const s=cf(e);return N(s),this.setAccessor(new it(this.accessor,{type:s})),this}_setByteLength(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.usage;N(e>=0),this._trackDeallocatedMemory();let r=e;e===0&&(r=new Float32Array(0));const i=this._getTarget();return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,n),this.gl.bindBuffer(i,null),this.usage=n,this.debugData=null,this.bytesUsed=e,this._trackAllocatedMemory(e),this}_getTarget(){return this.gl.webgl2?36663:this.target}_getAvailableElementCount(e){const n=js(this.accessor.type||5126,{clamped:!1}),r=e/n.BYTES_PER_ELEMENT;return this.getElementCount()-r}_inferType(e){this.accessor.type||this.setAccessor(new it(this.accessor,{type:cf(e)}))}_createHandle(){return this.gl.createBuffer()}_deleteHandle(){this.gl.deleteBuffer(this.handle),this._trackDeallocatedMemory()}_getParameter(e){this.gl.bindBuffer(this.target,this.handle);const n=this.gl.getBufferParameter(this.target,e);return this.gl.bindBuffer(this.target,null),n}get type(){return U.deprecated("Buffer.type","Buffer.accessor.type")(),this.accessor.type}get bytes(){return U.deprecated("Buffer.bytes","Buffer.byteLength")(),this.byteLength}setByteLength(e){return U.deprecated("setByteLength","reallocate")(),this.reallocate(e)}updateAccessor(e){return U.deprecated("updateAccessor(...)","setAccessor(new Accessor(buffer.accessor, ...)")(),this.accessor=new it(this.accessor,e),this}}const Gh={6407:{dataFormat:6407,types:[5121,33635]},6408:{dataFormat:6408,types:[5121,32819,32820]},6406:{dataFormat:6406,types:[5121]},6409:{dataFormat:6409,types:[5121]},6410:{dataFormat:6410,types:[5121]},33326:{dataFormat:6403,types:[5126],gl2:!0},33328:{dataFormat:33319,types:[5126],gl2:!0},34837:{dataFormat:6407,types:[5126],gl2:!0},34836:{dataFormat:6408,types:[5126],gl2:!0}},u_={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},c_={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function FP(t,e){const n=Gh[e];if(!n)return!1;if(n.gl1===void 0&&n.gl2===void 0)return!0;const r=$(t)&&n.gl2||n.gl1;return typeof r=="string"?t.getExtension(r):r}function DP(t,e){const n=Gh[e];switch(n&&n.types[0]){case 5126:return t.getExtension("OES_texture_float_linear");case 5131:return t.getExtension("OES_texture_half_float_linear");default:return!0}}const zP=[9729,9728],Pp=globalThis.WebGLBuffer||function(){};class br extends _n{get[Symbol.toStringTag](){return"Texture"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{format:r,linearFiltering:i}=n;let s=!0;return r&&(s=s&&FP(e,r),s=s&&(!i||DP(e,r))),s}constructor(e,n){const{id:r=Zn("texture"),handle:i,target:s}=n;super(e,{id:r,handle:i}),this.target=s,this.textureUnit=void 0,this.loaded=!1,this.width=void 0,this.height=void 0,this.depth=void 0,this.format=void 0,this.type=void 0,this.dataFormat=void 0,this.border=void 0,this.textureUnit=void 0,this.mipmaps=void 0}toString(){return"Texture(".concat(this.id,",").concat(this.width,"x").concat(this.height,")")}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=e.data;if(n instanceof Promise)return n.then(m=>this.initialize(Object.assign({},e,{pixels:m,data:m}))),this;const r=typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement;if(r&&n.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,n.addEventListener("loadeddata",()=>this.initialize(e)),this;const{pixels:i=null,format:s=6408,border:o=0,recreate:a=!1,parameters:l={},pixelStore:u={},textureUnit:c=void 0}=e;n||(n=i);let{width:f,height:h,dataFormat:d,type:p,compressed:E=!1,mipmaps:b=!0}=e;const{depth:y=0}=e;return{width:f,height:h,compressed:E,dataFormat:d,type:p}=this._deduceParameters({format:s,type:p,dataFormat:d,compressed:E,data:n,width:f,height:h}),this.width=f,this.height=h,this.depth=y,this.format=s,this.type=p,this.dataFormat=d,this.border=o,this.textureUnit=c,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),b&&this._isNPOT()&&(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),b=!1,this._updateForNPOT(l)),this.mipmaps=b,this.setImageData({data:n,width:f,height:h,depth:y,format:s,type:p,dataFormat:d,border:o,mipmaps:b,parameters:u,compressed:E}),b&&this.generateMipmap(),this.setParameters(l),a&&(this.data=n),r&&(this._video={video:n,parameters:l,lastTime:n.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?n.currentTime:-1}),this}update(){if(this._video){const{video:e,parameters:n,lastTime:r}=this._video;if(r===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:n}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}resize(e){let{height:n,width:r,mipmaps:i=!1}=e;return r!==this.width||n!==this.height?this.initialize({width:r,height:n,format:this.format,type:this.type,dataFormat:this.dataFormat,border:this.border,mipmaps:i}):this}generateMipmap(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isNPOT()?(U.warn("texture: ".concat(this," is Non-Power-Of-Two, disabling mipmaping"))(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),at(this.gl,e,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this)}setImageData(e){this._trackDeallocatedMemory("Texture");const{target:n=this.target,pixels:r=null,level:i=0,format:s=this.format,border:o=this.border,offset:a=0,parameters:l={}}=e;let{data:u=null,type:c=this.type,width:f=this.width,height:h=this.height,dataFormat:d=this.dataFormat,compressed:p=!1}=e;u||(u=r),{type:c,dataFormat:d,compressed:p,width:f,height:h}=this._deduceParameters({format:s,type:c,dataFormat:d,compressed:p,data:u,width:f,height:h});const{gl:E}=this;E.bindTexture(this.target,this.handle);let b=null;({data:u,dataType:b}=this._getDataType({data:u,compressed:p}));let y,m=0;if(at(this.gl,l,()=>{switch(b){case"null":E.texImage2D(n,i,s,f,h,o,d,c,u);break;case"typed-array":E.texImage2D(n,i,s,f,h,o,d,c,u,a);break;case"buffer":y=Be(E),y.bindBuffer(35052,u.handle||u),y.texImage2D(n,i,s,f,h,o,d,c,a),y.bindBuffer(35052,null);break;case"browser-object":$(E)?E.texImage2D(n,i,s,f,h,o,d,c,u):E.texImage2D(n,i,s,d,c,u);break;case"compressed":for(const[_,T]of u.entries())E.compressedTexImage2D(n,_,T.format,T.width,T.height,o,T.data),m+=T.levelSize;break;default:N(!1,"Unknown image data type")}}),b==="compressed")this._trackAllocatedMemory(m,"Texture");else if(u&&u.byteLength)this._trackAllocatedMemory(u.byteLength,"Texture");else{const _=u_[this.dataFormat]||4,T=c_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*_*T,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:u=0,format:c=this.format,type:f=this.type,dataFormat:h=this.dataFormat,compressed:d=!1,offset:p=0,border:E=this.border,parameters:b={}}=e;if({type:f,dataFormat:h,compressed:d,width:a,height:l}=this._deduceParameters({format:c,type:f,dataFormat:h,compressed:d,data:i,width:a,height:l}),N(this.depth===0,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const y=i;i=y.data,a=y.shape[0],l=y.shape[1]}i instanceof J&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),at(this.gl,b,()=>{if(d)this.gl.compressedTexSubImage2D(n,u,s,o,a,l,c,i);else if(i===null)this.gl.texSubImage2D(n,u,s,o,a,l,h,f,null);else if(ArrayBuffer.isView(i))this.gl.texSubImage2D(n,u,s,o,a,l,h,f,i,p);else if(i instanceof Pp){const y=Be(this.gl);y.bindBuffer(35052,i),y.texSubImage2D(n,u,s,o,a,l,h,f,p),y.bindBuffer(35052,null)}else $(this.gl)?Be(this.gl).texSubImage2D(n,u,s,o,a,l,h,f,i):this.gl.texSubImage2D(n,u,s,o,h,f,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,this.handle),e}unbind(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.textureUnit;const{gl:n}=this;return e!==void 0&&(this.textureUnit=e,n.activeTexture(33984+e)),n.bindTexture(this.target,null),e}_getDataType(e){let{data:n,compressed:r=!1}=e;return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof J?{data:n.handle,dataType:"buffer"}:n instanceof Pp?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(e){const{format:n,data:r}=e;let{width:i,height:s,dataFormat:o,type:a,compressed:l}=e;const u=Gh[n];return o=o||u&&u.dataFormat,a=a||u&&u.types[0],l=l||u&&u.compressed,{width:i,height:s}=this._deduceImageSize(r,i,s),{dataFormat:o,type:a,compressed:l,width:i,height:s,format:n,data:r}}_deduceImageSize(e,n,r){let i;return typeof ImageData<"u"&&e instanceof ImageData?i={width:e.width,height:e.height}:typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement?i={width:e.naturalWidth,height:e.naturalHeight}:typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement?i={width:e.width,height:e.height}:typeof ImageBitmap<"u"&&e instanceof ImageBitmap?i={width:e.width,height:e.height}:typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?i={width:e.videoWidth,height:e.videoHeight}:e?i={width:n,height:r}:i={width:n>=0?n:1,height:r>=0?r:1},N(i,"Could not deduced texture size"),N(n===void 0||i.width===n,"Deduced texture width does not match supplied width"),N(r===void 0||i.height===r,"Deduced texture height does not match supplied height"),i}_createHandle(){return this.gl.createTexture()}_deleteHandle(){this.gl.deleteTexture(this.handle),this._trackDeallocatedMemory("Texture")}_getParameter(e){switch(e){case 4096:return this.width;case 4097:return this.height;default:this.gl.bindTexture(this.target,this.handle);const n=this.gl.getTexParameter(this.target,e);return this.gl.bindTexture(this.target,null),n}}_setParameter(e,n){switch(this.gl.bindTexture(this.target,this.handle),n=this._getNPOTParam(e,n),e){case 33082:case 33083:this.gl.texParameterf(this.handle,e,n);break;case 4096:case 4097:N(!1);break;default:this.gl.texParameteri(this.target,e,n);break}return this.gl.bindTexture(this.target,null),this}_isNPOT(){return $(this.gl)||!this.width||!this.height?!1:!xp(this.width)||!xp(this.height)}_updateForNPOT(e){e[this.gl.TEXTURE_MIN_FILTER]===void 0&&(e[this.gl.TEXTURE_MIN_FILTER]=this.gl.LINEAR),e[this.gl.TEXTURE_WRAP_S]===void 0&&(e[this.gl.TEXTURE_WRAP_S]=this.gl.CLAMP_TO_EDGE),e[this.gl.TEXTURE_WRAP_T]===void 0&&(e[this.gl.TEXTURE_WRAP_T]=this.gl.CLAMP_TO_EDGE)}_getNPOTParam(e,n){if(this._isNPOT())switch(e){case 10241:zP.indexOf(n)===-1&&(n=9729);break;case 10242:case 10243:n!==33071&&(n=33071);break}return n}}let BP="";function UP(t,e){return N(typeof t=="string"),t=BP+t,new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error("Could not load image ".concat(t,"."))),i.crossOrigin=e&&e.crossOrigin||"anonymous",i.src=t}catch(i){r(i)}})}class ct extends br{get[Symbol.toStringTag](){return"Texture2D"}static isSupported(e,n){return br.isSupported(e,n)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Dl(e),(n instanceof Promise||typeof n=="string")&&(n={data:n}),typeof n.data=="string"&&(n=Object.assign({},n,{data:UP(n.data)})),super(e,Object.assign({},n,{target:3553})),this.initialize(n),Object.seal(this)}}const hf=[34069,34070,34071,34072,34073,34074];class f_ extends br{get[Symbol.toStringTag](){return"TextureCube"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Dl(e),super(e,Object.assign({},n,{target:34067})),this.initialize(n),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{mipmaps:n=!0,parameters:r={}}=e;return this.opts=e,this.setCubeMapImageData(e).then(()=>{this.loaded=!0,n&&this.generateMipmap(e),this.setParameters(r)}),this}subImage(e){let{face:n,data:r,x:i=0,y:s=0,mipmapLevel:o=0}=e;return this._subImage({target:n,data:r,x:i,y:s,mipmapLevel:o})}async setCubeMapImageData(e){let{width:n,height:r,pixels:i,data:s,border:o=0,format:a=6408,type:l=5121}=e;const{gl:u}=this,c=i||s,f=await Promise.all(hf.map(h=>{const d=c[h];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),hf.forEach((h,d)=>{f[d].length>1&&this.opts.mipmaps!==!1&&U.warn("".concat(this.id," has mipmap and multiple LODs."))(),f[d].forEach((p,E)=>{n&&r?u.texImage2D(h,E,a,n,r,o,a,l,p):u.texImage2D(h,E,a,a,l,p)})}),this.unbind()}setImageDataForFace(e){const{face:n,width:r,height:i,pixels:s,data:o,border:a=0,format:l=6408,type:u=5121}=e,{gl:c}=this,f=s||o;return this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},e,{face:n,data:h,pixels:h}))):this.width||this.height?c.texImage2D(n,0,l,r,i,a,l,u,f):c.texImage2D(n,0,l,l,u,f),this}}f_.FACES=hf;class VP extends br{get[Symbol.toStringTag](){return"Texture3D"}static isSupported(e){return $(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Be(e),n=Object.assign({depth:1},n,{target:32879,unpackFlipY:!1}),super(e,n),this.initialize(n),Object.seal(this)}setImageData(e){let{level:n=0,dataFormat:r=6408,width:i,height:s,depth:o=1,border:a=0,format:l,type:u=5121,offset:c=0,data:f,parameters:h={}}=e;if(this._trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle),at(this.gl,h,()=>{ArrayBuffer.isView(f)&&this.gl.texImage3D(this.target,n,r,i,s,o,a,l,u,f),f instanceof J&&(this.gl.bindBuffer(35052,f.handle),this.gl.texImage3D(this.target,n,r,i,s,o,a,l,u,c))}),f&&f.byteLength)this._trackAllocatedMemory(f.byteLength,"Texture");else{const d=u_[this.dataFormat]||4,p=c_[this.type]||1;this._trackAllocatedMemory(this.width*this.height*this.depth*d*p,"Texture")}return this.loaded=!0,this}}const rr="EXT_color_buffer_float",Ap={33189:{bpp:2},33190:{gl2:!0,bpp:3},36012:{gl2:!0,bpp:4},36168:{bpp:1},34041:{bpp:4},35056:{gl2:!0,bpp:4},36013:{gl2:!0,bpp:5},32854:{bpp:2},36194:{bpp:2},32855:{bpp:2},33321:{gl2:!0,bpp:1},33330:{gl2:!0,bpp:1},33329:{gl2:!0,bpp:1},33332:{gl2:!0,bpp:2},33331:{gl2:!0,bpp:2},33334:{gl2:!0,bpp:4},33333:{gl2:!0,bpp:4},33323:{gl2:!0,bpp:2},33336:{gl2:!0,bpp:2},33335:{gl2:!0,bpp:2},33338:{gl2:!0,bpp:4},33337:{gl2:!0,bpp:4},33340:{gl2:!0,bpp:8},33339:{gl2:!0,bpp:8},32849:{gl2:!0,bpp:3},32856:{gl2:!0,bpp:4},32857:{gl2:!0,bpp:4},36220:{gl2:!0,bpp:4},36238:{gl2:!0,bpp:4},36975:{gl2:!0,bpp:4},36214:{gl2:!0,bpp:8},36232:{gl2:!0,bpp:8},36226:{gl2:!0,bpp:16},36208:{gl2:!0,bpp:16},33325:{gl2:rr,bpp:2},33327:{gl2:rr,bpp:4},34842:{gl2:rr,bpp:8},33326:{gl2:rr,bpp:4},33328:{gl2:rr,bpp:8},34836:{gl2:rr,bpp:16},35898:{gl2:rr,bpp:4}};function jP(t,e,n){const r=n[e];if(!r)return!1;const i=$(t)&&r.gl2||r.gl1;return typeof i=="string"?t.getExtension(i):i}class ni extends _n{get[Symbol.toStringTag](){return"Renderbuffer"}static isSupported(e){let{format:n}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{format:null};return!n||jP(e,n,Ap)}static getSamplesForFormat(e,n){let{format:r}=n;return e.getInternalformatParameter(36161,r,32937)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.initialize(n),Object.seal(this)}initialize(e){let{format:n,width:r=1,height:i=1,samples:s=0}=e;return N(n,"Needs format"),this._trackDeallocatedMemory(),this.gl.bindRenderbuffer(36161,this.handle),s!==0&&$(this.gl)?this.gl.renderbufferStorageMultisample(36161,s,n,r,i):this.gl.renderbufferStorage(36161,n,r,i),this.format=n,this.width=r,this.height=i,this.samples=s,this._trackAllocatedMemory(this.width*this.height*(this.samples||1)*Ap[this.format].bpp),this}resize(e){let{width:n,height:r}=e;return n!==this.width||r!==this.height?this.initialize({width:n,height:r,format:this.format,samples:this.samples}):this}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this._trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(36161,e)}_syncHandle(e){this.format=this.getParameter(36164),this.width=this.getParameter(36162),this.height=this.getParameter(36163),this.samples=this.getParameter(36011)}_getParameter(e){return this.gl.bindRenderbuffer(36161,this.handle),this.gl.getRenderbufferParameter(36161,e)}}const GP=256,WP=1024,HP=16384,Lp=6144,Cp=6145,Ip=6146,Mp=34041,h_="clear: bad arguments";function Wh(t){let{framebuffer:e=null,color:n=null,depth:r=null,stencil:i=null}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const s={};e&&(s.framebuffer=e);let o=0;n&&(o|=HP,n!==!0&&(s.clearColor=n)),r&&(o|=GP,r!==!0&&(s.clearDepth=r)),i&&(o|=WP,r!==!0&&(s.clearStencil=r)),N(o!==0,h_),at(t,s,()=>{t.clear(o)})}function XP(t){let{framebuffer:e=null,buffer:n=Lp,drawBuffer:r=0,value:i=[0,0,0,0]}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Be(t),at(t,{framebuffer:e},()=>{switch(n){case Lp:switch(i.constructor){case Int32Array:t.clearBufferiv(n,r,i);break;case Uint32Array:t.clearBufferuiv(n,r,i);break;case Float32Array:default:t.clearBufferfv(n,r,i)}break;case Cp:t.clearBufferfv(Cp,0,[i]);break;case Ip:t.clearBufferiv(Ip,0,[i]);break;case Mp:const[s,o]=i;t.clearBufferfi(Mp,0,s,o);break;default:N(!1,h_)}})}function YP(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return N(!1),0}}function zl(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408}=e;let{sourceAttachment:s=36064,target:o=null,sourceWidth:a,sourceHeight:l,sourceType:u}=e;const{framebuffer:c,deleteFramebuffer:f}=d_(t);N(c);const{gl:h,handle:d,attachments:p}=c;a=a||c.width,l=l||c.height,s===36064&&d===null&&(s=1028),N(p[s]),u=u||p[s].type,o=ZP(o,u,i,a,l),u=u||cf(o);const E=h.bindFramebuffer(36160,d);return h.readPixels(n,r,a,l,i,u,o),h.bindFramebuffer(36160,E||null),f&&c.delete(),o}function Op(t){let{sourceAttachment:e=36064,targetMaxHeight:n=Number.MAX_SAFE_INTEGER}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=zl(t,{sourceAttachment:e}),{width:i,height:s}=t;for(;s>n;)({data:r,width:i,height:s}=MP({data:r,width:i,height:s}));IP({data:r,width:i,height:s});const o=document.createElement("canvas");o.width=i,o.height=s;const a=o.getContext("2d"),l=a.createImageData(i,s);return l.data.set(r),a.putImageData(l,0,0),o.toDataURL()}function $P(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{sourceX:r=0,sourceY:i=0,targetMipmaplevel:s=0,targetInternalFormat:o=6408}=n;let{targetX:a,targetY:l,targetZ:u,width:c,height:f}=n;const{framebuffer:h,deleteFramebuffer:d}=d_(t);N(h);const{gl:p,handle:E}=h,b=typeof a<"u"||typeof l<"u"||typeof u<"u";a=a||0,l=l||0,u=u||0;const y=p.bindFramebuffer(36160,E);N(e);let m=null;if(e instanceof br&&(m=e,c=Number.isFinite(c)?c:m.width,f=Number.isFinite(f)?f:m.height,m.bind(0),e=m.target),!b)p.copyTexImage2D(e,s,o,r,i,c,f,0);else switch(e){case 3553:case 34067:p.copyTexSubImage2D(e,s,a,l,r,i,c,f);break;case 35866:case 32879:Be(p).copyTexSubImage3D(e,s,a,l,u,r,i,c,f);break}return m&&m.unbind(),p.bindFramebuffer(36160,y||null),d&&h.delete(),m}function d_(t){return t instanceof be?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:sA(t),deleteFramebuffer:!0}}function ZP(t,e,n,r,i){if(t)return t;e=e||5121;const s=js(e,{clamped:!1}),o=YP(n);return new s(r*i*o)}const se={WEBGL2:"WEBGL2",VERTEX_ARRAY_OBJECT:"VERTEX_ARRAY_OBJECT",TIMER_QUERY:"TIMER_QUERY",INSTANCED_RENDERING:"INSTANCED_RENDERING",MULTIPLE_RENDER_TARGETS:"MULTIPLE_RENDER_TARGETS",ELEMENT_INDEX_UINT32:"ELEMENT_INDEX_UINT32",BLEND_EQUATION_MINMAX:"BLEND_EQUATION_MINMAX",FLOAT_BLEND:"FLOAT_BLEND",COLOR_ENCODING_SRGB:"COLOR_ENCODING_SRGB",TEXTURE_DEPTH:"TEXTURE_DEPTH",TEXTURE_FLOAT:"TEXTURE_FLOAT",TEXTURE_HALF_FLOAT:"TEXTURE_HALF_FLOAT",TEXTURE_FILTER_LINEAR_FLOAT:"TEXTURE_FILTER_LINEAR_FLOAT",TEXTURE_FILTER_LINEAR_HALF_FLOAT:"TEXTURE_FILTER_LINEAR_HALF_FLOAT",TEXTURE_FILTER_ANISOTROPIC:"TEXTURE_FILTER_ANISOTROPIC",COLOR_ATTACHMENT_RGBA32F:"COLOR_ATTACHMENT_RGBA32F",COLOR_ATTACHMENT_FLOAT:"COLOR_ATTACHMENT_FLOAT",COLOR_ATTACHMENT_HALF_FLOAT:"COLOR_ATTACHMENT_HALF_FLOAT",GLSL_FRAG_DATA:"GLSL_FRAG_DATA",GLSL_FRAG_DEPTH:"GLSL_FRAG_DEPTH",GLSL_DERIVATIVES:"GLSL_DERIVATIVES",GLSL_TEXTURE_LOD:"GLSL_TEXTURE_LOD"};function KP(t){const e=new ct(t,{format:6408,type:5126,dataFormat:6408}),n=new be(t,{id:"test-framebuffer",check:!1,attachments:{36064:e}}),r=n.getStatus();return e.delete(),n.delete(),r===36053}const g_={[se.WEBGL2]:[!1,!0],[se.VERTEX_ARRAY_OBJECT]:["OES_vertex_array_object",!0],[se.TIMER_QUERY]:["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],[se.INSTANCED_RENDERING]:["ANGLE_instanced_arrays",!0],[se.MULTIPLE_RENDER_TARGETS]:["WEBGL_draw_buffers",!0],[se.ELEMENT_INDEX_UINT32]:["OES_element_index_uint",!0],[se.BLEND_EQUATION_MINMAX]:["EXT_blend_minmax",!0],[se.FLOAT_BLEND]:["EXT_float_blend"],[se.COLOR_ENCODING_SRGB]:["EXT_sRGB",!0],[se.TEXTURE_DEPTH]:["WEBGL_depth_texture",!0],[se.TEXTURE_FLOAT]:["OES_texture_float",!0],[se.TEXTURE_HALF_FLOAT]:["OES_texture_half_float",!0],[se.TEXTURE_FILTER_LINEAR_FLOAT]:["OES_texture_float_linear"],[se.TEXTURE_FILTER_LINEAR_HALF_FLOAT]:["OES_texture_half_float_linear"],[se.TEXTURE_FILTER_ANISOTROPIC]:["EXT_texture_filter_anisotropic"],[se.COLOR_ATTACHMENT_RGBA32F]:[KP,"EXT_color_buffer_float"],[se.COLOR_ATTACHMENT_FLOAT]:[!1,"EXT_color_buffer_float"],[se.COLOR_ATTACHMENT_HALF_FLOAT]:["EXT_color_buffer_half_float"],[se.GLSL_FRAG_DATA]:["WEBGL_draw_buffers",!0],[se.GLSL_FRAG_DEPTH]:["EXT_frag_depth",!0],[se.GLSL_DERIVATIVES]:["OES_standard_derivatives",!0],[se.GLSL_TEXTURE_LOD]:["EXT_shader_texture_lod",!0]},qP=2;function QP(t,e){return Hh(t,e)}function Hh(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>p_(t,n))}function JP(t){t.luma=t.luma||{},t.luma.caps=t.luma.caps||{};for(const e in g_)t.luma.caps[e]===void 0&&(t.luma.caps[e]=p_(t,e));return t.luma.caps}function p_(t,e){return t.luma=t.luma||{},t.luma.caps=t.luma.caps||{},t.luma.caps[e]===void 0&&(t.luma.caps[e]=eA(t,e)),t.luma.caps[e]||U.log(qP,"Feature: ".concat(e," not supported"))(),t.luma.caps[e]}function eA(t,e){const n=g_[e];N(n,e);let r;const i=$(t)&&n[1]||n[0];if(typeof i=="function")r=i(t);else if(Array.isArray(i)){r=!0;for(const s of i)r=r&&!!t.getExtension(s)}else typeof i=="string"?r=!!t.getExtension(i):typeof i=="boolean"?r=i:N(!1);return r}const Rp="Multiple render targets not supported";class be extends _n{get[Symbol.toStringTag](){return"Framebuffer"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{colorBufferFloat:r,colorBufferHalfFloat:i}=n;let s=!0;return r&&(s=!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("WEBGL_color_buffer_float")||e.getExtension("OES_texture_float"))),i&&(s=s&&!!(e.getExtension("EXT_color_buffer_float")||e.getExtension("EXT_color_buffer_half_float"))),s}static getDefaultFramebuffer(e){return e.luma=e.luma||{},e.luma.defaultFramebuffer=e.luma.defaultFramebuffer||new be(e,{id:"default-framebuffer",handle:null,attachments:{}}),e.luma.defaultFramebuffer}get MAX_COLOR_ATTACHMENTS(){const e=Be(this.gl);return e.getParameter(e.MAX_COLOR_ATTACHMENTS)}get MAX_DRAW_BUFFERS(){const e=Be(this.gl);return e.getParameter(e.MAX_DRAW_BUFFERS)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.width=null,this.height=null,this.attachments={},this.readBuffer=36064,this.drawBuffers=[36064],this.ownResources=[],this.initialize(n),Object.seal(this)}get color(){return this.attachments[36064]||null}get texture(){return this.attachments[36064]||null}get depth(){return this.attachments[36096]||this.attachments[33306]||null}get stencil(){return this.attachments[36128]||this.attachments[33306]||null}initialize(e){let{width:n=1,height:r=1,attachments:i=null,color:s=!0,depth:o=!0,stencil:a=!1,check:l=!0,readBuffer:u=void 0,drawBuffers:c=void 0}=e;if(N(n>=0&&r>=0,"Width and height need to be integers"),this.width=n,this.height=r,i)for(const f in i){const h=i[f];(Array.isArray(h)?h[0]:h).resize({width:n,height:r})}else i=this._createDefaultAttachments(s,o,a,n,r);this.update({clearAttachments:!0,attachments:i,readBuffer:u,drawBuffers:c}),i&&l&&this.checkStatus()}delete(){for(const e of this.ownResources)e.delete();return super.delete(),this}update(e){let{attachments:n={},readBuffer:r,drawBuffers:i,clearAttachments:s=!1,resizeAttachments:o=!0}=e;this.attach(n,{clearAttachments:s,resizeAttachments:o});const{gl:a}=this,l=a.bindFramebuffer(36160,this.handle);return r&&this._setReadBuffer(r),i&&this._setDrawBuffers(i),a.bindFramebuffer(36160,l||null),this}resize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},{width:n,height:r}=e;if(this.handle===null)return N(n===void 0&&r===void 0),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight),n!==this.width&&r!==this.height&&U.log(2,"Resizing framebuffer ".concat(this.id," to ").concat(n,"x").concat(r))();for(const i in this.attachments)this.attachments[i].resize({width:n,height:r});return this.width=n,this.height=r,this}attach(e){let{clearAttachments:n=!1,resizeAttachments:r=!0}=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i={};n&&Object.keys(this.attachments).forEach(o=>{i[o]=null}),Object.assign(i,e);const s=this.gl.bindFramebuffer(36160,this.handle);for(const o in i){N(o!==void 0,"Misspelled framebuffer binding point?");const a=Number(o),l=i[a];let u=l;if(!u)this._unattach(a);else if(u instanceof ni)this._attachRenderbuffer({attachment:a,renderbuffer:u});else if(Array.isArray(l)){const[c,f=0,h=0]=l;u=c,this._attachTexture({attachment:a,texture:c,layer:f,level:h})}else this._attachTexture({attachment:a,texture:u,layer:0,level:0});r&&u&&u.resize({width:this.width,height:this.height})}this.gl.bindFramebuffer(36160,s||null),Object.assign(this.attachments,e),Object.keys(this.attachments).filter(o=>!this.attachments[o]).forEach(o=>{delete this.attachments[o]})}checkStatus(){const e=this.getStatus();if(e!==36053)throw new Error(nA(e));return this}getStatus(){const{gl:e}=this,n=e.bindFramebuffer(36160,this.handle),r=e.checkFramebufferStatus(36160);return e.bindFramebuffer(36160,n||null),r}clear(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{color:n,depth:r,stencil:i,drawBuffers:s=[]}=e,o=this.gl.bindFramebuffer(36160,this.handle);return(n||r||i)&&Wh(this.gl,{color:n,depth:r,stencil:i}),s.forEach((a,l)=>{XP(this.gl,{drawBuffer:l,value:a})}),this.gl.bindFramebuffer(36160,o||null),this}readPixels(){return U.error("Framebuffer.readPixels() is no logner supported, use readPixelsToArray(framebuffer)")(),null}readPixelsToBuffer(){return U.error("Framebuffer.readPixelsToBuffer()is no logner supported, use readPixelsToBuffer(framebuffer)")(),null}copyToDataUrl(){return U.error("Framebuffer.copyToDataUrl() is no logner supported, use copyToDataUrl(framebuffer)")(),null}copyToImage(){return U.error("Framebuffer.copyToImage() is no logner supported, use copyToImage(framebuffer)")(),null}copyToTexture(){return U.error("Framebuffer.copyToTexture({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}blit(){return U.error("Framebuffer.blit({...}) is no logner supported, use blit(source, target, opts)")(),null}invalidate(e){let{attachments:n=[],x:r=0,y:i=0,width:s,height:o}=e;const a=Be(this.gl),l=a.bindFramebuffer(36008,this.handle);return r===0&&i===0&&s===void 0&&o===void 0?a.invalidateFramebuffer(36008,n):a.invalidateFramebuffer(36008,n,r,i,s,o),a.bindFramebuffer(36008,l),this}getAttachmentParameter(e,n,r){let i=this._getAttachmentParameterFallback(n);return i===null&&(this.gl.bindFramebuffer(36160,this.handle),i=this.gl.getFramebufferAttachmentParameter(36160,e,n),this.gl.bindFramebuffer(36160,null)),r&&i>1e3&&(i=Hn(this.gl,i)),i}getAttachmentParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:36064,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:this.constructor.ATTACHMENT_PARAMETERS||[];const i={};for(const s of r){const o=n?Hn(this.gl,s):s;i[o]=this.getAttachmentParameter(e,s,n)}return i}getParameters(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;const n=Object.keys(this.attachments),r={};for(const i of n){const s=Number(i),o=e?Hn(this.gl,s):s;r[o]=this.getAttachmentParameters(s,e)}return r}show(){return typeof window<"u"&&window.open(Op(this),"luma-debug-texture"),this}log(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"";if(e>U.level||typeof window>"u")return this;n=n||"Framebuffer ".concat(this.id);const r=Op(this,{targetMaxHeight:100});return U.image({logLevel:e,message:n,image:r},n)(),this}bind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,this.handle),this}unbind(){let{target:e=36160}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.gl.bindFramebuffer(e,null),this}_createDefaultAttachments(e,n,r,i,s){let o=null;return e&&(o=o||{},o[36064]=new ct(this.gl,{id:"".concat(this.id,"-color0"),pixels:null,format:6408,type:5121,width:i,height:s,mipmaps:!1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.ownResources.push(o[36064])),n&&r?(o=o||{},o[33306]=new ni(this.gl,{id:"".concat(this.id,"-depth-stencil"),format:35056,width:i,height:111}),this.ownResources.push(o[33306])):n?(o=o||{},o[36096]=new ni(this.gl,{id:"".concat(this.id,"-depth"),format:33189,width:i,height:s}),this.ownResources.push(o[36096])):r&&N(!1),o}_unattach(e){const n=this.attachments[e];n&&(n instanceof ni?this.gl.framebufferRenderbuffer(36160,e,36161,null):this.gl.framebufferTexture2D(36160,e,3553,null,0),delete this.attachments[e])}_attachRenderbuffer(e){let{attachment:n=36064,renderbuffer:r}=e;const{gl:i}=this;i.framebufferRenderbuffer(36160,n,36161,r.handle),this.attachments[n]=r}_attachTexture(e){let{attachment:n=36064,texture:r,layer:i,level:s}=e;const{gl:o}=this;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:Be(o).framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const l=tA(i);o.framebufferTexture2D(36160,n,l,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:N(!1,"Illegal texture type")}o.bindTexture(r.target,null),this.attachments[n]=r}_setReadBuffer(e){const n=MS(this.gl);n?n.readBuffer(e):N(e===36064||e===1029,Rp),this.readBuffer=e}_setDrawBuffers(e){const{gl:n}=this,r=Be(n);if(r)r.drawBuffers(e);else{const i=n.getExtension("WEBGL_draw_buffers");i?i.drawBuffersWEBGL(e):N(e.length===1&&(e[0]===36064||e[0]===1029),Rp)}this.drawBuffers=e}_getAttachmentParameterFallback(e){const n=JP(this.gl);switch(e){case 36052:return n.WEBGL2?null:0;case 33298:case 33299:case 33300:case 33301:case 33302:case 33303:return n.WEBGL2?null:8;case 33297:return n.WEBGL2?null:5125;case 33296:return!n.WEBGL2&&!n.EXT_sRGB?9729:null;default:return null}}_createHandle(){return this.gl.createFramebuffer()}_deleteHandle(){this.gl.deleteFramebuffer(this.handle)}_bindHandle(e){return this.gl.bindFramebuffer(36160,e)}}function tA(t){return t<34069?t+34069:t}function nA(t){return(be.STATUS||{})[t]||"Framebuffer error ".concat(t)}const rA=[36049,36048,33296,33298,33299,33300,33301,33302,33303];be.ATTACHMENT_PARAMETERS=rA;function iA(t,e){N(t instanceof ct||t instanceof f_||t instanceof VP);const n=t.constructor,{gl:r,width:i,height:s,format:o,type:a,dataFormat:l,border:u,mipmaps:c}=t,f=Object.assign({width:i,height:s,format:o,type:a,dataFormat:l,border:u,mipmaps:c},e);return new n(r,f)}function sA(t,e){const{gl:n,width:r,height:i,id:s}=t;return new be(n,Object.assign({},e,{id:"framebuffer-for-".concat(s),width:r,height:i,attachments:{36064:t}}))}function xa(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"unnamed";const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/,r=t.match(n);return r?r[1]:e}const oA=35632,aA=35633;function lA(t){switch(t){case oA:return"fragment";case aA:return"vertex";default:return"unknown type"}}function uA(t,e,n,r){const i=t.split(/\r?\n/),s={},o={},a=r||xa(e)||"(unnamed)",l="".concat(lA(n)," shader ").concat(a);for(let c=0;c<i.length;c++){const f=i[c];if(f.length<=1)continue;const h=f.split(":"),d=h[0],p=parseInt(h[2],10);if(isNaN(p))throw new Error("GLSL compilation error in ".concat(l,": ").concat(t));d!=="WARNING"?s[p]=f:o[p]=f}const u=cA(e);return{shaderName:l,errors:kp(s,u),warnings:kp(o,u)}}function kp(t,e){let n="";for(let r=0;r<e.length;r++){const i=e[r];if(!(!t[r+3]&&!t[r+2]&&!t[r+1])&&(n+="".concat(i,`
`),t[r+1])){const s=t[r+1],o=s.split(":",3),a=o[0],l=parseInt(o[1],10)||0,u=s.substring(o.join(":").length+1).trim();n+=m_("^^^ ".concat(a,": ").concat(u,`

`),l)}}return n}function cA(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:": ";const r=t.split(/\r?\n/),i=String(r.length+e-1).length;return r.map((s,o)=>{const a=String(o+e),l=a.length;return m_(a,i-l)+n+s})}function m_(t,e){let n="";for(let r=0;r<e;++r)n+=" ";return"".concat(n).concat(t)}function y_(t){let e=100;const n=t.match(/[^\s]+/g);if(n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const fA="Shader: GLSL source code must be a JavaScript string";class Gs extends _n{get[Symbol.toStringTag](){return"Shader"}static getTypeName(e){switch(e){case 35633:return"vertex-shader";case 35632:return"fragment-shader";default:return N(!1),"unknown"}}constructor(e,n){Dl(e),N(typeof n.source=="string",fA);const r=xa(n.source,null)||n.id||Zn("unnamed ".concat(Gs.getTypeName(n.shaderType)));super(e,{id:r}),this.shaderType=n.shaderType,this.source=n.source,this.initialize(n)}initialize(e){let{source:n}=e;const r=xa(n,null);r&&(this.id=Zn(r)),this._compile(n)}getParameter(e){return this.gl.getShaderParameter(this.handle,e)}toString(){return"".concat(Gs.getTypeName(this.shaderType),":").concat(this.id)}getName(){return xa(this.source)||"unnamed-shader"}getSource(){return this.gl.getShaderSource(this.handle)}getTranslatedSource(){const e=this.gl.getExtension("WEBGL_debug_shaders");return e?e.getTranslatedShaderSource(this.handle):"No translated source available. WEBGL_debug_shaders not implemented"}_compile(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this.source;if(e.startsWith("#version ")||(e=`#version 100
`.concat(e)),this.source=e,this.gl.shaderSource(this.handle,this.source),this.gl.compileShader(this.handle),!this.getParameter(35713)){const r=this.gl.getShaderInfoLog(this.handle),{shaderName:i,errors:s,warnings:o}=uA(r,this.source,this.shaderType,this.id);throw U.error("GLSL compilation errors in ".concat(i,`
`).concat(s))(),U.warn("GLSL compilation warnings in ".concat(i,`
`).concat(o))(),new Error("GLSL compilation errors in ".concat(i))}}_deleteHandle(){this.gl.deleteShader(this.handle)}_getOptsFromHandle(){return{type:this.getParameter(35663),source:this.getSource()}}}class Du extends Gs{get[Symbol.toStringTag](){return"VertexShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35633}))}_createHandle(){return this.gl.createShader(35633)}}class zu extends Gs{get[Symbol.toStringTag](){return"FragmentShader"}constructor(e,n){typeof n=="string"&&(n={source:n}),super(e,Object.assign({},n,{shaderType:35632}))}_createHandle(){return this.gl.createShader(35632)}}const hA={5126:re.bind(null,"uniform1fv",tt,1,Fe),35664:re.bind(null,"uniform2fv",tt,2,Fe),35665:re.bind(null,"uniform3fv",tt,3,Fe),35666:re.bind(null,"uniform4fv",tt,4,Fe),5124:re.bind(null,"uniform1iv",xn,1,Fe),35667:re.bind(null,"uniform2iv",xn,2,Fe),35668:re.bind(null,"uniform3iv",xn,3,Fe),35669:re.bind(null,"uniform4iv",xn,4,Fe),35670:re.bind(null,"uniform1iv",xn,1,Fe),35671:re.bind(null,"uniform2iv",xn,2,Fe),35672:re.bind(null,"uniform3iv",xn,3,Fe),35673:re.bind(null,"uniform4iv",xn,4,Fe),35674:re.bind(null,"uniformMatrix2fv",tt,4,nn),35675:re.bind(null,"uniformMatrix3fv",tt,9,nn),35676:re.bind(null,"uniformMatrix4fv",tt,16,nn),35678:Ce,35680:Ce,5125:re.bind(null,"uniform1uiv",Yo,1,Fe),36294:re.bind(null,"uniform2uiv",Yo,2,Fe),36295:re.bind(null,"uniform3uiv",Yo,3,Fe),36296:re.bind(null,"uniform4uiv",Yo,4,Fe),35685:re.bind(null,"uniformMatrix2x3fv",tt,6,nn),35686:re.bind(null,"uniformMatrix2x4fv",tt,8,nn),35687:re.bind(null,"uniformMatrix3x2fv",tt,6,nn),35688:re.bind(null,"uniformMatrix3x4fv",tt,12,nn),35689:re.bind(null,"uniformMatrix4x2fv",tt,8,nn),35690:re.bind(null,"uniformMatrix4x3fv",tt,12,nn),35678:Ce,35680:Ce,35679:Ce,35682:Ce,36289:Ce,36292:Ce,36293:Ce,36298:Ce,36299:Ce,36300:Ce,36303:Ce,36306:Ce,36307:Ce,36308:Ce,36311:Ce},dA={},gA={},pA={},Np=[0];function Xh(t,e,n,r){e===1&&typeof t=="boolean"&&(t=t?1:0),Number.isFinite(t)&&(Np[0]=t,t=Np);const i=t.length;if(i%e&&U.warn("Uniform size should be multiples of ".concat(e),t)(),t instanceof n)return t;let s=r[i];s||(s=new n(i),r[i]=s);for(let o=0;o<i;o++)s[o]=t[o];return s}function tt(t,e){return Xh(t,e,Float32Array,dA)}function xn(t,e){return Xh(t,e,Int32Array,gA)}function Yo(t,e){return Xh(t,e,Uint32Array,pA)}function Fp(t,e,n){const r=hA[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,t,e)}function mA(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const e=/([^[]*)(\[[0-9]+\])?/,n=t.match(e);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(t));return{name:n[1],length:n[2]||1,isArray:!!n[2]}}function yA(t,e,n){for(const r in t){const i=t[r];if((!n||!!n[r])&&!vA(i))throw e=e?"".concat(e," "):"",console.error("".concat(e," Bad uniform ").concat(r),i),new Error("".concat(e," Bad uniform ").concat(r))}return!0}function vA(t){return Array.isArray(t)||ArrayBuffer.isView(t)?EA(t):isFinite(t)||t===!0||t===!1||t instanceof br||t instanceof ni?!0:t instanceof be?!!t.texture:!1}function _A(t,e,n){if(Array.isArray(n)||ArrayBuffer.isView(n))if(t[e]){const r=t[e];for(let i=0,s=n.length;i<s;++i)r[i]=n[i]}else t[e]=n.slice();else t[e]=n}function EA(t){if(t.length===0)return!1;const e=Math.min(t.length,16);for(let n=0;n<e;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Ce(){let t=null;return(e,n,r)=>{const i=t!==r;return i&&(e.uniform1i(n,r),t=r),i}}function re(t,e,n,r){let i=null,s=null;return(o,a,l)=>{const u=e(l,n),c=u.length;let f=!1;if(i===null)i=new Float32Array(c),s=c,f=!0;else{N(s===c,"Uniform length cannot change.");for(let h=0;h<c;++h)if(u[h]!==i[h]){f=!0;break}}return f&&(r(o,t,a,u),i.set(u)),f}}function Fe(t,e,n,r){t[e](n,r)}function nn(t,e,n,r){t[e](n,!1,r)}const wA=5120,TA=5121,bA=5122,xA=5123,Dp=0,$o=1,SA=2,PA=3,Zo=4,AA=5,LA=6,Ee=5126,CA=35664,IA=35665,MA=35666,Qi=5124,OA=35667,RA=35668,kA=35669,Ji=5125,NA=36294,FA=36295,DA=36296,zA=35670,BA=35671,UA=35672,VA=35673,jA=35674,GA=35675,WA=35676,HA=35685,XA=35686,YA=35687,$A=35688,ZA=35689,KA=35690,df={[Ee]:[Ee,1,"float"],[CA]:[Ee,2,"vec2"],[IA]:[Ee,3,"vec3"],[MA]:[Ee,4,"vec4"],[Qi]:[Qi,1,"int"],[OA]:[Qi,2,"ivec2"],[RA]:[Qi,3,"ivec3"],[kA]:[Qi,4,"ivec4"],[Ji]:[Ji,1,"uint"],[NA]:[Ji,2,"uvec2"],[FA]:[Ji,3,"uvec3"],[DA]:[Ji,4,"uvec4"],[zA]:[Ee,1,"bool"],[BA]:[Ee,2,"bvec2"],[UA]:[Ee,3,"bvec3"],[VA]:[Ee,4,"bvec4"],[jA]:[Ee,8,"mat2"],[HA]:[Ee,8,"mat2x3"],[XA]:[Ee,8,"mat2x4"],[GA]:[Ee,12,"mat3"],[YA]:[Ee,12,"mat3x2"],[$A]:[Ee,12,"mat3x4"],[WA]:[Ee,16,"mat4"],[ZA]:[Ee,16,"mat4x2"],[KA]:[Ee,16,"mat4x3"]};function qA(t){switch(t){case Dp:return Dp;case $o:return $o;case PA:return $o;case SA:return $o;case Zo:return Zo;case AA:return Zo;case LA:return Zo;default:return N(!1),0}}function zp(t){const e=df[t];if(!e)return null;const[n,r]=e;return{type:n,components:r}}function v_(t,e){switch(t){case wA:case TA:case bA:case xA:t=Ee;break}for(const n in df){const[r,i,s]=df[n];if(r===t&&i===e)return{glType:n,name:s}}return null}class QA{constructor(e){this.id=e.id,this.attributeInfos=[],this.attributeInfosByName={},this.attributeInfosByLocation=[],this.varyingInfos=[],this.varyingInfosByName={},Object.seal(this),this._readAttributesFromProgram(e),this._readVaryingsFromProgram(e)}getAttributeInfo(e){const n=Number(e);return Number.isFinite(n)?this.attributeInfosByLocation[n]:this.attributeInfosByName[e]||null}getAttributeLocation(e){const n=this.getAttributeInfo(e);return n?n.location:-1}getAttributeAccessor(e){const n=this.getAttributeInfo(e);return n?n.accessor:null}getVaryingInfo(e){const n=Number(e);return Number.isFinite(n)?this.varyingInfos[n]:this.varyingInfosByName[e]||null}getVaryingIndex(e){const n=this.getVaryingInfo();return n?n.location:-1}getVaryingAccessor(e){const n=this.getVaryingInfo();return n?n.accessor:null}_readAttributesFromProgram(e){const{gl:n}=e,r=n.getProgramParameter(e.handle,35721);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getActiveAttrib(e.handle,i),l=n.getAttribLocation(e.handle,s);l>=0&&this._addAttribute(l,s,o,a)}this.attributeInfos.sort((i,s)=>i.location-s.location)}_readVaryingsFromProgram(e){const{gl:n}=e;if(!$(n))return;const r=n.getProgramParameter(e.handle,35971);for(let i=0;i<r;i++){const{name:s,type:o,size:a}=n.getTransformFeedbackVarying(e.handle,i);this._addVarying(i,s,o,a)}this.varyingInfos.sort((i,s)=>i.location-s.location)}_addAttribute(e,n,r,i){const{type:s,components:o}=zp(r),a={type:s,size:i*o};this._inferProperties(e,n,a);const l={location:e,name:n,accessor:new it(a)};this.attributeInfos.push(l),this.attributeInfosByLocation[e]=l,this.attributeInfosByName[l.name]=l}_inferProperties(e,n,r){/instance/i.test(n)&&(r.divisor=1)}_addVarying(e,n,r,i){const{type:s,components:o}=zp(r),a=new it({type:s,size:i*o}),l={location:e,name:n,accessor:a};this.varyingInfos.push(l),this.varyingInfosByName[l.name]=l}}const Bp=4,JA=35981,eL=["setVertexArray","setAttributes","setBuffers","unsetBuffers","use","getUniformCount","getUniformInfo","getUniformLocation","getUniformValue","getVarying","getFragDataLocation","getAttachedShaders","getAttributeCount","getAttributeLocation","getAttributeInfo"];class __ extends _n{get[Symbol.toStringTag](){return"Program"}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.stubRemovedMethods("Program","v6.0",eL),this._isCached=!1,this.initialize(n),Object.seal(this),this._setId(n.id)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{hash:n,vs:r,fs:i,varyings:s,bufferMode:o=JA}=e;return this.hash=n||"",this.vs=typeof r=="string"?new Du(this.gl,{id:"".concat(e.id,"-vs"),source:r}):r,this.fs=typeof i=="string"?new zu(this.gl,{id:"".concat(e.id,"-fs"),source:i}):i,N(this.vs instanceof Du),N(this.fs instanceof zu),this.uniforms={},this._textureUniforms={},s&&s.length>0&&(Be(this.gl),this.varyings=s,this.gl2.transformFeedbackVaryings(this.handle,s,o)),this._compileAndLink(),this._readUniformLocationsFromLinkedProgram(),this.configuration=new QA(this),this.setProps(e)}delete(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this._isCached?this:super.delete(e)}setProps(e){return"uniforms"in e&&this.setUniforms(e.uniforms),this}draw(e){let{logPriority:n,drawMode:r=4,vertexCount:i,offset:s=0,start:o,end:a,isIndexed:l=!1,indexType:u=5123,instanceCount:c=0,isInstanced:f=c>0,vertexArray:h=null,transformFeedback:d,framebuffer:p,parameters:E={},uniforms:b,samplers:y}=e;if((b||y)&&(U.deprecated("Program.draw({uniforms})","Program.setUniforms(uniforms)")(),this.setUniforms(b||{})),U.priority>=n){const m=p?p.id:"default",_="mode=".concat(Hn(this.gl,r)," verts=").concat(i," ")+"instances=".concat(c," indexType=").concat(Hn(this.gl,u)," ")+"isInstanced=".concat(f," isIndexed=").concat(l," ")+"Framebuffer=".concat(m);U.log(n,_)()}return N(h),this.gl.useProgram(this.handle),!this._areTexturesRenderable()||i===0||f&&c===0?!1:(h.bindForDraw(i,c,()=>{if(p!==void 0&&(E=Object.assign({},E,{framebuffer:p})),d){const m=qA(r);d.begin(m)}this._bindTextures(),at(this.gl,E,()=>{l&&f?this.gl2.drawElementsInstanced(r,i,u,s,c):l&&$(this.gl)&&!isNaN(o)&&!isNaN(a)?this.gl2.drawRangeElements(r,o,a,i,u,s):l?this.gl.drawElements(r,i,u,s):f?this.gl2.drawArraysInstanced(r,s,i,c):this.gl.drawArrays(r,s,i)}),d&&d.end()}),!0)}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};U.priority>=2&&yA(e,this.id,this._uniformSetters),this.gl.useProgram(this.handle);for(const n in e){const r=e[n],i=this._uniformSetters[n];if(i){let s=r,o=!1;if(s instanceof be&&(s=s.texture),s instanceof br)if(o=this.uniforms[n]!==r,o){i.textureIndex===void 0&&(i.textureIndex=this._textureIndexCounter++);const a=s,{textureIndex:l}=i;a.bind(l),s=l,this._textureUniforms[n]=a}else s=i.textureIndex;else this._textureUniforms[n]&&delete this._textureUniforms[n];(i(s)||o)&&_A(this.uniforms,n,r)}}return this}_areTexturesRenderable(){let e=!0;for(const n in this._textureUniforms){const r=this._textureUniforms[n];r.update(),e=e&&r.loaded}return e}_bindTextures(){for(const e in this._textureUniforms){const n=this._uniformSetters[e].textureIndex;this._textureUniforms[e].bind(n)}}_createHandle(){return this.gl.createProgram()}_deleteHandle(){this.gl.deleteProgram(this.handle)}_getOptionsFromHandle(e){const n=this.gl.getAttachedShaders(e),r={};for(const i of n)switch(this.gl.getShaderParameter(this.handle,35663)){case 35633:r.vs=new Du({handle:i});break;case 35632:r.fs=new zu({handle:i});break}return r}_getParameter(e){return this.gl.getProgramParameter(this.handle,e)}_setId(e){if(!e){const n=this._getName();this.id=Zn(n)}}_getName(){let e=this.vs.getName()||this.fs.getName();return e=e.replace(/shader/i,""),e=e?"".concat(e,"-program"):"program",e}_compileAndLink(){const{gl:e}=this;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),U.time(Bp,"linkProgram for ".concat(this._getName()))(),e.linkProgram(this.handle),U.timeEnd(Bp,"linkProgram for ".concat(this._getName()))(),e.debug||U.level>0){if(!e.getProgramParameter(this.handle,35714))throw new Error("Error linking: ".concat(e.getProgramInfoLog(this.handle)));if(e.validateProgram(this.handle),!e.getProgramParameter(this.handle,35715))throw new Error("Error validating: ".concat(e.getProgramInfoLog(this.handle)))}}_readUniformLocationsFromLinkedProgram(){const{gl:e}=this;this._uniformSetters={},this._uniformCount=this._getParameter(35718);for(let n=0;n<this._uniformCount;n++){const r=this.gl.getActiveUniform(this.handle,n),{name:i}=mA(r.name);let s=e.getUniformLocation(this.handle,i);if(this._uniformSetters[i]=Fp(e,s,r),r.size>1)for(let o=0;o<r.size;o++)s=e.getUniformLocation(this.handle,"".concat(i,"[").concat(o,"]")),this._uniformSetters["".concat(i,"[").concat(o,"]")]=Fp(e,s,r)}this._textureIndexCounter=0}getActiveUniforms(e,n){return this.gl2.getActiveUniforms(this.handle,e,n)}getUniformBlockIndex(e){return this.gl2.getUniformBlockIndex(this.handle,e)}getActiveUniformBlockParameter(e,n){return this.gl2.getActiveUniformBlockParameter(this.handle,e,n)}uniformBlockBinding(e,n){this.gl2.uniformBlockBinding(this.handle,e,n)}}const tL=34918,nL=34919,rL=35007,iL=36795,sL=35976,oL=35887,aL=36202;class al extends _n{get[Symbol.toStringTag](){return"Query"}static isSupported(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];const r=$(e),i=Hh(e,se.TIMER_QUERY);let s=r||i;for(const o of n)switch(o){case"queries":s=s&&r;break;case"timers":s=s&&i;break;default:N(!1)}return s}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(e,n),this.target=null,this._queryPending=!1,this._pollingPromise=null,Object.seal(this)}beginTimeElapsedQuery(){return this.begin(rL)}beginOcclusionQuery(){let{conservative:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.begin(e?aL:oL)}beginTransformFeedbackQuery(){return this.begin(sL)}begin(e){return this._queryPending?this:(this.target=e,this.gl2.beginQuery(this.target,this.handle),this)}end(){return this._queryPending?this:(this.target&&(this.gl2.endQuery(this.target),this.target=null,this._queryPending=!0),this)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.gl2.getQueryParameter(this.handle,nL);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.gl2.getParameter(iL)}getResult(){return this.gl2.getQueryParameter(this.handle,tL)}getTimerMilliseconds(){return this.getResult()/1e6}createPoll(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Number.POSITIVE_INFINITY;if(this._pollingPromise)return this._pollingPromise;let n=0;return this._pollingPromise=new Promise((r,i)=>{const s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):n++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}_createHandle(){return al.isSupported(this.gl)?this.gl2.createQuery():null}_deleteHandle(){this.gl2.deleteQuery(this.handle)}}class E_ extends _n{get[Symbol.toStringTag](){return"TransformFeedback"}static isSupported(e){return $(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Be(e),super(e,n),this.initialize(n),this.stubRemovedMethods("TransformFeedback","v6.0",["pause","resume"]),Object.seal(this)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.buffers={},this.unused={},this.configuration=null,this.bindOnUse=!0,Ti(this.buffers)||this.bind(()=>this._unbindBuffers()),this.setProps(e),this}setProps(e){"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"bindOnUse"in e&&(e=e.bindOnUse),"buffers"in e&&this.setBuffers(e.buffers)}setBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.bind(()=>{for(const n in e)this.setBuffer(n,e[n])}),this}setBuffer(e,n){const r=this._getVaryingIndex(e),{buffer:i,byteSize:s,byteOffset:o}=this._getBufferParams(n);return r<0?(this.unused[e]=i,U.warn("".concat(this.id," unused varying buffer ").concat(e))(),this):(this.buffers[r]=n,this.bindOnUse||this._bindBuffer(r,i,o,s),this)}begin(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return this.gl.bindTransformFeedback(36386,this.handle),this._bindBuffers(),this.gl.beginTransformFeedback(e),this}end(){return this.gl.endTransformFeedback(),this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null),this}_getBufferParams(e){let n,r,i;return e instanceof J?i=e:(i=e.buffer,r=e.byteSize,n=e.byteOffset),(n!==void 0||r!==void 0)&&(n=n||0,r=r||i.byteLength-n),{buffer:i,byteOffset:n,byteSize:r}}_getVaryingInfo(e){return this.configuration&&this.configuration.getVaryingInfo(e)}_getVaryingIndex(e){if(this.configuration)return this.configuration.getVaryingInfo(e).location;const n=Number(e);return Number.isFinite(n)?n:-1}_bindBuffers(){if(this.bindOnUse)for(const e in this.buffers){const{buffer:n,byteSize:r,byteOffset:i}=this._getBufferParams(this.buffers[e]);this._bindBuffer(e,n,i,r)}}_unbindBuffers(){if(this.bindOnUse)for(const e in this.buffers)this._bindBuffer(e,null)}_bindBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;const s=n&&n.handle;return!s||i===void 0?this.gl.bindBufferBase(35982,e,s):this.gl.bindBufferRange(35982,e,s,r,i),this}_createHandle(){return this.gl.createTransformFeedback()}_deleteHandle(){this.gl.deleteTransformFeedback(this.handle)}_bindHandle(e){this.gl.bindTransformFeedback(36386,this.handle)}}let Ko=null;function lL(t){return(!Ko||Ko.byteLength<t)&&(Ko=new ArrayBuffer(t)),Ko}function uL(t,e){const n=lL(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function cL(t){let{target:e,source:n,start:r=0,count:i=1}=t;const s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return e}const fL="elements must be GL.ELEMENT_ARRAY_BUFFER";class nt extends _n{get[Symbol.toStringTag](){return"VertexArrayObject"}static isSupported(e){return(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).constantAttributeZero?$(e)||Uv()==="Chrome":!0}static getDefaultArray(e){return e.luma=e.luma||{},e.luma.defaultVertexArray||(e.luma.defaultVertexArray=new nt(e,{handle:null,isDefaultArray:!0})),e.luma.defaultVertexArray}static getMaxAttributes(e){return nt.MAX_ATTRIBUTES=nt.MAX_ATTRIBUTES||e.getParameter(34921),nt.MAX_ATTRIBUTES}static setConstant(e,n,r){switch(r.constructor){case Float32Array:nt._setConstantFloatArray(e,n,r);break;case Int32Array:nt._setConstantIntArray(e,n,r);break;case Uint32Array:nt._setConstantUintArray(e,n,r);break;default:N(!1)}}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;super(e,Object.assign({},n,{id:r})),this.buffer=null,this.bufferValue=null,this.isDefaultArray=n.isDefaultArray||!1,this.gl2=e,this.initialize(n),Object.seal(this)}delete(){return super.delete(),this.buffer&&this.buffer.delete(),this}get MAX_ATTRIBUTES(){return nt.getMaxAttributes(this.gl)}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.setProps(e)}setProps(e){return this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return N(!e||e.target===34963,fL),this.bind(()=>{this.gl.bindBuffer(34963,e?e.handle:null)}),this}setBuffer(e,n,r){if(n.target===34963)return this.setElementBuffer(n,r);const{size:i,type:s,stride:o,offset:a,normalized:l,integer:u,divisor:c}=r,{gl:f,gl2:h}=this;return e=Number(e),this.bind(()=>{f.bindBuffer(34962,n.handle),u?(N($(f)),h.vertexAttribIPointer(e,i,s,o,a)):f.vertexAttribPointer(e,i,s,l,o,a),f.enableVertexAttribArray(e),h.vertexAttribDivisor(e,c||0)}),this}enable(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return!n&&e===0&&!nt.isSupported(this.gl,{constantAttributeZero:!0})||(e=Number(e),this.bind(()=>n?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e))),this}getConstantBuffer(e,n){const r=this._normalizeConstantArrayValue(n),i=r.byteLength*e,s=r.length*e;let o=!this.buffer;if(this.buffer=this.buffer||new J(this.gl,i),o=o||this.buffer.reallocate(i),o=o||!this._compareConstantArrayValues(r,this.bufferValue),o){const a=uL(n.constructor,s);cL({target:a,source:r,start:0,count:s}),this.buffer.subData(a),this.bufferValue=n}return this.buffer}_normalizeConstantArrayValue(e){return Array.isArray(e)?new Float32Array(e):e}_compareConstantArrayValues(e,n){if(!e||!n||e.length!==n.length||e.constructor!==n.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==n[r])return!1;return!0}static _setConstantFloatArray(e,n,r){switch(r.length){case 1:e.vertexAttrib1fv(n,r);break;case 2:e.vertexAttrib2fv(n,r);break;case 3:e.vertexAttrib3fv(n,r);break;case 4:e.vertexAttrib4fv(n,r);break;default:N(!1)}}static _setConstantIntArray(e,n,r){switch(N($(e)),r.length){case 1:e.vertexAttribI1iv(n,r);break;case 2:e.vertexAttribI2iv(n,r);break;case 3:e.vertexAttribI3iv(n,r);break;case 4:e.vertexAttribI4iv(n,r);break;default:N(!1)}}static _setConstantUintArray(e,n,r){switch(N($(e)),r.length){case 1:e.vertexAttribI1uiv(n,r);break;case 2:e.vertexAttribI2uiv(n,r);break;case 3:e.vertexAttribI3uiv(n,r);break;case 4:e.vertexAttribI4uiv(n,r);break;default:N(!1)}}_createHandle(){return this.gl.createVertexArray()}_deleteHandle(e){return this.gl2.deleteVertexArray(e),[this.elements]}_bindHandle(e){this.gl2.bindVertexArray(e)}_getParameter(e,n){let{location:r}=n;return N(Number.isFinite(r)),this.bind(()=>{switch(e){case 34373:return this.gl.getVertexAttribOffset(r,e);default:return this.gl.getVertexAttrib(r,e)}})}}const hL="VertexArray: attributes must be Buffers or constants (i.e. typed array)",dL=/^(.+)__LOCATION_([0-9]+)$/,gL=["setBuffers","setGeneric","clearBindings","setLocations","setGenericValues","setDivisor","enable","disable"];class pL{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const r=n.id||n.program&&n.program.id;this.id=r,this.gl=e,this.configuration=null,this.elements=null,this.elementsAccessor=null,this.values=null,this.accessors=null,this.unused=null,this.drawParams=null,this.buffer=null,this.attributes={},this.vertexArrayObject=new nt(e),a_(this,"VertexArray","v6.0",gL),this.initialize(n),Object.seal(this)}delete(){this.buffer&&this.buffer.delete(),this.vertexArrayObject.delete()}initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.reset(),this.configuration=null,this.bindOnUse=!1,this.setProps(e)}reset(){this.elements=null,this.elementsAccessor=null;const{MAX_ATTRIBUTES:e}=this.vertexArrayObject;return this.values=new Array(e).fill(null),this.accessors=new Array(e).fill(null),this.unused={},this.drawParams=null,this}setProps(e){return"program"in e&&(this.configuration=e.program&&e.program.configuration),"configuration"in e&&(this.configuration=e.configuration),"attributes"in e&&this.setAttributes(e.attributes),"elements"in e&&this.setElementBuffer(e.elements),"bindOnUse"in e&&(e=e.bindOnUse),this}clearDrawParams(){this.drawParams=null}getDrawParams(){return this.drawParams=this.drawParams||this._updateDrawParams(),this.drawParams}setAttributes(e){return Object.assign(this.attributes,e),this.vertexArrayObject.bind(()=>{for(const n in e){const r=e[n];this._setAttribute(n,r)}this.gl.bindBuffer(34962,null)}),this}setElementBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return this.elements=e,this.elementsAccessor=n,this.clearDrawParams(),this.vertexArrayObject.setElementBuffer(e,n),this}setBuffer(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(n.target===34963)return this.setElementBuffer(n,r);const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,n.accessor,r);return i>=0&&(this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.setBuffer(i,n,s)),this}setConstant(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const{location:i,accessor:s}=this._resolveLocationAndAccessor(e,n,Object.assign({size:n.length},r));return i>=0&&(n=this.vertexArrayObject._normalizeConstantArrayValue(n),this.values[i]=n,this.accessors[i]=s,this.clearDrawParams(),this.vertexArrayObject.enable(i,!1)),this}unbindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.vertexArrayObject.setElementBuffer(null),this.buffer=this.buffer||new J(this.gl,{accessor:{size:4}});for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++)this.values[e]instanceof J&&(this.gl.disableVertexAttribArray(e),this.gl.bindBuffer(34962,this.buffer.handle),this.gl.vertexAttribPointer(e,1,5126,!1,0,0))}),this}bindBuffers(){return this.vertexArrayObject.bind(()=>{this.elements&&this.setElementBuffer(this.elements);for(let e=0;e<this.vertexArrayObject.MAX_ATTRIBUTES;e++){const n=this.values[e];n instanceof J&&this.setBuffer(e,n)}}),this}bindForDraw(e,n,r){let i;return this.vertexArrayObject.bind(()=>{this._setConstantAttributes(e,n),i=r()}),i}_resolveLocationAndAccessor(e,n,r,i){const s={location:-1,accessor:null},{location:o,name:a}=this._getAttributeIndex(e);if(!Number.isFinite(o)||o<0)return this.unused[e]=n,U.once(3,()=>"unused value ".concat(e," in ").concat(this.id))(),s;const l=this._getAttributeInfo(a||o);if(!l)return s;const u=this.accessors[o]||{},c=it.resolve(l.accessor,u,r,i),{size:f,type:h}=c;return N(Number.isFinite(f)&&Number.isFinite(h)),{location:o,accessor:c}}_getAttributeInfo(e){return this.configuration&&this.configuration.getAttributeInfo(e)}_getAttributeIndex(e){const n=Number(e);if(Number.isFinite(n))return{location:n};const r=dL.exec(e),i=r?r[1]:e,s=r?Number(r[2]):0;return this.configuration?{location:this.configuration.getAttributeLocation(i)+s,name:i}:{location:-1}}_setAttribute(e,n){if(n instanceof J)this.setBuffer(e,n);else if(Array.isArray(n)&&n.length&&n[0]instanceof J){const r=n[0],i=n[1];this.setBuffer(e,r,i)}else if(ArrayBuffer.isView(n)||Array.isArray(n)){const r=n;this.setConstant(e,r)}else if(n.buffer instanceof J){const r=n;this.setBuffer(e,r.buffer,r)}else throw new Error(hL)}_setConstantAttributes(e,n){const r=Math.max(e|0,n|0);let i=this.values[0];ArrayBuffer.isView(i)&&this._setConstantAttributeZero(i,r);for(let s=1;s<this.vertexArrayObject.MAX_ATTRIBUTES;s++)i=this.values[s],ArrayBuffer.isView(i)&&this._setConstantAttribute(s,i)}_setConstantAttributeZero(e,n){if(nt.isSupported(this.gl,{constantAttributeZero:!0})){this._setConstantAttribute(0,e);return}const r=this.vertexArrayObject.getConstantBuffer(n,e);this.vertexArrayObject.setBuffer(0,r,this.accessors[0])}_setConstantAttribute(e,n){nt.setConstant(this.gl,e,n)}_updateDrawParams(){const e={isIndexed:!1,isInstanced:!1,indexCount:1/0,vertexCount:1/0,instanceCount:1/0};for(let n=0;n<this.vertexArrayObject.MAX_ATTRIBUTES;n++)this._updateDrawParamsForLocation(e,n);return this.elements&&(e.elementCount=this.elements.getElementCount(this.elements.accessor),e.isIndexed=!0,e.indexType=this.elementsAccessor.type||this.elements.accessor.type,e.indexOffset=this.elementsAccessor.offset||0),e.indexCount===1/0&&(e.indexCount=0),e.vertexCount===1/0&&(e.vertexCount=0),e.instanceCount===1/0&&(e.instanceCount=0),e}_updateDrawParamsForLocation(e,n){const r=this.values[n],i=this.accessors[n];if(!r)return;const{divisor:s}=i,o=s>0;if(e.isInstanced=e.isInstanced||o,r instanceof J){const a=r;if(o){const l=a.getVertexCount(i);e.instanceCount=Math.min(e.instanceCount,l)}else{const l=a.getVertexCount(i);e.vertexCount=Math.min(e.vertexCount,l)}}}setElements(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return U.deprecated("setElements","setElementBuffer")(),this.setElementBuffer(e,n)}}function mL(t,e){const{maxElts:n=16,size:r=1}=e;let i="[";for(let o=0;o<t.length&&o<n;++o)o>0&&(i+=",".concat(o%r===0?" ":"")),i+=Ws(t[o],e);const s=t.length>n?"...":"]";return"".concat(i).concat(s)}function Ws(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=1e-16,{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return mL(t,e);if(!Number.isFinite(t))return String(t);if(Math.abs(t)<n)return r?"0":"0.";if(r||Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const i=t.toPrecision(2);return i.indexOf(".0")===i.length-2?i.slice(0,-1):i}function Up(t){let{header:e="Uniforms",program:n,uniforms:r,undefinedOnly:i=!1}=t;N(n);const s=".*_.*",o=".*Matrix",a=n._uniformSetters,l={},u=Object.keys(a).sort();let c=0;for(const d of u)!d.match(s)&&!d.match(o)&&Bu({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:i})&&c++;for(const d of u)d.match(o)&&Bu({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:i})&&c++;for(const d of u)l[d]||Bu({table:l,header:e,uniforms:r,uniformName:d,undefinedOnly:i})&&c++;let f=0;const h={};if(!i)for(const d in r){const p=r[d];l[d]||(f++,h[d]={Type:"NOT USED: ".concat(p),[e]:Ws(p)})}return{table:l,count:c,unusedTable:h,unusedCount:f}}function Bu(t){let{table:e,header:n,uniforms:r,uniformName:i,undefinedOnly:s}=t;const o=r[i],a=yL(o);return!s||!a?(e[i]={[n]:a?Ws(o):"N/A","Uniform Type":a?o:"NOT PROVIDED"},!0):!1}function yL(t){return t!=null}function vL(t){let{vertexArray:e,header:n="Attributes"}=t;if(!e.configuration)return{};const r={};e.elements&&(r.ELEMENT_ARRAY_BUFFER=Vp(e,e.elements,null,n));const i=e.values;for(const s in i){const o=e._getAttributeInfo(s);if(o){let a="".concat(s,": ").concat(o.name);const l=e.accessors[o.location];l&&(a="".concat(s,": ").concat(_L(o.name,l))),r[a]=Vp(e,i[s],l,n)}}return r}function Vp(t,e,n,r){const{gl:i}=t;if(!e)return{[r]:"null","Format ":"N/A"};let s="NOT PROVIDED",o=1,a=0,l=0,u,c,f;if(n&&(s=n.type,o=n.size,s=String(s).replace("Array",""),u=s.indexOf("nt")!==-1),e instanceof J){const h=e,{data:d,changed:p}=h.getDebugData();c=p?"*":"",f=d,l=h.byteLength,a=l/d.BYTES_PER_ELEMENT/o;let E;if(n){const b=n.divisor>0;E="".concat(b?"I ":"P "," ").concat(a," (x").concat(o,"=").concat(l," bytes ").concat(Hn(i,s),")")}else u=!0,E="".concat(l," bytes");return{[r]:"".concat(c).concat(Ws(f,{size:o,isInteger:u})),"Format ":E}}return f=e,o=e.length,s=String(e.constructor.name).replace("Array",""),u=s.indexOf("nt")!==-1,{[r]:"".concat(Ws(f,{size:o,isInteger:u})," (constant)"),"Format ":"".concat(o,"x").concat(s," (constant)")}}function _L(t,e){const{type:n,size:r}=e,i=v_(n,r);return i?"".concat(t," (").concat(i.name,")"):t}function EL(t){const e={},n="Accessors for ".concat(t.id);for(const r of t.attributeInfos)if(r){const i=jp(r);e["in ".concat(i)]={[n]:JSON.stringify(r.accessor)}}for(const r of t.varyingInfos)if(r){const i=jp(r);e["out ".concat(i)]={[n]:JSON.stringify(r.accessor)}}return e}function jp(t){const{type:e,size:n}=t.accessor,r=v_(e,n);return r?"".concat(r.name," ").concat(t.name):t.name}const Gp=vn()&&typeof document<"u";let wL=0;class TL{constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{onCreateContext:n=b=>o_(b),onAddHTML:r=null,onInitialize:i=()=>{},onRender:s=()=>{},onFinalize:o=()=>{},onError:a,gl:l=null,glOptions:u={},debug:c=!1,createFramebuffer:f=!1,autoResizeViewport:h=!0,autoResizeDrawingBuffer:d=!0,stats:p=hr.get("animation-loop-".concat(wL++))}=e;let{useDevicePixels:E=!0}=e;"useDevicePixelRatio"in e&&(U.deprecated("useDevicePixelRatio","useDevicePixels")(),E=e.useDevicePixelRatio),this.props={onCreateContext:n,onAddHTML:r,onInitialize:i,onRender:s,onFinalize:o,onError:a,gl:l,glOptions:u,debug:c,createFramebuffer:f},this.gl=l,this.needsRedraw=null,this.timeline=null,this.stats=p,this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.setProps({autoResizeViewport:h,autoResizeDrawingBuffer:d,useDevicePixels:E}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._pageLoadPromise=null,this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}delete(){this.stop(),this._setDisplay(null)}setNeedsRedraw(e){return N(typeof e=="string"),this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.autoResizeViewport=e.autoResizeViewport),"autoResizeDrawingBuffer"in e&&(this.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer),"useDevicePixels"in e&&(this.useDevicePixels=e.useDevicePixels),this}start(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(this._running)return this;this._running=!0;const n=this._getPageLoadPromise().then(()=>!this._running||this._initialized?null:(this._createWebGLContext(e),this._createFramebuffer(),this._startEventHandling(),this._initializeCallbackData(),this._updateCallbackData(),this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._gpuTimeQuery=al.isSupported(this.gl,["timers"])?new al(this.gl):null,this._initialized=!0,this.onInitialize(this.animationProps))).then(r=>{this._running&&(this._addCallbackData(r||{}),r!==!1&&this._startLoop())});return this.props.onError&&n.catch(this.props.onError),this}redraw(){return this.isContextLost()?this:(this._beginTimers(),this._setupFrame(),this._updateCallbackData(),this._renderFrame(this.animationProps),this._clearNeedsRedraw(),this.offScreen&&this.gl.commit&&this.gl.commit(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endTimers(),this)}stop(){return this._running&&(this._finalizeCallbackData(),this._cancelAnimationFrame(this._animationFrameId),this._nextFramePromise=null,this._resolveNextFrame=null,this._animationFrameId=null,this._running=!1),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){return this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.gl.canvas.toDataURL()}isContextLost(){return this.gl.isContextLost()}onCreateContext(){return this.props.onCreateContext(...arguments)}onInitialize(){return this.props.onInitialize(...arguments)}onRender(){return this.props.onRender(...arguments)}onFinalize(){return this.props.onFinalize(...arguments)}getHTMLControlValue(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.getElementById(e);return r?Number(r.value):n}setViewParameters(){return U.removed("AnimationLoop.setViewParameters","AnimationLoop.setProps")(),this}_startLoop(){const e=()=>{this._running&&(this.redraw(),this._animationFrameId=this._requestAnimationFrame(e))};this._cancelAnimationFrame(this._animationFrameId),this._animationFrameId=this._requestAnimationFrame(e)}_getPageLoadPromise(){return this._pageLoadPromise||(this._pageLoadPromise=Gp?new Promise((e,n)=>{if(Gp&&document.readyState==="complete"){e(document);return}window.addEventListener("load",()=>{e(document)})}):Promise.resolve({})),this._pageLoadPromise}_setDisplay(e){this.display&&(this.display.delete(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_cancelAnimationFrame(e){return this.display&&this.display.cancelAnimationFrame?this.display.cancelAnimationFrame(e):LP(e)}_requestAnimationFrame(e){if(this._running)return this.display&&this.display.requestAnimationFrame?this.display.requestAnimationFrame(e):AP(e)}_renderFrame(){if(this.display){this.display._renderFrame(...arguments);return}this.onRender(...arguments)}_clearNeedsRedraw(){this.needsRedraw=null}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport(),this._resizeFramebuffer()}_initializeCallbackData(){this.animationProps={gl:this.gl,stop:this.stop,canvas:this.gl.canvas,framebuffer:this.framebuffer,useDevicePixels:this.useDevicePixels,needsRedraw:null,startTime:Date.now(),engineTime:0,tick:0,tock:0,time:0,_timeline:this.timeline,_loop:this,_animationLoop:this,_mousePosition:null}}_updateCallbackData(){const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime,this.animationProps._offScreen=this.offScreen}_finalizeCallbackData(){this.onFinalize(this.animationProps)}_addCallbackData(e){typeof e=="object"&&e!==null&&(this.animationProps=Object.assign({},this.animationProps,e))}_createWebGLContext(e){if(this.offScreen=e.canvas&&typeof OffscreenCanvas<"u"&&e.canvas instanceof OffscreenCanvas,e=Object.assign({},e,this.props.glOptions),this.gl=this.props.gl?jh(this.props.gl,e):this.onCreateContext(e),!Fl(this.gl))throw new Error("AnimationLoop.onCreateContext - illegal context returned");gP(this.gl),this._createInfoDiv()}_createInfoDiv(){if(this.gl.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",e.appendChild(this.gl.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){const e=this.gl.drawingBufferWidth,n=this.gl.drawingBufferHeight;let r=1;const{canvas:i}=this.gl;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.autoResizeViewport&&this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.autoResizeDrawingBuffer&&_P(this.gl,{useDevicePixels:this.useDevicePixels})}_createFramebuffer(){this.props.createFramebuffer&&(this.framebuffer=new be(this.gl))}_resizeFramebuffer(){this.framebuffer&&this.framebuffer.resize({width:this.gl.drawingBufferWidth,height:this.gl.drawingBufferHeight})}_beginTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this._gpuTimeQuery&&this._gpuTimeQuery.isResultAvailable()&&!this._gpuTimeQuery.isTimerDisjoint()&&this.stats.get("GPU Time").addTime(this._gpuTimeQuery.getTimerMilliseconds()),this._gpuTimeQuery&&this._gpuTimeQuery.beginTimeElapsedQuery(),this.cpuTime.timeStart()}_endTimers(){this.cpuTime.timeEnd(),this._gpuTimeQuery&&this._gpuTimeQuery.end()}_startEventHandling(){const{canvas:e}=this.gl;e&&(e.addEventListener("mousemove",this._onMousemove),e.addEventListener("mouseleave",this._onMouseleave))}_onMousemove(e){this.animationProps._mousePosition=[e.offsetX,e.offsetY]}_onMouseleave(e){this.animationProps._mousePosition=null}}const ao="vs",Yh="fs";function lt(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Uu={number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},array:{validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function bL(t){const e={};for(const n in t){const r=t[n],i=xL(r);e[n]=i}return e}function xL(t){let e=Wp(t);return e==="object"?t?"type"in t?Object.assign({},t,Uu[t.type]):"value"in t?(e=Wp(t.value),Object.assign({type:e},t,Uu[e])):{type:"object",value:t}:{type:"object",value:null}:Object.assign({type:e,value:t},Uu[e])}function Wp(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const SL="vs",PL="fs";class Hp{constructor(e){let{name:n,vs:r,fs:i,dependencies:s=[],uniforms:o,getUniforms:a,deprecations:l=[],defines:u={},inject:c={},vertexShader:f,fragmentShader:h}=e;lt(typeof n=="string"),this.name=n,this.vs=r||f,this.fs=i||h,this.getModuleUniforms=a,this.dependencies=s,this.deprecations=this._parseDeprecationDefinitions(l),this.defines=u,this.injections=AL(c),o&&(this.uniforms=bL(o))}getModuleSource(e){let n;switch(e){case SL:n=this.vs||"";break;case PL:n=this.fs||"";break;default:lt(!1)}return"#define MODULE_".concat(this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),`
`).concat(n,"// END MODULE_").concat(this.name,`

`)}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):this.uniforms?this._defaultGetUniforms(e):{}}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{r.regex.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp("\\b".concat(n.old,"\\("));break;default:n.regex=new RegExp("".concat(n.type," ").concat(n.old,";"))}}),e}_defaultGetUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&lt(s.validate(e[i],s),"".concat(this.name,": invalid ").concat(i)),n[i]=e[i]):n[i]=s.value}return n}}function AL(t){const e={vs:{},fs:{}};for(const n in t){let r=t[n];const i=n.slice(0,2);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function LL(t){return CL(T_(t))}function CL(t){const e={},n={};return w_({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function w_(t){let{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&w_({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function T_(t,e){return t.map(n=>(n instanceof Hp||(lt(typeof n!="string","Shader module use by name is deprecated. Import shader module '".concat(n,"' and use it directly.")),lt(n.name,"shader module has no name"),n=new Hp(n),n.dependencies=T_(n.dependencies)),n))}function IL(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const e=typeof window<"u"?window.navigator||{}:{},n=t.userAgent||e.userAgent||"",r=n.indexOf("MSIE ")!==-1,i=n.indexOf("Trident/")!==-1;return r||i}const ML=7936,OL=7937,RL=7938,kL=35724,$h={GLSL_FRAG_DATA:["WEBGL_draw_buffers",!0],GLSL_FRAG_DEPTH:["EXT_frag_depth",!0],GLSL_DERIVATIVES:["OES_standard_derivatives",!0],GLSL_TEXTURE_LOD:["EXT_shader_texture_lod",!0]},lr={};Object.keys($h).forEach(t=>{lr[t]=t});function NL(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&t._version===2)}function FL(t){const e=t.getExtension("WEBGL_debug_renderer_info"),n=t.getParameter(e&&e.UNMASKED_VENDOR_WEBGL||ML),r=t.getParameter(e&&e.UNMASKED_RENDERER_WEBGL||OL);return{gpuVendor:DL(n,r),vendor:n,renderer:r,version:t.getParameter(RL),shadingLanguageVersion:t.getParameter(kL)}}function DL(t,e){return t.match(/NVIDIA/i)||e.match(/NVIDIA/i)?"NVIDIA":t.match(/INTEL/i)||e.match(/INTEL/i)?"INTEL":t.match(/AMD/i)||e.match(/AMD/i)||t.match(/ATI/i)||e.match(/ATI/i)?"AMD":"UNKNOWN GPU"}const Vu={};function Xp(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=$h[e];if(lt(r,e),!IL(n))return!0;if(e in Vu)return Vu[e];const i=r[0],s=n.behavior||"enable",o="#extension GL_".concat(i," : ").concat(s,`
void main(void) {}`),a=t.createShader(35633);t.shaderSource(a,o),t.compileShader(a);const l=t.getShaderParameter(a,35713);return t.deleteShader(a),Vu[e]=l,l}function zL(t,e){const n=$h[e];lt(n,e);const r=NL(t)&&n[1]||n[0],i=typeof r=="string"?!!t.getExtension(r):r;return lt(i===!1||i===!0),i}function qo(t,e){return e=Array.isArray(e)?e:[e],e.every(n=>zL(t,n))}function BL(t){switch(FL(t).gpuVendor.toLowerCase()){case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function UL(t,e,n){let r=`#if (__VERSION__ > 120)

# define FEATURE_GLSL_DERIVATIVES
# define FEATURE_GLSL_DRAW_BUFFERS
# define FEATURE_GLSL_FRAG_DEPTH
# define FEATURE_GLSL_TEXTURE_LOD

// DEPRECATED FLAGS, remove in v9
# define FRAG_DEPTH
# define DERIVATIVES
# define DRAW_BUFFERS
# define TEXTURE_LOD

#endif // __VERSION
`;return qo(t,lr.GLSL_FRAG_DEPTH)&&(r+=`
// FRAG_DEPTH => gl_FragDepth is available
#ifdef GL_EXT_frag_depth
#extension GL_EXT_frag_depth : enable
# define FEATURE_GLSL_FRAG_DEPTH
# define FRAG_DEPTH
# define gl_FragDepth gl_FragDepthEXT
#endif
`),qo(t,lr.GLSL_DERIVATIVES)&&Xp(t,lr.GLSL_DERIVATIVES)&&(r+=`
// DERIVATIVES => dxdF, dxdY and fwidth are available
#ifdef GL_OES_standard_derivatives
#extension GL_OES_standard_derivatives : enable
# define FEATURE_GLSL_DERIVATIVES
# define DERIVATIVES
#endif
`),qo(t,lr.GLSL_FRAG_DATA)&&Xp(t,lr.GLSL_FRAG_DATA,{behavior:"require"})&&(r+=`
// DRAW_BUFFERS => gl_FragData[] is available
#ifdef GL_EXT_draw_buffers
#extension GL_EXT_draw_buffers : require
#define FEATURE_GLSL_DRAW_BUFFERS
#define DRAW_BUFFERS
#endif
`),qo(t,lr.GLSL_TEXTURE_LOD)&&(r+=`// TEXTURE_LOD => texture2DLod etc are available
#ifdef GL_EXT_shader_texture_lod
#extension GL_EXT_shader_texture_lod : enable

# define FEATURE_GLSL_TEXTURE_LOD
# define TEXTURE_LOD

#endif
`),r}const VL=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,jL=`#ifdef MODULE_MATERIAL
  gl_FragColor = material_filterColor(gl_FragColor);
#endif

#ifdef MODULE_LIGHTING
  gl_FragColor = lighting_filterColor(gl_FragColor);
#endif

#ifdef MODULE_FOG
  gl_FragColor = fog_filterColor(gl_FragColor);
#endif

#ifdef MODULE_PICKING
  gl_FragColor = picking_filterHighlightColor(gl_FragColor);
  gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,GL={[ao]:VL,[Yh]:jL},Sa="__LUMA_INJECT_DECLARATIONS__",Yp=/void\s+main\s*\([^)]*\)\s*\{\n?/,$p=/}\n?[^{}]*$/,ju=[];function Zp(t,e,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;const i=e===ao;for(const s in n){const o=n[s];o.sort((l,u)=>l.order-u.order),ju.length=o.length;for(let l=0,u=o.length;l<u;++l)ju[l]=o[l].injection;const a="".concat(ju.join(`
`),`
`);switch(s){case"vs:#decl":i&&(t=t.replace(Sa,a));break;case"vs:#main-start":i&&(t=t.replace(Yp,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace($p,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Sa,a));break;case"fs:#main-start":i||(t=t.replace(Yp,l=>l+a));break;case"fs:#main-end":i||(t=t.replace($p,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Sa,""),r&&(t=t.replace(/\}\s*$/,s=>s+GL[e])),t}function gf(t){const e={};return lt(Array.isArray(t)&&t.length>1),t.forEach(n=>{for(const r in n)e[r]=e[r]?"".concat(e[r],`
`).concat(n[r]):n[r]}),e}function bi(t){return new RegExp("\\b".concat(t,"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)"),"g")}const b_=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],WL=[...b_,[bi("attribute"),"in $1"],[bi("varying"),"out $1"]],HL=[...b_,[bi("varying"),"in $1"]],x_=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],XL=[...x_,[bi("in"),"attribute $1"],[bi("out"),"varying $1"]],YL=[...x_,[bi("in"),"varying $1"]],pf="gl_FragColor",mf=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/,$L=/void\s+main\s*\([^)]*\)\s*\{\n?/;function ZL(t,e,n){switch(e){case 300:return n?ll(t,WL):KL(t);case 100:return n?ll(t,XL):qL(t);default:throw new Error("unknown GLSL version ".concat(e))}}function ll(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function KL(t){t=ll(t,HL);const e=t.match(mf);if(e){const n=e[1];t=t.replace(new RegExp("\\b".concat(pf,"\\b"),"g"),n)}else{const n="fragmentColor";t=t.replace($L,r=>"out vec4 ".concat(n,`;
`).concat(r)).replace(new RegExp("\\b".concat(pf,"\\b"),"g"),n)}return t}function qL(t){t=ll(t,YL);const e=t.match(mf);if(e){const n=e[1];t=t.replace(mf,"").replace(new RegExp("\\b".concat(n,"\\b"),"g"),pf)}return t}const QL=`

`.concat(Sa,`

`),S_={[ao]:"vertex",[Yh]:"fragment"},JL=`precision highp float;

`;function eC(t,e){const{vs:n,fs:r}=e,i=LL(e.modules||[]);return{gl:t,vs:Kp(t,Object.assign({},e,{source:n,type:ao,modules:i})),fs:Kp(t,Object.assign({},e,{source:r,type:Yh,modules:i})),getUniforms:tC(i)}}function Kp(t,e){let{id:n,source:r,type:i,modules:s,defines:o={},hookFunctions:a=[],inject:l={},transpileToGLSL100:u=!1,prologue:c=!0,log:f}=e;lt(typeof r=="string","shader source must be a string");const h=i===ao,d=r.split(`
`);let p=100,E="",b=r;d[0].indexOf("#version ")===0?(p=300,E=d[0],b=d.slice(1).join(`
`)):E="#version ".concat(p);const y={};s.forEach(L=>{Object.assign(y,L.getDefines())}),Object.assign(y,o);let m=c?"".concat(E,`
`).concat(rC({id:n,source:r,type:i}),`
`).concat(nC({type:i}),`
`).concat(BL(t),`
`).concat(UL(t),`
`).concat(iC(y),`
`).concat(h?"":JL,`
`):"".concat(E,`
`);const _=oC(a),T={},S={},P={};for(const L in l){const C=typeof l[L]=="string"?{injection:l[L],order:0}:l[L],I=L.match(/^(v|f)s:(#)?([\w-]+)$/);if(I){const M=I[2],B=I[3];M?B==="decl"?S[L]=[C]:P[L]=[C]:T[L]=[C]}else P[L]=[C]}for(const L of s){f&&L.checkDeprecations(b,f);const C=L.getModuleSource(i,p);m+=C;const I=L.injections[i];for(const M in I){const B=M.match(/^(v|f)s:#([\w-]+)$/);if(B){const j=B[2]==="decl"?S:P;j[M]=j[M]||[],j[M].push(I[M])}else T[M]=T[M]||[],T[M].push(I[M])}}return m+=QL,m=Zp(m,i,S),m+=sC(_[i],T),m+=b,m=Zp(m,i,P),m=ZL(m,u?100:p,h),m}function tC(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function nC(t){let{type:e}=t;return`
#define SHADER_TYPE_`.concat(S_[e].toUpperCase(),`
`)}function rC(t){let{id:e,source:n,type:r}=t;return e&&typeof e=="string"&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME `.concat(e,"_").concat(S_[r],`

`):""}function iC(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},e=0,n="";for(const r in t){e===0&&(n+=`
// APPLICATION DEFINES
`),e++;const i=t[r];(i||Number.isFinite(i))&&(n+="#define ".concat(r.toUpperCase()," ").concat(t[r],`
`))}return e===0&&(n+=`
`),n}function sC(t,e){let n="";for(const r in t){const i=t[r];if(n+="void ".concat(i.signature,` {
`),i.header&&(n+="  ".concat(i.header)),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+="  ".concat(o.injection,`
`)}i.footer&&(n+="  ".concat(i.footer)),n+=`}
`}return n}function oC(t){const e={vs:{},fs:{}};return t.forEach(n=>{let r;typeof n!="string"?(r=n,n=r.hook):r={},n=n.trim();const[i,s]=n.split(":"),o=n.replace(/\(.+/,"");e[i][o]=Object.assign(r,{signature:s})}),e}const aC="void main() {gl_FragColor = vec4(0);}",P_=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,lC=`#version 300 es
`.concat(P_);function A_(t,e){e=Array.isArray(e)?e:[e];const n=t.replace(/^\s+/,"").split(/\s+/),[r,i,s]=n;if(!e.includes(r)||!i||!s)return null;const o=s.split(";")[0];return{qualifier:r,type:i,name:o}}function L_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{version:e=100,input:n,inputType:r,output:i}=t;if(!n)return e===300?lC:e>300?"#version ".concat(e,`
`).concat(P_):aC;const s=fC(n,r);return e>=300?"#version ".concat(e," ").concat(e===300?"es":"",`
in `).concat(r," ").concat(n,`;
out vec4 `).concat(i,`;
void main() {
  `).concat(i," = ").concat(s,`;
}`):"varying ".concat(r," ").concat(n,`;
void main() {
  gl_FragColor = `).concat(s,`;
}`)}function uC(t){switch(t){case"float":return"x";case"vec2":return"xy";case"vec3":return"xyz";case"vec4":return"xyzw";default:return lt(!1),null}}function cC(t){switch(t){case"float":return 1;case"vec2":return 2;case"vec3":return 3;case"vec4":return 4;default:return lt(!1),null}}function fC(t,e){switch(e){case"float":return"vec4(".concat(t,", 0.0, 0.0, 1.0)");case"vec2":return"vec4(".concat(t,", 0.0, 1.0)");case"vec3":return"vec4(".concat(t,", 1.0)");case"vec4":return t;default:return lt(!1),null}}const hC=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,dC={name:"fp32",vs:hC,fs:null};function qp(t,e){if(!t)throw new Error("math.gl assertion ".concat(e))}const Je={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function gC(t,{precision:e=Je.precision}={}){return t=pC(t),"".concat(parseFloat(t.toPrecision(e)))}function xr(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function kn(t,e,n){return yC(t,r=>Math.max(e,Math.min(n,r)))}function ul(t,e,n){return xr(t)?t.map((r,i)=>ul(r,e[i],n)):n*e+(1-n)*t}function Hs(t,e,n){const r=Je.EPSILON;try{if(t===e)return!0;if(xr(t)&&xr(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Hs(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Je.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Je.EPSILON=r}}function pC(t){return Math.round(t/Je.EPSILON)*Je.EPSILON}function mC(t){return t.clone?t.clone():new Array(t.length)}function yC(t,e,n){if(xr(t)){const r=t;n=n||mC(r);for(let i=0;i<n.length&&i<r.length;++i)n[i]=e(t[i],i,n);return n}return e(t)}function vC(t){function e(){var n=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(n,Object.getPrototypeOf(this)),n}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}class C_ extends vC(Array){clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:xr(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Je)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+gC(this[r],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(n,"]")}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Hs(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i];this[i]=s+r*(n[i]-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Je.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function _C(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Me(t){if(!Number.isFinite(t))throw new Error("Invalid number ".concat(t));return t}function Gu(t,e,n=""){if(Je.debug&&!_C(t,e))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"));return t}class I_ extends C_{get x(){return this[0]}set x(e){this[0]=Me(e)}get y(){return this[1]}set y(e){this[1]=Me(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Me(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Me(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return qp(e>=0&&e<this.ELEMENTS,"index is out of range"),Me(this[e])}setComponent(e,n){return qp(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}var Pa=1e-6,xi=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function EC(){var t=new xi(2);return xi!=Float32Array&&(t[0]=0,t[1]=0),t}function Qp(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function wC(t,e){return t[0]=-e[0],t[1]=-e[1],t}function M_(t,e,n,r){var i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function TC(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t}function bC(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function xC(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function O_(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){var t=EC();return function(e,n,r,i,s,o){var a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function R_(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function k_(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function SC(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}class Wu extends I_{constructor(e=0,n=0){super(2),xr(e)&&arguments.length===1?this.copy(e):(Je.debug&&(Me(e),Me(n)),this[0]=e,this[1]=n)}set(e,n){return this[0]=e,this[1]=n,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return Je.debug&&(Me(e.x),Me(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return O_(this,this,e),this.check()}transformAsVector(e){return R_(this,this,e),this.check()}transformByMatrix3(e){return xC(this,this,e),this.check()}transformByMatrix2x3(e){return bC(this,this,e),this.check()}transformByMatrix2(e){return TC(this,this,e),this.check()}}function PC(){var t=new xi(3);return xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function AC(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function LC(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function CC(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function IC(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function N_(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function MC(t,e,n){var r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function OC(t,e,n){var r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],u=e[2],c=i*u-s*l,f=s*a-r*u,h=r*l-i*a,d=i*h-s*f,p=s*c-r*h,E=r*f-i*c,b=o*2;return c*=b,f*=b,h*=b,d*=2,p*=2,E*=2,t[0]=a+c+d,t[1]=l+f+p,t[2]=u+h+E,t}function RC(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function kC(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function NC(t,e,n,r){var i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function FC(t,e){var n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt(n*n+r*r+i*i),u=Math.sqrt(s*s+o*o+a*a),c=l*u,f=c&&CC(t,e)/c;return Math.acos(Math.min(Math.max(f,-1),1))}var DC=AC;(function(){var t=PC();return function(e,n,r,i,s,o){var a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Hu=[0,0,0];let Qo;class Qt extends I_{static get ZERO(){return Qo||(Qo=new Qt(0,0,0),Object.freeze(Qo)),Qo}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&xr(e)?this.copy(e):(Je.debug&&(Me(e),Me(n),Me(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Je.debug&&(Me(e.x),Me(e.y),Me(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Me(e)}angle(e){return FC(this,e)}cross(e){return IC(this,this,e),this.check()}rotateX({radians:e,origin:n=Hu}){return RC(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Hu}){return kC(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Hu}){return NC(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return N_(this,this,e),this.check()}transformAsVector(e){return k_(this,this,e),this.check()}transformByMatrix3(e){return MC(this,this,e),this.check()}transformByMatrix2(e){return SC(this,this,e),this.check()}transformByQuaternion(e){return OC(this,this,e),this.check()}}class zC extends C_{toString(){let e="[";if(Je.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=" ".concat(this[r*this.RANK+n])}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=" ".concat(this[n])}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Me(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function BC(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function UC(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function yf(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],u=e[7],c=e[8],f=e[9],h=e[10],d=e[11],p=e[12],E=e[13],b=e[14],y=e[15],m=n*a-r*o,_=n*l-i*o,T=n*u-s*o,S=r*l-i*a,P=r*u-s*a,L=i*u-s*l,C=c*E-f*p,I=c*b-h*p,M=c*y-d*p,B=f*b-h*E,V=f*y-d*E,j=h*y-d*b,Z=m*j-_*V+T*B+S*M-P*I+L*C;return Z?(Z=1/Z,t[0]=(a*j-l*V+u*B)*Z,t[1]=(i*V-r*j-s*B)*Z,t[2]=(E*L-b*P+y*S)*Z,t[3]=(h*P-f*L-d*S)*Z,t[4]=(l*M-o*j-u*I)*Z,t[5]=(n*j-i*M+s*I)*Z,t[6]=(b*T-p*L-y*_)*Z,t[7]=(c*L-h*T+d*_)*Z,t[8]=(o*V-a*M+u*C)*Z,t[9]=(r*M-n*V-s*C)*Z,t[10]=(p*P-E*T+y*m)*Z,t[11]=(f*T-c*P-d*m)*Z,t[12]=(a*I-o*B-l*C)*Z,t[13]=(n*B-r*I+i*C)*Z,t[14]=(E*_-p*S-b*m)*Z,t[15]=(c*S-f*_+h*m)*Z,t):null}function VC(t){var e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],u=t[8],c=t[9],f=t[10],h=t[11],d=t[12],p=t[13],E=t[14],b=t[15],y=e*o-n*s,m=e*a-r*s,_=e*l-i*s,T=n*a-r*o,S=n*l-i*o,P=r*l-i*a,L=u*p-c*d,C=u*E-f*d,I=u*b-h*d,M=c*E-f*p,B=c*b-h*p,V=f*b-h*E;return y*V-m*B+_*M+T*I-S*C+P*L}function pr(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],u=e[6],c=e[7],f=e[8],h=e[9],d=e[10],p=e[11],E=e[12],b=e[13],y=e[14],m=e[15],_=n[0],T=n[1],S=n[2],P=n[3];return t[0]=_*r+T*a+S*f+P*E,t[1]=_*i+T*l+S*h+P*b,t[2]=_*s+T*u+S*d+P*y,t[3]=_*o+T*c+S*p+P*m,_=n[4],T=n[5],S=n[6],P=n[7],t[4]=_*r+T*a+S*f+P*E,t[5]=_*i+T*l+S*h+P*b,t[6]=_*s+T*u+S*d+P*y,t[7]=_*o+T*c+S*p+P*m,_=n[8],T=n[9],S=n[10],P=n[11],t[8]=_*r+T*a+S*f+P*E,t[9]=_*i+T*l+S*h+P*b,t[10]=_*s+T*u+S*d+P*y,t[11]=_*o+T*c+S*p+P*m,_=n[12],T=n[13],S=n[14],P=n[15],t[12]=_*r+T*a+S*f+P*E,t[13]=_*i+T*l+S*h+P*b,t[14]=_*s+T*u+S*d+P*y,t[15]=_*o+T*c+S*p+P*m,t}function cl(t,e,n){var r=n[0],i=n[1],s=n[2],o,a,l,u,c,f,h,d,p,E,b,y;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],u=e[3],c=e[4],f=e[5],h=e[6],d=e[7],p=e[8],E=e[9],b=e[10],y=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=u,t[4]=c,t[5]=f,t[6]=h,t[7]=d,t[8]=p,t[9]=E,t[10]=b,t[11]=y,t[12]=o*r+c*i+p*s+e[12],t[13]=a*r+f*i+E*s+e[13],t[14]=l*r+h*i+b*s+e[14],t[15]=u*r+d*i+y*s+e[15]),t}function Zh(t,e,n){var r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function jC(t,e,n,r){var i=r[0],s=r[1],o=r[2],a=Math.hypot(i,s,o),l,u,c,f,h,d,p,E,b,y,m,_,T,S,P,L,C,I,M,B,V,j,Z,bt;return a<Pa?null:(a=1/a,i*=a,s*=a,o*=a,l=Math.sin(n),u=Math.cos(n),c=1-u,f=e[0],h=e[1],d=e[2],p=e[3],E=e[4],b=e[5],y=e[6],m=e[7],_=e[8],T=e[9],S=e[10],P=e[11],L=i*i*c+u,C=s*i*c+o*l,I=o*i*c-s*l,M=i*s*c-o*l,B=s*s*c+u,V=o*s*c+i*l,j=i*o*c+s*l,Z=s*o*c-i*l,bt=o*o*c+u,t[0]=f*L+E*C+_*I,t[1]=h*L+b*C+T*I,t[2]=d*L+y*C+S*I,t[3]=p*L+m*C+P*I,t[4]=f*M+E*B+_*V,t[5]=h*M+b*B+T*V,t[6]=d*M+y*B+S*V,t[7]=p*M+m*B+P*V,t[8]=f*j+E*Z+_*bt,t[9]=h*j+b*Z+T*bt,t[10]=d*j+y*Z+S*bt,t[11]=p*j+m*Z+P*bt,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function F_(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],u=e[8],c=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+u*r,t[5]=o*i+c*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=u*i-s*r,t[9]=c*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function GC(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],u=e[8],c=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-u*r,t[1]=o*i-c*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+u*i,t[9]=o*r+c*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function D_(t,e,n){var r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],u=e[4],c=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+u*r,t[1]=o*i+c*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=u*i-s*r,t[5]=c*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function WC(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,u=n*o,c=r*o,f=r*a,h=i*o,d=i*a,p=i*l,E=s*o,b=s*a,y=s*l;return t[0]=1-f-p,t[1]=c+y,t[2]=h-b,t[3]=0,t[4]=c-y,t[5]=1-u-p,t[6]=d+E,t[7]=0,t[8]=h+b,t[9]=d-E,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function HC(t,e,n,r,i,s,o){var a=1/(n-e),l=1/(i-r),u=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*u,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*u,t[15]=0,t}function XC(t,e,n,r,i){var s=1/Math.tan(e/2),o;return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var YC=XC;function $C(t,e,n,r,i,s,o){var a=1/(e-n),l=1/(r-i),u=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*u,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*u,t[15]=1,t}var ZC=$C;function KC(t,e,n,r){var i,s,o,a,l,u,c,f,h,d,p=e[0],E=e[1],b=e[2],y=r[0],m=r[1],_=r[2],T=n[0],S=n[1],P=n[2];return Math.abs(p-T)<Pa&&Math.abs(E-S)<Pa&&Math.abs(b-P)<Pa?BC(t):(c=p-T,f=E-S,h=b-P,d=1/Math.hypot(c,f,h),c*=d,f*=d,h*=d,i=m*h-_*f,s=_*c-y*h,o=y*f-m*c,d=Math.hypot(i,s,o),d?(d=1/d,i*=d,s*=d,o*=d):(i=0,s=0,o=0),a=f*o-h*s,l=h*i-c*o,u=c*s-f*i,d=Math.hypot(a,l,u),d?(d=1/d,a*=d,l*=d,u*=d):(a=0,l=0,u=0),t[0]=i,t[1]=a,t[2]=c,t[3]=0,t[4]=s,t[5]=l,t[6]=f,t[7]=0,t[8]=o,t[9]=u,t[10]=h,t[11]=0,t[12]=-(i*p+s*E+o*b),t[13]=-(a*p+l*E+u*b),t[14]=-(c*p+f*E+h*b),t[15]=1,t)}function qC(){var t=new xi(4);return xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function QC(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function lo(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){var t=qC();return function(e,n,r,i,s,o){var a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var vf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(vf||(vf={}));const JC=45*Math.PI/180,e2=1,Xu=.1,Yu=500,t2=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Ft extends zC{static get IDENTITY(){return r2()}static get ZERO(){return n2()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return vf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,u,c,f,h,d,p,E,b){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=u,this[9]=c,this[10]=f,this[11]=h,this[12]=d,this[13]=p,this[14]=E,this[15]=b,this.check()}setRowMajor(e,n,r,i,s,o,a,l,u,c,f,h,d,p,E,b){return this[0]=e,this[1]=s,this[2]=u,this[3]=d,this[4]=n,this[5]=o,this[6]=c,this[7]=p,this[8]=r,this[9]=a,this[10]=f,this[11]=E,this[12]=i,this[13]=l,this[14]=h,this[15]=b,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(t2)}fromObject(e){return this.check()}fromQuaternion(e){return WC(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Xu,far:a=Yu}=e;return a===1/0?i2(this,n,r,i,s,o):HC(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return KC(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Xu,far:a=Yu}=e;return ZC(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=JC,aspect:r=e2,focalDistance:i=1,near:s=Xu,far:o=Yu}=e;Jp(n);const a=n/2,l=i*Math.tan(a),u=l*r;return this.ortho({left:-u,right:u,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Jp(n),YC(this,n,r,i,s),this.check()}determinant(){return VC(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return UC(this,this),this.check()}invert(){return yf(this,this),this.check()}multiplyLeft(e){return pr(this,e,this),this.check()}multiplyRight(e){return pr(this,this,e),this.check()}rotateX(e){return F_(this,this,e),this.check()}rotateY(e){return GC(this,this,e),this.check()}rotateZ(e){return D_(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return jC(this,this,e,n),this.check()}scale(e){return Zh(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return cl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=lo(n||[-0,-0,-0,-0],e,this),Gu(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=O_(n||[-0,-0],e,this);break;case 3:i=N_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gu(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=R_(n||[-0,-0],e,this);break;case 3:r=k_(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Gu(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Jo,ea;function n2(){return Jo||(Jo=new Ft([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Jo)),Jo}function r2(){return ea||(ea=new Ft,Object.freeze(ea)),ea}function Jp(t){if(t>Math.PI*2)throw Error("expected radians")}function i2(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),u=(i+r)/(i-r),c=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=u,t[10]=c,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}const em=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))

struct AmbientLight {
 vec3 color;
};

struct PointLight {
 vec3 color;
 vec3 position;
 vec3 attenuation;
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;

uniform bool lighting_uEnabled;

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

#endif
`,s2={lightSources:{}};function $u(){let{color:t=[0,0,0],intensity:e=1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return t.map(n=>n*e/255)}function o2(t){let{ambientLight:e,pointLights:n=[],directionalLights:r=[]}=t;const i={};return e?i["lighting_uAmbientLight.color"]=$u(e):i["lighting_uAmbientLight.color"]=[0,0,0],n.forEach((s,o)=>{i["lighting_uPointLight[".concat(o,"].color")]=$u(s),i["lighting_uPointLight[".concat(o,"].position")]=s.position,i["lighting_uPointLight[".concat(o,"].attenuation")]=s.attenuation||[1,0,0]}),i.lighting_uPointLightCount=n.length,r.forEach((s,o)=>{i["lighting_uDirectionalLight[".concat(o,"].color")]=$u(s),i["lighting_uDirectionalLight[".concat(o,"].direction")]=s.direction}),i.lighting_uDirectionalLightCount=r.length,i}function z_(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:s2;if("lightSources"in t){const{ambientLight:e,pointLights:n,directionalLights:r}=t.lightSources||{};return e||n&&n.length>0||r&&r.length>0?Object.assign({},o2({ambientLight:e,pointLights:n,directionalLights:r}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const e={pointLights:[],directionalLights:[]};for(const n of t.lights||[])switch(n.type){case"ambient":e.ambientLight=n;break;case"directional":e.directionalLights.push(n);break;case"point":e.pointLights.push(n);break}return z_({lightSources:e})}return{}}const a2={name:"lights",vs:em,fs:em,getUniforms:z_,defines:{MAX_LIGHTS:3}},l2=new Uint8Array([0,255,255,255]),u2={pickingSelectedColor:null,pickingHighlightColor:l2,pickingActive:!1,pickingAttribute:!1};function c2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:u2;const e={};if(t.pickingSelectedColor!==void 0)if(!t.pickingSelectedColor)e.picking_uSelectedColorValid=0;else{const n=t.pickingSelectedColor.slice(0,3);e.picking_uSelectedColorValid=1,e.picking_uSelectedColor=n}if(t.pickingHighlightColor){const n=Array.from(t.pickingHighlightColor,r=>r/255);Number.isFinite(n[3])||(n[3]=1),e.picking_uHighlightColor=n}return t.pickingActive!==void 0&&(e.picking_uActive=!!t.pickingActive,e.picking_uAttribute=!!t.pickingAttribute),e}const f2=`uniform bool picking_uActive;
uniform bool picking_uAttribute;
uniform vec3 picking_uSelectedColor;
uniform bool picking_uSelectedColorValid;

out vec4 picking_vRGBcolor_Avalid;

const float COLOR_SCALE = 1. / 255.;

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.001;
}

bool isVertexPicked(vec3 vertexColor) {
  return
    picking_uSelectedColorValid &&
    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));
}

void picking_setPickingColor(vec3 pickingColor) {
  if (picking_uActive) {
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!picking_uAttribute) {
      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;
    }
  } else {
    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.r = value;
  }
}
void picking_setPickingAttribute(vec2 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}
void picking_setPickingAttribute(vec3 value) {
  if (picking_uAttribute) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,h2=`uniform bool picking_uActive;
uniform vec3 picking_uSelectedColor;
uniform vec4 picking_uHighlightColor;

in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
  if (picking_uActive) {
    return color;
  }
  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    float highLightAlpha = picking_uHighlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}
vec4 picking_filterPickingColor(vec4 color) {
  if (picking_uActive) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}
vec4 picking_filterColor(vec4 color) {
  vec4 highightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highightColor);
}

`,d2={name:"picking",vs:f2,fs:h2,getUniforms:c2},g2=`
uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
    vec3 halfway_direction = normalize(light_direction + view_direction);
    float lambertian = dot(light_direction, normal_worldspace);
    float specular = 0.0;
    if (lambertian > 0.0) {
      float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
      specular = pow(specular_angle, lighting_uShininess);
    }
    lambertian = max(lambertian, 0.0);
    return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);
    lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}

vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = vec3(0, 0, 0);
  vec3 surfaceColor = vec3(0, 0, 0);

  if (lighting_uEnabled) {
    vec3 view_direction = normalize(cameraPosition - position_worldspace);

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uPointLightCount) {
        break;
      }
      PointLight pointLight = lighting_uPointLight[i];
      vec3 light_position_worldspace = pointLight.position;
      vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
      lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
    }

    for (int i = 0; i < MAX_LIGHTS; i++) {
      if (i >= lighting_uDirectionalLightCount) {
        break;
      }
      DirectionalLight directionalLight = lighting_uDirectionalLight[i];
      lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
    }
  }
  return lightColor;
}
`,p2={};function m2(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function y2(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:p2;if(!("material"in t))return{};const{material:e}=t;return e?m2(e):{lighting_uEnabled:!1}}const v2={name:"gouraud-lighting",dependencies:[a2],vs:g2,defines:{LIGHTING_VERTEX:1},getUniforms:y2},_2=`attribute float transform_elementID;
vec2 transform_getPixelSizeHalf(vec2 size) {
  return vec2(1.) / (2. * size);
}

vec2 transform_getPixelIndices(vec2 texSize, vec2 pixelSizeHalf) {
  float yIndex = floor((transform_elementID / texSize[0]) + pixelSizeHalf[1]);
  float xIndex = transform_elementID - (yIndex * texSize[0]);
  return vec2(xIndex, yIndex);
}
vec2 transform_getTexCoord(vec2 size) {
  vec2 pixelSizeHalf = transform_getPixelSizeHalf(size);
  vec2 indices = transform_getPixelIndices(size, pixelSizeHalf);
  vec2 coord = indices / size + pixelSizeHalf;
  return coord;
}
vec2 transform_getPos(vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec2 pos = (texCoord * (2.0, 2.0)) - (1., 1.);
  return pos;
}
vec4 transform_getInput(sampler2D texSampler, vec2 size) {
  vec2 texCoord = transform_getTexCoord(size);
  vec4 textureColor = texture2D(texSampler, texCoord);
  return textureColor;
}
`,E2={name:"transform",vs:_2,fs:null};class uo{static getDefaultProgramManager(e){return e.luma=e.luma||{},e.luma.defaultProgramManager=e.luma.defaultProgramManager||new uo(e),e.luma.defaultProgramManager}constructor(e){this.gl=e,this._programCache={},this._getUniforms={},this._registeredModules={},this._hookFunctions=[],this._defaultModules=[],this._hashes={},this._hashCounter=0,this.stateHash=0,this._useCounts={}}addDefaultModule(e){this._defaultModules.find(n=>n.name===e.name)||this._defaultModules.push(e),this.stateHash++}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n),this.stateHash++}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e),this.stateHash++}get(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{vs:n="",fs:r="",defines:i={},inject:s={},varyings:o=[],bufferMode:a=35981,transpileToGLSL100:l=!1}=e,u=this._getModuleList(e.modules),c=this._getHash(n),f=this._getHash(r),h=u.map(_=>this._getHash(_.name)).sort(),d=o.map(_=>this._getHash(_)),p=Object.keys(i).sort(),E=Object.keys(s).sort(),b=[],y=[];for(const _ of p)b.push(this._getHash(_)),b.push(this._getHash(i[_]));for(const _ of E)y.push(this._getHash(_)),y.push(this._getHash(s[_]));const m="".concat(c,"/").concat(f,"D").concat(b.join("/"),"M").concat(h.join("/"),"I").concat(y.join("/"),"V").concat(d.join("/"),"H").concat(this.stateHash,"B").concat(a).concat(l?"T":"");if(!this._programCache[m]){const _=eC(this.gl,{vs:n,fs:r,modules:u,inject:s,defines:i,hookFunctions:this._hookFunctions,transpileToGLSL100:l});this._programCache[m]=new __(this.gl,{hash:m,vs:_.vs,fs:_.fs,varyings:o,bufferMode:a}),this._getUniforms[m]=_.getUniforms||(T=>{}),this._useCounts[m]=0}return this._useCounts[m]++,this._programCache[m]}getUniforms(e){return this._getUniforms[e.hash]||null}release(e){const n=e.hash;this._useCounts[n]--,this._useCounts[n]===0&&(this._programCache[n].delete(),delete this._programCache[n],delete this._getUniforms[n],delete this._useCounts[n])}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}_getModuleList(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,n}}const w2={POSITION:"positions",NORMAL:"normals",COLOR_0:"colors",TEXCOORD_0:"texCoords",TEXCOORD_1:"texCoords1",TEXCOORD_2:"texCoords2"};function T2(t,e,n){const r={};let i=e.indices;for(const s in e.attributes){const o=e.attributes[s],a=b2(s);if(s==="indices")i=o;else if(o.constant)r[a]=o.value;else{const l=o.value,u={...o};delete u.value,r[a]=[new J(t,l),u],x2(s,u)}}if(i){const s=i.value||i;N(s instanceof Uint16Array||s instanceof Uint32Array,'attribute array for "indices" must be of integer type');const o={size:1,isIndexed:i.isIndexed===void 0?!0:i.isIndexed};r.indices=[new J(t,{data:s,target:34963}),o]}return r}function b2(t,e){const{attributeMap:n=w2}={};return n&&n[t]||t}function x2(t,e){let n;switch(t){case"texCoords":case"texCoord1":case"texCoord2":case"texCoord3":n="uvs";break;case"vertices":case"positions":case"normals":case"pickingColors":n="vectors";break}switch(n){case"vectors":e.size=e.size||3;break;case"uvs":e.size=e.size||2;break}N(Number.isFinite(e.size),"attribute ".concat(t," needs size"))}const Ur=2,S2=1e4,P2="Model needs drawMode and vertexCount",tm=()=>{},A2={};class Sr{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{id:r=Zn("model")}=n;N(Fl(e)),this.id=r,this.gl=e,this.id=n.id||Zn("Model"),this.lastLogTime=0,this.animated=!1,this.initialize(n)}initialize(e){this.props={},this.programManager=e.programManager||uo.getDefaultProgramManager(this.gl),this._programManagerState=-1,this._managedProgram=!1;const{program:n=null,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:u,transpileToGLSL100:c}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:u,transpileToGLSL100:c},this.program=null,this.vertexArray=null,this._programDirty=!0,this.userData={},this.needsRedraw=!0,this._attributes={},this.attributes={},this.uniforms={},this.pickable=!0,this._checkProgram(),this.setUniforms(Object.assign({},this.getModuleUniforms(e.moduleSettings))),this.drawMode=e.drawMode!==void 0?e.drawMode:4,this.vertexCount=e.vertexCount||0,this.geometryBuffers={},this.isInstanced=e.isInstanced||e.instanced||e.instanceCount>0,this._setModelProps(e),this.geometry={},N(this.drawMode!==void 0&&Number.isFinite(this.vertexCount),P2)}setProps(e){this._setModelProps(e)}delete(){for(const e in this._attributes)this._attributes[e]!==this.attributes[e]&&this._attributes[e].delete();this._managedProgram&&(this.programManager.release(this.program),this._managedProgram=!1),this.vertexArray.delete(),this._deleteGeometryBuffers()}getDrawMode(){return this.drawMode}getVertexCount(){return this.vertexCount}getInstanceCount(){return this.instanceCount}getAttributes(){return this.attributes}getProgram(){return this.program}setProgram(e){const{program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:u,transpileToGLSL100:c}=e;this.programProps={program:n,vs:r,fs:i,modules:s,defines:o,inject:a,varyings:l,bufferMode:u,transpileToGLSL100:c},this._programDirty=!0}getUniforms(){return this.uniforms}setDrawMode(e){return this.drawMode=e,this}setVertexCount(e){return N(Number.isFinite(e)),this.vertexCount=e,this}setInstanceCount(e){return N(Number.isFinite(e)),this.instanceCount=e,this}setGeometry(e){return this.drawMode=e.drawMode,this.vertexCount=e.getVertexCount(),this._deleteGeometryBuffers(),this.geometryBuffers=T2(this.gl,e),this.vertexArray.setAttributes(this.geometryBuffers),this}setAttributes(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ti(e))return this;const n={};for(const r in e){const i=e[r];n[r]=i.getValue?i.getValue():i}return this.vertexArray.setAttributes(n),this}setUniforms(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.assign(this.uniforms,e),this}getModuleUniforms(e){this._checkProgram();const n=this.programManager.getUniforms(this.program);return n?n(e):{}}updateModuleSettings(e){const n=this.getModuleUniforms(e||{});return this.setUniforms(n)}clear(e){return Wh(this.program.gl,e),this}draw(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._checkProgram();const{moduleSettings:n=null,framebuffer:r,uniforms:i={},attributes:s={},transformFeedback:o=this.transformFeedback,parameters:a={},vertexArray:l=this.vertexArray}=e;this.setAttributes(s),this.updateModuleSettings(n),this.setUniforms(i);let u;U.priority>=Ur&&(u=this._logDrawCallStart(Ur));const c=this.vertexArray.getDrawParams(),{isIndexed:f=c.isIndexed,indexType:h=c.indexType,indexOffset:d=c.indexOffset,vertexArrayInstanced:p=c.isInstanced}=this.props;p&&!this.isInstanced&&U.warn("Found instanced attributes on non-instanced model",this.id)();const{isInstanced:E,instanceCount:b}=this,{onBeforeRender:y=tm,onAfterRender:m=tm}=this.props;y(),this.program.setUniforms(this.uniforms);const _=this.program.draw(Object.assign(A2,e,{logPriority:u,uniforms:null,framebuffer:r,parameters:a,drawMode:this.getDrawMode(),vertexCount:this.getVertexCount(),vertexArray:l,transformFeedback:o,isIndexed:f,indexType:h,isInstanced:E,instanceCount:b,offset:f?d:0}));return m(),U.priority>=Ur&&this._logDrawCallEnd(u,l,r),_}transform(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{discard:n=!0,feedbackBuffers:r,unbindModels:i=[]}=e;let{parameters:s}=e;r&&this._setFeedbackBuffers(r),n&&(s=Object.assign({},s,{35977:n})),i.forEach(o=>o.vertexArray.unbindBuffers());try{this.draw(Object.assign({},e,{parameters:s}))}finally{i.forEach(o=>o.vertexArray.bindBuffers())}return this}render(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return U.warn("Model.render() is deprecated. Use Model.setUniforms() and Model.draw()")(),this.setUniforms(e).draw()}_setModelProps(e){Object.assign(this.props,e),"uniforms"in e&&this.setUniforms(e.uniforms),"pickable"in e&&(this.pickable=e.pickable),"instanceCount"in e&&(this.instanceCount=e.instanceCount),"geometry"in e&&this.setGeometry(e.geometry),"attributes"in e&&this.setAttributes(e.attributes),"_feedbackBuffers"in e&&this._setFeedbackBuffers(e._feedbackBuffers)}_checkProgram(){if(!(this._programDirty||this.programManager.stateHash!==this._programManagerState))return;let{program:n}=this.programProps;if(n)this._managedProgram=!1;else{const{vs:r,fs:i,modules:s,inject:o,defines:a,varyings:l,bufferMode:u,transpileToGLSL100:c}=this.programProps;n=this.programManager.get({vs:r,fs:i,modules:s,inject:o,defines:a,varyings:l,bufferMode:u,transpileToGLSL100:c}),this.program&&this._managedProgram&&this.programManager.release(this.program),this._programManagerState=this.programManager.stateHash,this._managedProgram=!0}N(n instanceof __,"Model needs a program"),this._programDirty=!1,n!==this.program&&(this.program=n,this.vertexArray?this.vertexArray.setProps({program:this.program,attributes:this.vertexArray.attributes}):this.vertexArray=new pL(this.gl,{program:this.program}),this.setUniforms(Object.assign({},this.getModuleUniforms())))}_deleteGeometryBuffers(){for(const e in this.geometryBuffers){const n=this.geometryBuffers[e][0]||this.geometryBuffers[e];n instanceof J&&n.delete()}}_setAnimationProps(e){this.animated&&N(e,"Model.draw(): animated uniforms but no animationProps")}_setFeedbackBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Ti(e))return this;const{gl:n}=this.program;return this.transformFeedback=this.transformFeedback||new E_(n,{program:this.program}),this.transformFeedback.setBuffers(e),this}_logDrawCallStart(e){const n=e>3?0:S2;if(!(Date.now()-this.lastLogTime<n))return this.lastLogTime=Date.now(),U.group(Ur,">>> DRAWING MODEL ".concat(this.id),{collapsed:U.level<=2})(),e}_logDrawCallEnd(e,n,r,i){if(e===void 0)return;const s=vL({vertexArray:n,header:"".concat(this.id," attributes"),attributes:this._attributes}),{table:o,unusedTable:a,unusedCount:l}=Up({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r)}),{table:u,count:c}=Up({header:"".concat(this.id," uniforms"),program:this.program,uniforms:Object.assign({},this.program.uniforms,r),undefinedOnly:!0});c>0&&U.log("MISSING UNIFORMS",Object.keys(u))(),l>0&&U.log("UNUSED UNIFORMS",Object.keys(a))();const f=EL(this.vertexArray.configuration);U.table(e,s)(),U.table(e,o)(),U.table(e+1,f)(),i&&i.log({logLevel:Ur,message:"Rendered to ".concat(i.id)}),U.groupEnd(Ur)()}}class L2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.currentIndex=0,this.feedbackMap={},this.varyings=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}setupResources(e){for(const n of this.bindings)this._setupTransformFeedback(n,e)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyings:n}=this;return n.length>0&&(e=Object.assign({},e,{varyings:n})),e}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this.bindings[this.currentIndex],{sourceBuffers:r,transformFeedback:i}=n;return{attributes:Object.assign({},r,e.attributes),transformFeedback:i}}swap(){return this.feedbackMap?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e)}getBuffer(e){const{feedbackBuffers:n}=this.bindings[this.currentIndex],r=e?n[e]:null;return r?r instanceof J?r:r.buffer:null}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{varyingName:n}=e,r=this.getBuffer(n);return r?r.getData():null}delete(){for(const e in this.resources)this.resources[e].delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupBuffers(e),this.varyings=e.varyings||Object.keys(this.bindings[this.currentIndex].feedbackBuffers),this.varyings.length>0&&N($(this.gl))}_getFeedbackBuffers(e){const{sourceBuffers:n={}}=e,r={};if(this.bindings[this.currentIndex]&&Object.assign(r,this.bindings[this.currentIndex].feedbackBuffers),this.feedbackMap)for(const i in this.feedbackMap){const s=this.feedbackMap[i];i in n&&(r[s]=i)}Object.assign(r,e.feedbackBuffers);for(const i in r){const s=r[i];if(typeof s=="string"){const o=n[s],{byteLength:a,usage:l,accessor:u}=o;r[i]=this._createNewBuffer(i,{byteLength:a,usage:l,accessor:u})}}return r}_setupBuffers(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n=null}=e;Object.assign(this.feedbackMap,e.feedbackMap);const r=this._getFeedbackBuffers(e);this._updateBindings({sourceBuffers:n,feedbackBuffers:r})}_setupTransformFeedback(e,n){let{model:r}=n;const{program:i}=r;e.transformFeedback=new E_(this.gl,{program:i,buffers:e.feedbackBuffers})}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this.feedbackMap){const{sourceBuffers:n,feedbackBuffers:r}=this._swapBuffers(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceBuffers:n,feedbackBuffers:r})}}_updateBinding(e,n){return e?(Object.assign(e.sourceBuffers,n.sourceBuffers),Object.assign(e.feedbackBuffers,n.feedbackBuffers),e.transformFeedback&&e.transformFeedback.setBuffers(e.feedbackBuffers),e):{sourceBuffers:Object.assign({},n.sourceBuffers),feedbackBuffers:Object.assign({},n.feedbackBuffers)}}_swapBuffers(e){if(!this.feedbackMap)return null;const n=Object.assign({},e.sourceBuffers),r=Object.assign({},e.feedbackBuffers);for(const i in this.feedbackMap){const s=this.feedbackMap[i];n[i]=e.feedbackBuffers[s],r[s]=e.sourceBuffers[i],N(r[s]instanceof J)}return{sourceBuffers:n,feedbackBuffers:r}}_createNewBuffer(e,n){const r=new J(this.gl,n);return this.resources[e]&&this.resources[e].delete(),this.resources[e]=r,r}_getNextIndex(){return(this.currentIndex+1)%2}}const C2="transform_uSampler_",fl="transform_uSize_",nm="transform_position";function I2(t){let{vs:e,sourceTextureMap:n,targetTextureVarying:r,targetTexture:i}=t,o=Object.keys(n).length,a=null;const l={};let u=e,c={};if(o>0||r){const f=u.split(`
`),h=f.slice();if(f.forEach((d,p,E)=>{if(o>0){const b=N2(d,n);if(b){const{updatedLine:y,inject:m}=b;h[p]=y,c=gf([c,m]),Object.assign(l,b.samplerTextureMap),o--}}r&&!a&&(a=k2(d,r))}),r){N(i);const d="".concat(fl).concat(r),p="uniform vec2 ".concat(d,`;
`),E="     vec2 ".concat(nm," = transform_getPos(").concat(d,`);
     gl_Position = vec4(`).concat(nm,`, 0, 1.);
`);c=gf([c,{"vs:#decl":p,"vs:#main-start":E}])}u=h.join(`
`)}return{vs:u,targetTextureType:a,inject:c,samplerTextureMap:l}}function M2(t){let{sourceTextureMap:e,targetTextureVarying:n,targetTexture:r}=t;const i={};let s,o;n&&({width:s,height:o}=r,i["".concat(fl).concat(n)]=[s,o]);for(const a in e)({width:s,height:o}=e[a]),i["".concat(fl).concat(a)]=[s,o];return i}function O2(t){return A_(t,["attribute","in"])}function R2(t){const e="".concat(C2).concat(t),n="".concat(fl).concat(t),r="  uniform sampler2D ".concat(e,`;
  uniform vec2 `).concat(n,";");return{samplerName:e,sizeName:n,uniformDeclerations:r}}function k2(t,e){const n=A_(t,["varying","out"]);return n&&n.name===e?n.type:null}function N2(t,e){const n={},r=O2(t);if(!r)return null;const{type:i,name:s}=r;if(s&&e[s]){const o="// ".concat(t," => Replaced by Transform with a sampler"),{samplerName:a,sizeName:l,uniformDeclerations:u}=R2(s),c=uC(i),f="  ".concat(i," ").concat(s," = transform_getInput(").concat(a,", ").concat(l,").").concat(c,`;
`);return n[a]=s,{updatedLine:o,inject:{"vs:#decl":u,"vs:#main-start":f},samplerTextureMap:n}}return null}const F2={10241:9728,10240:9728,10242:33071,10243:33071},D2="transform_output";class z2{constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.id=this.currentIndex=0,this._swapTexture=null,this.targetTextureVarying=null,this.targetTextureType=null,this.samplerTextureMap=null,this.bindings=[],this.resources={},this._initialize(n),Object.seal(this)}updateModelProps(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=this._processVertexShader(e);return Object.assign({},e,n)}getDrawOptions(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,sourceTextures:r,framebuffer:i,targetTexture:s}=this.bindings[this.currentIndex],o=Object.assign({},n,e.attributes),a=Object.assign({},e.uniforms),l=Object.assign({},e.parameters);let u=e.discard;if(this.hasSourceTextures||this.hasTargetTexture){o.transform_elementID=this.elementIDBuffer;for(const f in this.samplerTextureMap){const h=this.samplerTextureMap[f];a[f]=r[h]}this._setSourceTextureParameters();const c=M2({sourceTextureMap:r,targetTextureVarying:this.targetTextureVarying,targetTexture:s});Object.assign(a,c)}return this.hasTargetTexture&&(u=!1,l.viewport=[0,0,i.width,i.height]),{attributes:o,framebuffer:i,uniforms:a,discard:u,parameters:l}}swap(){return this._swapTexture?(this.currentIndex=this._getNextIndex(),!0):!1}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._setupTextures(e)}getTargetTexture(){const{targetTexture:e}=this.bindings[this.currentIndex];return e}getData(){let{packed:e=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{framebuffer:n}=this.bindings[this.currentIndex],r=zl(n);if(!e)return r;const i=r.constructor,s=cC(this.targetTextureType),o=new i(r.length*s/4);let a=0;for(let l=0;l<r.length;l+=4)for(let u=0;u<s;u++)o[a++]=r[l+u];return o}getFramebuffer(){return this.bindings[this.currentIndex].framebuffer}delete(){this.ownTexture&&this.ownTexture.delete(),this.elementIDBuffer&&this.elementIDBuffer.delete()}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{_targetTextureVarying:n,_swapTexture:r}=e;this._swapTexture=r,this.targetTextureVarying=n,this.hasTargetTexture=n,this._setupTextures(e)}_createTargetTexture(e){const{sourceTextures:n,textureOrReference:r}=e;if(r instanceof ct)return r;const i=n[r];return i?(this._targetRefTexName=r,this._createNewTexture(i)):null}_setupTextures(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceBuffers:n,_sourceTextures:r={},_targetTexture:i}=e,s=this._createTargetTexture({sourceTextures:r,textureOrReference:i});this.hasSourceTextures=this.hasSourceTextures||r&&Object.keys(r).length>0,this._updateBindings({sourceBuffers:n,sourceTextures:r,targetTexture:s}),"elementCount"in e&&this._updateElementIDBuffer(e.elementCount)}_updateElementIDBuffer(e){if(typeof e!="number"||this.elementCount>=e)return;const n=new Float32Array(e);n.forEach((r,i,s)=>{s[i]=i}),this.elementIDBuffer?this.elementIDBuffer.setData({data:n}):this.elementIDBuffer=new J(this.gl,{data:n,accessor:{size:1}}),this.elementCount=e}_updateBindings(e){if(this.bindings[this.currentIndex]=this._updateBinding(this.bindings[this.currentIndex],e),this._swapTexture){const{sourceTextures:n,targetTexture:r}=this._swapTextures(this.bindings[this.currentIndex]),i=this._getNextIndex();this.bindings[i]=this._updateBinding(this.bindings[i],{sourceTextures:n,targetTexture:r})}}_updateBinding(e,n){const{sourceBuffers:r,sourceTextures:i,targetTexture:s}=n;if(e||(e={sourceBuffers:{},sourceTextures:{},targetTexture:null}),Object.assign(e.sourceTextures,i),Object.assign(e.sourceBuffers,r),s){e.targetTexture=s;const{width:o,height:a}=s,{framebuffer:l}=e;l?(l.update({attachments:{36064:s},resizeAttachments:!1}),l.resize({width:o,height:a})):e.framebuffer=new be(this.gl,{id:"transform-framebuffer",width:o,height:a,attachments:{36064:s}})}return e}_setSourceTextureParameters(){const e=this.currentIndex,{sourceTextures:n}=this.bindings[e];for(const r in n)n[r].setParameters(F2)}_swapTextures(e){if(!this._swapTexture)return null;const n=Object.assign({},e.sourceTextures);n[this._swapTexture]=e.targetTexture;const r=e.sourceTextures[this._swapTexture];return{sourceTextures:n,targetTexture:r}}_createNewTexture(e){const n=iA(e,{parameters:{10241:9728,10240:9728,10242:33071,10243:33071},pixelStore:{37440:!1}});return this.ownTexture&&this.ownTexture.delete(),this.ownTexture=n,n}_getNextIndex(){return(this.currentIndex+1)%2}_processVertexShader(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{sourceTextures:n,targetTexture:r}=this.bindings[this.currentIndex],{vs:i,uniforms:s,targetTextureType:o,inject:a,samplerTextureMap:l}=I2({vs:e.vs,sourceTextureMap:n,targetTextureVarying:this.targetTextureVarying,targetTexture:r}),u=gf([e.inject||{},a]);this.targetTextureType=o,this.samplerTextureMap=l;const c=e._fs||L_({version:y_(i),input:this.targetTextureVarying,inputType:o,output:D2}),f=this.hasSourceTextures||this.targetTextureVarying?[E2].concat(e.modules||[]):e.modules;return{vs:i,fs:c,modules:f,uniforms:s,inject:u}}}class Kh{static isSupported(e){return $(e)}constructor(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};this.gl=e,this.model=null,this.elementCount=0,this.bufferTransform=null,this.textureTransform=null,this.elementIDBuffer=null,this._initialize(n),Object.seal(this)}delete(){const{model:e,bufferTransform:n,textureTransform:r}=this;e&&e.delete(),n&&n.delete(),r&&r.delete()}run(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{clearRenderTarget:n=!0}=e,r=this._updateDrawOptions(e);n&&r.framebuffer&&r.framebuffer.clear({color:!0}),this.model.transform(r)}swap(){let e=!1;const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)e=e||r.swap();N(e,"Nothing to swap")}getBuffer(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return this.bufferTransform&&this.bufferTransform.getBuffer(e)}getData(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n){const i=r.getData(e);if(i)return i}return null}getFramebuffer(){return this.textureTransform&&this.textureTransform.getFramebuffer()}update(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};"elementCount"in e&&this.model.setVertexCount(e.elementCount);const n=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const r of n)r.update(e)}_initialize(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{gl:n}=this;this._buildResourceTransforms(n,e),e=this._updateModelProps(e),this.model=new Sr(n,Object.assign({},e,{fs:e.fs||L_({version:y_(e.vs)}),id:e.id||"transform-model",drawMode:e.drawMode||0,vertexCount:e.elementCount})),this.bufferTransform&&this.bufferTransform.setupResources({model:this.model})}_updateModelProps(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=i.updateModelProps(n);return n}_buildResourceTransforms(e,n){B2(n)&&(this.bufferTransform=new L2(e,n)),U2(n)&&(this.textureTransform=new z2(e,n)),N(this.bufferTransform||this.textureTransform,"must provide source/feedback buffers or source/target textures")}_updateDrawOptions(e){let n=Object.assign({},e);const r=[this.bufferTransform,this.textureTransform].filter(Boolean);for(const i of r)n=Object.assign(n,i.getDrawOptions(n));return n}}function B2(t){return!!(!Ti(t.feedbackBuffers)||!Ti(t.feedbackMap)||t.varyings&&t.varyings.length>0)}function U2(t){return!!(!Ti(t._sourceTextures)||t._targetTexture||t._targetTextureVarying)}const rm={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class co{static get DRAW_MODE(){return rm}constructor(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{id:n=Zn("geometry"),drawMode:r=rm.TRIANGLES,attributes:i={},indices:s=null,vertexCount:o=null}=e;this.id=n,this.drawMode=r|0,this.attributes={},this.userData={},this._setAttributes(i,s),this.vertexCount=o||this._calculateVertexCount(this.attributes,this.indices)}get mode(){return this.drawMode}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry ".concat(this.id," attribute ").concat(e)}_setAttributes(e,n){n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n);for(const r in e){let i=e[r];i=ArrayBuffer.isView(i)?{value:i}:i,N(ArrayBuffer.isView(i.value),"".concat(this._print(r),": must be typed array or object with value as typed array")),(r==="POSITION"||r==="positions")&&!i.size&&(i.size=3),r==="indices"?(N(!this.indices),this.indices=i):this.attributes[r]=i}return this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i in e){const s=e[i],{value:o,size:a,constant:l}=s;!l&&o&&a>=1&&(r=Math.min(r,o.length/a))}return N(Number.isFinite(r)),r}}let V2=1,j2=1;class B_{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=V2++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=j2++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}const G2=[255,255,255],W2=1;let H2=0;class X2{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","ambient");const{color:n=G2}=e,{intensity:r=W2}=e;this.id=e.id||"ambient-".concat(H2++),this.color=n,this.intensity=r}}const Y2=[255,255,255],$2=1,Z2=[0,0,-1];let K2=0;class im{constructor(e={}){g(this,"id",void 0),g(this,"color",void 0),g(this,"intensity",void 0),g(this,"type","directional"),g(this,"direction",void 0),g(this,"shadow",void 0);const{color:n=Y2}=e,{intensity:r=$2}=e,{direction:i=Z2}=e,{_shadow:s=!1}=e;this.id=e.id||"directional-".concat(K2++),this.color=n,this.intensity=r,this.type="directional",this.direction=new Qt(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class q2{constructor(e,n={id:"pass"}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"props",void 0);const{id:r}=n;this.id=r,this.gl=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class qh extends q2{constructor(...e){super(...e),g(this,"_lastRenderIndex",-1)}render(e){const n=this.gl;return qt(n,{framebuffer:e.target}),this._drawLayers(e)}_drawLayers(e){const{target:n,moduleParameters:r,viewports:i,views:s,onViewportActive:o,clearStack:a=!0,clearCanvas:l=!0}=e;e.pass=e.pass||"unknown";const u=this.gl;l&&J2(u,n),a&&(this._lastRenderIndex=-1);const c=[];for(const f of i){const h=s&&s[f.id];o==null||o(f);const d=this._getDrawLayerParams(f,e),p=f.subViewports||[f];for(const E of p){const b=this._drawLayersInViewport(u,{target:n,moduleParameters:r,viewport:E,view:h,pass:e.pass,layers:e.layers},d);c.push(b)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},u=!1){const c=[],f=U_(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},d={};for(let p=0;p<n.length;p++){const E=n[p],b=this._shouldDrawLayer(E,h,s,d),y={shouldDrawLayer:b};b&&!u&&(y.layerRenderIndex=f(E,b),y.moduleParameters=this._getModuleParameters(E,a,r,l),y.layerParameters=this.getLayerParameters(E,p,e)),c[p]=y}return c}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const u=Q2(e,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;at(e,{scissorTest:!0,scissor:u},()=>Wh(e,f))}const c={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};qt(e,{viewport:u});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:d,layerRenderIndex:p,moduleParameters:E,layerParameters:b}=l[f];if(d&&h.props.pickable&&c.pickableCount++,h.isComposite)c.compositeCount++;else if(d){c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,p),E.viewport=o;try{h._drawLayer({moduleParameters:E,uniforms:{layerIndex:p},parameters:b})}catch(y){h.raiseError(y,"drawing ".concat(h," to ").concat(i))}}}return c}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var s;const o=Object.assign(Object.create(((s=e.internalState)===null||s===void 0?void 0:s.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,pickingActive:0,devicePixelRatio:wi(this.gl)});if(n)for(const l of n){var a;Object.assign(o,(a=l.getModuleParameters)===null||a===void 0?void 0:a.call(l,e))}return Object.assign(o,this.getModuleParameters(e,n),i)}}function U_(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let u;if(l&&!(l in e)&&r(i.parent,!1),l in n){const c=n[l]=n[l]||U_(e[l],e);u=c(i,s),n[a]=c}else Number.isFinite(o)?(u=o+(e[l]||0),n[a]=null):u=t;return s&&u>=t&&(t=u+1),e[a]=u,u};return r}function Q2(t,{moduleParameters:e,target:n,viewport:r}){const i=n&&n.id!=="default-framebuffer",s=e&&e.devicePixelRatio||wi(t),o=i?n.height:t.drawingBufferHeight,a=r;return[a.x*s,o-(a.y+a.height)*s,a.width*s,a.height*s]}function J2(t,e){const n=e?e.width:t.drawingBufferWidth,r=e?e.height:t.drawingBufferHeight;qt(t,{viewport:[0,0,n,r]}),t.clear(16640)}class e3 extends qh{constructor(e,n){super(e,n),g(this,"shadowMap",void 0),g(this,"depthBuffer",void 0),g(this,"fbo",void 0),this.shadowMap=new ct(e,{width:1,height:1,parameters:{10241:9729,10240:9729,10242:33071,10243:33071}}),this.depthBuffer=new ni(e,{format:33189,width:1,height:1}),this.fbo=new be(e,{id:"shadowmap",width:1,height:1,attachments:{36064:this.shadowMap,36096:this.depthBuffer}})}render(e){const n=this.fbo;at(this.gl,{depthRange:[0,1],depthTest:!0,blend:!1,clearColor:[1,1,1,1]},()=>{const r=e.viewports[0],i=wi(this.gl),s=r.width*i,o=r.height*i;(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,target:n,pass:"shadow"})})}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.delete(),this.fbo=null),this.shadowMap&&(this.shadowMap.delete(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.delete(),this.depthBuffer=null)}}const V_="#define SMOOTH_EDGE_RADIUS 0.5",t3=`
`.concat(V_,`

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`),n3=`
`.concat(V_,`

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`),r3={name:"geometry",vs:t3,fs:n3},i3=Object.keys(q).map(t=>"const int COORDINATE_SYSTEM_".concat(t," = ").concat(q[t],";")).join(""),s3=Object.keys(Yt).map(t=>"const int PROJECTION_MODE_".concat(t," = ").concat(Yt[t],";")).join(""),o3=Object.keys(Tr).map(t=>"const int UNIT_".concat(t.toUpperCase()," = ").concat(Tr[t],";")).join(""),a3="".concat(i3,`
`).concat(s3,`
`).concat(o3,`

uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;

const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
  float y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

float project_size() {
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
    project_uPseudoMeters == false) {
    
    if (geometry.position.w == 0.0) {
      return project_size_at_latitude(geometry.worldPosition.y);
    }
  
    float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    float y2 = y * y;
    float y4 = y2 * y2;
    float y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

float project_size_at_latitude(float meters, float lat) {
  return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
  return meters * project_uCommonUnitsPerMeter.z * project_size();
}

vec2 project_size(vec2 meters) {
  return meters * project_uCommonUnitsPerMeter.xy * project_size();
}

vec3 project_size(vec3 meters) {
  return meters * project_uCommonUnitsPerMeter * project_size();
}

vec4 project_size(vec4 meters) {
  return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
  vec3 uz = normalize(up);
  vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
  vec3 uy = cross(uz, ux);
  return mat3(ux, uy, uz);
}

bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    transform = project_get_orientation_matrix(commonPosition);
    return true;
  }
  return false;
}
vec3 project_normal(vec3 vector) {
  vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
  vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
  mat3 rotation;
  if (project_needs_rotation(geometry.position.xyz, rotation)) {
    n = rotation * n;
  }
  return n;
}

vec4 project_offset_(vec4 offset) {
  float dy = offset.y;
  vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
  return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
  float x = lnglat.x;
  if (project_uWrapLongitude) {
    x = mod(x + 180., 360.0) - 180.;
  }
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

vec3 project_globe_(vec3 lnglatz) {
  float lambda = radians(lnglatz.x);
  float phi = radians(lnglatz.y);
  float cosPhi = cos(phi);
  float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;

  return vec3(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
  vec4 position_world = project_uModelMatrix * position;
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_mercator_(position_world.xy),
        project_size_at_latitude(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world.xyz += project_uCoordinateOrigin;
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
        return vec4(
          project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
          project_size(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
    (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
    (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
     project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world.xyz -= project_uCoordinateOrigin;
  }
  return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}

vec4 project_position(vec4 position) {
  return project_position(position, ZERO_64_LOW);
}

vec3 project_position(vec3 position, vec3 position64Low) {
  vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
  return projected_position.xyz;
}

vec3 project_position(vec3 position) {
  vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

vec2 project_position(vec2 position) {
  vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
  return offset * project_uFocalDistance;
}

float project_size_to_pixel(float meters) {
  return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
  if (unit == UNIT_METERS) return project_size_to_pixel(size);
  if (unit == UNIT_COMMON) return size * project_uScale;
  return size;
}
float project_pixel_size(float pixels) {
  return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
  return pixels / project_uScale;
}
`);function l3(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function fo(t){let e={},n;return r=>{for(const i in r)if(!l3(r[i],e[i])){n=t(r),e=r;break}return n}}const sm=[0,0,0,0],u3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],j_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],c3=[0,0,0],G_=[0,0,0],f3=fo(g3);function W_(t,e,n=G_){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===q.LNGLAT_OFFSETS||e===q.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Yt.WEB_MERCATOR:(e===q.LNGLAT||e===q.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Yt.WEB_MERCATOR_AUTO_OFFSET:e===q.LNGLAT?r=i:e===q.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Yt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Yt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function h3(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=sm,l=sm,u=t.cameraPosition;const{geospatialOrigin:c,shaderCoordinateOrigin:f,offsetMode:h}=W_(t,e,n);return h&&(l=t.projectPosition(c||f),u=[u[0]-l[0],u[1]-l[1],u[2]-l[2]],l[3]=1,a=lo([],l,o),s=r||s,o=pr([],i,s),o=pr([],o,u3)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:u,shaderCoordinateOrigin:f,geospatialOrigin:c}}function d3({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=q.DEFAULT,coordinateOrigin:i=G_,autoWrapLongitude:s=!1}){r===q.DEFAULT&&(r=t.isGeospatial?q.LNGLAT:q.CARTESIAN);const o=f3({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||j_,o}function g3({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:u}=h3(t,n,r),c=t.getDistanceScales(),f=[t.width*e,t.height*e],h=lo([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:f,project_uDevicePixelRatio:e,project_uFocalDistance:h,project_uCommonUnitsPerMeter:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit:c.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:c3,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:j_,project_uCameraPosition:a};if(u){const p=t.getDistanceScales(u);switch(n){case q.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=p.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerMeter2;break;case q.LNGLAT:case q.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=p.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=p.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=p.unitsPerDegree2;break;case q.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,p.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,p.unitsPerMeter2[2]];break}}return d}const p3={};function m3(t=p3){return"viewport"in t?d3(t):{}}const Qh={name:"project",dependencies:[dC,r3],vs:a3,getUniforms:m3};function y3(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function fi(t,e){const n=lo([],e,t);return QC(n,n,1/n[3]),n}function om(t,e){const n=t%e;return n<0?e+n:n}function _f(t,e,n){return t<e?e:t>n?n:t}function v3(t){return Math.log(t)*Math.LOG2E}const Jh=Math.log2||v3;function mn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const It=Math.PI,H_=It/4,Et=It/180,Ef=180/It,Si=512,hl=4003e4,ta=85.051129,_3=1.5;function E3(t){return Jh(t)}function dl(t){const[e,n]=t;mn(Number.isFinite(e)),mn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Et,i=n*Et,s=Si*(r+It)/(2*It),o=Si*(It+Math.log(Math.tan(H_+i*.5)))/(2*It);return[s,o]}function Pi(t){const[e,n]=t,r=e/Si*(2*It)-It,i=2*(Math.atan(Math.exp(n/Si*(2*It)-It))-H_);return[r*Ef,i*Ef]}function w3(t){const{latitude:e}=t;mn(Number.isFinite(e));const n=Math.cos(e*Et);return E3(hl*n)-9}function Zu(t){const e=Math.cos(t*Et);return Si/hl/e}function wf(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;mn(Number.isFinite(e)&&Number.isFinite(n));const i=Si,s=Math.cos(e*Et),o=i/360,a=o/s,l=i/hl/s,u={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const c=Et*Math.tan(e*Et)/s,f=o*c/2,h=i/hl*c,d=h/a*l;u.unitsPerDegree2=[0,f,h],u.unitsPerMeter2=[d,0,d]}return u}function X_(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:u}=wf({longitude:n,latitude:r,highPrecision:!0}),c=dl(t);c[0]+=s*(l[0]+u[0]*o),c[1]+=o*(l[1]+u[1]*o);const f=Pi(c),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function T3(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=y3();cl(a,a,[0,0,-i]),F_(a,a,-n*Et),D_(a,a,r*Et);const l=s/e;return Zh(a,a,[l,l,l]),o&&cl(a,a,LC([],o)),a}function b3(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:u=1}=t;let{fovy:c=gl(_3)}=t;r!==void 0&&(c=gl(r));const f=c*Et,h=i*Et,d=Y_(c);let p=d;o&&(p+=o[2]*a/Math.cos(h)/n);const E=f*(.5+(s?s[1]:0)/n),b=Math.sin(E)*p/Math.sin(_f(Math.PI/2-h-E,.01,Math.PI-.01)),y=Math.sin(h)*b+p,m=p*10,_=Math.min(y*u,m);return{fov:f,aspect:e/n,focalDistance:d,near:l,far:_}}function gl(t){return 2*Math.atan(.5/t)*Ef}function Y_(t){return .5/Math.tan(.5*t*Et)}function $_(t,e){const[n,r,i=0]=t;return mn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),fi(e,[n,r,i,1])}function ed(t,e,n=0){const[r,i,s]=t;if(mn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return fi(e,[r,i,s,1]);const o=fi(e,[r,i,0,1]),a=fi(e,[r,i,1,1]),l=o[2],u=a[2],c=l===u?0:((n||0)-l)/(u-l);return M_([],o,a,c)}function x3(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[u,c]]=r,f=S3(t.padding),h=dl([a,_f(c,-ta,ta)]),d=dl([u,_f(l,-ta,ta)]),p=[Math.max(Math.abs(d[0]-h[0]),i),Math.max(Math.abs(d[1]-h[1]),i)],E=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];mn(E[0]>0&&E[1]>0);const b=E[0]/p[0],y=E[1]/p[1],m=(f.right-f.left)/2/b,_=(f.top-f.bottom)/2/y,T=[(d[0]+h[0])/2+m,(d[1]+h[1])/2+_],S=Pi(T),P=Math.min(s,Jh(Math.abs(Math.min(b,y))));return mn(Number.isFinite(P)),{longitude:S[0],latitude:S[1],zoom:P}}function S3(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(mn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const am=Math.PI/180;function P3(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,u;const c=t.fovy?.5*t.fovy*am:Math.atan(.5/t.altitude),f=(90-t.pitch)*am;return c>f-.01?(l=lm(t,0,e),u=lm(t,n,e)):(l=i([0,0],s),u=i([n,0],s)),[o,a,u,l]}function lm(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=fi(r,[e,0,1,1]),s=fi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=M_([],i,s,a),u=Pi(l);return u.push(n),u}const um=512;function A3(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=om(i+180,360)-180),(a<-180||a>180)&&(a=om(a+180,360)-180);const l=Jh(n/um);if(o<=l)o=l,s=0;else{const u=n/2/Math.pow(2,o),c=Pi([0,u])[1];if(s<c)s=c;else{const f=Pi([0,um-u])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const L3=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,C3=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

varying vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture2D(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,I3=fo(N3),M3=fo(F3),O3=[0,0,0,1],R3=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function k3(t,e){const[n,r,i]=t,s=ed([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function N3({viewport:t,center:e}){return new Ft(t.viewProjectionMatrix).invert().transform(e)}function F3({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>k3(o,r));for(const o of e){const a=o.clone().translate(new Qt(t.center).negate()),l=s.map(c=>a.transform(c)),u=new Ft().ortho({left:Math.min(...l.map(c=>c[0])),right:Math.max(...l.map(c=>c[0])),bottom:Math.min(...l.map(c=>c[1])),top:Math.max(...l.map(c=>c[1])),near:Math.min(...l.map(c=>-c[2])),far:Math.max(...l.map(c=>-c[2]))});n.push(u.multiplyRight(o))}return n}function D3(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||O3,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=I3({viewport:t.viewport,center:e.project_uCenter}),s=[],o=M3({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],u=l.clone().translate(new Qt(t.viewport.center).negate());e.project_uCoordinateSystem===q.LNGLAT&&e.project_uProjectionMode===Yt.WEB_MERCATOR?(o[a]=u,s[a]=i):(o[a]=l.clone().multiplyRight(R3),s[a]=u.transform(i))}for(let a=0;a<o.length;a++)r["shadow_uViewProjectionMatrices[".concat(a,"]")]=o[a],r["shadow_uProjectCenters[".concat(a,"]")]=s[a],t.shadowMaps&&t.shadowMaps.length>0?r["shadow_uShadowMap".concat(a)]=t.shadowMaps[a]:r["shadow_uShadowMap".concat(a)]=t.dummyShadowMap;return r}const Ku={name:"shadow",dependencies:[Qh],vs:L3,fs:C3,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?D3(t,e):{}},z3={color:[255,255,255],intensity:1},cm=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],B3=[0,0,0,200/255];class Z_{constructor(e={}){g(this,"id","lighting-effect"),g(this,"props",void 0),g(this,"shadowColor",B3),g(this,"shadow",void 0),g(this,"ambientLight",void 0),g(this,"directionalLights",void 0),g(this,"pointLights",void 0),g(this,"shadowPasses",[]),g(this,"shadowMaps",[]),g(this,"dummyShadowMap",null),g(this,"programManager",void 0),g(this,"shadowMatrices",void 0),this.setProps(e)}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.props=e}preRender(e,{layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o}){if(this.shadow){this.shadowMatrices=this._calculateMatrices(),this.shadowPasses.length===0&&this._createShadowPasses(e),this.programManager||(this.programManager=uo.getDefaultProgramManager(e),Ku&&this.programManager.addDefaultModule(Ku)),this.dummyShadowMap||(this.dummyShadowMap=new ct(e,{width:1,height:1}));for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o,moduleParameters:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(){for(const e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.delete(),this.dummyShadowMap=null),this.shadow&&this.programManager&&(this.programManager.removeDefaultModule(Ku),this.programManager=null)}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Ft().lookAt({eye:new Qt(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new e3(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new X2(z3),this.directionalLights.push(new im(cm[0]),new im(cm[1])))}}class U3{constructor(e={}){g(this,"_pool",[]),g(this,"opts",{overAlloc:2,poolSize:100}),this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const u=i||e&&e.constructor||Float32Array,c=n*r+s;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new u(e.buffer,0,c)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(u,c,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(u=>u.byteLength>=a);if(l>=0){const u=new e(o.splice(l,1)[0],0,s);return r&&u.fill(0),u}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Ai=new U3;function ls(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function V3(t){return[t[12],t[13],t[14]]}function j3(t){return{left:Vr(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Vr(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Vr(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Vr(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Vr(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Vr(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const fm=new Qt;function Vr(t,e,n,r){fm.set(t,e,n);const i=fm.len();return{distance:r/i,normal:new Qt(-t/i,-e/i,-n/i)}}function G3(t){return t-Math.fround(t)}let es;function qu(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;es=Ai.allocate(es,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const u=t[o++];es[a+l]=u,es[a+l+n]=G3(u)}a+=n*2}return es.subarray(0,s*n*2)}function W3(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const H3=Math.PI/180,X3=ls(),hm=[0,0,0],Y3={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function $3({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,u=n?new Ft().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new Ft().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:c=0,right:f=0,top:h=0,bottom:d=0}=s,p=kn((c+t-f)/2,0,t)-t/2,E=kn((h+e-d)/2,0,e)-e/2;u[8]-=p*2/t,u[9]+=E*2/e}return u}class Oi{constructor(e={}){g(this,"id",void 0),g(this,"x",void 0),g(this,"y",void 0),g(this,"width",void 0),g(this,"height",void 0),g(this,"padding",void 0),g(this,"isGeospatial",void 0),g(this,"zoom",void 0),g(this,"focalDistance",void 0),g(this,"position",void 0),g(this,"modelMatrix",void 0),g(this,"distanceScales",void 0),g(this,"scale",void 0),g(this,"center",void 0),g(this,"cameraPosition",void 0),g(this,"projectionMatrix",void 0),g(this,"viewMatrix",void 0),g(this,"viewMatrixUncentered",void 0),g(this,"viewMatrixInverse",void 0),g(this,"viewProjectionMatrix",void 0),g(this,"pixelProjectionMatrix",void 0),g(this,"pixelUnprojectionMatrix",void 0),g(this,"resolution",void 0),g(this,"_frustumPlanes",{}),this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||Y3,this.focalDistance=e.focalDistance||1,this.position=e.position||hm,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Yt.WEB_MERCATOR:Yt.WEB_MERCATOR_AUTO_OFFSET:Yt.IDENTITY}equals(e){return e instanceof Oi?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Hs(e.projectionMatrix,this.projectionMatrix)&&Hs(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=$_(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],u=ed([i,a,o],this.pixelUnprojectionMatrix,l),[c,f,h]=this.unprojectPosition(u);return Number.isFinite(o)?[c,f,h]:Number.isFinite(r)?[c,f,r]:[c,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=dl(e);return n[1]=kn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Pi(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?wf({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,j3(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=w3({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||wf({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=hm;if(s&&(a=o?new Ft(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new Qt(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=X3,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:u=null,focalDistance:c=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Ft().multiplyRight(n).translate(new Qt(this.center).negate()),this.projectionMatrix=r||$3({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*H3,focalDistance:c,padding:u,near:a,far:l});const f=ls();pr(f,f,this.projectionMatrix),pr(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=yf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=V3(this.viewMatrixInverse);const h=ls(),d=ls();Zh(h,h,[this.width/2,-this.height/2,1]),cl(h,h,[1,-1,0]),pr(d,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=yf(ls(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||X.warn("Pixel project matrix not invertible")()}}g(Oi,"displayName","Viewport");class Li extends Oi{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:u,farZ:c,orthographic:f=!1,projectionMatrix:h,repeat:d=!1,worldOffset:p=0,position:E,padding:b,legacyMeterSizes:y=!1}=e;let{width:m,height:_,altitude:T=1.5}=e;const S=Math.pow(2,i);m=m||1,_=_||1;let P,L=null;if(h)T=h[5]/2,P=gl(T);else{e.fovy?(P=e.fovy,T=Y_(P)):P=gl(T);let I;if(b){const{top:M=0,bottom:B=0}=b;I=[0,kn((M+_-B)/2,0,_)-_/2]}L=b3({width:m,height:_,scale:S,center:E&&[0,0,E[2]*Zu(n)],offset:I,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(u)&&(L.near=u),Number.isFinite(c)&&(L.far=c)}let C=T3({height:_,pitch:s,bearing:o,scale:S,altitude:T});p&&(C=new Ft().translate([512*p,0,0]).multiplyLeft(C)),super({...e,width:m,height:_,viewMatrix:C,longitude:r,latitude:n,zoom:i,...L,fovy:P,focalDistance:T}),g(this,"longitude",void 0),g(this,"latitude",void 0),g(this,"pitch",void 0),g(this,"bearing",void 0),g(this,"altitude",void 0),g(this,"fovy",void 0),g(this,"orthographic",void 0),g(this,"_subViewports",void 0),g(this,"_pseudoMeters",void 0),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=T,this.fovy=P,this.orthographic=f,this._subViewports=d?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Li({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*Zu(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/Zu(r);return[n,r,i]}addMetersToLngLat(e,n){return X_(e,n)}panByPosition(e,n){const r=ed(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=Qp([],i,wC([],r)),o=Qp([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=P3(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=x3({width:r,height:i,bounds:e,...n});return new Li({width:r,height:i,longitude:s,latitude:o,zoom:a})}}g(Li,"displayName","WebMercatorViewport");const dm=[0,0,0];function Qu(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof Li){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function Z3(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===q.DEFAULT&&(i=e.isGeospatial?q.LNGLAT:q.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function K_(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=lo([],[o,a,l,1],n)),r){case q.LNGLAT:return Qu([o,a,l],e,s);case q.LNGLAT_OFFSETS:return Qu([o+i[0],a+i[1],l+(i[2]||0)],e,s);case q.METER_OFFSETS:return Qu(X_(i,[o,a,l]),e,s);case q.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function K3(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=Z3(e),{autoOffset:l=!0}=e,{geospatialOrigin:u=dm,shaderCoordinateOrigin:c=dm,offsetMode:f=!1}=l?W_(n,r,i):{},h=K_(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const d=n.projectPosition(u||c);DC(h,h,d)}return h}const gm={blendFunc:[1,0,32771,0],blendEquation:32774};class q_ extends qh{constructor(...e){super(...e),g(this,"pickZ",void 0),g(this,"_colorEncoderState",null)}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:u,height:c},cullRect:f,effects:h,pass:d="picking",pickZ:p,moduleParameters:E}){const b=this.gl;this.pickZ=p;const y=this._resetColorEncoder(p),m=at(b,{scissorTest:!0,scissor:[a,l,u,c],clearColor:[0,0,0,0],depthMask:!0,depthTest:!0,depthRange:[0,1],colorMask:[!0,!0,!0,!0],...gm,blend:!p},()=>super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(T=>T.useInPicking),pass:d,isPicking:!0,moduleParameters:E}));return this._colorEncoderState=null,{decodePickingColor:y&&Q3.bind(null,y),stats:m}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{pickingActive:1,pickingAttribute:this.pickZ,lightSources:{}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(Object.assign(i,gm),i.blend=!0,i.blendColor=q3(this._colorEncoderState,e,r)):i.blend=!1,o.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function q3(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(X.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function Q3(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Gr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},pl=Symbol.for("component"),Xn=Symbol.for("propTypes"),Ju=Symbol.for("deprecatedProps"),hi=Symbol.for("asyncPropDefaults"),Pr=Symbol.for("asyncPropOriginal"),Nn=Symbol.for("asyncPropResolved");function td(t,e=()=>!0){return Array.isArray(t)?Q_(t,e,[]):e(t)?[t]:[]}function Q_(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?Q_(i,e,n):e(i)&&n.push(i)}return n}function J3({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class eI{constructor(e,n,r){g(this,"id",void 0),g(this,"context",void 0),g(this,"isLoaded",void 0),g(this,"persistent",void 0),g(this,"_loadCount",0),g(this,"_subscribers",new Set),g(this,"_data",void 0),g(this,"_loader",void 0),g(this,"_error",void 0),g(this,"_content",void 0),this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=ol(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class tI{constructor({gl:e,protocol:n}){g(this,"protocol",void 0),g(this,"_context",void 0),g(this,"_resources",void 0),g(this,"_consumers",void 0),g(this,"_pruneRequest",void 0),this.protocol=n||"resource://",this._context={gl:e,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new eI(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{},a=o[n]||{},l=a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(o[n]=a,a.onChange=i,a.resourceId=r.id,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const nI=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,ho={name:"project32",dependencies:[Qh],vs:nI},go={inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:#decl":`
uniform bool picking_uAttribute;
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}},...d2},rI=[Qh],iI=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function sI(t){const e=uo.getDefaultProgramManager(t);for(const n of rI)e.addDefaultModule(n);for(const n of iI)e.addShaderHook(n);return e}const oI="layerManager.setLayers",aI="layerManager.activateViewport";class lI{constructor(e,{deck:n,stats:r,viewport:i,timeline:s}={}){g(this,"layers",void 0),g(this,"context",void 0),g(this,"resourceManager",void 0),g(this,"_lastRenderedLayers",[]),g(this,"_needsRedraw",!1),g(this,"_needsUpdate",!1),g(this,"_nextLayers",null),g(this,"_debug",!1),g(this,"activateViewport",o=>{De(aI,this,o),o&&(this.context.viewport=o)}),this.layers=[],this.resourceManager=new tI({gl:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,gl:e,deck:n,programManager:e&&sI(e),stats:r||new Rh({id:"deck.gl"}),viewport:i||new Oi({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:s||new B_,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){De(oI,this,n,e),this._lastRenderedLayers=e;const r=td(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw("updating layers: ".concat(e)),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}_handleError(e,n,r){r.raiseError(n,"".concat(e," of ").concat(r))}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?X.warn("Multiple old layers with same id ".concat(o.id))():r[o.id]=o;const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s="Uniform transition in ".concat(o);break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&X.warn("Multiple new layers with same id ".concat(i.id))(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Gr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Gr.MATCHED,n!==e&&(e.lifecycle=Gr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||"finalized ".concat(e),e.lifecycle=Gr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Gr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function $t(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!$t(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!$t(t[s],e[s],n-1))return!1;return!0}return!1}class uI{constructor(e){g(this,"width",void 0),g(this,"height",void 0),g(this,"views",void 0),g(this,"viewState",void 0),g(this,"controllers",void 0),g(this,"timeline",void 0),g(this,"_viewports",void 0),g(this,"_viewportMap",void 0),g(this,"_isUpdating",void 0),g(this,"_needsRedraw",void 0),g(this,"_needsUpdate",void 0),g(this,"_eventManager",void 0),g(this,"_eventCallbacks",void 0),this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=td(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!$t(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):X.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))===null||o===void 0?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const u=!!s.controller;u&&!l&&(r=!0),(r||!u)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const cI=/([0-9]+\.?[0-9]*)(%|px)/;function Sn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=cI.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error("Could not parse position string ".concat(t))}}function Pn(t,e){return t.relative?Math.round(t.position*e):t.position}function Pe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class fI{constructor(e){g(this,"id",void 0),g(this,"viewportInstance",void 0),g(this,"_x",void 0),g(this,"_y",void 0),g(this,"_width",void 0),g(this,"_height",void 0),g(this,"_padding",void 0),g(this,"props",void 0);const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null,viewportInstance:l}=e||{};Pe(!l||l instanceof Oi),this.viewportInstance=l,this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Sn(r),this._y=Sn(i),this._width=Sn(s),this._height=Sn(o),this._padding=a&&{left:Sn(a.left||0),right:Sn(a.right||0),top:Sn(a.top||0),bottom:Sn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.viewportInstance?e.viewportInstance?this.viewportInstance.equals(e.viewportInstance):!1:this.ViewportType===e.ViewportType&&$t(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){if(this.viewportInstance)return this.viewportInstance;r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Pn(this._x,e),y:Pn(this._y,n),width:Pn(this._width,e),height:Pn(this._height,n)};return this._padding&&(r.padding={left:Pn(this._padding.left,e),top:Pn(this._padding.top,n),right:Pn(this._padding.right,e),bottom:Pn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class po{constructor(e){g(this,"_inProgress",void 0),g(this,"_handle",void 0),g(this,"_timeline",void 0),g(this,"time",void 0),g(this,"settings",void 0),this._inProgress=!1,this._handle=null,this._timeline=e,this.time=0,this.settings={duration:0}}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(n=(r=this.settings).onStart)===null||n===void 0||n.call(r,this)}end(){if(this._inProgress){var e,n;this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(e=(n=this.settings).onEnd)===null||e===void 0||e.call(n,this)}}cancel(){if(this._inProgress){var e,n;(e=(n=this.settings).onInterrupt)===null||e===void 0||e.call(n,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1}}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(e=(n=this.settings).onUpdate)===null||e===void 0||e.call(n,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const pm=()=>{},Tf={BREAK:1,SNAP_TO_END:2,IGNORE:3},hI=t=>t,dI=Tf.BREAK;class gI{constructor(e){g(this,"getControllerState",void 0),g(this,"props",void 0),g(this,"propsInTransition",void 0),g(this,"transition",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"_onTransitionUpdate",n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,u=l(r/a),c=i.interpolateProps(s,o,u);this.propsInTransition=this.getControllerState({...this.props,...c}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})}),this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new po(e.timeline),this.onViewStateChange=e.onViewStateChange||pm,this.onStateChange=e.onStateChange||pm}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===Tf.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===Tf.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||hI,interpolator:s,interruption:n.transitionInterruption||dI,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}class pI{constructor(e){g(this,"_propsToCompare",void 0),g(this,"_propsToExtract",void 0),g(this,"_requiredProps",void 0);const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Hs(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Pe(Number.isFinite(r)||Array.isArray(r),"".concat(n," is required for transition"))})}}const mI=["longitude","latitude","zoom","bearing","pitch"],yI=["longitude","latitude","zoom"];class J_ extends pI{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:mI,required:yI},super(r.transitionProps),g(this,"opts",void 0),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=ul(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,ul(e.around,n.around,r)))}return i}}const An={transitionDuration:0},vI=300,na=t=>1-(1-t)*(1-t),jr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ir={};class _I{constructor(e){g(this,"props",void 0),g(this,"state",{}),g(this,"transitionManager",void 0),g(this,"eventManager",void 0),g(this,"onViewStateChange",void 0),g(this,"onStateChange",void 0),g(this,"makeViewport",void 0),g(this,"_controllerState",void 0),g(this,"_events",{}),g(this,"_interactionState",{isDragging:!1}),g(this,"_customEvents",[]),g(this,"_eventStartBlocked",null),g(this,"_panMove",!1),g(this,"invertPan",!1),g(this,"dragMode","rotate"),g(this,"inertia",0),g(this,"scrollZoom",!0),g(this,"dragPan",!0),g(this,"dragRotate",!0),g(this,"doubleClickZoom",!0),g(this,"touchZoom",!0),g(this,"touchRotate",!1),g(this,"keyboard",!0),this.transitionManager=new gI({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const n in this._events)if(this._events[n]){var e;(e=this.eventManager)===null||e===void 0||e.off(n,this.handleEvent)}this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?vI:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:u=!0}=e,c=!!this.onViewStateChange;this.toggleEvents(jr.WHEEL,c&&r),this.toggleEvents(jr.PAN,c),this.toggleEvents(jr.PINCH,c&&(a||l)),this.toggleEvents(jr.TRIPLE_PAN,c&&l),this.toggleEvents(jr.DOUBLE_TAP,c&&o),this.toggleEvents(jr.KEYBOARD,c&&u),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=u}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,An,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,An,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,An,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,An,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,An,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:na},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ir._startPinchRotation=e.rotation,ir._lastPinchEvent=e,this.updateViewport(r,An,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:ir._startPinchRotation-r})}return this.updateViewport(n,An,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ir._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=ir;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:na},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ir._startPinchRotation=null,ir._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const u={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),u.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),u.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),u.isRotating=!0):(l=a.moveLeft(i),u.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),u.isRotating=!0):(l=a.moveRight(i),u.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),u.isRotating=!0):(l=a.moveUp(i),u.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),u.isRotating=!0):(l=a.moveDown(i),u.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),u),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?An:e?{...n,transitionInterpolator:new J_({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class EI{constructor(e,n){g(this,"_viewportProps",void 0),g(this,"_state",void 0),this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const mm=5,wI=1.2;class TI extends EI{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:u=1.5,position:c=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:d=60,minPitch:p=0,startPanLngLat:E,startZoomLngLat:b,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T,normalize:S=!0}=e;Pe(Number.isFinite(s)),Pe(Number.isFinite(i)),Pe(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:u,maxZoom:f,minZoom:h,maxPitch:d,minPitch:p,normalize:S,position:c},{startPanLngLat:E,startZoomLngLat:b,startRotatePos:y,startBearing:m,startPitch:_,startZoom:T}),g(this,"makeViewport",void 0),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=kn(l,a,o);const u=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...u.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=kn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=kn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,A3(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:u,height:c}=this.getViewportProps(),f=s/u;let h=0;o>0?Math.abs(c-l)>mm&&(h=o/(l-c)*wI):o<0&&l>mm&&(h=1-a/l),h=kn(h,-1,1);const{minPitch:d,maxPitch:p}=this.getViewportProps(),E=i+180*f;let b=r;return h>0?b=r+h*(p-r):h<0&&(b=r-h*(d-r)),{pitch:b,bearing:E}}}class bI extends _I{constructor(...e){super(...e),g(this,"ControllerState",TI),g(this,"transition",{transitionDuration:300,transitionInterpolator:new J_({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})}),g(this,"dragMode","pan")}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class e1 extends fI{get ViewportType(){return Li}get ControllerType(){return bI}}g(e1,"displayName","MapView");const xI=new Z_;function SI(t,e){var n,r;const i=(n=t.order)!==null&&n!==void 0?n:1/0,s=(r=e.order)!==null&&r!==void 0?r:1/0;return i-s}class PI{constructor(){g(this,"effects",void 0),g(this,"_resolvedEffects",[]),g(this,"_defaultEffects",[]),g(this,"_needsRedraw",void 0),this.effects=[],this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>SI(i,e)>0);r<0?n.push(e):n.splice(r,0,e),this._setEffects(this.effects)}}setProps(e){"effects"in e&&($t(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];s&&s!==i?s.setProps?(s.setProps(i.props),r.push(s)):(s.cleanup(),r.push(i)):r.push(i),delete n[i.id]}for(const i in n)n[i].cleanup();this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof Z_)||this._resolvedEffects.push(xI),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup();this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class AI extends qh{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const LI="deckRenderer.renderLayers";class CI{constructor(e){g(this,"gl",void 0),g(this,"layerFilter",void 0),g(this,"drawPickingColors",void 0),g(this,"drawLayersPass",void 0),g(this,"pickLayersPass",void 0),g(this,"renderCount",void 0),g(this,"_needsRedraw",void 0),g(this,"renderBuffers",void 0),g(this,"lastPostProcessEffect",void 0),this.gl=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new AI(e),this.pickLayersPass=new q_(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e,target:e.target||be.getDefaultFramebuffer(this.gl)};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target,s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,De(LI,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(this.gl,n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this;e.length===0&&e.push(new be(this.gl),new be(this.gl));for(const n of e)n.resize()}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1],target:null};for(const s of e)if(s.postRender){if(s.id===this.lastPostProcessEffect){i.target=n.target,s.postRender(this.gl,i);break}const o=s.postRender(this.gl,i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const II={pickedColor:null,pickedObjectIndex:-1};function MI({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:u}=s;let c=i*i,f=-1,h=0;for(let d=0;d<u;d++){const p=d+a-r,E=p*p;if(E>c)h+=4*l;else for(let b=0;b<l;b++){if(t[h+3]-1>=0){const m=b+o-n,_=m*m+E;_<=c&&(c=_,f=h)}h+=4}}if(f>=0){const d=t.slice(f,f+4),p=e(d);if(p){const E=Math.floor(f/4/l),b=f/4-E*l;return{...p,pickedColor:d,pickedX:o+b,pickedY:a+E}}X.error("Picked non-existent layer. Is picking buffer corrupt?")()}return II}function OI({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):X.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function t1({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=kI((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function RI(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,d=o?o.props.id:null;if(d!==h||a!==f){if(d!==h){const p=i.find(E=>E.props.id===h);p&&l.unshift(p)}n.layerId=d,n.index=a,n.info=null}}const u=t1(t),c=new Map;return c.set(null,u),l.forEach(f=>{let h={...u};f===o&&(h.color=s,h.index=a,h.picked=!0),h=n1({layer:f,info:h,mode:r});const d=h.layer;f===o&&r==="hover"&&(n.info=h),c.set(d.id,h),r==="hover"&&d.updateAutoHighlight(h)}),c}function n1({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function kI(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class NI{constructor(e){g(this,"gl",void 0),g(this,"pickingFBO",void 0),g(this,"depthFBO",void 0),g(this,"pickLayersPass",void 0),g(this,"layerFilter",void 0),g(this,"lastPickedInfo",void 0),g(this,"_pickable",!0),this.gl=e,this.pickLayersPass=new q_(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.color.delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,u=a&&i.find(h=>h.id===a)||i[0],c=u&&u.unproject([e-u.x,n-u.y]);return{...s,...{x:e,y:n,viewport:u,coordinate:c,layer:l}}}_resizeBuffer(){var e,n;const{gl:r}=this;if(!this.pickingFBO&&(this.pickingFBO=new be(r),be.isSupported(r,{colorBufferFloat:!0}))){const i=new be(r);i.attach({36064:new ct(r,{format:$(r)?34836:6408,type:5126})}),this.depthFBO=i}(e=this.pickingFBO)===null||e===void 0||e.resize({width:r.canvas.width,height:r.canvas.height}),(n=this.depthFBO)===null||n===void 0||n.resize({width:r.canvas.width,height:r.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:u,onViewportActive:c,effects:f}){const h=this._getPickable(e),d=wi(this.gl);if(!h)return{result:[],emptyInfo:t1({viewports:r,x:i,y:s,pixelRatio:d})};this._resizeBuffer();const p=ku(this.gl,[i,s],!0),E=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],b=Math.round(o*d),{width:y,height:m}=this.pickingFBO,_=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:b,deviceWidth:y,deviceHeight:m}),T={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let S;const P=[],L=new Set;for(let C=0;C<a;C++){let I;if(_){const B=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:c,deviceRect:_,cullRect:T,effects:f,pass:"picking:".concat(l)});I=MI({...B,deviceX:E[0],deviceY:E[1],deviceRadius:b,deviceRect:_})}else I={pickedColor:null,pickedObjectIndex:-1};let M;if(I.pickedLayer&&u&&this.depthFBO){const{pickedColors:B}=this._drawAndSample({layers:[I.pickedLayer],views:n,viewports:r,onViewportActive:c,deviceRect:{x:I.pickedX,y:I.pickedY,width:1,height:1},cullRect:T,effects:f,pass:"picking:".concat(l,":z")},!0);B[3]&&(M=B[0])}I.pickedLayer&&C+1<a&&(L.add(I.pickedLayer),I.pickedLayer.disablePickingIndex(I.pickedObjectIndex)),S=RI({pickInfo:I,lastPickedInfo:this.lastPickedInfo,mode:l,layers:h,viewports:r,x:i,y:s,z:M,pixelRatio:d});for(const B of S.values())B.layer&&P.push(B);if(!I.pickedColor)break}for(const C of L)C.restorePickingColors();return{result:P,emptyInfo:S.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:u=null,onViewportActive:c,effects:f}){const h=this._getPickable(e);if(!h)return[];this._resizeBuffer();const d=wi(this.gl),p=ku(this.gl,[i,s],!0),E=p.x,b=p.y+p.height,y=ku(this.gl,[i+o,s+a],!0),m=y.x+y.width,_=y.y,T={x:E,y:_,width:m-E,height:b-_},S=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:c,deviceRect:T,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:"picking:".concat(l)}),P=OI(S),L=new Map,C=Number.isFinite(u);for(let M=0;M<P.length;M++){var I;if(C&&u&&L.size>=u)break;const B=P[M];let V={color:B.pickedColor,layer:null,index:B.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d};V=n1({layer:B.pickedLayer,info:V,mode:l});const j=(I=V.object)!==null&&I!==void 0?I:"".concat(V.layer.id,"[").concat(V.index,"]");L.has(j)||L.set(j,V)}return Array.from(L.values())}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},u=!1){const c=u?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:c,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:u,preRenderStats:{}};for(const m of a)m.useInPicking&&(f.preRenderStats[m.id]=m.preRender(this.gl,f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:d,y:p,width:E,height:b}=s,y=new(u?Float32Array:Uint8Array)(E*b*4);return zl(c,{sourceX:d,sourceY:p,sourceWidth:E,sourceHeight:b,target:y}),{pickedColors:y,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,u=Math.min(s,n+r+1)-a;return l<=0||u<=0?null:{x:o,y:a,width:l,height:u}}}const FI={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class DI{constructor(e){g(this,"el",null),g(this,"isVisible",!1);const n=e.parentElement;n&&(this.el=document.createElement("div"),this.el.className="deck-tooltip",Object.assign(this.el.style,FI),n.appendChild(this.el))}setTooltip(e,n,r){const i=this.el;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform="translate(".concat(n,"px, ").concat(r,"px)"),e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}remove(){this.el&&(this.el.remove(),this.el=null)}}var r1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,u=Math.abs,c=Date.now;function f(v,w,x){return setTimeout(_(v,x),w)}function h(v,w,x){return Array.isArray(v)?(d(v,x[w],x),!0):!1}function d(v,w,x){var A;if(v)if(v.forEach)v.forEach(w,x);else if(v.length!==i)for(A=0;A<v.length;)w.call(x,v[A],A,v),A++;else for(A in v)v.hasOwnProperty(A)&&w.call(x,v[A],A,v)}function p(v,w,x){var A="DEPRECATED METHOD: "+w+`
`+x+` AT 
`;return function(){var O=new Error("get-stack-trace"),F=O&&O.stack?O.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",H=e.console&&(e.console.warn||e.console.log);return H&&H.call(e.console,A,F),v.apply(this,arguments)}}var E;typeof Object.assign!="function"?E=function(w){if(w===i||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var x=Object(w),A=1;A<arguments.length;A++){var O=arguments[A];if(O!==i&&O!==null)for(var F in O)O.hasOwnProperty(F)&&(x[F]=O[F])}return x}:E=Object.assign;var b=p(function(w,x,A){for(var O=Object.keys(x),F=0;F<O.length;)(!A||A&&w[O[F]]===i)&&(w[O[F]]=x[O[F]]),F++;return w},"extend","Use `assign`."),y=p(function(w,x){return b(w,x,!0)},"merge","Use `assign`.");function m(v,w,x){var A=w.prototype,O;O=v.prototype=Object.create(A),O.constructor=v,O._super=A,x&&E(O,x)}function _(v,w){return function(){return v.apply(w,arguments)}}function T(v,w){return typeof v==a?v.apply(w&&w[0]||i,w):v}function S(v,w){return v===i?w:v}function P(v,w,x){d(M(w),function(A){v.addEventListener(A,x,!1)})}function L(v,w,x){d(M(w),function(A){v.removeEventListener(A,x,!1)})}function C(v,w){for(;v;){if(v==w)return!0;v=v.parentNode}return!1}function I(v,w){return v.indexOf(w)>-1}function M(v){return v.trim().split(/\s+/g)}function B(v,w,x){if(v.indexOf&&!x)return v.indexOf(w);for(var A=0;A<v.length;){if(x&&v[A][x]==w||!x&&v[A]===w)return A;A++}return-1}function V(v){return Array.prototype.slice.call(v,0)}function j(v,w,x){for(var A=[],O=[],F=0;F<v.length;){var H=v[F][w];B(O,H)<0&&A.push(v[F]),O[F]=H,F++}return A=A.sort(function(Le,Ve){return Le[w]>Ve[w]}),A}function Z(v,w){for(var x,A,O=w[0].toUpperCase()+w.slice(1),F=0;F<s.length;){if(x=s[F],A=x?x+O:w,A in v)return A;F++}return i}var bt=1;function Ri(){return bt++}function Rr(v){var w=v.ownerDocument||v;return w.defaultView||w.parentWindow||e}var D=/mobile|tablet|ip(ad|hone|od)|android/i,G="ontouchstart"in e,W=Z(e,"PointerEvent")!==i,ue=G&&D.test(navigator.userAgent),ae="touch",kr="pen",xt="mouse",ki="kinect",Jt=25,ye=1,er=2,ve=4,Ye=8,yo=1,Ni=2,Fi=4,Di=8,zi=16,Dt=Ni|Fi,tr=Di|zi,yd=Dt|tr,vd=["x","y"],vo=["clientX","clientY"];function dt(v,w){var x=this;this.manager=v,this.callback=w,this.element=v.element,this.target=v.options.inputTarget,this.domHandler=function(A){T(v.options.enable,[v])&&x.handler(A)},this.init()}dt.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(Rr(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&L(this.element,this.evEl,this.domHandler),this.evTarget&&L(this.target,this.evTarget,this.domHandler),this.evWin&&L(Rr(this.element),this.evWin,this.domHandler)}};function D1(v){var w,x=v.options.inputClass;return x?w=x:W?w=Xl:ue?w=wo:G?w=Yl:w=Eo,new w(v,z1)}function z1(v,w,x){var A=x.pointers.length,O=x.changedPointers.length,F=w&ye&&A-O===0,H=w&(ve|Ye)&&A-O===0;x.isFirst=!!F,x.isFinal=!!H,F&&(v.session={}),x.eventType=w,B1(v,x),v.emit("hammer.input",x),v.recognize(x),v.session.prevInput=x}function B1(v,w){var x=v.session,A=w.pointers,O=A.length;x.firstInput||(x.firstInput=_d(w)),O>1&&!x.firstMultiple?x.firstMultiple=_d(w):O===1&&(x.firstMultiple=!1);var F=x.firstInput,H=x.firstMultiple,xe=H?H.center:F.center,Le=w.center=Ed(A);w.timeStamp=c(),w.deltaTime=w.timeStamp-F.timeStamp,w.angle=Hl(xe,Le),w.distance=_o(xe,Le),U1(x,w),w.offsetDirection=Td(w.deltaX,w.deltaY);var Ve=wd(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=Ve.x,w.overallVelocityY=Ve.y,w.overallVelocity=u(Ve.x)>u(Ve.y)?Ve.x:Ve.y,w.scale=H?G1(H.pointers,A):1,w.rotation=H?j1(H.pointers,A):0,w.maxPointers=x.prevInput?w.pointers.length>x.prevInput.maxPointers?w.pointers.length:x.prevInput.maxPointers:w.pointers.length,V1(x,w);var Bt=v.element;C(w.srcEvent.target,Bt)&&(Bt=w.srcEvent.target),w.target=Bt}function U1(v,w){var x=w.center,A=v.offsetDelta||{},O=v.prevDelta||{},F=v.prevInput||{};(w.eventType===ye||F.eventType===ve)&&(O=v.prevDelta={x:F.deltaX||0,y:F.deltaY||0},A=v.offsetDelta={x:x.x,y:x.y}),w.deltaX=O.x+(x.x-A.x),w.deltaY=O.y+(x.y-A.y)}function V1(v,w){var x=v.lastInterval||w,A=w.timeStamp-x.timeStamp,O,F,H,xe;if(w.eventType!=Ye&&(A>Jt||x.velocity===i)){var Le=w.deltaX-x.deltaX,Ve=w.deltaY-x.deltaY,Bt=wd(A,Le,Ve);F=Bt.x,H=Bt.y,O=u(Bt.x)>u(Bt.y)?Bt.x:Bt.y,xe=Td(Le,Ve),v.lastInterval=w}else O=x.velocity,F=x.velocityX,H=x.velocityY,xe=x.direction;w.velocity=O,w.velocityX=F,w.velocityY=H,w.direction=xe}function _d(v){for(var w=[],x=0;x<v.pointers.length;)w[x]={clientX:l(v.pointers[x].clientX),clientY:l(v.pointers[x].clientY)},x++;return{timeStamp:c(),pointers:w,center:Ed(w),deltaX:v.deltaX,deltaY:v.deltaY}}function Ed(v){var w=v.length;if(w===1)return{x:l(v[0].clientX),y:l(v[0].clientY)};for(var x=0,A=0,O=0;O<w;)x+=v[O].clientX,A+=v[O].clientY,O++;return{x:l(x/w),y:l(A/w)}}function wd(v,w,x){return{x:w/v||0,y:x/v||0}}function Td(v,w){return v===w?yo:u(v)>=u(w)?v<0?Ni:Fi:w<0?Di:zi}function _o(v,w,x){x||(x=vd);var A=w[x[0]]-v[x[0]],O=w[x[1]]-v[x[1]];return Math.sqrt(A*A+O*O)}function Hl(v,w,x){x||(x=vd);var A=w[x[0]]-v[x[0]],O=w[x[1]]-v[x[1]];return Math.atan2(O,A)*180/Math.PI}function j1(v,w){return Hl(w[1],w[0],vo)+Hl(v[1],v[0],vo)}function G1(v,w){return _o(w[0],w[1],vo)/_o(v[0],v[1],vo)}var W1={mousedown:ye,mousemove:er,mouseup:ve},H1="mousedown",X1="mousemove mouseup";function Eo(){this.evEl=H1,this.evWin=X1,this.pressed=!1,dt.apply(this,arguments)}m(Eo,dt,{handler:function(w){var x=W1[w.type];x&ye&&w.button===0&&(this.pressed=!0),x&er&&w.which!==1&&(x=ve),this.pressed&&(x&ve&&(this.pressed=!1),this.callback(this.manager,x,{pointers:[w],changedPointers:[w],pointerType:xt,srcEvent:w}))}});var Y1={pointerdown:ye,pointermove:er,pointerup:ve,pointercancel:Ye,pointerout:Ye},$1={2:ae,3:kr,4:xt,5:ki},bd="pointerdown",xd="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(bd="MSPointerDown",xd="MSPointerMove MSPointerUp MSPointerCancel");function Xl(){this.evEl=bd,this.evWin=xd,dt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}m(Xl,dt,{handler:function(w){var x=this.store,A=!1,O=w.type.toLowerCase().replace("ms",""),F=Y1[O],H=$1[w.pointerType]||w.pointerType,xe=H==ae,Le=B(x,w.pointerId,"pointerId");F&ye&&(w.button===0||xe)?Le<0&&(x.push(w),Le=x.length-1):F&(ve|Ye)&&(A=!0),!(Le<0)&&(x[Le]=w,this.callback(this.manager,F,{pointers:x,changedPointers:[w],pointerType:H,srcEvent:w}),A&&x.splice(Le,1))}});var Z1={touchstart:ye,touchmove:er,touchend:ve,touchcancel:Ye},K1="touchstart",q1="touchstart touchmove touchend touchcancel";function Sd(){this.evTarget=K1,this.evWin=q1,this.started=!1,dt.apply(this,arguments)}m(Sd,dt,{handler:function(w){var x=Z1[w.type];if(x===ye&&(this.started=!0),!!this.started){var A=Q1.call(this,w,x);x&(ve|Ye)&&A[0].length-A[1].length===0&&(this.started=!1),this.callback(this.manager,x,{pointers:A[0],changedPointers:A[1],pointerType:ae,srcEvent:w})}}});function Q1(v,w){var x=V(v.touches),A=V(v.changedTouches);return w&(ve|Ye)&&(x=j(x.concat(A),"identifier")),[x,A]}var J1={touchstart:ye,touchmove:er,touchend:ve,touchcancel:Ye},eE="touchstart touchmove touchend touchcancel";function wo(){this.evTarget=eE,this.targetIds={},dt.apply(this,arguments)}m(wo,dt,{handler:function(w){var x=J1[w.type],A=tE.call(this,w,x);A&&this.callback(this.manager,x,{pointers:A[0],changedPointers:A[1],pointerType:ae,srcEvent:w})}});function tE(v,w){var x=V(v.touches),A=this.targetIds;if(w&(ye|er)&&x.length===1)return A[x[0].identifier]=!0,[x,x];var O,F,H=V(v.changedTouches),xe=[],Le=this.target;if(F=x.filter(function(Ve){return C(Ve.target,Le)}),w===ye)for(O=0;O<F.length;)A[F[O].identifier]=!0,O++;for(O=0;O<H.length;)A[H[O].identifier]&&xe.push(H[O]),w&(ve|Ye)&&delete A[H[O].identifier],O++;if(xe.length)return[j(F.concat(xe),"identifier"),xe]}var nE=2500,Pd=25;function Yl(){dt.apply(this,arguments);var v=_(this.handler,this);this.touch=new wo(this.manager,v),this.mouse=new Eo(this.manager,v),this.primaryTouch=null,this.lastTouches=[]}m(Yl,dt,{handler:function(w,x,A){var O=A.pointerType==ae,F=A.pointerType==xt;if(!(F&&A.sourceCapabilities&&A.sourceCapabilities.firesTouchEvents)){if(O)rE.call(this,x,A);else if(F&&iE.call(this,A))return;this.callback(w,x,A)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function rE(v,w){v&ye?(this.primaryTouch=w.changedPointers[0].identifier,Ad.call(this,w)):v&(ve|Ye)&&Ad.call(this,w)}function Ad(v){var w=v.changedPointers[0];if(w.identifier===this.primaryTouch){var x={x:w.clientX,y:w.clientY};this.lastTouches.push(x);var A=this.lastTouches,O=function(){var F=A.indexOf(x);F>-1&&A.splice(F,1)};setTimeout(O,nE)}}function iE(v){for(var w=v.srcEvent.clientX,x=v.srcEvent.clientY,A=0;A<this.lastTouches.length;A++){var O=this.lastTouches[A],F=Math.abs(w-O.x),H=Math.abs(x-O.y);if(F<=Pd&&H<=Pd)return!0}return!1}var Ld=Z(o.style,"touchAction"),Cd=Ld!==i,Id="compute",Md="auto",$l="manipulation",nr="none",Bi="pan-x",Ui="pan-y",To=oE();function Zl(v,w){this.manager=v,this.set(w)}Zl.prototype={set:function(v){v==Id&&(v=this.compute()),Cd&&this.manager.element.style&&To[v]&&(this.manager.element.style[Ld]=v),this.actions=v.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var v=[];return d(this.manager.recognizers,function(w){T(w.options.enable,[w])&&(v=v.concat(w.getTouchAction()))}),sE(v.join(" "))},preventDefaults:function(v){var w=v.srcEvent,x=v.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var A=this.actions,O=I(A,nr)&&!To[nr],F=I(A,Ui)&&!To[Ui],H=I(A,Bi)&&!To[Bi];if(O){var xe=v.pointers.length===1,Le=v.distance<2,Ve=v.deltaTime<250;if(xe&&Le&&Ve)return}if(!(H&&F)&&(O||F&&x&Dt||H&&x&tr))return this.preventSrc(w)},preventSrc:function(v){this.manager.session.prevented=!0,v.preventDefault()}};function sE(v){if(I(v,nr))return nr;var w=I(v,Bi),x=I(v,Ui);return w&&x?nr:w||x?w?Bi:Ui:I(v,$l)?$l:Md}function oE(){if(!Cd)return!1;var v={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(x){v[x]=w?e.CSS.supports("touch-action",x):!0}),v}var bo=1,gt=2,Nr=4,En=8,en=En,Vi=16,zt=32;function tn(v){this.options=E({},this.defaults,v||{}),this.id=Ri(),this.manager=null,this.options.enable=S(this.options.enable,!0),this.state=bo,this.simultaneous={},this.requireFail=[]}tn.prototype={defaults:{},set:function(v){return E(this.options,v),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(v){if(h(v,"recognizeWith",this))return this;var w=this.simultaneous;return v=xo(v,this),w[v.id]||(w[v.id]=v,v.recognizeWith(this)),this},dropRecognizeWith:function(v){return h(v,"dropRecognizeWith",this)?this:(v=xo(v,this),delete this.simultaneous[v.id],this)},requireFailure:function(v){if(h(v,"requireFailure",this))return this;var w=this.requireFail;return v=xo(v,this),B(w,v)===-1&&(w.push(v),v.requireFailure(this)),this},dropRequireFailure:function(v){if(h(v,"dropRequireFailure",this))return this;v=xo(v,this);var w=B(this.requireFail,v);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(v){return!!this.simultaneous[v.id]},emit:function(v){var w=this,x=this.state;function A(O){w.manager.emit(O,v)}x<En&&A(w.options.event+Od(x)),A(w.options.event),v.additionalEvent&&A(v.additionalEvent),x>=En&&A(w.options.event+Od(x))},tryEmit:function(v){if(this.canEmit())return this.emit(v);this.state=zt},canEmit:function(){for(var v=0;v<this.requireFail.length;){if(!(this.requireFail[v].state&(zt|bo)))return!1;v++}return!0},recognize:function(v){var w=E({},v);if(!T(this.options.enable,[this,w])){this.reset(),this.state=zt;return}this.state&(en|Vi|zt)&&(this.state=bo),this.state=this.process(w),this.state&(gt|Nr|En|Vi)&&this.tryEmit(w)},process:function(v){},getTouchAction:function(){},reset:function(){}};function Od(v){return v&Vi?"cancel":v&En?"end":v&Nr?"move":v&gt?"start":""}function Rd(v){return v==zi?"down":v==Di?"up":v==Ni?"left":v==Fi?"right":""}function xo(v,w){var x=w.manager;return x?x.get(v):v}function St(){tn.apply(this,arguments)}m(St,tn,{defaults:{pointers:1},attrTest:function(v){var w=this.options.pointers;return w===0||v.pointers.length===w},process:function(v){var w=this.state,x=v.eventType,A=w&(gt|Nr),O=this.attrTest(v);return A&&(x&Ye||!O)?w|Vi:A||O?x&ve?w|En:w&gt?w|Nr:gt:zt}});function So(){St.apply(this,arguments),this.pX=null,this.pY=null}m(So,St,{defaults:{event:"pan",threshold:10,pointers:1,direction:yd},getTouchAction:function(){var v=this.options.direction,w=[];return v&Dt&&w.push(Ui),v&tr&&w.push(Bi),w},directionTest:function(v){var w=this.options,x=!0,A=v.distance,O=v.direction,F=v.deltaX,H=v.deltaY;return O&w.direction||(w.direction&Dt?(O=F===0?yo:F<0?Ni:Fi,x=F!=this.pX,A=Math.abs(v.deltaX)):(O=H===0?yo:H<0?Di:zi,x=H!=this.pY,A=Math.abs(v.deltaY))),v.direction=O,x&&A>w.threshold&&O&w.direction},attrTest:function(v){return St.prototype.attrTest.call(this,v)&&(this.state&gt||!(this.state&gt)&&this.directionTest(v))},emit:function(v){this.pX=v.deltaX,this.pY=v.deltaY;var w=Rd(v.direction);w&&(v.additionalEvent=this.options.event+w),this._super.emit.call(this,v)}});function Kl(){St.apply(this,arguments)}m(Kl,St,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.scale-1)>this.options.threshold||this.state&gt)},emit:function(v){if(v.scale!==1){var w=v.scale<1?"in":"out";v.additionalEvent=this.options.event+w}this._super.emit.call(this,v)}});function ql(){tn.apply(this,arguments),this._timer=null,this._input=null}m(ql,tn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Md]},process:function(v){var w=this.options,x=v.pointers.length===w.pointers,A=v.distance<w.threshold,O=v.deltaTime>w.time;if(this._input=v,!A||!x||v.eventType&(ve|Ye)&&!O)this.reset();else if(v.eventType&ye)this.reset(),this._timer=f(function(){this.state=en,this.tryEmit()},w.time,this);else if(v.eventType&ve)return en;return zt},reset:function(){clearTimeout(this._timer)},emit:function(v){this.state===en&&(v&&v.eventType&ve?this.manager.emit(this.options.event+"up",v):(this._input.timeStamp=c(),this.manager.emit(this.options.event,this._input)))}});function Ql(){St.apply(this,arguments)}m(Ql,St,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[nr]},attrTest:function(v){return this._super.attrTest.call(this,v)&&(Math.abs(v.rotation)>this.options.threshold||this.state&gt)}});function Jl(){St.apply(this,arguments)}m(Jl,St,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Dt|tr,pointers:1},getTouchAction:function(){return So.prototype.getTouchAction.call(this)},attrTest:function(v){var w=this.options.direction,x;return w&(Dt|tr)?x=v.overallVelocity:w&Dt?x=v.overallVelocityX:w&tr&&(x=v.overallVelocityY),this._super.attrTest.call(this,v)&&w&v.offsetDirection&&v.distance>this.options.threshold&&v.maxPointers==this.options.pointers&&u(x)>this.options.velocity&&v.eventType&ve},emit:function(v){var w=Rd(v.offsetDirection);w&&this.manager.emit(this.options.event+w,v),this.manager.emit(this.options.event,v)}});function Po(){tn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}m(Po,tn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[$l]},process:function(v){var w=this.options,x=v.pointers.length===w.pointers,A=v.distance<w.threshold,O=v.deltaTime<w.time;if(this.reset(),v.eventType&ye&&this.count===0)return this.failTimeout();if(A&&O&&x){if(v.eventType!=ve)return this.failTimeout();var F=this.pTime?v.timeStamp-this.pTime<w.interval:!0,H=!this.pCenter||_o(this.pCenter,v.center)<w.posThreshold;this.pTime=v.timeStamp,this.pCenter=v.center,!H||!F?this.count=1:this.count+=1,this._input=v;var xe=this.count%w.taps;if(xe===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=en,this.tryEmit()},w.interval,this),gt):en}return zt},failTimeout:function(){return this._timer=f(function(){this.state=zt},this.options.interval,this),zt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==en&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function wn(v,w){return w=w||{},w.recognizers=S(w.recognizers,wn.defaults.preset),new eu(v,w)}wn.VERSION="2.0.7",wn.defaults={domEvents:!1,touchAction:Id,enable:!0,inputTarget:null,inputClass:null,preset:[[Ql,{enable:!1}],[Kl,{enable:!1},["rotate"]],[Jl,{direction:Dt}],[So,{direction:Dt},["swipe"]],[Po],[Po,{event:"doubletap",taps:2},["tap"]],[ql]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var aE=1,kd=2;function eu(v,w){this.options=E({},wn.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||v,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=v,this.input=D1(this),this.touchAction=new Zl(this,this.options.touchAction),Nd(this,!0),d(this.options.recognizers,function(x){var A=this.add(new x[0](x[1]));x[2]&&A.recognizeWith(x[2]),x[3]&&A.requireFailure(x[3])},this)}eu.prototype={set:function(v){return E(this.options,v),v.touchAction&&this.touchAction.update(),v.inputTarget&&(this.input.destroy(),this.input.target=v.inputTarget,this.input.init()),this},stop:function(v){this.session.stopped=v?kd:aE},recognize:function(v){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(v);var x,A=this.recognizers,O=w.curRecognizer;(!O||O&&O.state&en)&&(O=w.curRecognizer=null);for(var F=0;F<A.length;)x=A[F],w.stopped!==kd&&(!O||x==O||x.canRecognizeWith(O))?x.recognize(v):x.reset(),!O&&x.state&(gt|Nr|En)&&(O=w.curRecognizer=x),F++}},get:function(v){if(v instanceof tn)return v;for(var w=this.recognizers,x=0;x<w.length;x++)if(w[x].options.event==v)return w[x];return null},add:function(v){if(h(v,"add",this))return this;var w=this.get(v.options.event);return w&&this.remove(w),this.recognizers.push(v),v.manager=this,this.touchAction.update(),v},remove:function(v){if(h(v,"remove",this))return this;if(v=this.get(v),v){var w=this.recognizers,x=B(w,v);x!==-1&&(w.splice(x,1),this.touchAction.update())}return this},on:function(v,w){if(v!==i&&w!==i){var x=this.handlers;return d(M(v),function(A){x[A]=x[A]||[],x[A].push(w)}),this}},off:function(v,w){if(v!==i){var x=this.handlers;return d(M(v),function(A){w?x[A]&&x[A].splice(B(x[A],w),1):delete x[A]}),this}},emit:function(v,w){this.options.domEvents&&lE(v,w);var x=this.handlers[v]&&this.handlers[v].slice();if(!(!x||!x.length)){w.type=v,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var A=0;A<x.length;)x[A](w),A++}},destroy:function(){this.element&&Nd(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Nd(v,w){var x=v.element;if(x.style){var A;d(v.options.cssProps,function(O,F){A=Z(x.style,F),w?(v.oldCssProps[A]=x.style[A],x.style[A]=O):x.style[A]=v.oldCssProps[A]||""}),w||(v.oldCssProps={})}}function lE(v,w){var x=n.createEvent("Event");x.initEvent(v,!0,!0),x.gesture=w,w.target.dispatchEvent(x)}E(wn,{INPUT_START:ye,INPUT_MOVE:er,INPUT_END:ve,INPUT_CANCEL:Ye,STATE_POSSIBLE:bo,STATE_BEGAN:gt,STATE_CHANGED:Nr,STATE_ENDED:En,STATE_RECOGNIZED:en,STATE_CANCELLED:Vi,STATE_FAILED:zt,DIRECTION_NONE:yo,DIRECTION_LEFT:Ni,DIRECTION_RIGHT:Fi,DIRECTION_UP:Di,DIRECTION_DOWN:zi,DIRECTION_HORIZONTAL:Dt,DIRECTION_VERTICAL:tr,DIRECTION_ALL:yd,Manager:eu,Input:dt,TouchAction:Zl,TouchInput:wo,MouseInput:Eo,PointerEventInput:Xl,TouchMouseInput:Yl,SingleTouchInput:Sd,Recognizer:tn,AttrRecognizer:St,Tap:Po,Pan:So,Swipe:Jl,Pinch:Kl,Rotate:Ql,Press:ql,on:P,off:L,each:d,merge:y,extend:b,assign:E,inherit:m,bindFn:_,prefixed:Z});var uE=typeof e<"u"?e:typeof self<"u"?self:{};uE.Hammer=wn,t.exports?t.exports=wn:e[r]=wn})(window,document,"Hammer")})(r1);var mo=r1.exports;const zI=_l(mo),jt=cE({__proto__:null,default:zI},[mo]),i1=1,s1=2,bf=4,BI={mousedown:i1,mousemove:s1,mouseup:bf};function UI(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function VI(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(UI(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function jI(t){t.prototype.handler=function(n){let r=BI[n.type];r&i1&&n.button>=0&&(this.pressed=!0),r&s1&&n.buttons===0&&(r=bf),this.pressed&&(r&bf&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}VI(mo.PointerEventInput);jI(mo.MouseInput);const GI=mo.Manager;class Bl{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const WI=jt?[[jt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[jt.Rotate,{enable:!1}],[jt.Pinch,{enable:!1}],[jt.Swipe,{enable:!1}],[jt.Pan,{threshold:0,enable:!1}],[jt.Press,{enable:!1}],[jt.Tap,{event:"doubletap",taps:2,enable:!1}],[jt.Tap,{event:"anytap",enable:!1}],[jt.Tap,{enable:!1}]]:null,ym={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},HI={doubletap:["tap"]},XI={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},nd={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},YI={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},vm={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},$I=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",ri=typeof window<"u"?window:global;let xf=!1;try{const t={get passive(){return xf=!0,!0}};ri.addEventListener("test",null,t),ri.removeEventListener("test",null)}catch{xf=!1}const ZI=$I.indexOf("firefox")!==-1,{WHEEL_EVENTS:KI}=nd,_m="wheel",Em=4.000244140625,qI=40,QI=.25;class JI extends Bl{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;ri.WheelEvent&&(ZI&&i.deltaMode===ri.WheelEvent.DOM_DELTA_PIXEL&&(s/=ri.devicePixelRatio),i.deltaMode===ri.WheelEvent.DOM_DELTA_LINE&&(s*=qI)),s!==0&&s%Em===0&&(s=Math.floor(s/Em)),i.shiftKey&&s&&(s=s*QI),this.callback({type:_m,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(KI),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,xf?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===_m&&(this.options.enable=n)}}const{MOUSE_EVENTS:eM}=nd,wm="pointermove",Tm="pointerover",bm="pointerout",xm="pointerenter",Sm="pointerleave";class tM extends Bl{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(eM),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===wm&&(this.enableMoveEvent=n),e===Tm&&(this.enableOverEvent=n),e===bm&&(this.enableOutEvent=n),e===xm&&(this.enableEnterEvent=n),e===Sm&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(Tm,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(bm,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(xm,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Sm,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(wm,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:nM}=nd,Pm="keydown",Am="keyup";class rM extends Bl{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:Pm,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:Am,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(nM),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Pm&&(this.enableDownEvent=n),e===Am&&(this.enableUpEvent=n)}}const Lm="contextmenu";class iM extends Bl{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:Lm,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Lm&&(this.options.enable=n)}}const Cm=1,Sf=2,Im=4,sM={pointerdown:Cm,pointermove:Sf,pointerup:Im,mousedown:Cm,mousemove:Sf,mouseup:Im},oM=0,aM=1,lM=2,uM=1,cM=2,fM=4;function hM(t){const e=sM[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===Sf?(i=!!(n&uM),s=!!(n&fM),o=!!(n&cM)):(i=r===oM,s=r===aM,o=r===lM),{leftButton:i,middleButton:s,rightButton:o}}function dM(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const ec={srcElement:"root",priority:0};class gM{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=ec;typeof r=="string"||r&&r.addEventListener?l={...ec,srcElement:r}:r&&(l={...ec,...r});let u=a.get(l.srcElement);u||(u=[],a.set(l.srcElement,u));const c={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(c.once=!0),s&&(c.passive=!0),o.push(c),this._active=this._active||!c.passive;let f=u.length-1;for(;f>=0&&!(u[f].priority>=c.priority);)f--;u.splice(f+1,0,c)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:u,handler:c,once:f}=r[l];if(c({...e,type:u,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:u,handler:c}=a[l];this.remove(u,c)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...hM(e),...dM(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const pM={events:null,recognizers:null,recognizerOptions:{},Manager:GI,touchAction:"none",tabIndex:0};class mM{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=XI[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...pM,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||WI}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(ym).forEach(i=>{const s=this.manager.get(i);s&&ym[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new JI(e,this._onOtherEvent,{enable:!1}),this.moveInput=new tM(e,this._onOtherEvent,{enable:!1}),this.keyInput=new rM(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new iM(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=HI[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const c in e)this._addEventHandler(c,e[c],r,i,s);return}const{manager:o,events:a}=this,l=vm[e]||e;let u=a.get(l);u||(u=new gM(this),a.set(l,u),u.recognizerName=YI[l]||l,o&&o.on(l,u.handleEvent)),u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=vm[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function sr(){}const yM=({isDragging:t})=>t?"grabbing":"grab",o1={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,glOptions:{},parameters:{},parent:null,gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,onWebGLInitialized:sr,onResize:sr,onViewStateChange:sr,onInteractionStateChange:sr,onBeforeRender:sr,onAfterRender:sr,onLoad:sr,onError:t=>X.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:yM,getTooltip:null,debug:!1,drawPickingColors:!1};class rd{constructor(e){g(this,"props",void 0),g(this,"width",0),g(this,"height",0),g(this,"userData",{}),g(this,"canvas",null),g(this,"viewManager",null),g(this,"layerManager",null),g(this,"effectManager",null),g(this,"deckRenderer",null),g(this,"deckPicker",null),g(this,"eventManager",null),g(this,"tooltip",null),g(this,"metrics",void 0),g(this,"animationLoop",void 0),g(this,"stats",void 0),g(this,"viewState",void 0),g(this,"cursorState",void 0),g(this,"_needsRedraw",void 0),g(this,"_pickRequest",void 0),g(this,"_lastPointerDownInfo",null),g(this,"_metricsCounter",void 0),g(this,"_onPointerMove",n=>{const{_pickRequest:r}=this;if(n.type==="pointerleave")r.x=-1,r.y=-1,r.radius=0;else{if(n.leftButton||n.rightButton)return;{const i=n.offsetCenter;if(!i)return;r.x=i.x,r.y=i.y,r.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:r.x,y:r.y}),r.event=n}),g(this,"_onEvent",n=>{const r=dp[n.type],i=n.offsetCenter;if(!r||!i||!this.layerManager)return;const s=this.layerManager.getLayers(),o=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:s,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:a}=o,l=a&&(a[r.handler]||a.props[r.handler]),u=this.props[r.handler];let c=!1;l&&(c=l.call(a,o,n)),!c&&u&&u(o,n)}),g(this,"_onPointerDown",n=>{const r=n.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:r.x,y:r.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo}),this.props={...o1,...e},e=this.props,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this.cursorState={isHovering:!1,isDragging:!1},e.viewState&&e.initialViewState&&X.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),Uv()==="IE"&&X.warn("IE 11 is not supported")(),this.viewState=e.initialViewState,e.gl||typeof document<"u"&&(this.canvas=this._createCanvas(e)),this.animationLoop=this._createAnimationLoop(e),this.stats=new Rh({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this.setProps(e),e._typedArrayManagerProps&&Ai.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l;if((e=this.animationLoop)===null||e===void 0||e.stop(),this.animationLoop=null,this._lastPointerDownInfo=null,(n=this.layerManager)===null||n===void 0||n.finalize(),this.layerManager=null,(r=this.viewManager)===null||r===void 0||r.finalize(),this.viewManager=null,(i=this.effectManager)===null||i===void 0||i.finalize(),this.effectManager=null,(s=this.deckRenderer)===null||s===void 0||s.finalize(),this.deckRenderer=null,(o=this.deckPicker)===null||o===void 0||o.finalize(),this.deckPicker=null,(a=this.eventManager)===null||a===void 0||a.destroy(),this.eventManager=null,(l=this.tooltip)===null||l===void 0||l.remove(),this.tooltip=null,!this.props.canvas&&!this.props.gl&&this.canvas){var u;(u=this.canvas.parentElement)===null||u===void 0||u.removeChild(this.canvas),this.canvas=null}}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&X.removed("onLayerHover","onHover")(),"onLayerClick"in e&&X.removed("onLayerClick","onClick")(),e.initialViewState&&!$t(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Pe(this.viewManager),this.viewManager.views}getViewports(e){return Pe(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_pick(e,n,r){Pe(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Pe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?"".concat(n,"px"):n;this.canvas.style.width=s}if(r||r===0){var i;const s=Number.isFinite(r)?"".concat(r,"px"):r;this.canvas.style.position=((i=e.style)===null||i===void 0?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var e,n;const{canvas:r}=this;if(!r)return;const i=(e=r.clientWidth)!==null&&e!==void 0?e:r.width,s=(n=r.clientHeight)!==null&&n!==void 0?n:r.height;if(i!==this.width||s!==this.height){var o,a;this.width=i,this.height=s,(o=this.viewManager)===null||o===void 0||o.setProps({width:i,height:s}),(a=this.layerManager)===null||a===void 0||a.activateViewport(this.getViewports()[0]),this.props.onResize({width:i,height:s})}}_createAnimationLoop(e){const{width:n,height:r,gl:i,glOptions:s,debug:o,onError:a,onBeforeRender:l,onAfterRender:u,useDevicePixels:c}=e;return new TL({width:n,height:r,useDevicePixels:c,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,gl:i,onCreateContext:f=>o_({...s,...f,canvas:this.canvas,debug:o,onContextLost:()=>this._onContextLost()}),onInitialize:f=>this._setGLContext(f.gl),onRender:this._onRenderFrame.bind(this),onBeforeRender:l,onAfterRender:u,onError:a})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let e=this.props.views||[new e1({id:"default-view"})];return e=Array.isArray(e)?e:[e],e.length&&this.props.controller&&(e[0].props.controller=this.props.controller),e}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){const{_pickRequest:e}=this;if(e.event){const{result:r,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=r.length>0;let s=i,o=!1;for(const a of r){var n;s=a,o=((n=a.layer)===null||n===void 0?void 0:n.onHover(a,e.event))||o}if(!o&&this.props.onHover&&this.props.onHover(s,e.event),this.props.getTooltip&&this.tooltip){const a=this.props.getTooltip(s);this.tooltip.setTooltip(a,s.x,s.y)}e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setGLContext(e){if(this.layerManager)return;this.canvas||(this.canvas=e.canvas,jh(e,{enable:!0,copyState:!0})),this.tooltip=new DI(this.canvas),qt(e,{blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onWebGLInitialized(e);const n=new B_;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new mM(this.props.parent||e.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in dp)this.eventManager.on(i,this._onEvent);this.viewManager=new uI({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new lI(e,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new PI,this.deckRenderer=new CI(e),this.deckPicker=new NI(e),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){const{gl:r}=this.layerManager.context;qt(r,this.props.parameters),this.props.onBeforeRender({gl:r}),this.deckRenderer.renderLayers({target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n}),this.props.onAfterRender({gl:r})}_onRenderFrame(e){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),X.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.tooltip.isVisible&&this.viewManager.needsRedraw()&&this.tooltip.setTooltip(null),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=hr.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}g(rd,"defaultProps",o1);g(rd,"VERSION",LS);class tc{constructor(e,n){g(this,"opts",void 0),g(this,"source",void 0),this.opts=n,this.source=e}get value(){return this.source.value}getValue(){const e=this.source.getBuffer(),n=this.getAccessor();if(e)return[e,n];const{value:r}=this.source,{size:i}=n;let s=r;if(r&&r.length!==i){s=new Float32Array(i);const o=n.elementOffset||0;for(let a=0;a<i;++a)s[a]=r[o+a]}return s}getAccessor(){return{...this.source.getAccessor(),...this.opts}}}function vM(t){switch(t){case 5126:return Float32Array;case 5130:return Float64Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return Uint8ClampedArray;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Unknown GL type")}}function Aa(t){return t.stride||t.size*t.bytesPerElement}function a1(t,e){e.offset&&X.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=Aa(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function _M(t,e){const n=a1(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class EM{constructor(e,n,r){g(this,"gl",void 0),g(this,"id",void 0),g(this,"size",void 0),g(this,"settings",void 0),g(this,"value",void 0),g(this,"doublePrecision",void 0),g(this,"_buffer",void 0),g(this,"state",void 0),this.gl=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i===5130;let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a=5126:!i&&n.isIndexed?a=e&&QP(e,se.ELEMENT_INDEX_UINT32)?5125:5123:a=i||5126;let l=vM(i||a||5126);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1},this._buffer=null}get isConstant(){return this.state.constant}get buffer(){if(!this._buffer){const{isIndexed:e,type:n}=this.settings;this._buffer=new J(this.gl,{id:this.id,target:e?34963:34962,accessor:{type:n}})}return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*Aa(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ai.release(this.state.allocatedValue)}getShaderAttributes(e,n){if(this.doublePrecision){const r={},i=this.value instanceof Float64Array,s=_M(this.getAccessor(),n||{});return r[e]=new tc(this,s.high),r["".concat(e,"64Low")]=i?new tc(this,s.low):new Float32Array(this.size),r}if(n){const r=a1(this.getAccessor(),n);return{[e]:new tc(this,r)}}return{[e]:this}}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(){return this.state.constant?this.value:[this.getBuffer(),this.getAccessor()]}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let u=0;u<i;u++){const c=n[l++];c<o[u]&&(o[u]=c),c>a[u]&&(a[u]=c)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof J?r={buffer:e}:r=e;const i={...this.settings,...r};if(n.bufferAccessor=i,n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=s}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null;const o=r.value instanceof Float64Array;i.type=r.type||s.accessor.type,i.bytesPerElement=s.accessor.BYTES_PER_ELEMENT*(o?2:1),i.stride=Aa(i)}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s,i.bytesPerElement=s.BYTES_PER_ELEMENT,i.stride=Aa(i);const{buffer:o,byteOffset:a}=this;this.doublePrecision&&s instanceof Float64Array&&(s=qu(s,i));const l=s.byteLength+a+i.stride*2;o.byteLength<l&&o.reallocate(l),o.setAccessor(null),o.subData({data:s,offset:a}),i.type=r.type||o.accessor.type}return!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.subData({data:this.doublePrecision&&n instanceof Float64Array?qu(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),offset:r*n.BYTES_PER_ELEMENT+this.byteOffset})}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Ai.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{buffer:o,byteOffset:a}=this;return o.byteLength<s.byteLength+a&&(o.reallocate(s.byteLength+a),n&&i&&o.subData({data:i instanceof Float64Array?qu(i,this):i,offset:a})),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,r.bufferAccessor=this.settings,!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error("Attribute ".concat(this.id," value is not TypedArray"));const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error("Attribute ".concat(this.id," does not support ").concat(n.constructor.name));!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&X.warn("Attribute ".concat(this.id," is normalized"))()}normalizeConstant(e){switch(this.settings.type){case 5120:return new Float32Array(e).map(n=>(n+128)/255*2-1);case 5122:return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case 5121:return new Float32Array(e).map(n=>n/255);case 5123:return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}}const Mm=[],Om=[];function Ul(t,e=0,n=1/0){let r=Mm;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(Om.length=t.length,r=Om):r=Mm,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function l1(t){return t&&t[Symbol.asyncIterator]}function u1(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,u=i?i/a:0,c=Math.floor((t.length-u)/l);return(f,{index:h,target:d})=>{if(!s){const y=h*l+u;for(let m=0;m<n;m++)d[m]=t[y+m];return d}const p=s[h],E=s[h+1]||c;let b;if(o){b=new Array(E-p);for(let y=p;y<E;y++){const m=y*l+u;d=new Array(n);for(let _=0;_<n;_++)d[_]=t[m+_];b[y-p]=d}}else if(l===n)b=t.subarray(p*n+u,E*n+u);else{b=new t.constructor((E-p)*n);let y=0;for(let m=p;m<E;m++){const _=m*l+u;for(let T=0;T<n;T++)b[y++]=t[_+T]}}return b}}const wM=[],La=[[0,1/0]];function TM(t,e){if(t===La||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}function nc(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let u=a;for(;u<l;){const c=s(u,e);for(let f=0;f<i;f++)n[r+u]=c[f]||0,u++}}function bM({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!Array.isArray(s))return nc({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((c,f)=>r(c+a,f)),u=Math.min(i.length,s.length);for(let c=1;c<u;c++){const f=i[c]*n,h=s[c]*n;nc({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&nc({source:[],target:e,start:a,size:n,getData:l}),e}const xM={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function c1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...xM[n],...e,...t,type:n}}function f1(t,e){const n=e.getBuffer();return n?[n,{divisor:0,size:e.size,normalized:e.settings.normalized}]:e.value}function h1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error('No defined attribute type for size "'.concat(t,'"'))}}function d1(t){t.push(t.shift())}function id(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;return(r.noAlloc?i.length:e*s)*o}function g1({buffer:t,numInstances:e,attribute:n,fromLength:r,fromStartIndices:i,getData:s=o=>o}){const o=n.doublePrecision&&n.value instanceof Float64Array?2:1,a=n.size*o,l=n.byteOffset,u=n.startIndices,c=i&&u,f=id(n,e),h=n.isConstant;if(!c&&r>=f)return;const d=h?n.value:n.getBuffer().getData({srcByteOffset:l});if(n.settings.normalized&&!h){const y=s;s=(m,_)=>n.normalizeConstant(y(m,_))}const p=h?(y,m)=>s(d,m):(y,m)=>s(d.subarray(y,y+a),m),E=t.getData({length:r}),b=new Float32Array(f);bM({source:E,target:b,sourceStartIndices:i,targetStartIndices:u,size:a,getData:p}),t.byteLength<b.byteLength+l&&t.reallocate(b.byteLength+l),t.subData({data:b,offset:l})}class sd extends EM{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,updateRanges:La}),g(this,"constant",!1),this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return c1(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=TM(this.state.updateRanges,[r,i])}else this.state.updateRanges=La}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=wM}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==La),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[u,c]of s)o.call(i,this,{data:n,startRow:u,endRow:c,props:r,numInstances:e});if(this.value)if(this.constant||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[u,c]of s){const f=Number.isFinite(u)?this.getVertexOffset(u):0,h=Number.isFinite(c)?this.getVertexOffset(c):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Pe(ArrayBuffer.isView(o.value),"invalid ".concat(i.accessor));const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=u1(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getShaderAttributes(){const e=this.settings.shaderAttributes||{[this.id]:null},n={};for(const r in e)Object.assign(n,super.getShaderAttributes(r,e[r]));return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:u,size:c,startIndices:f}=e,{accessor:h,transform:d}=a,p=l.binaryAccessor||(typeof h=="function"?h:s[h]);Pe(typeof p=="function",'accessor "'.concat(h,'" is not a function'));let E=e.getVertexOffset(r);const{iterable:b,objectInfo:y}=Ul(n,r,i);for(const m of b){y.index++;let _=p(m,y);if(d&&(_=d.call(this,_)),f){const T=(y.index<f.length-1?f[y.index+1]:o)-f[y.index];if(_&&Array.isArray(_[0])){let S=E;for(const P of _)e._normalizeValue(P,u,S),S+=c}else _&&_.length>c?u.set(_,E):(e._normalizeValue(_,y.target,0),J3({target:u,source:y.target,start:E,count:T}));E+=T*c}else e._normalizeValue(_,u,E),E+=c}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error("Attribute ".concat(this.id," missing update or accessor"))}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error("Illegal attribute generated for ".concat(this.id))}}}class SM{constructor({gl:e,attribute:n,timeline:r}){g(this,"gl",void 0),g(this,"type","interpolation"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.transition=new po(r),this.attribute=n,this.attributeInTransition=new sd(e,n.settings),this.currentStartIndices=n.startIndices,this.currentLength=0,this.transform=AM(e,n);const i={byteLength:0,usage:35050};this.buffers=[new J(e,i),new J(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){if(e.duration<=0){this.transition.cancel();return}this.settings=e;const{gl:r,buffers:i,attribute:s}=this;d1(i);const o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)g1({buffer:a,...o});this.currentStartIndices=s.startIndices,this.currentLength=id(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start(e),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aFrom:i[0],aTo:f1(r,s)},feedbackBuffers:{vCurrent:i[1]}})}update(){const e=this.transition.update();if(e){const{duration:n,easing:r}=this.settings,{time:i}=this.transition;let s=i/n;r&&(s=r(s)),this.transform.run({uniforms:{time:s}})}return e}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0}}const PM=`
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
attribute ATTRIBUTE_TYPE aFrom;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function AM(t,e){const n=h1(e.size);return new Kh(t,{vs:PM,defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class LM{constructor({gl:e,attribute:n,timeline:r}){g(this,"gl",void 0),g(this,"type","spring"),g(this,"attributeInTransition",void 0),g(this,"settings",void 0),g(this,"attribute",void 0),g(this,"transition",void 0),g(this,"currentStartIndices",void 0),g(this,"currentLength",void 0),g(this,"texture",void 0),g(this,"framebuffer",void 0),g(this,"transform",void 0),g(this,"buffers",void 0),this.gl=e,this.type="spring",this.transition=new po(r),this.attribute=n,this.attributeInTransition=new sd(e,{...n.settings,normalized:!1}),this.currentStartIndices=n.startIndices,this.currentLength=0,this.texture=IM(e),this.framebuffer=MM(e,this.texture),this.transform=CM(e,n,this.framebuffer);const i={byteLength:0,usage:35050};this.buffers=[new J(e,i),new J(e,i),new J(e,i)]}get inProgress(){return this.transition.inProgress}start(e,n){const{gl:r,buffers:i,attribute:s}=this,o={numInstances:n,attribute:s,fromLength:this.currentLength,fromStartIndices:this.currentStartIndices,getData:e.enter};for(const a of i)g1({buffer:a,...o});this.settings=e,this.currentStartIndices=s.startIndices,this.currentLength=id(s,n),this.attributeInTransition.setData({buffer:i[1],value:s.value}),this.transition.start({...e,duration:1/0}),this.transform.update({elementCount:Math.floor(this.currentLength/s.size),sourceBuffers:{aTo:f1(r,s)}})}update(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this;if(!i.update())return!1;const o=this.settings;return n.update({sourceBuffers:{aPrev:e[0],aCur:e[1]},feedbackBuffers:{vNext:e[2]}}),n.run({framebuffer:r,discard:!1,clearRenderTarget:!0,uniforms:{stiffness:o.stiffness,damping:o.damping},parameters:{depthTest:!1,blend:!0,viewport:[0,0,1,1],blendFunc:[1,1],blendEquation:[32776,32776]}}),d1(e),this.attributeInTransition.setData({buffer:e[1],value:this.attribute.value}),zl(r)[0]>0||i.end(),!0}cancel(){this.transition.cancel(),this.transform.delete();for(const e of this.buffers)e.delete();this.buffers.length=0,this.texture.delete(),this.framebuffer.delete()}}function CM(t,e,n){const r=h1(e.size);return new Kh(t,{framebuffer:n,vs:`
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
attribute ATTRIBUTE_TYPE aPrev;
attribute ATTRIBUTE_TYPE aCur;
attribute ATTRIBUTE_TYPE aTo;
varying ATTRIBUTE_TYPE vNext;
varying float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,fs:`
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

varying float vIsTransitioningFlag;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  gl_FragColor = vec4(1.0);
}`,defines:{ATTRIBUTE_TYPE:r},varyings:["vNext"]})}function IM(t){return new ct(t,{data:new Uint8Array(4),format:6408,type:5121,border:0,mipmaps:!1,dataFormat:6408,width:1,height:1})}function MM(t,e){return new be(t,{id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,attachments:{36064:e}})}const OM={interpolation:SM,spring:LM};class RM{constructor(e,{id:n,timeline:r}){g(this,"id",void 0),g(this,"isSupported",void 0),g(this,"gl",void 0),g(this,"timeline",void 0),g(this,"transitions",void 0),g(this,"needsRedraw",void 0),g(this,"numInstances",void 0),this.id=n,this.gl=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1,this.isSupported=Kh.isSupported(e)}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(!this.isSupported||this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].cancel(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){if(!this.isSupported){X.warn("WebGL2 not supported by this browser. Transition for ".concat(e," is disabled."))();return}i&&this._removeTransition(e);const o=OM[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,gl:this.gl}):(X.error("unsupported transition type '".concat(r.type,"'"))(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const Rm="attributeManager.invalidate",kM="attributeManager.updateStart",NM="attributeManager.updateEnd",FM="attribute.updateStart",DM="attribute.allocate",zM="attribute.updateEnd";class BM{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){g(this,"id",void 0),g(this,"gl",void 0),g(this,"attributes",void 0),g(this,"updateTriggers",void 0),g(this,"needsRedraw",void 0),g(this,"userData",void 0),g(this,"stats",void 0),g(this,"attributeTransitionManager",void 0),g(this,"mergeBoundsMemoized",fo(W3)),this.id=n,this.gl=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new RM(e,{id:"".concat(n,"-transitions"),timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);De(Rm,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);De(Rm,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;De(kM,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const u in this.attributes){const c=this.attributes[u],f=c.settings.accessor;c.startIndices=r,c.numInstances=n,s[u]&&X.removed("props.".concat(u),"data.attributes.".concat(u))(),c.setExternalBuffer(o[u])||c.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&c.setConstantValue(s[f])||c.needsUpdate()&&(l=!0,this._updateAttribute({attribute:c,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||c.needsRedraw()}l&&De(NM,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return this.attributes}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])===null||i===void 0?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getShaderAttributes(e,n={}){e||(e=this.getAttributes());const r={};for(const i in e)n[i]||Object.assign(r,e[i].getShaderAttributes());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new sd(this.gl,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(De(FM,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&De(DM,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,De(zM,n,r))}}class UM extends po{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=ul(n,r,o)}}const km=1e-5;function Nm(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function VM(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Nm(t[o],e[o],n[o],r,i);return s}return Nm(t,e,n,r,i)}function Fm(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class jM extends po{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=VM(s,o,n,r,i);const l=Fm(a,n),u=Fm(a,o);l<km&&u<km&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const GM={interpolation:UM,spring:jM};class WM{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:u=l.settings.fromValue}=l;n=u,this.remove(e)}if(i=c1(i),!i)return;const o=GM[i.type];if(!o){X.error("unsupported transition type '".concat(i.type,"'"))();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function HM(t){const e=t[Xn];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error("Invalid prop ".concat(n,": ").concat(t[n]))}}function XM(t,e){const n=p1({newProps:t,oldProps:e,propTypes:t[Xn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=$M(t,e);let i=!1;return r||(i=ZM(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:KM(t,e),transitionsChanged:YM(t,e)}}function YM(t,e){if(!t.transitions)return!1;const n={},r=t[Xn];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&Pf(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function p1({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return"".concat(i," changed shallowly");for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return"".concat(i,".").concat(s," added");const o=Pf(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return"".concat(i,".").concat(s," dropped");if(!Object.hasOwnProperty.call(t,s)){const o=Pf(t[s],e[s],r[s]);if(o)return"".concat(i,".").concat(s," ").concat(o)}}return!1}function Pf(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function $M(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function ZM(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Dm(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&Dm(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function KM(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function Dm(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},p1({oldProps:i,newProps:r,triggerName:n})}const qM="count(): argument not an object",QM="count(): argument not a container";function JM(t){if(!tO(t))throw new Error(qM);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(eO(t))return Object.keys(t).length;throw new Error(QM)}function eO(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function tO(t){return t!==null&&typeof t=="object"}function nO(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const rO={10241:9987,10240:9729,10242:33071,10243:33071},Af={};function iO(t,e,n,r){if(n instanceof ct)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={10241:n.data.length>1?9985:9729});const s=new ct(e,{...n,parameters:{...rO,...i,...r}});return Af[s.id]=t,s}function sO(t,e){!e||!(e instanceof ct)||Af[e.id]===t&&(e.delete(),delete Af[e.id])}const oO={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||Lf(t)&&(t.length===3||t.length===4)},equal(t,e,n){return $t(t,e,1)}},accessor:{validate(t,e){const n=ml(t);return n==="function"||n===ml(e.value)},equal(t,e,n){return typeof e=="function"?!0:$t(t,e,1)}},array:{validate(t,e){return e.optional&&!t||Lf(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?$t(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?$t(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{const{dataTransform:r}=n.props;return r&&t?r(t):t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.gl?null:iO(n.id,r.gl,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{sO(n.id,t)}}};function aO(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=lO(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function lO(t,e){switch(ml(e)){case"object":return ts(t,e);case"array":return ts(t,{type:"array",value:e,compare:!1});case"boolean":return ts(t,{type:"boolean",value:e});case"number":return ts(t,{type:"number",value:e});case"function":return ts(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ts(t,e){return"type"in e?{name:t,...oO[e.type],...e}:"value"in e?{name:t,type:ml(e.value),...e}:{name:t,type:"object",value:e}}function Lf(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function ml(t){return Lf(t)?"array":t===null?"null":typeof t}function uO(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=Cf(t.constructor,n),i=Object.create(r);i[pl]=t,i[Pr]={},i[Nn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const cO="_mergedDefaultProps";function Cf(t,e){let n=cO;if(e)for(const i of e){const s=i.constructor;s&&(n+=":".concat(s.extensionName||s.name))}const r=m1(t,n);return r||(t[n]=fO(t,e||[]))}function fO(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=Cf(r),s=m1(t,"defaultProps")||{},o=aO(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[Xn],o.propTypes),u=Object.assign(Object.create(null),i==null?void 0:i[Ju],o.deprecatedProps);for(const c of e){const f=Cf(c.constructor);f&&(Object.assign(a,f),Object.assign(l,f[Xn]),Object.assign(u,f[Ju]))}return hO(a,t),gO(a,l),dO(a,u),a[Xn]=l,a[Ju]=u,e.length===0&&!od(t,"_propTypes")&&(t._propTypes=l),a}function hO(t,e){const n=mO(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function dO(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i="".concat(this.id,": ").concat(n);for(const s of e[n])od(this,s)||(this[s]=r);X.deprecated(i,e[n].join("/"))()}})}function gO(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=pO(o))}t[hi]=n,t[Pr]={},Object.defineProperties(t,r)}function pO(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||l1(e)?this[Pr][t]=e:this[Nn][t]=e},get(){if(this[Nn]){if(t in this[Nn])return this[Nn][t]||this[hi][t];if(t in this[Pr]){const e=this[pl]&&this[pl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[hi][t]}}return this[hi][t]}}}function od(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function m1(t,e){return od(t,e)&&t[e]}function mO(t){const e=t.componentName;return e||X.warn("".concat(t.name,".componentName not specified"))(),e||t.name}let yO=0;class ad{constructor(...e){g(this,"id",void 0),g(this,"props",void 0),g(this,"count",void 0),this.props=uO(this,e),this.id=this.props.id,this.count=yO++}clone(e){const{props:n}=this,r={};for(const i in n[hi])i in n[Nn]?r[i]=n[Nn][i]:i in n[Pr]&&(r[i]=n[Pr][i]);return new this.constructor({...n,...r,...e})}}g(ad,"componentName","Component");g(ad,"defaultProps",{});const vO=Object.freeze({});class _O{constructor(e){g(this,"component",void 0),g(this,"onAsyncPropUpdated",void 0),g(this,"asyncProps",void 0),g(this,"oldProps",void 0),g(this,"oldAsyncProps",void 0),this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||vO}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[pl]||this.component;const n=e[Nn]||{},r=e[Pr]||e,i=e[hi]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(l1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Xn];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class EO extends _O{constructor({attributeManager:e,layer:n}){super(n),g(this,"attributeManager",void 0),g(this,"needsRedraw",void 0),g(this,"needsUpdate",void 0),g(this,"subLayers",void 0),g(this,"usesPickingColorCache",void 0),g(this,"hasPickingBuffer",void 0),g(this,"changeFlags",void 0),g(this,"viewport",void 0),g(this,"uniformTransitions",void 0),g(this,"propsInTransition",void 0),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,"loading ".concat(e," of ").concat(this.layer))}}const wO="layer.changeFlag",TO="layer.initialize",bO="layer.update",xO="layer.finalize",SO="layer.matched",zm=2**24-1,PO=Object.freeze([]),AO=fo(({oldViewport:t,viewport:e})=>t.equals(e));let Gt=new Uint8ClampedArray(0);const LO={data:{type:"data",value:PO,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;if(i=i||n.getLoadOptions(),r=r||n.props.loaders,s){var a;i={...i,fetch:{...(a=i)===null||a===void 0?void 0:a.fetch,signal:s}}}let l=o.contains(t);return!l&&!i&&(o.add({resourceId:t,data:ol(t,r),persistent:!1}),l=!0),l?o.subscribe({resourceId:t,onChange:u=>{var c;return(c=n.internalState)===null||c===void 0?void 0:c.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):ol(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:q.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Jn extends ad{constructor(...e){super(...e),g(this,"internalState",null),g(this,"lifecycle",Gr.NO_STATE),g(this,"context",void 0),g(this,"state",void 0),g(this,"parent",null)}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){const e=this.constructor.layerName||this.constructor.name;return"".concat(e,"({id: '").concat(this.props.id,"'})")}project(e){Pe(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=K_(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=$_(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Pe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Pe(this.internalState);const r=this.internalState.viewport||this.context.viewport;return K3(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){return this.state&&(this.state.models||this.state.model&&[this.state.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===q.DEFAULT||e===q.LNGLAT||e===q.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Pe(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:JM(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())===null||e===void 0?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){for(const n of this.props.extensions)e=nO(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,u=a||l;u&&(o&&u.constant&&(u.constant=!1,n.invalidate(u.id)),!u.value&&!o&&(u.constant=!0,u.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.delete();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i;if(n&&(e=new Error("".concat(n,": ").concat(e.message),{cause:e})),!((r=(i=this.props).onError)!==null&&r!==void 0&&r.call(i,e))){var s,o;(s=this.context)===null||s===void 0||(o=s.onError)===null||o===void 0||o.call(s,e,this)}}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)===null||e===void 0?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!AO({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){for(const n of this.getModels())this._setModelAttributes(n,e)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Gt.length/3);if(this.internalState.usesPickingColorCache=!0,r<n){n>zm&&X.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Gt=Ai.allocate(Gt,n,{size:3,copy:!0,maxCount:Math.max(n,zm)});const i=Math.floor(Gt.length/3),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Gt[o*3+0]=s[0],Gt[o*3+1]=s[1],Gt[o*3+2]=s[2]}e.value=Gt.subarray(0,n*3)}_setModelAttributes(e,n){const r=this.getAttributeManager(),i=e.userData.excludeAttributes||{},s=r.getShaderAttributes(n,i);e.setAttributes(s)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let u=0;u<n.length;u++){const c=s.getVertexOffset(u);a[c]===l[0]&&a[c+1]===l[1]&&a[c+2]===l[2]&&this._disablePickingIndex(u)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.subData({data:new Uint8Array(o-s),offset:s})}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Gt.buffer&&(r.value=Gt.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Pe(!this.internalState),Pe(Number.isFinite(this.props.coordinateSystem)),De(TO,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:5121,size:3,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new EO({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(X.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new WM(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){De(SO,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(De(bO,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.gl)this.updateState(a);else try{this.updateState(a)}catch{}for(const c of this.props.extensions)c.updateState.call(this,a,c);const u=this.getModels()[0]!==l[0];this._postUpdate(a,u)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){De(xO,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({moduleParameters:e=null,uniforms:n={},parameters:r={}}){this._updateAttributeTransition();const i=this.props,s=this.context;this.props=this.internalState.propsInTransition||i;const o=this.props.opacity;n.opacity=Math.pow(o,1/2.2);try{e&&this.setModuleParameters(e);const{getPolygonOffset:a}=this.props,l=a&&a(n)||[0,0];qt(s.gl,{polygonOffset:l}),at(s.gl,r,()=>{const u={moduleParameters:e,uniforms:n,parameters:r,context:s};for(const c of this.props.extensions)c.draw.call(this,u,c);this.draw(u)})}finally{this.props=i}}getChangeFlags(){var e;return(e=this.internalState)===null||e===void 0?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&De(wO,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){const r=XM(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged){var i;this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)===null||i===void 0?void 0:i[s])}return this.setChangeFlags(r)}validateProps(){HM(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={pickingSelectedColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.pickingHighlightColor=r(e)),this.setModuleParameters(n),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new BM(e.gl,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const{model:s}=this.state;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const u={};o||(u.pickingSelectedColor=null),Array.isArray(l)&&(u.pickingHighlightColor=l),(n||a!==i.highlightedObjectIndex)&&(u.pickingSelectedColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setModuleParameters(u)}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}g(Jn,"defaultProps",LO);g(Jn,"layerName","Layer");const CO="compositeLayer.renderLayers";class ld extends Jn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var n;const{opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:u,highlightColor:c,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:E,extensions:b,fetch:y,operation:m,_subLayerProps:_}=this.props,T={id:"",updateTriggers:{},opacity:r,pickable:i,visible:s,parameters:o,getPolygonOffset:a,highlightedObjectIndex:l,autoHighlight:u,highlightColor:c,coordinateSystem:f,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:E,extensions:b,fetch:y,operation:m},S=_&&e.id&&_[e.id],P=S&&S.updateTriggers,L=e.id||"sublayer";if(S){const C=this.props[Xn],I=e.type?e.type._propTypes:{};for(const M in S){const B=I[M]||C[M];B&&B.type==="accessor"&&(S[M]=this.getSubLayerAccessor(S[M]))}}Object.assign(T,e,S),T.id="".concat(this.props.id,"-").concat(L),T.updateTriggers={all:(n=this.props.updateTriggers)===null||n===void 0?void 0:n.all,...e.updateTriggers,...P};for(const C of b){const I=C.getSubLayerProps.call(this,C);I&&Object.assign(T,I,{updateTriggers:Object.assign(T.updateTriggers,I.updateTriggers)})}return T}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=td(s,Boolean),this.internalState.subLayers=r}De(CO,this,i,r);for(const s of r)s.parent=this}}g(ld,"layerName","CompositeLayer");class y1{constructor(e){g(this,"opts",void 0),g(this,"typedArrayManager",void 0),g(this,"indexStarts",[0]),g(this,"vertexStarts",[0]),g(this,"vertexCount",0),g(this,"instanceCount",0),g(this,"attributes",void 0),g(this,"_attributeDefs",void 0),g(this,"data",void 0),g(this,"getGeometry",void 0),g(this,"geometryBuffer",void 0),g(this,"buffers",void 0),g(this,"positionSize",void 0),g(this,"normalize",void 0);const{attributes:n={}}=e;this.typedArrayManager=Ai,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(Pe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.positions=s)),this.geometryBuffer=r.positions,Array.isArray(a))for(const u of a)this._rebuildGeometry(u);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?u1(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=Ul(i,n,r);for(const l of o){a.index++;const u=s?s(l,a):null;e(u,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},u={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((f,h)=>{const d=f&&this.normalizeGeometry(f);u[h]=d,r[h+1]=r[h]+(d?this.getGeometrySize(d):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof J){const f=o.accessor.stride||this.positionSize*4;i=i||o.byteLength/f}else if(o.buffer){const f=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/f}else if(o.value){const f=o.value,h=o.stride/f.BYTES_PER_ELEMENT||this.positionSize;i=i||f.length/h}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const c={};this._forEachGeometry((f,h)=>{const d=u[h]||f;c.vertexStart=r[h],c.indexStart=n[h];const p=h<r.length-1?r[h+1]:i;c.geometrySize=p-r[h],c.geometryIndex=h,this.updateGeometryAttributes(d,c)},a,l),this.vertexCount=n[n.length-1]}}const IO=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`,MO=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,OO=1024,RO=4,Bm=()=>{},Um={10241:9987,10240:9729,10242:33071,10243:33071};function kO(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function NO(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Xs(t){return t&&(t.id||t.url)}function FO(t,e,n,r){const i=t.width,s=t.height,o=new ct(t.gl,{width:e,height:n,parameters:r});return $P(t,o,{targetY:0,width:i,height:s}),t.delete(),o}function Vm(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=Xs(i);t[o]={...i,x:s,y:n}}}function DO({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const u=t[l],c=Xs(u);if(!n[c]){const{height:f,width:h}=u;r+h+e>o&&(Vm(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:u,xOffset:r}),r=r+h+e,s=Math.max(s,f)}}return a.length>0&&Vm(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:kO(s+i+e)}}function zO(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=Ul(t);for(const o of i){s.index++;const a=e(o,s),l=Xs(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class BO{constructor(e,{onUpdate:n=Bm,onError:r=Bm}){g(this,"gl",void 0),g(this,"onUpdate",void 0),g(this,"onError",void 0),g(this,"_loadOptions",null),g(this,"_texture",null),g(this,"_externalTexture",null),g(this,"_mapping",{}),g(this,"_textureParameters",null),g(this,"_pendingCount",0),g(this,"_autoPacking",!1),g(this,"_xOffset",0),g(this,"_yOffset",0),g(this,"_rowHeight",0),g(this,"_buffer",RO),g(this,"_canvasWidth",OO),g(this,"_canvasHeight",0),g(this,"_canvas",null),this.gl=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)===null||e===void 0||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Xs(e):e;return this._mapping[n]||{}}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){if(e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r){var o;(o=this._texture)===null||o===void 0||o.delete(),this._texture=null,this._externalTexture=r}s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(zO(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=DO({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=new ct(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Um})),this._texture.height!==this._canvasHeight&&(this._texture=FO(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Um)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,ol(r.url,this._loadOptions).then(i=>{const s=Xs(r),o=this._mapping[s],{x:a,y:l,width:u,height:c}=o,{data:f,width:h,height:d}=NO(n,i,u,c);this._texture.setSubImageData({data:f,x:a+(u-h)/2,y:l+(c-d)/2,width:h,height:d}),o.width=h,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const v1=[0,0,0,255],UO={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:v1},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}};class Vl extends Jn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:IO,fs:MO,modules:[ho,go]})}initializeState(){this.state={iconManager:new BO(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:v1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:u,textureParameters:c}=n,{iconManager:f}=this.state,h=o||this.internalState.isAsyncPropLoading("iconAtlas");if(f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:c}),h?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&f.packIcons(l,u),i.extensionsChanged){var d;const{gl:p}=this.context;(d=this.state.model)===null||d===void 0||d.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,u=l.getTexture();u&&this.state.model.setUniforms(e).setUniforms({iconsTexture:u,iconsTextureDim:[u.width,u.height],sizeUnits:Tr[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a}).draw()}_getModel(e){const n=[-1,-1,-1,1,1,1,1,-1];return new Sr(e,{...this.getShaders(),id:this.props.id,geometry:new co({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var n;const r=(n=this.getCurrentLayer())===null||n===void 0?void 0:n.props.onIconError;r?r(e):X.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}}g(Vl,"defaultProps",UO);g(Vl,"layerName","IconLayer");const VO=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,jO=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (!filled) {
    discard;
  } else {
    gl_FragColor = vFillColor;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,jm=[0,0,0,255],GO={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:jm},getLineColor:{type:"accessor",value:jm},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class jl extends Jn{getShaders(){return super.getShaders({vs:VO,fs:jO,modules:[ho,go]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){if(super.updateState(e),e.changeFlags.extensionsChanged){var n;const{gl:r}=this.context;(n=this.state.model)===null||n===void 0||n.delete(),this.state.model=this._getModel(r),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:u,lineWidthUnits:c,lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props;this.state.model.setUniforms(e).setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:u,radiusUnits:Tr[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Tr[c],lineWidthScale:f,lineWidthMinPixels:h,lineWidthMaxPixels:d}).draw()}_getModel(e){const n=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Sr(e,{...this.getShaders(),id:this.props.id,geometry:new co({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(n)}}}),isInstanced:!0})}}g(jl,"defaultProps",GO);g(jl,"layerName","ScatterplotLayer");const _1={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function E1(t,e,n={}){return WO(t,n)!==e?(XO(t,n),!0):!1}function WO(t,e={}){return Math.sign(HO(t,e))}function HO(t,e={}){const{start:n=0,end:r=t.length}=e,i=e.size||2;let s=0;for(let o=n,a=r-i;o<r;o+=i)s+=(t[o]-t[a])*(t[o+1]+t[a+1]),a=o;return s/2}function XO(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,u=n+(s-1-a)*i;for(let c=0;c<i;++c){const f=t[l+c];t[l+c]=t[u+c],t[u+c]=f}}}function Mt(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function If(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function Ys(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function Mf(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Ca(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function w1(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let u=[];const c=[u],f=Ys(t,0,n,o);let h,d;const p=b1(f,i,s,[]),E=[];Mt(u,f);for(let b=1;b<l;b++){for(h=Ys(t,b,n,o,h),d=Ca(h,p);d;){Mf(f,h,d,p,E);const y=Ca(E,p);y&&(Mf(f,E,y,p,E),d=y),Mt(u,E),If(f,E),$O(p,i,d),r&&u.length>n&&(u=[],c.push(u),Mt(u,f)),d=Ca(h,p)}Mt(u,h),If(f,h)}return r?c:c[0]}const Gm=0,YO=1;function ra(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}function T1(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/r).fill(YO):null,holes:e||[]}],u=[[],[]];let c=[];for(;l.length;){const{pos:f,types:h,holes:d}=l.shift();ZO(f,r,d[0]||f.length,u),c=b1(u[0],i,s,c);const p=Ca(u[1],c);if(p){let E=Wm(f,h,r,0,d[0]||f.length,c,p);const b={pos:E[0].pos,types:E[0].types,holes:[]},y={pos:E[1].pos,types:E[1].types,holes:[]};l.push(b,y);for(let m=0;m<d.length;m++)E=Wm(f,h,r,d[m],d[m+1]||f.length,c,p),E[0]&&(b.holes.push(b.pos.length),b.pos=ra(b.pos,E[0].pos),o&&(b.types=ra(b.types,E[0].types))),E[1]&&(y.holes.push(y.pos.length),y.pos=ra(y.pos,E[1].pos),o&&(y.types=ra(y.types,E[1].types)))}else{const E={positions:f};o&&(E.edgeTypes=h),d.length&&(E.holeIndices=d),a.push(E)}}return a}function Wm(t,e,n,r,i,s,o){const a=(i-r)/n,l=[],u=[],c=[],f=[],h=[];let d,p,E;const b=Ys(t,a-1,n,r);let y=Math.sign(o&8?b[1]-s[3]:b[0]-s[2]),m=e&&e[a-1],_=0,T=0;for(let S=0;S<a;S++)d=Ys(t,S,n,r,d),p=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),E=e&&e[r/n+S],p&&y&&y!==p&&(Mf(b,d,o,s,h),Mt(l,h)&&c.push(m),Mt(u,h)&&f.push(m)),p<=0?(Mt(l,d)&&c.push(E),_-=p):c.length&&(c[c.length-1]=Gm),p>=0?(Mt(u,d)&&f.push(E),T+=p):f.length&&(f[f.length-1]=Gm),If(b,d),y=p,m=E;return[_?{pos:l,types:e&&c}:null,T?{pos:u,types:e&&f}:null]}function b1(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function $O(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function ZO(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const u=t[l],c=t[l+1];i=u<i?u:i,s=u>s?u:s,o=c<o?c:o,a=c>a?c:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}const KO=85.051129;function qO(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);x1(o,n,0,i-r);const a=w1(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)S1(l,n);return a}function QO(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,u=0;for(let f=0;f<=e.length;f++){const h=e[f]||t.length,d=u,p=JO(t,r,l,h);for(let E=p;E<h;E++)o[u++]=t[E];for(let E=l;E<p;E++)o[u++]=t[E];x1(o,r,d,u),eR(o,r,d,u,n==null?void 0:n.maxLatitude),l=h,a[f]=u}a.pop();const c=T1(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const f of c)S1(f.positions,r);return c}function JO(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function eR(t,e,n,r,i=KO){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=Ys(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Mt(t,a),a[1]=Math.sign(a[1])*i,Mt(t,a),a[0]=s,Mt(t,a)}}function x1(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function S1(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function tR(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?w1(i,{size:e,gridResolution:n}):r?qO(i,{size:e}):i}const nR=1,rR=2,rc=4;class iR extends y1{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?tR(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Hm(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Hm(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=rc,r[s+o-2]=rc):(r[s]+=nR,r[s+o-2]+=rR),r[s+o-1]=rc}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function Hm(t){return Array.isArray(t[0])}const sR=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,oR=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,P1=[0,0,0,255],aR={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:P1},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},ic={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class ud extends Jn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:sR,fs:oR,modules:[ho,go]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:ic,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:ic,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:ic,defaultValue:P1},instancePickingColors:{size:3,type:5121,accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new iR({fp64:this.use64bitPositions()})})}updateState(e){super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}if(r.extensionsChanged){var o;const{gl:a}=this.context;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),i.invalidateAll()}}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:u}=this.props;this.state.model.setUniforms(e).setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:Tr[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:u}).draw()}_getModel(e){const n=[0,1,2,1,4,2,1,3,4,3,5,4],r=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Sr(e,{...this.getShaders(),id:this.props.id,geometry:new co({drawMode:4,attributes:{indices:new Uint16Array(n),positions:{value:new Float32Array(r),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}g(ud,"defaultProps",aR);g(ud,"layerName","PathLayer");var cd={exports:{}};cd.exports=Gl;cd.exports.default=Gl;function Gl(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=A1(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,u,c,f,h,d;if(r&&(s=hR(t,e,s,n)),t.length>80*n){a=u=t[0],l=c=t[1];for(var p=n;p<i;p+=n)f=t[p],h=t[p+1],f<a&&(a=f),h<l&&(l=h),f>u&&(u=f),h>c&&(c=h);d=Math.max(u-a,c-l),d=d!==0?32767/d:0}return $s(s,o,n,a,l,d,0),o}function A1(t,e,n,r,i){var s,o;if(i===kf(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Xm(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Xm(s,t[s],t[s+1],o);return o&&Wl(o,o.next)&&(Ks(o),o=o.next),o}function Ar(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Wl(n,n.next)||fe(n.prev,n,n.next)===0)){if(Ks(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function $s(t,e,n,r,i,s,o){if(t){!o&&s&&yR(t,r,i,s);for(var a=t,l,u;t.prev!==t.next;){if(l=t.prev,u=t.next,s?uR(t,r,i,s):lR(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(u.i/n|0),Ks(t),t=u.next,a=u.next;continue}if(t=u,t===a){o?o===1?(t=cR(Ar(t),e,n),$s(t,e,n,r,i,s,2)):o===2&&fR(t,e,n,r,i,s):$s(Ar(t),e,n,r,i,s,1);break}}}}function lR(t){var e=t.prev,n=t,r=t.next;if(fe(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,u=r.y,c=i<s?i<o?i:o:s<o?s:o,f=a<l?a<u?a:u:l<u?l:u,h=i>s?i>o?i:o:s>o?s:o,d=a>l?a>u?a:u:l>u?l:u,p=r.next;p!==e;){if(p.x>=c&&p.x<=h&&p.y>=f&&p.y<=d&&ii(i,a,s,l,o,u,p.x,p.y)&&fe(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function uR(t,e,n,r){var i=t.prev,s=t,o=t.next;if(fe(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,u=o.x,c=i.y,f=s.y,h=o.y,d=a<l?a<u?a:u:l<u?l:u,p=c<f?c<h?c:h:f<h?f:h,E=a>l?a>u?a:u:l>u?l:u,b=c>f?c>h?c:h:f>h?f:h,y=Of(d,p,e,n,r),m=Of(E,b,e,n,r),_=t.prevZ,T=t.nextZ;_&&_.z>=y&&T&&T.z<=m;){if(_.x>=d&&_.x<=E&&_.y>=p&&_.y<=b&&_!==i&&_!==o&&ii(a,c,l,f,u,h,_.x,_.y)&&fe(_.prev,_,_.next)>=0||(_=_.prevZ,T.x>=d&&T.x<=E&&T.y>=p&&T.y<=b&&T!==i&&T!==o&&ii(a,c,l,f,u,h,T.x,T.y)&&fe(T.prev,T,T.next)>=0))return!1;T=T.nextZ}for(;_&&_.z>=y;){if(_.x>=d&&_.x<=E&&_.y>=p&&_.y<=b&&_!==i&&_!==o&&ii(a,c,l,f,u,h,_.x,_.y)&&fe(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;T&&T.z<=m;){if(T.x>=d&&T.x<=E&&T.y>=p&&T.y<=b&&T!==i&&T!==o&&ii(a,c,l,f,u,h,T.x,T.y)&&fe(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function cR(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Wl(i,s)&&L1(i,r,r.next,s)&&Zs(i,s)&&Zs(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),Ks(r),Ks(r.next),r=t=s),r=r.next}while(r!==t);return Ar(r)}function fR(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&ER(o,a)){var l=C1(o,a);o=Ar(o,o.next),l=Ar(l,l.next),$s(o,e,n,r,i,s,0),$s(l,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function hR(t,e,n,r){var i=[],s,o,a,l,u;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,u=A1(t,a,l,r,!1),u===u.next&&(u.steiner=!0),i.push(_R(u));for(i.sort(dR),s=0;s<i.length;s++)n=gR(i[s],n);return n}function dR(t,e){return t.x-e.x}function gR(t,e){var n=pR(t,e);if(!n)return e;var r=C1(n,t);return Ar(r,r.next),Ar(n,n.next)}function pR(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,u=o.x,c=o.y,f=1/0,h;n=o;do r>=n.x&&n.x>=u&&r!==n.x&&ii(i<c?r:s,i,u,c,i<c?s:r,i,n.x,n.y)&&(h=Math.abs(i-n.y)/(r-n.x),Zs(n,t)&&(h<f||h===f&&(n.x>o.x||n.x===o.x&&mR(o,n)))&&(o=n,f=h)),n=n.next;while(n!==l);return o}function mR(t,e){return fe(t.prev,t,e.prev)<0&&fe(e.next,t,t.next)<0}function yR(t,e,n,r){var i=t;do i.z===0&&(i.z=Of(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,vR(i)}function vR(t){var e,n,r,i,s,o,a,l,u=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<u&&(a++,r=r.nextZ,!!r);e++);for(l=u;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,u*=2}while(o>1);return t}function Of(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function _R(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function ii(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function ER(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!wR(t,e)&&(Zs(t,e)&&Zs(e,t)&&TR(t,e)&&(fe(t.prev,t,e.prev)||fe(t,e.prev,e))||Wl(t,e)&&fe(t.prev,t,t.next)>0&&fe(e.prev,e,e.next)>0)}function fe(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Wl(t,e){return t.x===e.x&&t.y===e.y}function L1(t,e,n,r){var i=sa(fe(t,e,n)),s=sa(fe(t,e,r)),o=sa(fe(n,r,t)),a=sa(fe(n,r,e));return!!(i!==s&&o!==a||i===0&&ia(t,n,e)||s===0&&ia(t,r,e)||o===0&&ia(n,t,r)||a===0&&ia(n,e,r))}function ia(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function sa(t){return t>0?1:t<0?-1:0}function wR(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&L1(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Zs(t,e){return fe(t.prev,t,t.next)<0?fe(t,e,t.next)>=0&&fe(t,t.prev,e)>=0:fe(t,e,t.prev)<0||fe(t,t.next,e)<0}function TR(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function C1(t,e){var n=new Rf(t.i,t.x,t.y),r=new Rf(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Xm(t,e,n,r){var i=new Rf(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ks(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rf(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Gl.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(kf(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var u=e[a]*n,c=a<l-1?e[a+1]*n:t.length;o-=Math.abs(kf(t,u,c,n))}var f=0;for(a=0;a<r.length;a+=3){var h=r[a]*n,d=r[a+1]*n,p=r[a+2]*n;f+=Math.abs((t[h]-t[p])*(t[d+1]-t[h+1])-(t[h]-t[d])*(t[p+1]-t[h+1]))}return o===0&&f===0?0:Math.abs((f-o)/o)};function kf(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}Gl.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var bR=cd.exports;const xR=_l(bR),oa=_1.CLOCKWISE,Ym=_1.COUNTER_CLOCKWISE,Fn={isClosed:!0};function SR(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function us(t){return"positions"in t?t.positions:t}function Ia(t){return"holeIndices"in t?t.holeIndices:null}function PR(t){return Array.isArray(t[0])}function AR(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function LR(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function CR(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function $m(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<r;l++)t[s++]=n[a][l]||0;if(!LR(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Fn.start=e,Fn.end=s,Fn.size=r,E1(t,i,Fn),s}function Zm(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let l=e;for(let u=0;u<a;u++)t[l++]=n[i+u];if(!CR(n,r,i,s))for(let u=0;u<r;u++)t[l++]=n[i+u];return Fn.start=e,Fn.end=l,Fn.size=r,E1(t,o,Fn),l}function IR(t,e){SR(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=Zm(n,o,i,e,s[a-1],s[a],a===0?oa:Ym),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!PR(t))return Zm(n,0,t,e,0,n.length,oa),n;if(!AR(t)){let i=0;for(const[s,o]of t.entries())i=$m(n,i,o,e,s===0?oa:Ym),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return $m(n,0,t,e,oa),n}function sc(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function Km(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],l=t[o+1],u=t[o+2];t[o+e]=a,t[o+n]=l,t[o+r]=u}}function MR(t,e,n,r){let i=Ia(t);i&&(i=i.map(a=>a/e));let s=us(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let u=0;u<a;u+=e){l[0]=s[u],l[1]=s[u+1],o&&(l[2]=s[u+2]);const c=n(l);s[u]=c[0],s[u+1]=c[1],o&&(s[u+2]=c[2])}}if(o){const a=sc(s,0,1),l=sc(s,0,2),u=sc(s,1,2);if(!a&&!l&&!u)return[];a>l&&a>u||(l>u?(n||(s=s.slice()),Km(s,0,2,1)):(n||(s=s.slice()),Km(s,2,0,1)))}return xR(s,i,e)}class OR extends y1{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=IR(e,this.positionSize);return this.opts.resolution?T1(us(n),Ia(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?QO(us(n),Ia(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(qm(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return us(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&qm(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else this._updateIndices(e,n),this._updatePositions(e,n),this._updateVertexValid(e,n)}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let u=i;const c=MR(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+c.length,{copy:!0});for(let f=0;f<c.length;f++)l[u++]=c[f]+r;o[n+1]=i+c.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=us(e);for(let a=n,l=0;l<r;a++,l++){const u=o[l*s],c=o[l*s+1],f=s>2?o[l*s+2]:0;i[a*3]=u,i[a*3+1]=c,i[a*3+2]=f}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&Ia(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function qm(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const I1=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`,RR=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(I1,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`),kR=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(I1,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`),NR=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,yl=[0,0,0,255],FR={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:yl},getLineColor:{type:"accessor",value:yl},material:!0},aa={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class fd extends Jn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(e){return super.getShaders({vs:e==="top"?RR:kR,fs:NR,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ho,v2,go]})}get wrapLongitude(){return!1}initializeState(){const{gl:e,viewport:n}=this.context;let{coordinateSystem:r}=this.props;const{_full3d:i}=this.props;n.isGeospatial&&r===q.DEFAULT&&(r=q.LNGLAT);let s;r===q.LNGLAT&&(i?s=n.projectPosition.bind(n):s=n.projectFlat.bind(n)),this.setState({numInstances:0,polygonTesselator:new OR({preproject:s,fp64:this.use64bitPositions(),IndexType:!e||Hh(e,se.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});const o=this.getAttributeManager(),a=!0;o.remove(["instancePickingColors"]),o.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:aa,accessor:"getPolygon",update:this.calculatePositions,noAlloc:a,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:a},elevations:{size:1,transition:aa,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:aa,accessor:"getFillColor",defaultValue:yl,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:aa,accessor:"getLineColor",defaultValue:yl,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:(l,{index:u,target:c})=>this.encodePickingColor(l&&l.__source?l.__source.index:u,c),shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,{data:i}=this.props;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const{data:n}=this.props;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,polygonTesselator:l}=this.state,u={...e,extruded:!!n,elevationScale:s};a&&(a.setInstanceCount(l.instanceCount-1),a.setUniforms(u),i&&(a.setDrawMode(3),a.setUniforms({isWireframe:!0}).draw()),r&&(a.setDrawMode(6),a.setUniforms({isWireframe:!1}).draw())),o&&(o.setVertexCount(l.vertexCount),o.setUniforms(u).draw())}updateState(e){super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();if(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded){var a;(a=this.state.models)===null||a===void 0||a.forEach(l=>l.delete()),this.setState(this._getModels(this.context.gl)),s.invalidateAll()}}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(e){const{id:n,filled:r,extruded:i}=this.props;let s,o;if(r){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1,s=new Sr(e,{...a,id:"".concat(n,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0})}return i&&(o=new Sr(e,{...this.getShaders("side"),id:"".concat(n,"-side"),geometry:new co({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1}),o.userData.excludeAttributes={indices:!0}),{models:[o,s].filter(Boolean),topModel:s,sideModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}g(fd,"defaultProps",FR);g(fd,"layerName","SolidPolygonLayer");function DR({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let h=0;h<o;h++){const d=e(t[h]);if(a>h&&d>=i&&(a=h),d>=s){l=h;break}}let u=a;const f=l-a!==r.length?t.slice(l):void 0;for(let h=0;h<r.length;h++)t[u++]=r[h];if(f){for(let h=0;h<f.length;h++)t[u++]=f[h];t.length=u}return{startRow:a,endRow:a+r.length}}function zR(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?BR(t,r,n):null}function BR(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function UR(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*3);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),n[r][o*3+0]=s[0],n[r][o*3+1]=s[1],n[r][o*3+2]=s[2]}return n}const VR=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,oc=192/256,Qm=[],jR={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class hd extends Vl{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return{...super.getShaders(),fs:VR}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&X.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,oc*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:oc,outlineBuffer:o,gamma:r,sdf:!!n,outlineColor:s},super.draw(e),n&&i){const{iconManager:a}=this.state;a.getTexture()&&this.state.model.draw({uniforms:{outlineBuffer:oc}})}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Qm}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Qm}}g(hd,"defaultProps",jR);g(hd,"layerName","MultiIconLayer");const Ts=1e20;class GR{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,u=this._createCanvas(l),c=this.ctx=u.getContext("2d",{willReadFrequently:!0});c.font=`${a} ${o} ${e}px ${s}`,c.textBaseline="alphabetic",c.textAlign="left",c.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),c=Math.min(this.size-this.buffer,a+Math.ceil(i)),f=u+2*this.buffer,h=c+2*this.buffer,d=Math.max(f*h,0),p=new Uint8ClampedArray(d),E={data:p,width:f,height:h,glyphWidth:u,glyphHeight:c,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(u===0||c===0)return E;const{ctx:b,buffer:y,gridInner:m,gridOuter:_}=this;b.clearRect(y,y,u,c),b.fillText(e,y,y+a);const T=b.getImageData(y,y,u,c);_.fill(Ts,0,d),m.fill(0,0,d);for(let S=0;S<c;S++)for(let P=0;P<u;P++){const L=T.data[4*(S*u+P)+3]/255;if(L===0)continue;const C=(S+y)*f+P+y;if(L===1)_[C]=0,m[C]=Ts;else{const I=.5-L;_[C]=I>0?I*I:0,m[C]=I<0?I*I:0}}Jm(_,0,0,f,h,f,this.f,this.v,this.z),Jm(m,y,y,u,c,f,this.f,this.v,this.z);for(let S=0;S<d;S++){const P=Math.sqrt(_[S])-Math.sqrt(m[S]);p[S]=Math.round(255-255*(P/this.radius+this.cutoff))}return E}}function Jm(t,e,n,r,i,s,o,a,l){for(let u=e;u<e+r;u++)e0(t,n*s+u,s,i,o,a,l);for(let u=n;u<n+i;u++)e0(t,u*s+e,1,r,o,a,l)}function e0(t,e,n,r,i,s,o){s[0]=0,o[0]=-Ts,o[1]=Ts,i[0]=t[e];for(let a=1,l=0,u=0;a<r;a++){i[a]=t[e+a*n];const c=a*a;do{const f=s[l];u=(i[a]-i[f]+c-f*f)/(a-f)/2}while(u<=o[l]&&--l>-1);l++,s[l]=a,o[l]=u,o[l+1]=Ts}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const u=s[l],c=a-u;t[e+a*n]=i[u]+c*c}}const WR=32,HR=[];function XR(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function YR({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,u=o;const c=n+r*2;for(const f of t)if(!s[f]){const h=e(f);u+h+r*2>i&&(u=0,l++),s[f]={x:u+r,y:a+l*c+r,width:h,height:c,layoutWidth:h,layoutHeight:n},u+=h+r*2}return{mapping:s,xOffset:u,yOffset:a+l*c,canvasHeight:XR(a+(l+1)*c)}}function M1(t,e,n,r){let i=0;for(let o=e;o<n;o++){var s;const a=t[o];i+=((s=r[a])===null||s===void 0?void 0:s.layoutWidth)||0}return i}function O1(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const u=M1(t,l,l+1,i);a+u>r&&(o<l&&s.push(l),o=l,a=0),a+=u}return a}function $R(t,e,n,r,i,s){let o=e,a=e,l=e,u=0;for(let c=e;c<n;c++)if((t[c]===" "||t[c+1]===" "||c+1===n)&&(l=c+1),l>a){let f=M1(t,a,l,i);u+f>r&&(o<a&&(s.push(a),o=a,u=0),f>r&&(f=O1(t,a,l,r,i,s),o=s[s.length-1])),a=l,u+=f}return u}function ZR(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?O1(t,i,s,n,r,o):$R(t,i,s,n,r,o),o}function KR(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const u=t[l],c=r[u];c?(a||(a=c.layoutHeight),i[l]=o+c.layoutWidth/2,o+=c.layoutWidth):(X.warn("Missing character: ".concat(u," (").concat(u.codePointAt(0),")"))(),i[l]=o,o+=WR)}s[0]=o,s[1]=a}function qR(t,e,n,r,i){const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),u=new Array(o),c=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,f=[0,0],h=[0,0];let d=0,p=0,E=0;for(let y=0;y<=o;y++){const m=s[y];if((m===`
`||y===o)&&(E=y),E>p){const _=c?ZR(s,n,r,i,p,E):HR;for(let T=0;T<=_.length;T++){const S=T===0?p:_[T-1],P=T<_.length?_[T]:E;KR(s,S,P,i,a,h);for(let L=S;L<P;L++){var b;const C=s[L],I=((b=i[C])===null||b===void 0?void 0:b.layoutOffsetY)||0;l[L]=d+h[1]/2+I,u[L]=h[0]}d=d+h[1]*e,f[0]=Math.max(f[0],h[0])}p=E}m===`
`&&(a[p]=0,l[p]=0,u[p]=0,p++)}return f[1]=d,{x:a,y:l,rowWidth:u,size:f}}function QR({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,u=i[e]||Math.ceil((t.length-l)/a),c=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const d=t.constructor;h=new d(u);for(let p=0;p<u;p++)h[p]=t[p*a+l]}for(let d=0;d<e;d++){const p=i[d],E=i[d+1]||u,b=h.subarray(p,E);f[d]=String.fromCodePoint.apply(null,b),c&&b.forEach(c.add,c)}if(c)for(const d of c)s.add(String.fromCodePoint(d));return{texts:f,characterCount:u}}class R1{constructor(e=5){g(this,"limit",void 0),g(this,"_cache",{}),g(this,"_order",[]),this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function JR(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const di={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:JR(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},t0=1024,n0=.9,r0=1.2,k1=3;let vl=new R1(k1);function ek(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=vl.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function tk(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function i0(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function nk(t){X.assert(Number.isFinite(t)&&t>=k1,"Invalid cache limit"),vl=new R1(t)}class rk{constructor(){g(this,"props",{...di}),g(this,"_key",void 0),g(this,"_atlas",void 0)}get texture(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*r0+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=ek(this._key,this.props.characterSet),r=vl.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,vl.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:u}=this.props;let c=n&&n.data;c||(c=document.createElement("canvas"),c.width=t0);const f=c.getContext("2d",{willReadFrequently:!0});i0(f,r,s,i);const{mapping:h,canvasHeight:d,xOffset:p,yOffset:E}=YR({getFontWidth:b=>f.measureText(b).width,fontHeight:s*r0,buffer:o,characterSet:e,maxCanvasWidth:t0,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(c.height!==d){const b=f.getImageData(0,0,c.width,c.height);c.height=d,f.putImageData(b,0,0)}if(i0(f,r,s,i),a){const b=new GR({fontSize:s,buffer:o,radius:l,cutoff:u,fontFamily:r,fontWeight:"".concat(i)});for(const y of e){const{data:m,width:_,height:T,glyphTop:S}=b.draw(y);h[y].width=_,h[y].layoutOffsetY=s*n0-S;const P=f.createImageData(_,T);tk(m,P),f.putImageData(P,h[y].x,h[y].y)}}else for(const b of e)f.fillText(b,h[b].x,h[b].y+o+s*n0);return{xOffset:p,yOffset:E,mapping:h,data:c,width:c.width,height:c.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?"".concat(e," ").concat(n," ").concat(r," ").concat(i," ").concat(o," ").concat(a):"".concat(e," ").concat(n," ").concat(r," ").concat(i)}}const ik=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,sk=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`,ok={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class dd extends Jn{constructor(...e){super(...e),g(this,"state",void 0)}getShaders(){return super.getShaders({vs:ik,fs:sk,modules:[ho,go]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e);const{changeFlags:n}=e;if(n.extensionsChanged){var r;const{gl:i}=this.context;(r=this.state.model)===null||r===void 0||r.delete(),this.state.model=this._getModel(i),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]),this.state.model.setUniforms(e).setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:Tr[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}).draw()}_getModel(e){const n=[0,0,1,0,1,1,0,1];return new Sr(e,{...this.getShaders(),id:this.props.id,geometry:new co({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(n)}}}),isInstanced:!0})}}g(dd,"defaultProps",ok);g(dd,"layerName","TextBackgroundLayer");const s0={start:1,middle:0,end:-1},o0={top:1,center:0,bottom:-1},ac=[0,0,0,255],ak=1,lk={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ac},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:di.characterSet},fontFamily:di.fontFamily,fontWeight:di.fontWeight,lineHeight:ak,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ac},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:ac},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class gd extends ld{constructor(...e){super(...e),g(this,"state",void 0),g(this,"getBoundingRect",(n,r)=>{let{size:[i,s]}=this.transformParagraph(n,r);const{fontSize:o}=this.state.fontAtlasManager.props;i/=o,s/=o;const{getTextAnchor:a,getAlignmentBaseline:l}=this.props,u=s0[typeof a=="function"?a(n,r):a],c=o0[typeof l=="function"?l(n,r):l];return[(u-1)*i/2,(c-1)*s/2,i,s]}),g(this,"getIconOffsets",(n,r)=>{const{getTextAnchor:i,getAlignmentBaseline:s}=this.props,{x:o,y:a,rowWidth:l,size:[u,c]}=this.transformParagraph(n,r),f=s0[typeof i=="function"?i(n,r):i],h=o0[typeof s=="function"?s(n,r):s],d=o.length,p=new Array(d*2);let E=0;for(let b=0;b<d;b++){const y=(1-f)*(u-l[b])/2;p[E++]=(f-1)*u/2+y+o[b],p[E++]=(h-1)*c/2+a[b]}return p})}initializeState(){this.state={styleVersion:0,fontAtlasManager:new rk},this.props.maxWidth>0&&X.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var e;const{data:n,characterSet:r}=this.props,i=(e=n.attributes)===null||e===void 0?void 0:e.getText;let{getText:s}=this.props,o=n.startIndices,a;const l=r==="auto"&&new Set;if(i&&o){const{texts:u,characterCount:c}=QR({...ArrayBuffer.isView(i)?{value:i}:i,length:n.length,startIndices:o,characterSet:l});a=c,s=(f,{index:h})=>u[h]}else{const{iterable:u,objectInfo:c}=Ul(n);o=[0],a=0;for(const f of u){c.index++;const h=Array.from(s(f,c)||"");l&&h.forEach(l.add,l),a+=h.length,o.push(a)}}this.setState({getText:s,startIndices:o,numInstances:a,characterSet:l||r})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,u=s(e,n)||"";return qR(u,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,texture:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:u,getPosition:c,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,getBackgroundColor:E,getBorderColor:b,getBorderWidth:y,backgroundPadding:m,background:_,billboard:T,fontSettings:S,outlineWidth:P,outlineColor:L,sizeScale:C,sizeUnits:I,sizeMinPixels:M,sizeMaxPixels:B,transitions:V,updateTriggers:j}=this.props,Z=this.getSubLayerClass("characters",hd),bt=this.getSubLayerClass("background",dd);return[_&&new bt({getFillColor:E,getLineColor:b,getLineWidth:y,padding:m,getPosition:c,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:C,sizeUnits:I,sizeMinPixels:M,sizeMaxPixels:B,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getSize:V.getSize,getFillColor:V.getBackgroundColor,getLineColor:V.getBorderColor,getLineWidth:V.getBorderWidth,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset,getBoundingRect:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:u,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new Z({sdf:S.sdf,smoothing:Number.isFinite(S.smoothing)?S.smoothing:di.smoothing,outlineWidth:P/(S.radius||di.radius),outlineColor:L,iconAtlas:s,iconMapping:o,getPosition:c,getColor:f,getSize:h,getAngle:d,getPixelOffset:p,billboard:T,sizeScale:C*i,sizeUnits:I,sizeMinPixels:M*i,sizeMaxPixels:B*i,transitions:V&&{getPosition:V.getPosition,getAngle:V.getAngle,getColor:V.getColor,getSize:V.getSize,getPixelOffset:V.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:j.getText,getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset,getIconOffsets:{getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:u,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){nk(e)}}g(gd,"defaultProps",lk);g(gd,"layerName","TextLayer");const Ma={circle:{type:jl,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:Vl,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:gd,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Oa={type:ud,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},Nf={type:fd,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function ns({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function lc(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],n&&(i.transitions[o]=n[s])),i[o]=a}return i}function uk(t){if(Array.isArray(t))return t;switch(X.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return X.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function a0(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=t.length}=n;for(let o=i;o<s;o++){const a=t[o],{geometry:l}=a;if(l)if(l.type==="GeometryCollection"){X.assert(Array.isArray(l.geometries),"GeoJSON does not have geometries array");const{geometries:u}=l;for(let c=0;c<u.length;c++){const f=u[c];l0(f,r,e,a,o)}}else l0(l,r,e,a,o)}return r}function l0(t,e,n,r,i){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:l,polygonFeatures:u,polygonOutlineFeatures:c}=e;if(!fk(s,o)){X.warn("".concat(s," coordinates are malformed"))();return}switch(s){case"Point":a.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach(f=>{a.push(n({geometry:{type:"Point",coordinates:f}},r,i))});break;case"LineString":l.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach(f=>{l.push(n({geometry:{type:"LineString",coordinates:f}},r,i))});break;case"Polygon":u.push(n({geometry:t},r,i)),o.forEach(f=>{c.push(n({geometry:{type:"LineString",coordinates:f}},r,i))});break;case"MultiPolygon":o.forEach(f=>{u.push(n({geometry:{type:"Polygon",coordinates:f}},r,i)),f.forEach(h=>{c.push(n({geometry:{type:"LineString",coordinates:h}},r,i))})});break}}const ck={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function fk(t,e){let n=ck[t];for(X.assert(n,"Unknown GeoJSON type ".concat(t));e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function N1(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function la(t){return t.geometry.coordinates}function hk(t,e){const n=N1(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=la,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=la,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=la,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=la,n}function dk(t,e){const n=N1(),{points:r,lines:i,polygons:s}=t,o=UR(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:3,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:3,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:3,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const gk=["points","linestrings","polygons"],pk={...ns(Ma.circle),...ns(Ma.icon),...ns(Ma.text),...ns(Oa),...ns(Nf),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class pd extends ld{initializeState(){this.state={layerProps:{},features:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=dk(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=uk(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const l=this.state.features;for(const u in l)s[u]=l[u].slice(),o[u]=[];for(const u of n.dataChanged){const c=a0(r,i,u);for(const f in l)o[f].push(DR({data:s[f],getIndex:h=>h.__source.index,dataRange:u,replace:c[f]}))}}else s=a0(r,i);const a=hk(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=gk.find(s=>i.id.startsWith("".concat(this.id,"-").concat(s,"-"))),r>=0&&i.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n="".concat(this.id,"-points-"),r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,r.polygons.data)&&this.getSubLayerClass(i,Nf.type);if(s){const o=lc(this,Nf.props),a=e&&n;return a||delete o.getLineColor,o.updateTriggers.lineColors=a,new s(o,this.getSubLayerProps({id:i,updateTriggers:o.updateTriggers}),r.polygons)}return null}_renderLineLayers(){const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(i,r.polygonsOutline.data)&&this.getSubLayerClass(i,Oa.type),a=this.shouldRenderSubLayer(s,r.lines.data)&&this.getSubLayerClass(s,Oa.type);if(o||a){const l=lc(this,Oa.props);return[o&&new o(l,this.getSubLayerProps({id:i,updateTriggers:l.updateTriggers}),r.polygonsOutline),a&&new a(l,this.getSubLayerProps({id:s,updateTriggers:l.updateTriggers}),r.lines)]}return null}_renderPointLayers(){const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(a=>a.__source.index===i));const s=new Set(e.split("+")),o=[];for(const a of s){const l="points-".concat(a),u=Ma[a],c=u&&this.shouldRenderSubLayer(l,n.points.data)&&this.getSubLayerClass(l,u.type);if(c){const f=lc(this,u.props);let h=n.points;if(a==="text"&&r){const{instancePickingColors:d,...p}=h.data.attributes;h={...h,data:{...h.data,attributes:p}}}o.push(new c(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers,highlightedObjectIndex:i}),h))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=zR(s,o);return e(a,i)}}}g(pd,"layerName","GeoJsonLayer");g(pd,"defaultProps",pk);const uc=85.05113;function u0(t,e,n,r){if(n){if(n.userData._googleMap===t)return n;Ff(n)}const i={click:null,rightclick:null,dblclick:null,mousemove:null,mouseout:null},s=new rd({...r,useDevicePixels:r.interleaved?!0:r.useDevicePixels,style:r.interleaved?null:{pointerEvents:"none"},parent:mk(e,r.style),initialViewState:{longitude:0,latitude:0,zoom:1},controller:!1});for(const o in i)i[o]=t.addListener(o,a=>_k(s,o,a));return s.userData._googleMap=t,s.userData._eventListeners=i,s}function mk(t,e){const n=document.createElement("div");if(n.style.position="absolute",Object.assign(n.style,e),"getPanes"in t){var r;(r=t.getPanes())===null||r===void 0||r.overlayLayer.appendChild(n)}else{var i;(i=t.getMap())===null||i===void 0||i.getDiv().appendChild(n)}return n}function Ff(t){const{_eventListeners:e}=t.userData;for(const n in e)e[n]&&e[n].remove();t.finalize()}function yk(t,e){const{width:n,height:r}=F1(t),i=e.getProjection(),s=t.getBounds();if(!s)return{width:n,height:r,left:0,top:0};const o=s.getNorthEast(),a=s.getSouthWest(),l=i.fromLatLngToDivPixel(o),u=i.fromLatLngToDivPixel(a),c=cc(i,n/2,r/2),f=new google.maps.LatLng(0,c[0]),h=i.fromLatLngToContainerPixel(f),d=i.fromLatLngToDivPixel(f);if(!l||!u||!d||!h)return{width:n,height:r,left:0,top:0};const p=Math.round(d.x-h.x);let E=d.y-h.y;const b=cc(i,n/2,0),y=cc(i,n/2,r);let m=c[1];const _=c[0];if(Math.abs(m)>uc){m=m>0?uc:-uc;const I=new google.maps.LatLng(m,_),M=i.fromLatLngToContainerPixel(I);E+=M.y-r/2}E=Math.round(E);let S=180*new Wu(b).sub(y).verticalAngle()/Math.PI;S<0&&(S+=360);const P=t.getHeading()||0;let L=t.getZoom()-1,C;if(S===0)C=r?(u.y-l.y)/r:1;else if(S===P){const I=new Wu([l.x,l.y]).sub([u.x,u.y]).len(),M=new Wu([n,-r]).len();C=M?I/M:1}return L+=Math.log2(C||1),{width:n,height:r,left:p,top:E,zoom:L,bearing:S,pitch:t.getTilt(),latitude:m,longitude:_}}function c0(t,e){const{width:n,height:r}=F1(t),{center:i,heading:s,tilt:o,zoom:a}=e.getCameraParams(),l=25,u=r?n/r:1,h=new Ft().perspective({fovy:l*Math.PI/180,aspect:u,near:.75,far:3e14}),d=.5*h[5];return{width:n,height:r,viewState:{altitude:d,bearing:s,latitude:i.lat(),longitude:i.lng(),pitch:o,projectionMatrix:h,repeat:!0,zoom:a-1}}}function F1(t){const e=t.getDiv().firstChild;return{width:e.offsetWidth,height:e.offsetHeight}}function cc(t,e,n){const r=new google.maps.Point(e,n),i=t.fromContainerPixelToLatLng(r);return[i.lng(),i.lat()]}function vk(t,e){if(t.pixel)return t.pixel;const n=e.getViewports()[0].project([t.latLng.lng(),t.latLng.lat()]);return{x:n[0],y:n[1]}}function _k(t,e,n){if(!t.isInitialized)return;const r={type:e,offsetCenter:vk(n,t),srcEvent:n};switch(e){case"click":case"rightclick":r.type="click",r.tapCount=1,t._onPointerDown(r),t._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,t._onEvent(r);break;case"mousemove":r.type="pointermove",t._onPointerMove(r);break;case"mouseout":r.type="pointerleave",t._onPointerMove(r);break;default:return}}const Ek=()=>!1,wk={depthMask:!0,depthTest:!0,blend:!0,blendFunc:[770,771,1,771],blendEquation:32774};function f0(){}const Tk={interleaved:!0};class bk{constructor(e){g(this,"props",{}),g(this,"_map",null),g(this,"_deck",null),g(this,"_overlay",null),this.setProps({...Tk,...e})}setMap(e){if(e===this._map)return;const{VECTOR:n,UNINITIALIZED:r}=google.maps.RenderingType;if(this._map){var i;!e&&this._map.getRenderingType()===n&&this.props.interleaved&&this._overlay.requestRedraw(),(i=this._overlay)===null||i===void 0||i.setMap(null),this._map=null}e&&(this._map=e,e.getRenderingType()!==r?this._createOverlay(e):e.addListener("renderingtype_changed",()=>{this._createOverlay(e)}))}setProps(e){if(Object.assign(this.props,e),this._deck){const n=this._deck.getCanvas();if(e.style&&n!==null&&n!==void 0&&n.parentElement){const r=n.parentElement.style;Object.assign(r,e.style),e.style=null}this._deck.setProps(e)}}pickObject(e){return this._deck&&this._deck.pickObject(e)}pickMultipleObjects(e){return this._deck&&this._deck.pickMultipleObjects(e)}pickObjects(e){return this._deck&&this._deck.pickObjects(e)}finalize(){this.setMap(null),this._deck&&(Ff(this._deck),this._deck=null)}_createOverlay(e){const{interleaved:n}=this.props,{VECTOR:r,UNINITIALIZED:i}=google.maps.RenderingType,s=e.getRenderingType();if(s===i)return;const a=s===r&&google.maps.WebGLOverlayView?google.maps.WebGLOverlayView:google.maps.OverlayView,l=new a;l instanceof google.maps.WebGLOverlayView?(n?(l.onAdd=f0,l.onContextRestored=this._onContextRestored.bind(this),l.onDraw=this._onDrawVectorInterleaved.bind(this)):(l.onAdd=this._onAdd.bind(this),l.onContextRestored=f0,l.onDraw=this._onDrawVectorOverlay.bind(this)),l.onContextLost=this._onContextLost.bind(this)):(l.onAdd=this._onAdd.bind(this),l.draw=this._onDrawRaster.bind(this)),l.onRemove=this._onRemove.bind(this),this._overlay=l,this._overlay.setMap(e)}_onAdd(){this._deck=u0(this._map,this._overlay,this._deck,this.props)}_onContextRestored({gl:e}){if(!this._map||!this._overlay)return;const n=()=>{this._overlay&&this._overlay.requestRedraw()},r=u0(this._map,this._overlay,this._deck,{gl:e,_customRender:n,...this.props});this._deck=r;const{animationLoop:i}=r;i._renderFrame=()=>{const s=e.getParameter(34964);at(e,{},()=>{i.onRender()}),e.bindBuffer(34962,s)}}_onContextLost(){this._deck&&(Ff(this._deck),this._deck=null)}_onRemove(){var e;(e=this._deck)===null||e===void 0||e.setProps({layerFilter:Ek})}_onDrawRaster(){if(!this._deck||!this._map)return;const e=this._deck,{width:n,height:r,left:i,top:s,...o}=yk(this._map,this._overlay),a=e.getCanvas();if(a!=null&&a.parentElement){const u=a.parentElement.style;u.left="".concat(i,"px"),u.top="".concat(s,"px")}e.setProps({width:n,height:r,viewState:{altitude:1e4,repeat:!0,...o}}),e.redraw()}_onDrawVectorInterleaved({gl:e,transformer:n}){if(!this._deck||!this._map)return;const r=this._deck;if(r.setProps({...c0(this._map,n),width:null,height:null}),r.isInitialized){const i=i_(e,36006);r.setProps({_framebuffer:i}),r.needsRedraw({clearRedrawFlags:!0}),qt(e,{viewport:[0,0,e.canvas.width,e.canvas.height],scissor:[0,0,e.canvas.width,e.canvas.height],stencilFunc:[519,0,255,519,0,255]}),at(e,wk,()=>{r._drawLayers("google-vector",{clearCanvas:!1})})}}_onDrawVectorOverlay({transformer:e}){if(!this._deck||!this._map)return;const n=this._deck;n.setProps({...c0(this._map,e)}),n.redraw()}}const xk=({layers:t})=>{const e=k.useMemo(()=>new bk({interleaved:!0}),[]),n=Mh();return k.useEffect(()=>(e.setMap(n),()=>e.setMap(null)),[e,n]),k.useEffect(()=>{e.setProps({layers:t})},[e,t]),null};function Sk(){return k.createElement("div",{className:"control-panel"},k.createElement("h3",null,"deck.gl Interleaved Overlay Example"),k.createElement("p",null,"An example demonstrating how an interleaved deck.gl overlay can be added to a ",k.createElement("code",null,"<Map>")," component. (using the"," ",k.createElement("code",null,"GoogleMapsOverlay")," from"," ",k.createElement("a",{href:"https://deck.gl/docs/api-reference/google-maps/overview"},"@deck.gl/google-maps"),")."),k.createElement("div",{className:"links"},k.createElement("a",{href:"https://codesandbox.io/s/github/visgl/react-google-maps/tree/main/examples/deckgl-overlay",target:"_new"},"Try on CodeSandbox ↗"),k.createElement("a",{href:"https://github.com/visgl/react-google-maps/tree/main/examples/deckgl-overlay",target:"_new"},"View Code ↗")))}const Pk=k.memo(Sk),Ak="./data.geojson",Lk="AIzaSyBRuzD0vjPUy4w3QIrZ_VODDuN_3yJyz60",Ck=()=>{const[t,e]=k.useState(null),[n,r]=k.useState([]),[i,s]=k.useState([]),[o,a]=k.useState(0),[l,u]=k.useState(0),c={position:"fixed",bottom:"10px",left:"50%",transform:"translateX(-50%)",backgroundColor:"rgba(0, 0, 0, 0.5)",color:"white",padding:"10px",borderRadius:"5px",zIndex:1e3,fontSize:"14px",textAlign:"center"};return k.useEffect(()=>{fetch(Ak).then(f=>f.json()).then(f=>{e(f);const h=Ik(f),d=Mk(h,50);r(d),u(d.length);const p=f.features.filter(y=>y.geometry.type==="LineString").length;a(p);const E=h0(f,2,300),b=h0(f,2,150);s([...E,...b])})},[]),ee.createElement(ee.Fragment,null,ee.createElement(UT,{apiKey:Lk},ee.createElement(Iv,{defaultCenter:{lat:43.67,lng:-79.34},defaultZoom:16,mapId:"4f6dde3310be51d7",gestureHandling:"greedy",disableDefaultUI:!0},ee.createElement(xk,{layers:Nk(t,n,i)})),ee.createElement(Pk,null)),ee.createElement("div",{style:c},"Total Roads: ",o," | Total Intersections: ",l))};function Ik(t){const e={},n=[];return t.features.forEach(r=>{r.geometry.type==="LineString"&&r.geometry.coordinates.forEach(i=>{const s=`${i[0]},${i[1]}`;e[s]?n.push(i):e[s]=i})}),n}function md([t,e],[n,r]){const s=Math.PI/180,o=(r-e)*s,a=(n-t)*s,l=Math.sin(o/2)*Math.sin(o/2)+Math.cos(e*s)*Math.cos(r*s)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)))}function Mk(t,e){const n=[];return t.forEach(r=>{n.some(s=>md(s,r)<e)||n.push(r)}),n}function h0(t,e,n){const r=[],i=[];for(t.features.forEach(s=>{s.geometry.type==="LineString"&&r.push(...s.geometry.coordinates)});i.length<e;){const s=Math.floor(Math.random()*r.length),o=r[s];i.some(l=>md(l,o)<n)||i.push(o)}return i}function Ok(t,e){const n=e.map(o=>md(o,t)),r=Math.min(...n),s=Math.max(0,100-r/300*100);return Rk(s)}function Rk(t){const e=t/100;return[Math.floor(255*e),Math.floor(255*(1-e)),0]}function kk(t,e){const n=e.filter(([u,c])=>Math.abs(u-t[0])<5e-4),r=e.filter(([u,c])=>Math.abs(c-t[1])<5e-4),i=n.length,s=r.length,o=i+s;if(o===0)return{vertical:50,horizontal:50};let a=i/o*100,l=s/o*100;return i===s?(a=50,l=50):(a>90&&(a=90),l>90&&(l=90),a=Math.min(a,90),l=100-a),a=Math.max(10,Math.min(90,a)),l=100-a,console.log(`Intersection at (${t[0]}, ${t[1]}): Vertical Axis Ratio: ${a}%, Horizontal Axis Ratio: ${l}%`),{vertical:a,horizontal:l}}function Nk(t,e,n){return t?(e.forEach(r=>{kk(r,n)}),[new pd({id:"geojson-layer",data:t,stroked:!0,filled:!0,extruded:!1,pointType:"circle",lineWidthScale:2,lineWidthMinPixels:1,getFillColor:[160,160,180,200],getLineColor:r=>!r.geometry.coordinates||r.geometry.coordinates.length===0?[255,255,255]:Ok(r.geometry.coordinates[0],n),getPointRadius:200,getLineWidth:2,getElevation:0}),new jl({id:"scatterplot-layer",data:e,getPosition:r=>r,getRadius:3,getFillColor:[255,0,0],pickable:!0})]):[]}function Fk(t){xv(t).render(ee.createElement(ee.StrictMode,null,ee.createElement(Ck,null)))}Fk(document.querySelector("#app"));
