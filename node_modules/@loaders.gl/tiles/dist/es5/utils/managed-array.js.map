{"version":3,"file":"managed-array.js","names":["_loaderUtils","require","ManagedArray","constructor","length","arguments","undefined","_defineProperty2","default","Map","_array","Array","_length","values","get","index","assert","set","element","_map","has","delete","splice","peek","push","pop","reserve","resize","trim","reset","find","target","exports"],"sources":["../../../src/utils/managed-array.ts"],"sourcesContent":["// This file is derived from the Cesium code base under Apache 2 license\n// See LICENSE.md and https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md\n\nimport {assert} from '@loaders.gl/loader-utils';\n\n/**\n * A wrapper around arrays so that the internal length of the array can be manually managed.\n *\n * @alias ManagedArray\n * @constructor\n * @private\n *\n * @param {Number} [length=0] The initial length of the array.\n */\nexport class ManagedArray {\n  _map = new Map();\n  _array: any[];\n  _length: number;\n\n  constructor(length = 0) {\n    this._array = new Array(length);\n    this._length = length;\n  }\n\n  /**\n   * Gets or sets the length of the array.\n   * If the set length is greater than the length of the internal array, the internal array is resized.\n   *\n   * @memberof ManagedArray.prototype\n   * @type Number\n   */\n  get length() {\n    return this._length;\n  }\n\n  set length(length) {\n    this._length = length;\n    if (length > this._array.length) {\n      this._array.length = length;\n    }\n  }\n\n  /**\n   * Gets the internal array.\n   *\n   * @memberof ManagedArray.prototype\n   * @type Array\n   * @readonly\n   */\n  get values() {\n    return this._array;\n  }\n\n  /**\n   * Gets the element at an index.\n   *\n   * @param {Number} index The index to get.\n   */\n  get(index) {\n    assert(index < this._array.length);\n    return this._array[index];\n  }\n\n  /**\n   * Sets the element at an index. Resizes the array if index is greater than the length of the array.\n   *\n   * @param {Number} index The index to set.\n   * @param {*} element The element to set at index.\n   */\n  set(index, element) {\n    assert(index >= 0);\n\n    if (index >= this.length) {\n      this.length = index + 1;\n    }\n\n    if (this._map.has(this._array[index])) {\n      this._map.delete(this._array[index]);\n    }\n\n    this._array[index] = element;\n    this._map.set(element, index);\n  }\n\n  delete(element) {\n    const index = this._map.get(element);\n    if (index >= 0) {\n      this._array.splice(index, 1);\n      this._map.delete(element);\n      this.length--;\n    }\n  }\n\n  /**\n   * Returns the last element in the array without modifying the array.\n   *\n   * @returns {*} The last element in the array.\n   */\n  peek() {\n    return this._array[this._length - 1];\n  }\n\n  /**\n   * Push an element into the array.\n   *\n   * @param {*} element The element to push.\n   */\n  push(element) {\n    if (!this._map.has(element)) {\n      const index = this.length++;\n      this._array[index] = element;\n      this._map.set(element, index);\n    }\n  }\n\n  /**\n   * Pop an element from the array.\n   *\n   * @returns {*} The last element in the array.\n   */\n  pop() {\n    const element = this._array[--this.length];\n    this._map.delete(element);\n    return element;\n  }\n\n  /**\n   * Resize the internal array if length > _array.length.\n   *\n   * @param {Number} length The length.\n   */\n  reserve(length) {\n    assert(length >= 0);\n\n    if (length > this._array.length) {\n      this._array.length = length;\n    }\n  }\n\n  /**\n   * Resize the array.\n   *\n   * @param {Number} length The length.\n   */\n  resize(length) {\n    assert(length >= 0);\n\n    this.length = length;\n  }\n\n  /**\n   * Trim the internal array to the specified length. Defaults to the current length.\n   *\n   * @param {Number} [length] The length.\n   */\n  trim(length) {\n    if (length === null || length === undefined) {\n      length = this.length;\n    }\n    this._array.length = length;\n  }\n\n  reset() {\n    this._array = [];\n    this._map = new Map();\n    this._length = 0;\n  }\n\n  find(target) {\n    return this._map.has(target);\n  }\n}\n"],"mappings":"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"}