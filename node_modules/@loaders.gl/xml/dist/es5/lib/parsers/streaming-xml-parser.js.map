{"version":3,"file":"streaming-xml-parser.js","names":["_sax","require","StreamingXMLParser","constructor","options","_defineProperty2","default","undefined","Object","freeze","container","key","reset","parser","SAXParser","onready","previousStates","length","currentState","onopentag","_ref","name","attributes","isSelfClosing","_openObject","emit","onkey","onclosetag","_closeObject","onopenarray","_openArray","onclosearray","_closeArray","ontext","value","_pushOrSet","onerror","error","onend","result","pop","write","chunk","close","Array","isArray","push","newContainer","arguments","exports"],"sources":["../../../../src/lib/parsers/streaming-xml-parser.ts"],"sourcesContent":["// @ts-nocheck\n/* eslint-disable */\n\nimport {SAXParser, SAXParserOptions} from '../../sax-ts/sax';\n// import JSONPath from '../jsonpath/jsonpath';\n\nexport type StreamingXMLParserOptions = SAXParserOptions;\n\n/**\n * StreamingXMLParser builds a JSON object using the events emitted by the SAX parser\n */\nexport class StreamingXMLParser {\n  readonly parser: SAXParser;\n  result = undefined;\n  previousStates = [];\n  currentState = Object.freeze({container: [], key: null});\n  // jsonpath: JSONPath = new JSONPath();\n\n  constructor(options: SAXParserOptions) {\n    this.reset();\n    this.parser = new SAXParser({\n      onready: () => {\n        this.previousStates.length = 0;\n        this.currentState.container.length = 0;\n      },\n\n      onopentag: ({name, attributes, isSelfClosing}) => {\n        this._openObject({});\n        if (typeof name !== 'undefined') {\n          this.parser.emit('onkey', name);\n        }\n      },\n\n      onkey: (name) => {\n        this.currentState.key = name;\n      },\n\n      onclosetag: () => {\n        this._closeObject();\n      },\n\n      onopenarray: () => {\n        this._openArray();\n      },\n\n      onclosearray: () => {\n        this._closeArray();\n      },\n\n      ontext: (value) => {\n        this._pushOrSet(value);\n      },\n\n      onerror: (error) => {\n        throw error;\n      },\n\n      onend: () => {\n        this.result = this.currentState.container.pop();\n      },\n\n      ...options\n    });\n  }\n\n  reset(): void {\n    this.result = undefined;\n    this.previousStates = [];\n    this.currentState = Object.freeze({container: [], key: null});\n  }\n\n  write(chunk): void {\n    this.parser.write(chunk);\n  }\n\n  close(): void {\n    this.parser.close();\n  }\n\n  // PRIVATE METHODS\n\n  _pushOrSet(value): void {\n    const {container, key} = this.currentState;\n    if (key !== null) {\n      container[key] = value;\n      this.currentState.key = null;\n    } else if (Array.isArray(container)) {\n      container.push(value);\n    } else if (container) {\n      // debugger\n    }\n  }\n\n  _openArray(newContainer = []): void {\n    // this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: true, key: null};\n  }\n\n  _closeArray(): void {\n    // this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n\n  _openObject(newContainer = {}): void {\n    // this.jsonpath.push(null);\n    this._pushOrSet(newContainer);\n    this.previousStates.push(this.currentState);\n    this.currentState = {container: newContainer, isArray: false, key: null};\n  }\n\n  _closeObject(): void {\n    // this.jsonpath.pop();\n    this.currentState = this.previousStates.pop();\n  }\n}\n"],"mappings":"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"}