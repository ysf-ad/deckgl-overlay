{"version":3,"file":"ion.js","names":["_core","require","_loaderUtils","CESIUM_ION_URL","getIonTilesetMetadata","accessToken","assetId","assets","getIonAssets","item","items","type","id","ionAssetMetadata","getIonAssetMetadata","url","assert","headers","Authorization","concat","response","fetchFile","fetch","ok","Error","statusText","json","metadata","tilesetInfo"],"sources":["../../../../src/lib/ion/ion.ts"],"sourcesContent":["// Minimal support to load tilsets from the Cesium ION services\n\nimport {fetchFile} from '@loaders.gl/core';\nimport {assert} from '@loaders.gl/loader-utils';\n\nconst CESIUM_ION_URL = 'https://api.cesium.com/v1/assets';\n\n// Returns `{url, headers, type, attributions}` for an ion tileset\nexport async function getIonTilesetMetadata(accessToken, assetId) {\n  // Step 1, if no asset id, look for first 3DTILES asset associated with this token.\n  if (!assetId) {\n    const assets = await getIonAssets(accessToken);\n    for (const item of assets.items) {\n      if (item.type === '3DTILES') {\n        assetId = item.id;\n      }\n    }\n  }\n\n  // Step 2: Query metdatadata for this asset.\n  const ionAssetMetadata = await getIonAssetMetadata(accessToken, assetId);\n  const {type, url} = ionAssetMetadata;\n  assert(type === '3DTILES' && url);\n\n  // Prepare a headers object for fetch\n  ionAssetMetadata.headers = {\n    Authorization: `Bearer ${ionAssetMetadata.accessToken}`\n  };\n  return ionAssetMetadata;\n}\n\n// Return a list of all assets associated with accessToken\nexport async function getIonAssets(accessToken) {\n  assert(accessToken);\n  const url = CESIUM_ION_URL;\n  const headers = {Authorization: `Bearer ${accessToken}`};\n  const response = await fetchFile(url, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  return await response.json();\n}\n\n// Return metadata for a specific asset associated with token\nexport async function getIonAssetMetadata(accessToken, assetId) {\n  assert(accessToken, assetId);\n  const headers = {Authorization: `Bearer ${accessToken}`};\n\n  const url = `${CESIUM_ION_URL}/${assetId}`;\n  // https://cesium.com/docs/rest-api/#operation/getAsset\n  // Retrieves metadata information about a specific asset.\n  let response = await fetchFile(`${url}`, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  let metadata = await response.json();\n\n  // https://cesium.com/docs/rest-api/#operation/getAssetEndpoint\n  // Retrieves information and credentials that allow you to access the tiled asset data for visualization and analysis.\n  response = await fetchFile(`${url}/endpoint`, {fetch: {headers}});\n  if (!response.ok) {\n    throw new Error(response.statusText);\n  }\n  const tilesetInfo = await response.json();\n\n  // extract dataset description\n  metadata = {\n    ...metadata,\n    ...tilesetInfo\n  };\n\n  return metadata;\n}\n"],"mappings":";;;;;;;;AAEA,IAAAA,KAAA,GAAAC,OAAA;AACA,IAAAC,YAAA,GAAAD,OAAA;AAEA,MAAME,cAAc,GAAG,kCAAkC;AAGlD,eAAeC,qBAAqBA,CAACC,WAAW,EAAEC,OAAO,EAAE;EAEhE,IAAI,CAACA,OAAO,EAAE;IACZ,MAAMC,MAAM,GAAG,MAAMC,YAAY,CAACH,WAAW,CAAC;IAC9C,KAAK,MAAMI,IAAI,IAAIF,MAAM,CAACG,KAAK,EAAE;MAC/B,IAAID,IAAI,CAACE,IAAI,KAAK,SAAS,EAAE;QAC3BL,OAAO,GAAGG,IAAI,CAACG,EAAE;MACnB;IACF;EACF;EAGA,MAAMC,gBAAgB,GAAG,MAAMC,mBAAmB,CAACT,WAAW,EAAEC,OAAO,CAAC;EACxE,MAAM;IAACK,IAAI;IAAEI;EAAG,CAAC,GAAGF,gBAAgB;EACpC,IAAAG,mBAAM,EAACL,IAAI,KAAK,SAAS,IAAII,GAAG,CAAC;EAGjCF,gBAAgB,CAACI,OAAO,GAAG;IACzBC,aAAa,YAAAC,MAAA,CAAYN,gBAAgB,CAACR,WAAW;EACvD,CAAC;EACD,OAAOQ,gBAAgB;AACzB;AAGO,eAAeL,YAAYA,CAACH,WAAW,EAAE;EAC9C,IAAAW,mBAAM,EAACX,WAAW,CAAC;EACnB,MAAMU,GAAG,GAAGZ,cAAc;EAC1B,MAAMc,OAAO,GAAG;IAACC,aAAa,YAAAC,MAAA,CAAYd,WAAW;EAAE,CAAC;EACxD,MAAMe,QAAQ,GAAG,MAAM,IAAAC,eAAS,EAACN,GAAG,EAAE;IAACO,KAAK,EAAE;MAACL;IAAO;EAAC,CAAC,CAAC;EACzD,IAAI,CAACG,QAAQ,CAACG,EAAE,EAAE;IAChB,MAAM,IAAIC,KAAK,CAACJ,QAAQ,CAACK,UAAU,CAAC;EACtC;EACA,OAAO,MAAML,QAAQ,CAACM,IAAI,CAAC,CAAC;AAC9B;AAGO,eAAeZ,mBAAmBA,CAACT,WAAW,EAAEC,OAAO,EAAE;EAC9D,IAAAU,mBAAM,EAACX,WAAW,EAAEC,OAAO,CAAC;EAC5B,MAAMW,OAAO,GAAG;IAACC,aAAa,YAAAC,MAAA,CAAYd,WAAW;EAAE,CAAC;EAExD,MAAMU,GAAG,MAAAI,MAAA,CAAMhB,cAAc,OAAAgB,MAAA,CAAIb,OAAO,CAAE;EAG1C,IAAIc,QAAQ,GAAG,MAAM,IAAAC,eAAS,KAAAF,MAAA,CAAIJ,GAAG,GAAI;IAACO,KAAK,EAAE;MAACL;IAAO;EAAC,CAAC,CAAC;EAC5D,IAAI,CAACG,QAAQ,CAACG,EAAE,EAAE;IAChB,MAAM,IAAIC,KAAK,CAACJ,QAAQ,CAACK,UAAU,CAAC;EACtC;EACA,IAAIE,QAAQ,GAAG,MAAMP,QAAQ,CAACM,IAAI,CAAC,CAAC;EAIpCN,QAAQ,GAAG,MAAM,IAAAC,eAAS,KAAAF,MAAA,CAAIJ,GAAG,gBAAa;IAACO,KAAK,EAAE;MAACL;IAAO;EAAC,CAAC,CAAC;EACjE,IAAI,CAACG,QAAQ,CAACG,EAAE,EAAE;IAChB,MAAM,IAAIC,KAAK,CAACJ,QAAQ,CAACK,UAAU,CAAC;EACtC;EACA,MAAMG,WAAW,GAAG,MAAMR,QAAQ,CAACM,IAAI,CAAC,CAAC;EAGzCC,QAAQ,GAAG;IACT,GAAGA,QAAQ;IACX,GAAGC;EACL,CAAC;EAED,OAAOD,QAAQ;AACjB"}